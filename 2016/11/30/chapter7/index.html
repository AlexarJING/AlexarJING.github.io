<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="描述">
    

    <!--Author-->
    
        <meta name="author" content="AlexarJING">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="chapter7"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="描述" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Alexar的Love2d实战教程"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>chapter7 - Alexar的Love2d实战教程</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2016/11/30/chapter7/">
                chapter7
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2016-11-30</span>
            
            <a href="#disqus_thread" class="comments">评论</a>
            
                <span class="category">
                    <a href="/categories/初级教程/">初级教程</a>
                </span>
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <p>本章内容：前面的学习基本完成了制作简单游戏所有必备的知识，案例也几乎就是完整的小游戏了。但是随着我们代码量的增加，我们发现使用单一的文档结构看起来比较混乱，不再能够满足我们的项目了，这章我们讲解如何把一个项目合理的进行文件布局。同时，我们会看一些库文件的代码，来让他们更加规范的加入到我们的项目。<br><a id="more"></a></p>
<h1 id="游戏文档结构以及库使用规范"><a href="#游戏文档结构以及库使用规范" class="headerlink" title="游戏文档结构以及库使用规范"></a>游戏文档结构以及库使用规范</h1><p>文档结构，看起来很高大上的样子，实际上就是你怎么安排你的文件更加合理，合理的理解为你想找的东西，你一下子就能找到。而每个人的思维习惯不同，这也导致文档结构的千差万别，下面介绍的，仅仅是笔者对文档结构的一个习惯性安排，读者可以根据自身需求安排自己想要的模式。</p>
<h2 id="文档架构"><a href="#文档架构" class="headerlink" title="文档架构"></a>文档架构</h2><ol>
<li>conf.lua<br>从读取顺序来讲，这个文件是最先读取的，它的作用是在引擎初始化时，对其进行设置。各个设置请自行wiki。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">io.stdout:setvbuf(&quot;no&quot;)</div></pre></td></tr></table></figure>
</li>
</ol>
<p>这个代码一般我加入到conf里，它控制着print这种标准输出是否缓存。如果缓存的话，只有当缓存溢出或结束时才会输出。这种是为了避免过多的文件读写。但我们print主要用于debug，所以要关闭缓存。</p>
<ol>
<li><p>main.lua<br>个人喜好上，把所有需要引用的库以及全局变量放到这里。避免在此文件以外定义全局变量。过多的全局变量不但会增加代码出错的因素，而且会降低效率。</p>
</li>
<li><p>场景库以及场景<br>一般而言，游戏是分场景的，比如入场的splash（中文咋说，就是商标，团队图标等淡入淡出），游戏开始菜单，游戏场景，结束画面等。下面解释一下场景库的原理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">state = &#123;&#125;</div><div class="line">state[1] = &#123;</div><div class="line">	load = function() print(&quot;load1&quot;)end,</div><div class="line">	enter = function() print(&quot;enter1&quot;) end,</div><div class="line">	update = function() print(&quot;update1&quot;) end,</div><div class="line">	draw = function() print(&quot;draw1&quot;) end,</div><div class="line">	leave = function() print(&quot;leave1&quot;) end,</div><div class="line">&#125;</div><div class="line"></div><div class="line">state[2] = &#123;</div><div class="line">	load = function() print(&quot;load2&quot;)end,</div><div class="line">	enter = function() print(&quot;enter2&quot;) end,</div><div class="line">	update = function() print(&quot;update2&quot;) end,</div><div class="line">	draw = function() print(&quot;draw2&quot;) end,</div><div class="line">	leave = function() print(&quot;leave1&quot;) end,</div><div class="line">&#125;</div><div class="line"></div><div class="line">for i,v in ipairs(state) do</div><div class="line">	state[i]:load()	</div><div class="line">end</div><div class="line"></div><div class="line">local cStateIndex =1</div><div class="line"></div><div class="line">function setState(index)</div><div class="line">	state[cStateIndex]:leave()</div><div class="line">	local current = state[index]</div><div class="line">	current:enter()</div><div class="line">	love.update = current.update</div><div class="line">	love.draw = current.draw</div><div class="line">	cStateIndex = index</div><div class="line">end</div><div class="line"></div><div class="line">setState[2]</div></pre></td></tr></table></figure>
</li>
</ol>
<p>解读一下上面的代码，首先定义了两个state，他们相当于两个场景，他们都有各自的load,update,draw方法，对应着love的回调，但是又多了一个enter方法和一个leave方法。他们意思是进入和退出场景时的回调。<br>然后对每一个场景进行load，当然，你也可以动态的load，只不过尚未读取的场景是不能被使用的。<br>接下来是设置场景的方法setState，从函数内部我们可以看出，它实际上是动态的赋予love.update和love.draw于我们场景对应的方法，从而实现场景跳转。当然，还有从上一个场景离开和新场景进入的方法。<br>上面的代码仅仅是为了解释场景的工作原理，除了update,draw之外，所有love回调都需要被重新定向。比较完整的场景库之一hump.gamestate是笔者比较喜欢的场景库，下面有一段我惯用的导入场景的方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">gamestate= require &quot;lib/hump/gamestate&quot;</div><div class="line">function love.load()</div><div class="line">    gameState=&#123;&#125;</div><div class="line">    for _,name in ipairs(love.filesystem.getDirectoryItems(&quot;scene&quot;)) do</div><div class="line">        local filename = name:sub(1,-5) --“.lua”四个字符</div><div class="line">        gameState[filename]=require(&quot;scene.&quot;..filename)</div><div class="line">    end</div><div class="line">    gamestate.registerEvents()</div><div class="line">    gamestate.switch(gameState.splash)</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>上面的代码的含义是我们从scene文件夹中读取所有文件，除去.lua四个字符为名字，定义场景。然后跳转场景到splash场景。这里有个filesystem的方法。这里只知道含义即可。</p>
<ol>
<li><p>文件夹<br>上面说到了scene文件夹，我们就系统说一下我的一般项目文件夹的排布，当然并不是统一的，根据自己的喜好来。<br>首先，我们知道main.lua和conf.lua只有放在根目录下才能发挥作用。这个不变。<br>然后是library目录，里面存放第三方或者自己写的库文件。至于库文件的规范待会说。<br>然后是scene目录，存放各种场景文件。<br>接下来asset目录，存放各种资源，包括image,sound,mucis,font,tile,spine等子目录。<br>然后是object目录，存放游戏对象的类模板。<br>最后是misc目录，各种各样的单个脚本，或者不适合放在其他目录的文件。<br>当然，上面是以类型为分类的，也可以以游戏对象为分类，把一种游戏对象的资源放在一个文件夹下。如game目录，player目录，enemy目录等，将类文件，素材文件，读取脚本等都放在一起。</p>
</li>
<li><p>文件和库的导入。<br>lua的require机制需要比较熟悉，require的参数为一个lua文件，且不含.lua文件拓展名。其实现的实际上是下面代码：<br>local abc = require “file” 等价于<br>local func = function()  文件内容 end<br>local abc = func(path/to/file)<br>你需要理解的是:<br>首先，任何单独的lua文件都是被看做一个function的，如果你在文件中不注册全局变量也没有返回值，那他不会对其他文件产生污染。也就是要么你在文件中写个全局变量或者注册在全局变量下，比如love.yourlib,要么你需要有一个返回值return，不然你的文件等于0。</p>
</li>
</ol>

    </div>

    

    

    <!-- Comments -->
    
    <div class="comments">
        
<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="love2d" data-title="love2d" data-url="alexarjing.github.io"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"love2d"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->




    </div>
    

</div>
        </section>

    </div>
</div>

</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>关于</h2>
                <p>
                    本教程配套软件:<a href="https://alexarjing.github.io/tutorial.love">tutorial.love</a>. 请安装love环境使用。
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>最近发表</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2016/11/30/chapter7/">chapter7</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016/11/30/chapter6/">第6章 动画与音效</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016/11/29/chapter5/">第5章 游戏对象</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016/11/28/chapter4/">第4章 碰撞检测及反馈</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>分类</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/初级教程/">初级教程</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/klugjo/hexo-theme-alpha-dust">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://twitter.com/?lang=en">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.facebook.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.instagram.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://dribbble.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://plus.google.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-google-plus"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.behance.net/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://500px.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:alexar@foxmail.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    本文作者Alexar alexar@foxmail.com; 原创内容禁止转载。作者保留一切权利。
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->





</body>

</html>