<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="描述">
    

    <!--Author-->
    
        <meta name="author" content="AlexarJING">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="第4章 碰撞检测及反馈"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="描述" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Alexar的Love2d实战教程"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>第4章 碰撞检测及反馈 - Alexar的Love2d实战教程</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    主页
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    文章
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    关于
                </a>
            </li>
            
            <li class="menu-item">
                <a href="http://webchat.oftc.net/?channels=Alexar&uio=d4">
                    交流
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    联系
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
    </div>
    <script>
		(function(){
		    var bp = document.createElement('script');
		    var curProtocol = window.location.protocol.split(':')[0];
		    if (curProtocol === 'https') {
		        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
		    }
		    else {
		        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
		    }
		    var s = document.getElementsByTagName("script")[0];
		    s.parentNode.insertBefore(bp, s);
		})();
	</script>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2016/11/28/chapter4/">
                第4章 碰撞检测及反馈
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2016-11-28</span>
            
            <a href="#disqus_thread" class="comments">评论</a>
            
                <span class="category">
                    <a href="/categories/初级教程/">初级教程</a>
                </span>
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <p>本章内容：运用了之前的知识，我们应该可以很随意的移动我们的游戏对象了，当然还有其他移动游戏对象的方法，实际也是基于前面讲的内容，比如一个像魂斗罗里来回旋转的那种子弹。既然提到了子弹，我们就不得不开始游戏的另一个重要构成，碰撞。<br><a id="more"></a></p>
<h1 id="碰撞检测及反馈"><a href="#碰撞检测及反馈" class="headerlink" title="碰撞检测及反馈"></a>碰撞检测及反馈</h1><p>碰撞对于游戏而言往往并不是我们通常的物理碰撞，而是只任何两个游戏对象，有所交叠。一般而言，碰撞测试的结果只有两个，真或假。<br>2d游戏的碰撞的种类主要可以分为碰撞球，碰撞盒及多边形碰撞。而对于每一种碰撞，能够提供的检测方式有点测试，面交叠，射线测试几种。下面我们分别来介绍一下。</p>
<h2 id="碰撞球"><a href="#碰撞球" class="headerlink" title="碰撞球"></a>碰撞球</h2><p>碰撞球的意思是，把任何需要感知碰撞的物体，绑定在一个球上（平面上是圆），这个球最好能尽可能多的覆盖游戏对象，并且尽可能少的溢出游戏对象。任何与这个球发生碰撞，就相当于与这个游戏对象发生了碰撞。<br>这种碰撞方式，从感官上是最为简单的，因为它仅仅涉及连个变量，一个是圆心的位置，一个是圆半径。两个球如何碰撞？自然是两个球的距离小于等于两个球的半径之和了。对于碰撞球而言，最关键的部分在于到圆心的距离。<br>所以对于点是否在球上则有<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">function dist(x1,y1,x2,y2) --两点间距离公式</div><div class="line">	return math.sqrt((x1-x2)^2+(y1-y2)^2)</div><div class="line">end</div><div class="line">function pointTest(x,y,ox,oy,r) -- 待测试点，碰撞球圆心及半径</div><div class="line">	return dist(x,y,ox,oy)&lt;=r</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>对于两圆是否碰撞则有<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">function bodyTest(x1,y1,r1,x2,y2,r2)</div><div class="line">	return dist(x1,y1,x2,y2)&lt;= r1+r2</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>对于直线与圆是否碰撞有<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">function pointToLine(a,b,c,x,y)</div><div class="line">  return math.abs(a*x+b*y+c)/math.sqrt(a*a+b*b)</div><div class="line">end</div><div class="line">function getLineABC(x,y,tx,ty)</div><div class="line">	local a = (ty-y)/(tx-x)</div><div class="line">	local b = -1</div><div class="line">	local c = -x*a+y</div><div class="line">	return a,b,c</div><div class="line">end</div><div class="line"></div><div class="line">function lineTest(x1,y1,x2,y2,ox,oy,r)</div><div class="line">	local a,b,c = getLineABC(x1,y1,x2,y2)</div><div class="line">	return pointToLine(a,b,c,ox,oy)&lt;= r</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>线到圆公式用向量计算更为简便。这里仅用最基本几何计算。具体过程不再详细描述。<br>碰撞球的优点在于变量较少，无偏移计算（圆心即为中心）,比较容易理解。缺点在于，仅能支持形状比较规则，接近圆的物体，碰撞计算涉及乘方和开方计算量大，拓展性很差。</p>
<h2 id="碰撞盒"><a href="#碰撞盒" class="headerlink" title="碰撞盒"></a>碰撞盒</h2><p>碰撞盒是最常见的碰撞形式了，经常听到的AABB指的就是它，就是把物体的轮廓抽象为矩形，并用它来检测跟其他碰撞盒的互动。<br>碰撞盒需要提供的是，物体所在的矩形，实际上需求的是ltrb(left,top,right,bottom),即左上角和右下角的坐标。而判断的方式很简单，就是作比较。</p>
<p>一个点和碰撞盒进行碰撞检测。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">function pointTest(x,y,l,t,r,b)</div><div class="line">	if x&lt; l or x&gt; r or y&lt; t or y&gt;b then return end</div><div class="line">	return true</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>这里有个小技巧就是“提前退出”,有的时候，不需要把所有情况都计算到，能提早结束就提早结束。所以使用or而非使用and.<br>两个碰撞盒间碰撞。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">function bodyTest(Al,At,Ar,Ab,Bl,Bt,Br,Bb)</div><div class="line">	if pointTest(Al,At,Bl,Bt,Br,Bb) </div><div class="line">		or pointTest(Ar,At,Bl,Bt,Br,Bb) </div><div class="line">		or pointTest(Al,Ab,Bl,Bt,Br,Bb) </div><div class="line">		or pointTest(Ar,Ab,Bl,Bt,Br,Bb)  then</div><div class="line">		return true</div><div class="line">	end</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>意思是，对于A来讲，任意一个点如果跟B发生碰撞则碰撞。当然，还要考虑到包含关系，如果A正好圈到B外面，那么A的所有点跟B都不会碰撞，但是他们会交叠，因此，要以较大的形状作为点测试对象。以及要考虑那种两个矩形无顶点交叠只有中间交叠的情况。更标准的做法是用轴检测：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">function bodyTest(Al,At,Ar,Ab,Bl,Bt,Br,Bb)</div><div class="line">	if Ab &lt; Bt or Bb &lt; At then return end</div><div class="line">	if Ar &gt; Bl or Br &lt; Al then return end</div><div class="line">	return true</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>这里还是提前退出机制，如果a顶在b顶之上，而a的底还在b的顶之上则，a整个图形都在b之上，不相交。<br>同理，</p>
<p>碰撞盒的射线，这里暂时不写，之所以给出上面一些代码，并不是说让你们在实际游戏中直接拿来用，而是将通一些原理，方便你能够更好的理解别人的库，以及自己做些简单的应用库。</p>
<h2 id="多边形碰撞"><a href="#多边形碰撞" class="headerlink" title="多边形碰撞"></a>多边形碰撞</h2><p>多边形碰撞实际上更加符合现实的情形，只不过对于一般游戏而言，往往不必要那么精确，因为精确意味着更大的计算量，更大的散热，甚至游戏的卡顿。由于多边形的碰撞更加复杂，这里暂时对原理部分不再过多阐述了，仅仅提供一个常用的多边形点测试。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">function pointTest(x,y,verts)</div><div class="line">	local pX=&#123;&#125;</div><div class="line">	local pY=&#123;&#125;</div><div class="line">	for i=1,#verts,2 do</div><div class="line">		table.insert(pX, verts[i])</div><div class="line">		table.insert(pY, verts[i+1])</div><div class="line">	end</div><div class="line">	local oddNodes=false</div><div class="line">	local pCount=#pX</div><div class="line">	local j=pCount</div><div class="line">	for i=1,pCount do</div><div class="line">		if ((pY[i]&lt; y and pY[j]&gt;=y) or (pY[j]&lt; y and pY[i]&gt;=y))</div><div class="line">			and (pX[i]&lt;=x or pX[j]&lt;=x) then</div><div class="line">			if pX[i]+(y-pY[i])/(pY[j]-pY[i])*(pX[j]-pX[i])&lt; x then</div><div class="line">				oddNodes=not oddNodes</div><div class="line">			end</div><div class="line">		end</div><div class="line">		j=i</div><div class="line">	end</div><div class="line">	return oddNodes</div><div class="line">end</div></pre></td></tr></table></figure>
<h2 id="矩阵碰撞"><a href="#矩阵碰撞" class="headerlink" title="矩阵碰撞"></a>矩阵碰撞</h2><p>这种碰撞主要用于过去老式的矩阵游戏机，比如俄罗斯方块。不过现在也有个别用像素是否填充作为碰撞标的。如果对于小的矩阵还是可以的，但是如果是动辄1080p的画面来讲，就很不经济了，而且像素往往也不太能够携带额外的信息。这种像素级的检测方式逐渐发展为后文的网格碰撞策略。</p>
<h2 id="碰撞优化策略"><a href="#碰撞优化策略" class="headerlink" title="碰撞优化策略"></a>碰撞优化策略</h2><p>由于碰撞的检测往往要遍历大量的游戏对象，进行较大的计算，为了避免一些不必要的碰撞检测，因此成熟的碰撞库往往都进行了策略的优化，这里仅仅介绍两种。<br>一种是分格的策略，由于很多物体距离很远，根本不需要进行很精细的碰撞检测，因此先把所有单位划分到大的格子中，碰撞检测仅在相邻的格子中所有的单位间进行。<br>另外一种是行为策略，仅当一个物体移动时，才跟其他进行碰撞检测，否则不进行检测（休眠）。</p>
<h2 id="碰撞反馈"><a href="#碰撞反馈" class="headerlink" title="碰撞反馈"></a>碰撞反馈</h2><p>碰撞反馈是单位之间发生碰撞后，由程序自动设定的一些行为。碰撞反馈实际包含两个方面。一个方面是碰撞行为，另一个是碰撞用户界面。<br>碰撞行为是指，当检测到物体碰撞时，物体之间的位置如何设置。比如，当两个碰撞盒有交叠是，是让他们保持交叠的样子，还是退到两个相接的情况，还是反弹交叠的距离。这是三种最典型的碰撞行为，分别用常用的，“cross”,”slide”,”bounce”来指代上面的情形。注意,这个碰撞行为，仅仅控制物体的位置，对物体运行速度并没有干预。实际上，除了有物理成分的碰撞库，其他都不会对你物体的速度有影响，仅仅是对当前的位置进行判断。<br>碰撞用户界面是指，当发生碰撞时，把控制权交给用户，来处理如何影响物体的速度，行为等。这种控制权有两种形式，一种是以回调形式的，即一旦发生碰撞，碰撞的对象将以参数的形式激活回调，用户在回调内编程。另一种是，系统将发生碰撞的单位以列表形式传回来，本质上都是一样的。<br>对于物理碰撞引擎（库）而言，碰撞反馈是在定义碰撞体时就设定好了的。有些碰撞库则需要更多的手动控制。</p>
<h2 id="碰撞的一般流程"><a href="#碰撞的一般流程" class="headerlink" title="碰撞的一般流程"></a>碰撞的一般流程</h2><p>对于游戏而言，碰撞有如下流程：</p>
<ol>
<li>引入碰撞库；当然如果你没使用碰撞库的化，就要自己写碰撞程序。</li>
<li>启动碰撞世界，碰撞世界和游戏世界是两个概念，因为碰撞世界里只有碰撞体，游戏世界是游戏对象，他们之间有相互的引用保持联系，一个世界不会直接干预另一个世界。</li>
<li>对游戏对象绑定碰撞体，碰撞体最好能贴合游戏对象，这样更加真实。在初始化时，游戏对象在游戏世界的位置（x,y坐标），与碰撞世界的位置保持一致。</li>
<li>游戏对象移动控制。由于对于大多情况，游戏对象的坐标与物理对象坐标并不一致。需要用一个专门的代码来同步。保证当移动了一个世界物体时，另一个世界也能做出相应的反馈。</li>
<li>物理世界更新，物理世界更新主要是更新物理世界对象的速度，位置，碰撞检测，内置的碰撞回馈等等。</li>
<li>碰撞处理，当发生碰撞时，游戏世界发生了什么，碰撞后，游戏世界和物理世界如何行为。这是这里要解决的问题。</li>
<li>同步物理世界与游戏世界。跟上面一样，只不过这次是从物理世界到游戏世界。</li>
<li>游戏对象删除是一定要删除物理对象，否则物理对象将留在物理世界里，从而对碰撞产生影响。</li>
</ol>
<h2 id="边缘检测"><a href="#边缘检测" class="headerlink" title="边缘检测"></a>边缘检测</h2><p>边缘检测实际上是一种特殊的碰撞，世界到了边了，如何处理呢？有一些是让他们看起来围成一个圈，就是从左边出去，从右边回来。有的让他们碰到边界了就不能再往外移动了，有的是碰到边界又反弹回来。从统一性来讲，可以在物理世界做一个叫做边界的物体，并赋予相应行为。也可以用单独的程序控制，如果选择后者，别忘了同步物理世界和游戏世界。</p>
<h2 id="碰撞跳跃"><a href="#碰撞跳跃" class="headerlink" title="碰撞跳跃"></a>碰撞跳跃</h2><p>由于游戏的物理是非线性的，而是离散的，物体的移动是非连续的，所以，很有可能前一帧没有碰撞，后一帧也没有碰撞，但是中间穿过了一个本应发生碰撞的物体，这种现象经常发生在物体移动速度过快上。当然过快的移动，往往导致屏幕上也仅仅是一闪而过。为了避免这种情况，比如子弹来讲，就不再使用实体子弹碰撞了，而是采用射线检测。不过射线检测的效率往往比一般低多了。</p>
<h2 id="Love常用的碰撞库"><a href="#Love常用的碰撞库" class="headerlink" title="Love常用的碰撞库"></a>Love常用的碰撞库</h2><p>下面介绍几种love常用的碰撞库，还是像之前所说的，先当作黑箱来用，我们编程能力高了之后，再去理解内部实现以及自己订制和修改库。</p>
<h3 id="box2d"><a href="#box2d" class="headerlink" title="box2d"></a>box2d</h3><p>box2d是love内建的物理库，在love.physics下。box2d是一个开源的C++物理引擎，用来模拟物理效果和行为的。比较出名的愤怒的小鸟，割绳子，粘粘世界等游戏都用了这个物理引擎。当然还有比较直接的应用，比如物理蜡笔等等。box2d有别一般碰撞检测库在于它不但能够侦测物体碰撞，而且能够仿真的模拟物体碰撞结果，以及各种受力情况。因此使用了物理引擎的游戏在碰撞表现上更加真实。我们使用box2d，实际上就是跟box2d的各种对象打交道，它主要的对象有以下几种，世界，刚体，形状，部件，连接，碰撞。我们通过创建这些对象，赋予他们属性，使用他们的方法来实现物理模拟。<br>关于box2d的内容，笔者有一个小工具角Alexar的box2d编辑器。在笔者github上可以下载。这个编辑器可以可视编辑box2d碰撞体，可以导出或导入场景，编辑脚本等等。有兴趣的同学可以去看一下，内部的文档也算齐全，理解起来应该没有问题。<br>就像在lovewiki中讲的，对于一般的碰撞情形而言，使用box2d就像用一个巨型大锤来敲一个图钉，可以是可以，没有必要。因为box2d的使用并不算十分容易。即使你包装了原来的api。只有当你想要真实的物理模拟时（主要是多边形碰撞，圆形碰撞以及他们的物理反馈，包括摩擦，弹性等等。），才用得上。</p>
<h3 id="bump"><a href="#bump" class="headerlink" title="bump"></a>bump</h3><p>bump是一个很小巧的碰撞库，仅仅适用于碰撞盒碰撞。所以别想着它能够用来绑定其他形状的物体，或者旋转。它真的不能。<br>它的很大一个特点是，并直接在update里面进行物理世界的更新，而是在每一次物体移动时进行碰撞检测。</p>
<h3 id="HC-HardonCollider"><a href="#HC-HardonCollider" class="headerlink" title="HC-HardonCollider"></a>HC-HardonCollider</h3><p>hc是一个十分强大的碰撞库，只要你不要求物理行为，完全可以替代box2d在碰撞时的作用。它支持多边形和旋转。经过几次改版，从原来的对象式的转变为立即式的编程模式，有些人用不习惯，其实很好用啦。以后我会开设专题来讲解面向对象式编程和面向组件式编程的各自特点。</p>
<p>上面的库的文档十分齐全，在编程上基本都是大同小异的，只所以上面码了这么多文字，看起来很枯燥，为的是在对碰撞有了较深入的理解后，你们可以快速的上手不同的碰撞库，比较他们的区别，然后有选择的去使用他们。</p>
<h2 id="编程时间"><a href="#编程时间" class="headerlink" title="编程时间"></a>编程时间</h2><p>了解到碰撞是什么后，我们可以更加丰富的展现人机互动了。我们这次来实现一个很经典的游戏。乒乓。关于这个游戏的历史，请自行百度吧。</p>
<h3 id="设计阶段"><a href="#设计阶段" class="headerlink" title="设计阶段"></a>设计阶段</h3><ol>
<li>做一个球桌，用线框画出来，球碰到球桌边界时，会反弹。</li>
<li>做两个球拍，分别用w，s 和 上下键控制，注意，球拍不能移出球桌边缘。</li>
<li>做一个球，开始时给球一个向左的初速度。</li>
<li>球与球拍接触时反弹，并给予球一个球拍移动方向的冲量（改变速度）</li>
<li>计分系统，每一次球与球拍接触，就给球拍加分。<br>我们的碰撞算法决定使用手动的碰撞盒来模拟。手动的边缘检测。球拍的控制已经很容易了，这里不多说。<br>我们动手开整。</li>
</ol>
<h3 id="实现阶段"><a href="#实现阶段" class="headerlink" title="实现阶段"></a>实现阶段</h3><p>首先是球桌对象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">local board = &#123;</div><div class="line">	x = 0, --为了方便，我们把球桌就定为窗体了。</div><div class="line">	y = 0,</div><div class="line">	w = 800,</div><div class="line">	h = 600</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后是球，因为我们不希望球能够有加速度，比如重力（因为这个是个俯视游戏），所以只考虑匀速状态。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">local ball = &#123;</div><div class="line">	x = 400,</div><div class="line">	y = 300,</div><div class="line">	r = 20, --画面为20的圆，但是物理世界是40*40的矩形</div><div class="line">	 --它的碰撞盒是以球位置为中心的一个正方形。</div><div class="line">	l = -20,</div><div class="line">	t = -20,</div><div class="line">	r = 20,</div><div class="line">	b = 20,</div><div class="line">	</div><div class="line">	vx = -2,</div><div class="line">	vy = 0</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后是球拍，因为暂时我们还不接触面对对象编程，所以球拍仅仅是数据而且不能被继承。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">local leftPad = &#123;</div><div class="line">	x = 100,</div><div class="line">	y = 300,</div><div class="line">	w = 30,</div><div class="line">	h = 150,</div><div class="line">	</div><div class="line">	l = -15,</div><div class="line">	t = -75,</div><div class="line">	r = 15,</div><div class="line">	b = 75,</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line">local rightPad = &#123;</div><div class="line">	x = 700,</div><div class="line">	y = 300,</div><div class="line">	w = 30,</div><div class="line">	h = 150,</div><div class="line">	</div><div class="line">	l = -15,</div><div class="line">	t = -75,</div><div class="line">	r = 15,</div><div class="line">	b = 75</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>对象已经建立好啦，我们让各种对象能够移动起来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">function keyTest()</div><div class="line">	local down = love.keyboard.isDown</div><div class="line">	if down(&quot;w&quot;) then</div><div class="line">		leftPad.y = leftPad.y - 1</div><div class="line">		leftPad.vy = -1</div><div class="line">		if leftPad.y - leftPad.h/2 &lt; board.y then --边界</div><div class="line">			leftPad.y = leftPad.h</div><div class="line">		end</div><div class="line">	elseif down(&quot;s&quot;) then</div><div class="line">		leftPad.y = leftPad.y + 1</div><div class="line">		leftPad.vy = 1</div><div class="line">		if leftPad.y + leftPad.h/2 &gt; board.y + board.h then</div><div class="line">			leftPad.y = board.h + board.y - leftPad.h/2</div><div class="line">		end</div><div class="line">	else</div><div class="line">		leftPad.vy = 0</div><div class="line">	end</div><div class="line"></div><div class="line"></div><div class="line">	if down(&quot;up&quot;) then</div><div class="line">		rightPad.y = rightPad.y - 1</div><div class="line">		rightPad.vy = -1</div><div class="line">		if rightPad.y - rightPad.h/2 &lt; board.y then --边界</div><div class="line">			rightPad.y = rightPad.h</div><div class="line">		end</div><div class="line">	elseif down(&quot;down&quot;) then</div><div class="line">		rightPad.y = rightPad.y + 1</div><div class="line">		rightPad.vy = 1</div><div class="line">		if rightPad.y + rightPad.h/2 &gt; board.y + board.h then</div><div class="line">			rightPad.y = board.h + board.y - rightPad.h/2</div><div class="line">		end</div><div class="line">	else</div><div class="line">		rightPad.vy = 0</div><div class="line">	end</div><div class="line">end</div><div class="line"></div><div class="line">function ballMove()</div><div class="line">	ball.x = ball.x + ball.vx</div><div class="line">	ball.y = ball.y + ball.vy</div><div class="line">	if ball.x-ball.r &lt; board.x then</div><div class="line">		ball.x = ball.r + board.x</div><div class="line">		ball.vx = - ball.vx</div><div class="line">	elseif ball.x + ball.r &gt; board.w + board.x then</div><div class="line">		ball.x = board.x + board.w - ball.r</div><div class="line">		ball.vx = - ball.vx</div><div class="line">	end</div><div class="line"></div><div class="line">	if ball.y-ball.r &lt; board.y then</div><div class="line">		ball.y = ball.r + board.y</div><div class="line">		ball.vy = - ball.vy</div><div class="line">	elseif ball.y + ball.r &gt; board.h + board.y then</div><div class="line">		ball.y = board.y + board.h - ball.r</div><div class="line">		ball.vy = - ball.vy</div><div class="line">	end</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>下面就进入碰撞阶段了，因为本案例游戏对象只有3个（能动的），所以直接进行判断了，而不是遍历。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">function pointTest(x,y,l,t,r,b)</div><div class="line">	if x&lt; l or x&gt; r or y&lt; t or y&gt;b then return end</div><div class="line">	return true</div><div class="line">end</div><div class="line"></div><div class="line">function bodyTest(Al,At,Ar,Ab,Bl,Bt,Br,Bb)</div><div class="line">	if pointTest(Al,At,Bl,Bt,Br,Bb) </div><div class="line">		or pointTest(Ar,At,Bl,Bt,Br,Bb) </div><div class="line">		or pointTest(Al,Ab,Bl,Bt,Br,Bb) </div><div class="line">		or pointTest(Ar,Ab,Bl,Bt,Br,Bb)  then</div><div class="line">		return true</div><div class="line">	end</div><div class="line">end</div><div class="line"></div><div class="line"></div><div class="line">function leftCollTest()</div><div class="line">	local al, at, ar, ab = </div><div class="line">		ball.x + ball.l, ball.y + ball.t, ball.x + ball.r, ball.y + ball.b</div><div class="line">	local bl, bt, br, bb = </div><div class="line">		leftPad.x - leftPad.w/2</div><div class="line">		leftPad.y - leftPad.h/2</div><div class="line">		leftPad.x + leftPad.w/2</div><div class="line">		leftPad.y + leftPad.h/2</div><div class="line">	local coll = bodyTest(al, at, ar, ab,bl, bt, br, bb)</div><div class="line">	if coll then</div><div class="line">		ball.vx = -ball.vx</div><div class="line">		ball.vy = ball.vy + leftPad.vy/2</div><div class="line">	end</div><div class="line">end</div><div class="line"></div><div class="line"></div><div class="line">function rightCollTest()</div><div class="line">	local al, at, ar, ab = </div><div class="line">		ball.x + ball.l, ball.y + ball.t, ball.x + ball.r, ball.y + ball.b</div><div class="line">	local bl, bt, br, bb = </div><div class="line">		rightPad.x - rightPad.w/2</div><div class="line">		rightPad.y - rightPad.h/2</div><div class="line">		rightPad.x + rightPad.w/2</div><div class="line">		rightPad.y + rightPad.h/2</div><div class="line">	local coll = bodyTest(al, at, ar, ab,bl, bt, br, bb)</div><div class="line">	if coll then</div><div class="line">		ball.vx = -ball.vx</div><div class="line">		ball.vy = ball.vy + rightPad.vy/2</div><div class="line">	end</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>好啦碰撞做好了，我们就可以绘制所有物品了，这里不再赘述，放到后面代码自己查看。<br>上述代码并不是最终的库，但是解释了一些碰撞的原理。我希望大家回头可以仔细研究下别人比较成熟的碰撞库，最终能够为自己所用。</p>
<h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><ol>
<li>自行阅读bump的案例和文档，使用bump库来完成本课的案例。</li>
<li>既然会碰撞了，我们试着做一个方块马里奥跑酷吧，前面的课程可以让他跳跃，今天的课程可以让他跳到障碍物上了。也许现在有些困难，没关系，我们要勇于尝试，至少把自己能做出的东西做出来。</li>
<li>试着用box2d来完成今天的案例，体会不同碰撞库的代码形式及特点。</li>
</ol>
<h2 id="本章代码"><a href="#本章代码" class="headerlink" title="本章代码"></a>本章代码</h2><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">love.load</span><span class="params">()</span></span></div><div class="line">	board = &#123;</div><div class="line">		x = <span class="number">0</span>, <span class="comment">--为了方便，我们把球桌就定为窗体了。</span></div><div class="line">		y = <span class="number">0</span>,</div><div class="line">		w = <span class="number">800</span>,</div><div class="line">		h = <span class="number">600</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	ball = &#123;</div><div class="line">		x = <span class="number">400</span>,</div><div class="line">		y = <span class="number">300</span>,</div><div class="line">		r = <span class="number">20</span>, <span class="comment">--画面为20的圆，但是物理世界是40*40的矩形</span></div><div class="line">		</div><div class="line">		l = <span class="number">-20</span>,</div><div class="line">		t = <span class="number">-20</span>,</div><div class="line">		r = <span class="number">20</span>,</div><div class="line">		b = <span class="number">20</span>,</div><div class="line">	</div><div class="line">		vx = <span class="number">-4</span>,</div><div class="line">		vy = <span class="number">0</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	leftPad = &#123;</div><div class="line">		x = <span class="number">100</span>,</div><div class="line">		y = <span class="number">300</span>,</div><div class="line">		w = <span class="number">30</span>,</div><div class="line">		h = <span class="number">150</span>,</div><div class="line">		</div><div class="line">		l = <span class="number">-15</span>,</div><div class="line">		t = <span class="number">-75</span>,</div><div class="line">		r = <span class="number">15</span>,</div><div class="line">		b = <span class="number">75</span>,</div><div class="line">		</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	rightPad = &#123;</div><div class="line">		x = <span class="number">700</span>,</div><div class="line">		y = <span class="number">300</span>,</div><div class="line">		w = <span class="number">30</span>,</div><div class="line">		h = <span class="number">150</span>,</div><div class="line">		</div><div class="line">		l = <span class="number">-15</span>,</div><div class="line">		t = <span class="number">-75</span>,</div><div class="line">		r = <span class="number">15</span>,</div><div class="line">		b = <span class="number">75</span>,</div><div class="line">		</div><div class="line">	&#125;</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">keyTest</span><span class="params">()</span></span></div><div class="line">	<span class="keyword">local</span> down = love.keyboard.isDown</div><div class="line">	<span class="keyword">if</span> down(<span class="string">"w"</span>) <span class="keyword">then</span></div><div class="line">		leftPad.y = leftPad.y - <span class="number">2</span></div><div class="line">		leftPad.vy = <span class="number">-2</span></div><div class="line">		<span class="keyword">if</span> leftPad.y - leftPad.h/<span class="number">2</span> &lt; board.y <span class="keyword">then</span> <span class="comment">--边界</span></div><div class="line">			leftPad.y = leftPad.h</div><div class="line">		<span class="keyword">end</span></div><div class="line">	<span class="keyword">elseif</span> down(<span class="string">"s"</span>) <span class="keyword">then</span></div><div class="line">		leftPad.y = leftPad.y + <span class="number">2</span></div><div class="line">		leftPad.vy = <span class="number">2</span></div><div class="line">		<span class="keyword">if</span> leftPad.y + leftPad.h/<span class="number">2</span> &gt; board.y + board.h <span class="keyword">then</span></div><div class="line">			leftPad.y = board.h + board.y - leftPad.h/<span class="number">2</span></div><div class="line">		<span class="keyword">end</span></div><div class="line">	<span class="keyword">else</span></div><div class="line">		leftPad.vy = <span class="number">0</span></div><div class="line">	<span class="keyword">end</span></div><div class="line"></div><div class="line"></div><div class="line">	<span class="keyword">if</span> down(<span class="string">"up"</span>) <span class="keyword">then</span></div><div class="line">		rightPad.y = rightPad.y - <span class="number">2</span></div><div class="line">		rightPad.vy = <span class="number">-2</span></div><div class="line">		<span class="keyword">if</span> rightPad.y - rightPad.h/<span class="number">2</span> &lt; board.y <span class="keyword">then</span> <span class="comment">--边界</span></div><div class="line">			rightPad.y = rightPad.h</div><div class="line">		<span class="keyword">end</span></div><div class="line">	<span class="keyword">elseif</span> down(<span class="string">"down"</span>) <span class="keyword">then</span></div><div class="line">		rightPad.y = rightPad.y + <span class="number">2</span></div><div class="line">		rightPad.vy = <span class="number">2</span></div><div class="line">		<span class="keyword">if</span> rightPad.y + rightPad.h/<span class="number">2</span> &gt; board.y + board.h <span class="keyword">then</span></div><div class="line">			rightPad.y = board.h + board.y - rightPad.h/<span class="number">2</span></div><div class="line">		<span class="keyword">end</span></div><div class="line">	<span class="keyword">else</span></div><div class="line">		rightPad.vy = <span class="number">0</span></div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ballMove</span><span class="params">()</span></span></div><div class="line">	ball.x = ball.x + ball.vx</div><div class="line">	ball.y = ball.y + ball.vy</div><div class="line">	<span class="keyword">if</span> ball.x-ball.r &lt; board.x <span class="keyword">then</span></div><div class="line">		ball.x = ball.r + board.x</div><div class="line">		ball.vx = - ball.vx</div><div class="line">	<span class="keyword">elseif</span> ball.x + ball.r &gt; board.w + board.x <span class="keyword">then</span></div><div class="line">		ball.x = board.x + board.w - ball.r</div><div class="line">		ball.vx = - ball.vx</div><div class="line">	<span class="keyword">end</span></div><div class="line"></div><div class="line">	<span class="keyword">if</span> ball.y-ball.r &lt; board.y <span class="keyword">then</span></div><div class="line">		ball.y = ball.r + board.y</div><div class="line">		ball.vy = - ball.vy</div><div class="line">	<span class="keyword">elseif</span> ball.y + ball.r &gt; board.h + board.y <span class="keyword">then</span></div><div class="line">		ball.y = board.y + board.h - ball.r</div><div class="line">		ball.vy = - ball.vy</div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">pointTest</span><span class="params">(x,y,l,t,r,b)</span></span></div><div class="line">	<span class="keyword">if</span> x&lt; l <span class="keyword">or</span> x&gt; r <span class="keyword">or</span> y&lt; t <span class="keyword">or</span> y&gt;b <span class="keyword">then</span> <span class="keyword">return</span> <span class="keyword">end</span></div><div class="line">	<span class="keyword">return</span> <span class="keyword">true</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bodyTest</span><span class="params">(Al,At,Ar,Ab,Bl,Bt,Br,Bb)</span></span></div><div class="line">	<span class="keyword">if</span> pointTest(Al,At,Bl,Bt,Br,Bb) </div><div class="line">		<span class="keyword">or</span> pointTest(Ar,At,Bl,Bt,Br,Bb) </div><div class="line">		<span class="keyword">or</span> pointTest(Al,Ab,Bl,Bt,Br,Bb) </div><div class="line">		<span class="keyword">or</span> pointTest(Ar,Ab,Bl,Bt,Br,Bb)  <span class="keyword">then</span></div><div class="line">		<span class="keyword">return</span> <span class="keyword">true</span></div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">leftCollTest</span><span class="params">()</span></span></div><div class="line">	<span class="keyword">local</span> al, at, ar, ab = </div><div class="line">		ball.x + ball.l, ball.y + ball.t, ball.x + ball.r, ball.y + ball.b</div><div class="line">	<span class="keyword">local</span> bl, bt, br, bb = </div><div class="line">		leftPad.x - leftPad.w/<span class="number">2</span>,</div><div class="line">		leftPad.y - leftPad.h/<span class="number">2</span>,</div><div class="line">		leftPad.x + leftPad.w/<span class="number">2</span>,</div><div class="line">		leftPad.y + leftPad.h/<span class="number">2</span></div><div class="line">	<span class="keyword">local</span> coll = bodyTest(al, at, ar, ab,bl, bt, br, bb)</div><div class="line">	<span class="keyword">if</span> coll <span class="keyword">then</span></div><div class="line">		ball.vx = -ball.vx</div><div class="line">		ball.vy = ball.vy + leftPad.vy/<span class="number">2</span></div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">rightCollTest</span><span class="params">()</span></span></div><div class="line">	<span class="keyword">local</span> al, at, ar, ab = </div><div class="line">		ball.x + ball.l, ball.y + ball.t, ball.x + ball.r, ball.y + ball.b</div><div class="line">	<span class="keyword">local</span> bl, bt, br, bb = </div><div class="line">		rightPad.x - rightPad.w/<span class="number">2</span>,</div><div class="line">		rightPad.y - rightPad.h/<span class="number">2</span>,</div><div class="line">		rightPad.x + rightPad.w/<span class="number">2</span>,</div><div class="line">		rightPad.y + rightPad.h/<span class="number">2</span></div><div class="line">	<span class="keyword">local</span> coll = bodyTest(al, at, ar, ab,bl, bt, br, bb)</div><div class="line">	<span class="keyword">if</span> coll <span class="keyword">then</span></div><div class="line">		ball.vx = -ball.vx</div><div class="line">		ball.vy = ball.vy + rightPad.vy/<span class="number">2</span></div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">love.update</span><span class="params">()</span></span></div><div class="line">	leftCollTest()</div><div class="line">	rightCollTest()</div><div class="line">	keyTest()</div><div class="line">	ballMove()</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">love.draw</span><span class="params">()</span></span></div><div class="line">	love.graphics.setColor(<span class="number">55</span>, <span class="number">50</span>, <span class="number">50</span>, <span class="number">250</span>)</div><div class="line">	love.graphics.rectangle(<span class="string">"fill"</span>, board.x, board.y , board.w, board.h)</div><div class="line">	love.graphics.setColor(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>)</div><div class="line">	love.graphics.circle(<span class="string">"fill"</span>, ball.x, ball.y, ball.r)</div><div class="line">	love.graphics.setColor(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>)</div><div class="line">	love.graphics.rectangle(<span class="string">"fill"</span>, leftPad.x - leftPad.w/<span class="number">2</span>, leftPad.y - leftPad.h/<span class="number">2</span>, leftPad.w, leftPad.h)</div><div class="line">	love.graphics.rectangle(<span class="string">"fill"</span>, rightPad.x - rightPad.w/<span class="number">2</span>, rightPad.y - rightPad.h/<span class="number">2</span>, rightPad.w, rightPad.h)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>

    </div>

    

    

    <!-- Comments -->
    
    <div class="comments">
        
<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="love2d" data-title="love2d" data-url="alexarjing.github.io"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"love2d"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->




    </div>
    

</div>
        </section>

    </div>
</div>

</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>关于</h2>
                <p>
                    本教程配套软件:<a href="https://alexarjing.github.io/tutorial.love">tutorial.love</a>. 请安装love环境使用。
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>最近发表</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2017/03/02/chapter17/">第17章 love项目的web编译</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2017/01/03/example-flee/">华容道案例</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2017/01/03/example-snake/">贪吃蛇</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016/12/27/blender-execises/">Blender习题计划</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>分类</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/Blender学习笔记/">Blender学习笔记</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/案例教程/">案例教程</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/初级教程/">初级教程</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/中级教程/">中级教程</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/klugjo/hexo-theme-alpha-dust">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://twitter.com/?lang=en">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.facebook.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.instagram.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://dribbble.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://plus.google.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-google-plus"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.behance.net/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://500px.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:alexar@foxmail.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    本文作者Alexar alexar@foxmail.com; 原创内容禁止转载。作者保留一切权利。
                </div>
            </div>
        </div>
    </div>
  <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  <span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次,感谢大家支持！
    </span>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->





</body>

</html>