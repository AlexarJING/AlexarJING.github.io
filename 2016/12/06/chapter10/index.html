<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="描述">
    

    <!--Author-->
    
        <meta name="author" content="AlexarJING">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="高级绘图（II）—— Mesh, Canvas, SpriteBatch"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="描述" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Alexar的Love2d实战教程"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>高级绘图（II）—— Mesh, Canvas, SpriteBatch - Alexar的Love2d实战教程</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
    </div>
    <script>
		(function(){
		    var bp = document.createElement('script');
		    var curProtocol = window.location.protocol.split(':')[0];
		    if (curProtocol === 'https') {
		        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
		    }
		    else {
		        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
		    }
		    var s = document.getElementsByTagName("script")[0];
		    s.parentNode.insertBefore(bp, s);
		})();
	</script>

</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2016/12/06/chapter10/">
                高级绘图（II）—— Mesh, Canvas, SpriteBatch
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2016-12-06</span>
            
            <a href="#disqus_thread" class="comments">评论</a>
            
                <span class="category">
                    <a href="/categories/中级教程/">中级教程</a>
                </span>
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <p>本章将继续介绍一些love的高级绘图功能。Mesh绘图，Canvas绘图缓存，以及SpriteBatch绘制组，以及一些数据知识。<br><a id="more"></a></p>
<h1 id="高级绘图（II）"><a href="#高级绘图（II）" class="headerlink" title="高级绘图（II）"></a>高级绘图（II）</h1><h2 id="Mesh-网格"><a href="#Mesh-网格" class="headerlink" title="Mesh 网格"></a>Mesh 网格</h2><p>Mesh实际上是显卡绘制图片的基础，所有的图片都是通过用mesh组成的多边形，从图片的各个像素映射到渲染对象上的。Mesh由存储一个一个顶点位置，顶点对应的材质的位置，以及渲染颜色组成。Mesh中的顶点组成的多边形的基础单位是最简单的面,即三角形，任何复杂的图形都可以用三角形来拼接起来。而Mesh的绘制模式，则指定了这些顶点如何拼接三角形。<br>Mesh的主要作用是绘制任意形状，任意变形的材质，以及颜色的渐变等。</p>
<p>这里仅介绍标准型（非用户自定义属性mesh）Mesh的相关用法，而自定义mesh必须配合shader使用，这里暂不讲解。</p>
<h3 id="mesh的创建"><a href="#mesh的创建" class="headerlink" title="mesh的创建"></a>mesh的创建</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mesh = love.graphics.newMesh( vertices, mode, usage )</div><div class="line">``</div><div class="line">#### vertices 顶点</div><div class="line">这个参数是一个表，包含以下列格式组成的顶点组。</div></pre></td></tr></table></figure>
<p>{x,y,u,v,r,g,b,a}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">其中x,y指的是mesh系统中顶点的位置（绝对位置）。u,v指的是这个顶点对应的材质的位置(它们是相对位置，取值0，1之间)，r,g,b,a指的是该顶点对应的绘制颜色。</div><div class="line">#### mode 构型模式</div><div class="line">这个参数接受一个字符串，来指定顶点通过什么形式来构型的，默认为“fan”</div><div class="line">fan 扇形，以第一个点为中心，然后其他点分别与中心点相连来构成三角形。一般用作画一些中心放射的图形。</div><div class="line">strip 三角形链，由诸如1,2,3;3,2,4;3,4,5这种每连续3个三个顶点组成。一般用作画带状的图形。</div><div class="line">triangles 三角形表，每三个顶点组成一个独立表，没有公用关系。它可以画任意图形，只不过如果用在前两种的话，效率稍低。因为顶点更多，有重复的。</div><div class="line">points 孤点表，这里暂不学习。</div><div class="line">你也可以单独的指定 setVertexMap来单独指定某个顶点的加入顺序。</div><div class="line"></div><div class="line">#### usage 使用方式</div><div class="line">这个参数也接受一个字符串，来确定顶点的读取行为，默认为“动态”</div><div class="line">dynamic 普通的动态加载</div><div class="line">static 顶点位置不再改变</div><div class="line">stream 流式加载，顶点位置每帧都要变化。</div><div class="line"></div><div class="line">解释完参数，让我们举一个形象的例子来说明mesh是如何工作的。</div><div class="line">1. 首先准备一个素材图片或者纯白的图片。</div><div class="line">2. 我们选取这个素材图片上的三个点来构成一个三角形。</div><div class="line">3. 准备一个可以伸缩的薄膜，裁剪成三角形同样的形状和大小，并把这个三角形内的素材复制下来。然后按照需求在三个顶点进行染色。色彩将按其距离远近进行扩散。</div><div class="line">4. 现在，我们这个薄膜就是一个只有一个三角形的mesh。然后我们按照我们的需求，通过拉伸这三个顶点来控制这个三角形的形状。</div><div class="line">5. 然后我们把这个薄膜作为一个图层放到我们的屏幕上，这就是mesh的绘制的。</div><div class="line">6. 如果是一组顶点，那么可以想象 把一大块薄膜蒙在图片上，然后各个顶点用图钉固定住，裁剪掉没有用的部分，我们就得到了一个带图钉的图片，图片复制到薄膜上。然后我们通过移动图钉的位置，带动薄膜改变形状，从而形成mesh新的状态。</div><div class="line"></div><div class="line">#### 设置材质</div></pre></td></tr></table></figure></p>
<p>Mesh:setTexture( texture )<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">如果你不设置材质，就相当于用纯白填充一个矩形。</div><div class="line"></div><div class="line">### 动态Mesh的更新</div></pre></td></tr></table></figure></p>
<p>Mesh:setVertex( index, x, y, u, v, r, g, b, a )<br>Mesh:setVertex( index, {x, y, u, v, r, g, b, a} )<br>Mesh:setVertices( vertices )<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">上面前两种方法是针对某一个顶点的，必须指定顶点的序号。第三种可以直接整体修改。</div><div class="line"></div><div class="line">### Mesh的绘制</div><div class="line">mesh是一个drawable对象，所以可以直接像绘制。跟普通的图片是一样的，可以拉伸，旋转等。</div><div class="line"></div><div class="line"></div><div class="line">## Canvas 绘图缓存</div><div class="line">canvas有很多中叫法，比如内存dc，画布，帧缓存，虚拟绘制对象等等。它就是一块内存区域，在设置后，把drawcall的结果并非发送到屏幕上，而是发送到这块内存里。</div><div class="line">canvas的作用当然就是存储了，单单存储还不够，它的核心在于“累积”。</div><div class="line">因为之前我们讲到love绘图就跟ps一样，但是唯一的区别在于，ps是静态的积累的，而love是动态的，每一帧都要用背景颜色把画面重新填充一次。而canvas就给了我们一个积累的平台。除非手动清理，不然canvas的结果将一直被保留。另外，它作为虚拟绘制对象，是不受love.draw回调限制的，也就是对canvas的绘制可以写在任意位置。</div><div class="line">比如有一个图片，它是动态拼接而成的，如果我们不希望重复的进行拼接工作，而直接使用拼接结果，那么我们就可以先把它绘制在canvas上，然后每次仅仅绘制这个canvas就可以了。</div><div class="line">canvas的创建很简单，只需要提供一个宽和高就行了，默认是屏幕的大小。</div></pre></td></tr></table></figure></p>
<p>canvas = love.graphics.newCanvas()<br>love.graphics.setCanvas(canvas)<br>love.graphics.setColor(230,240,120)<br>love.graphics.rectangle(‘fill’,0,0,100,100)<br>love.graphics.setCanvas()<br>function love.draw()<br>    love.graphics.setColor(255,255,255)<br>    love.graphics.draw(canvas, 200,100, 0, .5,.5)<br>end<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">canvas也是一个开关设置，与其他一样，开启时加参数，关闭是无参数调用。注意，仅仅在canvas上绘制不会体现到屏幕上。</div><div class="line">还有一种回调方式来绘制canvas，如下：</div></pre></td></tr></table></figure></p>
<p>canvas:renderTo(function()<br>    love.graphics.setColor(love.math.random(255), 0, 0);<br>    love.graphics.line(0, 0,<br>    love.math.random(0, love.graphics.getWidth()),<br>    love.math.random(0, love.graphics.getHeight()));<br>end);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">一些摄像机库也用同样的方式来绑定绘制函数。</div><div class="line"></div><div class="line">## SpriteBatch 绘制组</div><div class="line">SpriteBatch成为精灵组、绘制组，是一种提高渲染效率的方法。它通过合并很多重复的对于同一个对象的绘制来达到减少drawcall的目的。注意，它的合并是针对某一个图片而言的，也就是不同的图片是不能合并在一个图片组里。但是由于一些素材采用的是精灵清单的形式，这种合并就十分强大而有效率，尤其对于大量的重复出现的图片。</div><div class="line">创建</div></pre></td></tr></table></figure></p>
<p>spriteBatch = love.graphics.newSpriteBatch( image, maxsprites,usage )<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">它要求指定一个素材，和最大组数。默认为1000. 用法与上面mesh是一样的，可以选择动态，静态和流式三种。</div><div class="line">每当要添加绘制的时候，代码如下</div></pre></td></tr></table></figure></p>
<p>id = SpriteBatch:add( x, y, r, sx, sy, ox, oy, kx, ky )<br>id = SpriteBatch:add( quad, x, y, r, sx, sy, ox, oy, kx, ky )<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">参数就是每个精灵单独绘制的参数了，实际上它是一个Matrix矩阵。返回值是id，用来单独控制某一个精灵组中的精灵。</div><div class="line">当然，每次绘制玩了，你需要清空这个组，不然是要积累下去的。</div></pre></td></tr></table></figure></p>
<p>SpriteBatch:clear()<br>```<br>精灵组的绘制同任何drawable一样。一般而言，精灵组直接绘制到0，0就行了。</p>
<h2 id="数据对象"><a href="#数据对象" class="headerlink" title="数据对象"></a>数据对象</h2><p>相信每一个用love的同学最开始对love.image.newImageData()这类函数比较疑惑。因为他们只是数据对象而非绘图对象。他们用来做什么呢？</p>

    </div>

    

    

    <!-- Comments -->
    
    <div class="comments">
        
<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="love2d" data-title="love2d" data-url="alexarjing.github.io"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"love2d"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->




    </div>
    

</div>
        </section>

    </div>
</div>

</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>关于</h2>
                <p>
                    本教程配套软件:<a href="https://alexarjing.github.io/tutorial.love">tutorial.love</a>. 请安装love环境使用。
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>最近发表</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2016/12/06/chapter10/">高级绘图（II）—— Mesh, Canvas, </a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016/12/05/chapter9/">高级绘图（I）——Scissor，Stencil，</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016/12/05/chapter8/">第8章 用户界面</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016/12/05/interlude/">插曲：你的独立游戏生涯</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>分类</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/中级教程/">中级教程</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/初级教程/">初级教程</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/klugjo/hexo-theme-alpha-dust">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://twitter.com/?lang=en">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.facebook.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.instagram.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://dribbble.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://plus.google.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-google-plus"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.behance.net/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://500px.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:alexar@foxmail.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    本文作者Alexar alexar@foxmail.com; 原创内容禁止转载。作者保留一切权利。
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->





</body>

</html>