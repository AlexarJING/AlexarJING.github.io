(()=>{var yt=(r,a)=>()=>(a||r((a={exports:{}}).exports,a),a.exports);var Ct=yt(ct=>{window.fgui={};window.fairygui=window.fgui;fgui={};f=f||globalThis.PIXI;var bt=ct&&ct.__awaiter||function(r,a,c,e){return new(c||(c=Promise))(function(i,t){function s(l){try{n(e.next(l))}catch(o){t(o)}}function h(l){try{n(e.throw(l))}catch(o){t(o)}}function n(l){l.done?i(l.value):new c(function(o){o(l.value)}).then(s,h)}n((e=e.apply(r,a||[])).next())})};(function(r){let a=window,c=!!(a.PointerEvent||a.MSPointerEvent),e="ontouchstart"in window&&f.utils.isMobile.any;class i{}i.Down=c?"pointerdown":e?"touchstart":"mousedown",i.Cancel=c?"pointercancel":e?"touchcancel":"mousecancel",i.Up=c?"pointerup":e?"touchend":"mouseup",i.Click=c?"pointertap":e?"tap":"click",i.UpOutside=c?"pointerupoutside":e?"touchendoutside":"mouseupoutside",i.Move=c?"pointermove":e?"touchmove":"mousemove",i.Over=c?"pointerover":e?null:"mouseover",i.Out=c?"pointerout":e?null:"mouseout",i.RightDown="rightdown",i.RightUp="rightup",i.RightClick="rightclick",i.RightUpOutside="rightupoutside",r.InteractiveEvents=i,r.GearXMLNodeNameMap={gearDisplay:0,gearXY:1,gearSize:2,gearLook:3,gearColor:4,gearAni:5,gearText:6,gearIcon:7},r.BlendModeMap=["Normal","Add","Multiply","Screen","Overlay","Darken","Lighten","ColorDodge","ColorBurn","HardLight","SoftLight","Difference","Exclusion","Hue","Saturation","Color","Luminosity","NormalNPM","AddNPM","ScreenNPM"];function t(u){switch(u){case"visible":return 0;case"hidden":return 1;case"scroll":return 2;case"scale":return 3;case"scaleFree":return 4;default:return 0}}r.ParseOverflowType=t;function s(u){switch(u){case"horizontal":return 0;case"vertical":return 1;case"both":return 2;default:return 1}}r.ParseScrollType=s;function h(u){switch(u){case"none":return 0;case"scale":return 1;case"scaleMatchHeight":return 2;case"scaleMatchWidth":return 3;case"scaleFree":return 4;case"scaleNoBorder":return 5;default:return 0}}r.ParseLoaderFillType=h;function n(u){switch(u){case"column":return 0;case"row":return 1;case"flow_hz":return 2;case"flow_vt":return 3;case"pagination":return 4;default:return 0}}r.ParseListLayoutType=n;function l(u){switch(u){case"single":return 0;case"multiple":return 1;case"multipleSingleClick":return 2;case"none":return 3;default:return 0}}r.ParseListSelectionMode=l;function o(u){switch(u){case"image":return 0;case"movieclip":return 2;case"sound":return 3;case"component":return 4;case"swf":return 1;case"font":return 6;case"atlas":return 7;default:return 5}}r.ParsePackageItemType=o;function $(u){switch(u){case"percent":return 0;case"valueAndmax":return 1;case"value":return 2;case"max":return 3;default:return 0}}r.ParseProgressTitleType=$;function d(u){switch(u){case"default":return 0;case"visible":return 1;case"auto":return 2;case"hidden":return 3;default:return 0}}r.ParseScrollBarDisplayType=d;function p(u){switch(u){case"hz":return 1;case"vt":return 2;case"both":return 3;default:return 0}}r.ParseFlipType=p;function w(u){switch(u){case"Common":return 0;case"Check":return 1;case"Radio":return 2;default:return 0}}r.ParseButtonMode=w;function C(u){switch(u){case"none":return 0;case"both":return 1;case"height":return 2;case"shrink":return 3;default:return 0}}r.ParseAutoSizeType=C;function I(u){switch(u){case"left":return"left";case"center":return"center";case"right":return"right";default:return"left"}}r.ParseAlignType=I;function m(u){switch(u){case"top":return 0;case"middle":return 1;case"bottom":return 2;default:return 0}}r.ParseVertAlignType=m;function b(u){switch(u){case"ascent":return 0;case"descent":return 1;case"arch":return 2;default:return 0}}r.ParseListChildrenRenderOrder=b;let g={Linear:TWEEN.Easing.Linear.None,"Elastic.In":TWEEN.Easing.Elastic.In,"Elastic.Out":TWEEN.Easing.Elastic.Out,"Elastic.InOut":TWEEN.Easing.Elastic.InOut,"Quad.In":TWEEN.Easing.Quadratic.In,"Quad.Out":TWEEN.Easing.Quadratic.Out,"Quad.InOut":TWEEN.Easing.Quadratic.InOut,"Cube.In":TWEEN.Easing.Cubic.In,"Cube.Out":TWEEN.Easing.Cubic.Out,"Cube.InOut":TWEEN.Easing.Cubic.InOut,"Quart.In":TWEEN.Easing.Quartic.In,"Quart.Out":TWEEN.Easing.Quartic.Out,"Quart.InOut":TWEEN.Easing.Quartic.InOut,"Quint.In":TWEEN.Easing.Quintic.In,"Quint.Out":TWEEN.Easing.Quintic.Out,"Quint.InOut":TWEEN.Easing.Quintic.InOut,"Sine.In":TWEEN.Easing.Sinusoidal.In,"Sine.Out":TWEEN.Easing.Sinusoidal.Out,"Sine.InOut":TWEEN.Easing.Sinusoidal.InOut,"Bounce.In":TWEEN.Easing.Bounce.In,"Bounce.Out":TWEEN.Easing.Bounce.Out,"Bounce.InOut":TWEEN.Easing.Bounce.InOut,"Circ.In":TWEEN.Easing.Circular.In,"Circ.Out":TWEEN.Easing.Circular.Out,"Circ.InOut":TWEEN.Easing.Circular.InOut,"Expo.In":TWEEN.Easing.Exponential.In,"Expo.Out":TWEEN.Easing.Exponential.Out,"Expo.InOut":TWEEN.Easing.Exponential.InOut,"Back.In":TWEEN.Easing.Back.In,"Back.Out":TWEEN.Easing.Back.Out,"Back.InOut":TWEEN.Easing.Back.InOut};function T(u){return g[u]||g.Linear}r.ParseEaseType=T})(fgui||(fgui={}));(function(r){class a{constructor(){this.$x=0,this.$y=0,this.$width=0,this.$height=0,this.$alpha=1,this.$rotation=0,this.$visible=!0,this.$touchable=!0,this.$grayed=!1,this.$draggable=!1,this.$scaleX=1,this.$scaleY=1,this.$skewX=0,this.$skewY=0,this.$pivot=new f.Point,this.$pivotAsAnchor=!1,this.$pivotOffset=new f.Point,this.$sortingOrder=0,this.$internalVisible=!0,this.$focusable=!1,this.$pixelSnapping=!1,this.$handlingController=!1,this.$lastColorComponents=null,this.$rawWidth=0,this.$rawHeight=0,this.$initWidth=0,this.$initHeight=0,this.$sourceWidth=0,this.$sourceHeight=0,this.$id=`${a.gInstanceCounter++}`,this.$name="",this.createDisplayObject(),this.$relations=new r.Relations(this),this.$gears=[]}get id(){return this.$id}get name(){return this.$name}set name(e){this.$name=e}get x(){return this.$x}set x(e){this.setXY(e,this.$y)}get y(){return this.$y}set y(e){this.setXY(this.$x,e)}setXY(e,i){(this.$x!=e||this.$y!=i)&&(this.$x=e,this.$y=i,this.handleXYChanged(),this.updateGear(1),this.$parent&&(this.$parent.setBoundsChangedFlag(),this.$displayObject.emit(r.DisplayObjectEvent.XY_CHANGED,this)),a.draggingObject==this&&!a.sUpdatingWhileDragging&&this.localToGlobalRect(0,0,this.width,this.height,a.sGlobalRect))}get pixelSnapping(){return this.$pixelSnapping}set pixelSnapping(e){this.$pixelSnapping!=e&&(this.$pixelSnapping=e,this.handleXYChanged())}center(e=!1){let i;this.$parent!=null?i=this.parent:i=this.root,this.setXY((i.width-this.width)/2,(i.height-this.height)/2),e&&(this.addRelation(i,3),this.addRelation(i,10))}get width(){return this.ensureSizeCorrect(),this.$relations.sizeDirty&&this.$relations.ensureRelationsSizeCorrect(),this.$width}set width(e){this.setSize(e,this.$rawHeight)}get height(){return this.ensureSizeCorrect(),this.$relations.sizeDirty&&this.$relations.ensureRelationsSizeCorrect(),this.$height}set height(e){this.setSize(this.$rawWidth,e)}setSize(e,i,t=!1){if(this.$rawWidth!=e||this.$rawHeight!=i){this.$rawWidth=e,this.$rawHeight=i,e=Math.max(0,e),i=Math.max(0,i);let s=e-this.mapPivotWidth(1),h=i-this.mapPivotHeight(1);this.$width=e,this.$height=i,this.handleSizeChanged(),(this.$pivot.x!=0||this.$pivot.y!=0)&&(this.$pivotAsAnchor?this.applyPivot():(t||this.setXY(this.x-this.$pivot.x*s,this.y-this.$pivot.y*h),this.updatePivotOffset())),this.updateGear(2),this.$parent&&(this.$relations.onOwnerSizeChanged(s,h),this.$parent.setBoundsChangedFlag()),this.$displayObject.emit(r.DisplayObjectEvent.SIZE_CHANGED,this)}}ensureSizeCorrect(){}get sourceHeight(){return this.$sourceHeight}get sourceWidth(){return this.$sourceWidth}get initHeight(){return this.$initHeight}get initWidth(){return this.$initWidth}get actualWidth(){return this.width*Math.abs(this.$scaleX)}get actualHeight(){return this.height*Math.abs(this.$scaleY)}get scaleX(){return this.$scaleX}set scaleX(e){this.setScale(e,this.$scaleY)}get scaleY(){return this.$scaleY}set scaleY(e){this.setScale(this.$scaleX,e)}setScale(e,i){(this.$scaleX!=e||this.$scaleY!=i)&&(this.$scaleX=e,this.$scaleY=i,this.handleScaleChanged(),this.applyPivot(),this.updateGear(2))}get skewX(){return this.$skewX}set skewX(e){this.setSkew(e,this.$skewY)}get skewY(){return this.$skewY}set skewY(e){this.setSkew(this.$skewX,e)}setSkew(e,i){(this.$skewX!=e||this.$skewY!=i)&&(this.$skewX=e,this.$skewY=i,this.$displayObject.skew.set(e*-r.utils.NumberUtil.RADIAN,i*r.utils.NumberUtil.RADIAN),this.applyPivot())}mapPivotWidth(e){return e*this.$width}mapPivotHeight(e){return e*this.$height}get pivotX(){return this.$pivot.x}get pivotY(){return this.$pivot.y}set pivotX(e){this.setPivot(e,this.pivotY)}set pivotY(e){this.setPivot(this.pivotX,e)}setPivot(e,i,t=!1){(this.$pivot.x!=e||this.$pivot.y!=i||this.$pivotAsAnchor!=t)&&(this.$pivot.set(e,i),this.$pivotAsAnchor=t,this.updatePivotOffset(),this.handleXYChanged())}internalSetPivot(e,i,t){this.$pivot.set(e,i),this.$pivotAsAnchor=t,t&&this.handleXYChanged()}updatePivotOffset(){if(this.$pivot.x!=0||this.$pivot.y!=0&&this.$displayObject.transform){let e=this.mapPivotWidth(this.$pivot.x),i=this.mapPivotHeight(this.$pivot.y);a.sHelperPoint.set(e,i),this.$displayObject.transform.updateLocalTransform();let t=this.$displayObject.localTransform,s=t.apply(a.sHelperPoint,a.sHelperPoint);s.x-=t.tx,s.y-=t.ty,this.$pivotOffset.set(this.$pivot.x*this.$width-s.x,this.$pivot.y*this.$height-s.y)}else this.$pivotOffset.set(0,0)}applyPivot(){(this.$pivot.x!=0||this.$pivot.y!=0)&&(this.updatePivotOffset(),this.handleXYChanged())}get touchable(){return this.$touchable}set touchable(e){this.$touchable=e,this.$displayObject.interactive=this.$touchable,this.$displayObject.interactiveChildren=this.$touchable,this.$displayObject.ignoreHit=!this.$touchable}get grayed(){return this.$grayed}set grayed(e){this.$grayed!=e&&(this.$grayed=e,this.handleGrayedChanged(),this.updateGear(3))}get enabled(){return!this.$grayed&&this.$touchable}set enabled(e){this.grayed=!e,this.touchable=e}get rotation(){return this.$rotation}set rotation(e){this.$rotation!=e&&(this.$rotation=e,this.$displayObject&&(this.$displayObject.rotation=r.utils.NumberUtil.angleToRadian(this.normalizeRotation)),this.applyPivot(),this.updateGear(3))}get normalizeRotation(){let e=this.$rotation%360;return e>180?e-=360:e<-180&&(e+=360),e}get alpha(){return this.$alpha}set alpha(e){this.$alpha!=e&&(this.$alpha=e,this.updateAlpha())}updateAlpha(){this.$displayObject&&(this.$displayObject.alpha=this.$alpha),this.updateGear(3)}get visible(){return this.$visible}set visible(e){this.$visible!=e&&(this.$visible=e,this.$displayObject&&(this.$displayObject.visible=this.$visible),this.$parent&&(this.$parent.childStateChanged(this),this.$parent.setBoundsChangedFlag()),this.emit(r.DisplayObjectEvent.VISIBLE_CHANGED,this.$visible,this))}set internalVisible(e){e!=this.$internalVisible&&(this.$internalVisible=e,this.$parent&&this.$parent.childStateChanged(this))}get internalVisible(){return this.$internalVisible}get finalVisible(){return this.$visible&&this.$internalVisible&&(!this.$group||this.$group.finalVisible)}get sortingOrder(){return this.$sortingOrder}set sortingOrder(e){if(e<0&&(e=0),this.$sortingOrder!=e){let i=this.$sortingOrder;this.$sortingOrder=e,this.$parent!=null&&this.$parent.childSortingOrderChanged(this,i,this.$sortingOrder)}}get focusable(){return this.$focusable}set focusable(e){this.$focusable=e}get focused(){return this.root.focus==this}requestFocus(){let e=this;for(;e&&!e.$focusable;)e=e.parent;e!=null&&(this.root.focus=e)}get tooltips(){return this.$tooltips}set tooltips(e){this.$tooltips=e}get blendMode(){return this.$displayObject&&this.$displayObject instanceof f.Sprite?r.BlendModeMap[this.$displayObject.blendMode]||"None":r.BlendModeMap[0]}set blendMode(e){if(!(!e||!e.length||!this.$displayObject||!(this.$displayObject instanceof f.Sprite))){for(let i=0;i<r.BlendModeMap.length;i++)if(r.BlendModeMap[i].toLowerCase()===e.toLowerCase()){this.$displayObject.blendMode=i;return}}}get filters(){return this.$displayObject.filters}set filters(e){this.$displayObject.filters=e}get inContainer(){return this.$displayObject.parent!=null}static isDisplayObjectOnStage(e){if(!e||!e.parent)return!1;let i=e;for(;i!=null;){if(i==r.GRoot.inst.nativeStage)return!0;i=i.parent}return!1}get onStage(){return a.isDisplayObjectOnStage(this.$displayObject)}get resourceURL(){return this.packageItem!=null?`ui://${this.packageItem.owner.id}${this.packageItem.id}`:null}set group(e){this.$group=e}get group(){return this.$group}getGear(e){let i=this.$gears[e];if(i==null){switch(e){case 0:i=new r.GearDisplay(this);break;case 1:i=new r.GearXY(this);break;case 2:i=new r.GearSize(this);break;case 3:i=new r.GearLook(this);break;case 4:if(r.isColorGear(this))i=new r.GearColor(this);else throw new Error(`Invalid component type to add GearColor feature, please check the component named ${this.$name} in the Editor.`);break;case 5:if(r.isAnimationGear(this))i=new r.GearAnimation(this);else throw new Error(`Invalid component type to add GearAnimation feature, please check the component named ${this.$name} in the Editor.`);break;case 6:i=new r.GearText(this);break;case 7:i=new r.GearIcon(this);break;default:throw new Error("FGUI: invalid gear type")}this.$gears[e]=i}return i}updateGear(e){this.$gears[e]!=null&&this.$gears[e].updateState()}updateGearFromRelations(e,i,t){this.$gears[e]!=null&&this.$gears[e].updateFromRelations(i,t)}hasGearController(e,i){return this.$gears[e]&&this.$gears[e].controller==i}lockGearDisplay(){let e=this.$gears[0];if(e&&e.controller){let i=e.lock();return this.checkGearVisible(),i}else return 0}releaseGearDisplay(e){let i=this.$gears[0];i&&i.controller&&(i.release(e),this.checkGearVisible())}checkGearVisible(){if(this.$handlingController)return;let e=this.$gears[0],i=!e||e.connected;i!=this.$internalVisible&&(this.$internalVisible=i,this.$parent&&this.$parent.childStateChanged(this))}get gearXY(){return this.getGear(1)}get gearSize(){return this.getGear(2)}get gearLook(){return this.getGear(3)}get relations(){return this.$relations}addRelation(e,i,t=!1){this.$relations.add(e,i,t)}removeRelation(e,i=0){this.$relations.remove(e,i)}get displayObject(){return this.$displayObject}createDisplayObject(){}setDisplayObject(e){this.$displayObject=e}get parent(){return this.$parent}set parent(e){this.$parent=e}removeFromParent(){this.$parent&&this.$parent.removeChild(this)}get root(){if(this instanceof r.GRoot)return this;let e=this.$parent;for(;e;){if(e instanceof r.GRoot)return e;e=e.parent}return r.GRoot.inst}get text(){return null}set text(e){}get icon(){return null}set icon(e){}dispose(){this.removeFromParent(),this.$relations.dispose(),this.removeAllListeners(),this.$owner&&(this.$owner.off(r.InteractiveEvents.Move,this.$moving,this),this.$owner.off(r.InteractiveEvents.Up,this.$end,this),this.$owner.off(r.InteractiveEvents.Move,this.$moving2,this),this.$owner.off(r.InteractiveEvents.Up,this.$end2,this)),this.$displayObject.destroy()}click(e,i){return this.on(r.InteractiveEvents.Click,e,i)}onClick(e,i){return this.on(r.InteractiveEvents.Click,e,i)}setPosition(e,i){this.setXY(e,i)}onConstruct(){}removeClick(e,i){return this.off(r.InteractiveEvents.Click,e,i)}hasClick(e){return this.hasListener(r.InteractiveEvents.Click,e)}on(e,i,t){return e==null?this:(this.$displayObject.on(e,i,t),this)}off(e,i,t){return e==null?this:(this.$displayObject.listeners(e)&&this.$displayObject.off(e,i,t),this)}once(e,i,t){return e==null?this:(this.$displayObject.once(e,i,t),this)}hasListener(e,i){return this.$displayObject.listeners(e).indexOf(i)>=0}emit(e,...i){return!i||i.length<=0?i=[e]:i.unshift(e),this.$displayObject.emit.apply(this.$displayObject,i)}removeAllListeners(e){this.$displayObject.removeAllListeners(e)}get draggable(){return this.$draggable}set draggable(e){this.$draggable!=e&&(this.$draggable=e,this.initDrag())}get dragBounds(){return this.$dragBounds}set dragBounds(e){this.$dragBounds=e}startDrag(e=-1){!this.onStage||this.dragBegin()}stopDrag(){this.dragEnd()}get dragging(){return a.draggingObject==this}localToGlobal(e=0,i=0,t){return this.$pivotAsAnchor&&(e+=this.$pivot.x*this.$width,i+=this.$pivot.y*this.$height),t||(t=a.sHelperPoint),t.x=e,t.y=i,this.$displayObject.toGlobal(t,t)}globalToLocal(e=0,i=0,t){return t||(t=a.sHelperPoint),t.set(e,i),t=this.$displayObject.toLocal(t,r.GRoot.inst.nativeStage),this.$pivotAsAnchor&&(t.x-=this.$pivot.x*this.$width,t.y-=this.$pivot.y*this.$height),t}localToRoot(e=0,i=0,t){let s=this.localToGlobal(e,i,t);return s.x/=r.GRoot.inst.contentScaleFactor,s.y/=r.GRoot.inst.contentScaleFactor,s}rootToLocal(e=0,i=0,t){return e*=r.GRoot.inst.contentScaleFactor,i*=r.GRoot.inst.contentScaleFactor,this.globalToLocal(e,i,t)}localToGlobalRect(e=0,i=0,t=0,s=0,h){h==null&&(h=a.sDragHelperRect);let n=this.localToGlobal(e,i);return h.x=n.x,h.y=n.y,h.width=t,h.height=s,h}globalToLocalRect(e=0,i=0,t=0,s=0,h){h==null&&(h=a.sDragHelperRect);let n=this.globalToLocal(e,i);return h.x=n.x,h.y=n.y,h.width=t,h.height=s,h}handleControllerChanged(e){this.$handlingController=!0;for(let i=0;i<8;i++){let t=this.$gears[i];t!=null&&t.controller==e&&t.apply()}this.$handlingController=!1,this.checkGearVisible()}switchDisplayObject(e){if(e==this.$displayObject)return;let i=this.$displayObject;if(this.inContainer){let t=this.$displayObject.parent.getChildIndex(this.$displayObject);this.$displayObject.parent.addChildAt(e,t),this.$displayObject.parent.removeChild(this.$displayObject)}this.$displayObject=e,this.$displayObject.x=i.x,this.$displayObject.y=i.y,this.$displayObject.rotation=i.rotation,this.$displayObject.alpha=i.alpha,this.$displayObject.visible=i.visible,this.$displayObject.scale.x=i.scale.x,this.$displayObject.scale.y=i.scale.y,this.$displayObject.interactive=i.interactive,this.$displayObject instanceof f.Container&&i instanceof f.Container&&(this.$displayObject.interactiveChildren=i.interactiveChildren)}handleXYChanged(){if(this.$displayObject){let e=this.$x,i=this.$y;this.$pivotAsAnchor&&(e-=this.$pivot.x*this.$width,i-=this.$pivot.y*this.$height),this.$pixelSnapping&&(e=Math.round(e),i=Math.round(i)),this.$displayObject.position.set(e+this.$pivotOffset.x,i+this.$pivotOffset.y)}}handleSizeChanged(){}handleScaleChanged(){this.$displayObject&&this.$displayObject.scale.set(this.$scaleX,this.$scaleY)}get colorFilter(){if(this.$colorFilter)return this.$colorFilter;if(this.$colorFilter=new f.filters.ColorMatrixFilter,this.$displayObject){let e=this.$displayObject.filters||[];e.push(this.$colorFilter),this.$displayObject.filters=e}return this.$colorFilter}updateColorComponents(e,i,t,s){a.$colorHelper||(a.$colorHelper=new r.utils.ColorMatrix);let h=a.$colorHelper;h.setColor(e,i*100,t*100,s*180);let n=this.colorFilter;n.enabled=!0,n.reset(),n.matrix=h.toArray(),this.$lastColorComponents||(this.$lastColorComponents=[]),this.$lastColorComponents.length=0,this.$lastColorComponents.push(h.brightness,h.contrast,h.saturation,h.hue)}handleGrayedChanged(){if(this.$displayObject){let e=this.colorFilter;e.enabled=!0,this.$grayed?e.blackAndWhite(!0):this.$lastColorComponents&&this.$lastColorComponents.length>=4?this.updateColorComponents(this.$lastColorComponents[0],this.$lastColorComponents[1],this.$lastColorComponents[2],this.$lastColorComponents[3]):e.enabled=!1}}constructFromResource(){}setupBeforeAdd(e){let i,t;if(this.$id=e.attributes.id,this.$name=e.attributes.name,i=e.attributes.xy,t=i.split(","),this.setXY(parseInt(t[0]),parseInt(t[1])),i=e.attributes.size,i&&(t=i.split(","),this.$initWidth=parseInt(t[0]),this.$initHeight=parseInt(t[1]),this.setSize(this.$initWidth,this.$initHeight,!0)),i=e.attributes.scale,i&&(t=i.split(","),this.setScale(parseFloat(t[0]),parseFloat(t[1]))),i=e.attributes.rotation,i&&(this.rotation=parseInt(i)),i=e.attributes.skew,i&&(t=i.split(","),this.setSkew(parseFloat(t[0]),parseFloat(t[1]))),i=e.attributes.pivot,i){t=i.split(",");let s=parseFloat(t[0]),h=parseFloat(t[1]);i=e.attributes.anchor,this.setPivot(s,h,i=="true")}if(i=e.attributes.alpha,i&&(this.alpha=parseFloat(i)),e.attributes.touchable=="false"&&(this.touchable=!1),e.attributes.visible=="false"&&(this.visible=!1),e.attributes.grayed=="true"&&(this.grayed=!0),this.tooltips=e.attributes.tooltips,this.customData=e.attributes.customData,e.children&&e.children.filter(h=>h.nodeName=="property").forEach(h=>{let n=this[h.attributes.target];n.text=h.attributes.value}),i=e.attributes.blend,i&&(this.blendMode=i),i=e.attributes.filter,i)switch(i){case"color":i=e.attributes.filterData,t=i.split(","),this.updateColorComponents(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));break}}setupAfterAdd(e){let i=e.attributes.group;if(i&&(this.$group=this.$parent.getChildById(i)),e.children.forEach(s=>{let h=r.GearXMLNodeNameMap[s.nodeName];h!=null&&this.getGear(h).setup(s)},this),i=e.attributes.controller,i&&i.includes(",")){let s=i.split(",");for(let h=0;h<s.length/2;h++)this.getController(s[h*2]).selectedIndex=Number(s[h*2+1])}}static castFromNativeObject(e){return r.isUIObject(e)?e.UIOwner:null}initDrag(){this.$draggable?this.on(r.InteractiveEvents.Down,this.$touchBegin,this):this.off(r.InteractiveEvents.Down,this.$touchBegin,this)}dragBegin(){a.draggingObject!=null&&a.draggingObject.stopDrag(),a.sGlobalDragStart.x=r.GRoot.globalMouseStatus.mouseX,a.sGlobalDragStart.y=r.GRoot.globalMouseStatus.mouseY,this.localToGlobalRect(0,0,this.width,this.height,a.sGlobalRect),a.draggingObject=this,this.$owner.on(r.InteractiveEvents.Move,this.$moving2,this),this.$owner.on(r.InteractiveEvents.Up,this.$end2,this)}dragEnd(){a.draggingObject==this&&(this.$owner.off(r.InteractiveEvents.Move,this.$moving2,this),this.$owner.off(r.InteractiveEvents.Up,this.$end2,this),a.draggingObject=null),a.$dragBeginCancelled=!0}reset(){this.$owner.off(r.InteractiveEvents.Move,this.$moving,this),this.$owner.off(r.InteractiveEvents.Up,this.$end,this)}$touchBegin(e){this.$touchDownPoint==null&&(this.$touchDownPoint=new f.Point),this.$touchDownPoint.x=e.data.global.x,this.$touchDownPoint.y=e.data.global.y,this.$owner.on(r.InteractiveEvents.Move,this.$moving,this),this.$owner.on(r.InteractiveEvents.Up,this.$end,this)}$end(e){this.reset()}$moving(e){let i=r.UIConfig.touchDragSensitivity;this.$touchDownPoint!=null&&Math.abs(this.$touchDownPoint.x-e.data.global.x)<i&&Math.abs(this.$touchDownPoint.y-e.data.global.y)<i||(this.reset(),a.$dragBeginCancelled=!1,e.currentTarget=this.$displayObject,this.$displayObject.emit(r.DragEvent.START,e,this),a.$dragBeginCancelled||this.dragBegin())}$moving2(e){let i=e.data.global.x-a.sGlobalDragStart.x+a.sGlobalRect.x,t=e.data.global.y-a.sGlobalDragStart.y+a.sGlobalRect.y;if(this.$dragBounds!=null){let h=r.GRoot.inst.localToGlobalRect(this.$dragBounds.x,this.$dragBounds.y,this.$dragBounds.width,this.$dragBounds.height,a.sDragHelperRect);i<h.x?i=h.x:i+a.sGlobalRect.width>h.right&&(i=h.right-a.sGlobalRect.width,i<h.x&&(i=h.x)),t<h.y?t=h.y:t+a.sGlobalRect.height>h.bottom&&(t=h.bottom-a.sGlobalRect.height,t<h.y&&(t=h.y))}a.sUpdatingWhileDragging=!0,a.sHelperPoint.x=i,a.sHelperPoint.y=t;let s=this.parent.globalToLocal(i,t,a.sHelperPoint);this.setXY(Math.round(s.x),Math.round(s.y)),a.sUpdatingWhileDragging=!1,e.currentTarget=this.$displayObject,this.$displayObject.emit(r.DragEvent.MOVING,e,this)}$end2(e){a.draggingObject==this&&(this.stopDrag(),e.currentTarget=this.$displayObject,this.$displayObject.emit(r.DragEvent.END,e,this))}}a.gInstanceCounter=0,a.sGlobalDragStart=new f.Point,a.sGlobalRect=new f.Rectangle,a.sHelperPoint=new f.Point,a.sDragHelperRect=new f.Rectangle,r.GObject=a})(fgui||(fgui={}));(function(r){class a extends r.GObject{constructor(){super(),this.$sortingChildCount=0,this.$children=[],this.$controllers=[],this.$transitions=[],this.$margin=new r.utils.Margin,this.$alignOffset=new f.Point}createDisplayObject(){this.$rootContainer=new r.UIContainer(this),this.setDisplayObject(this.$rootContainer),this.$container=this.$rootContainer}dispose(){r.GTimer.inst.remove(this.$validate,this),this.off("added",this.$added,this),this.off("removed",this.$removed,this),this.$transitions.forEach(i=>{i.dispose()});let e=this.$children.length;for(let i=e-1;i>=0;--i){let t=this.$children[i];t.parent=null,t.dispose()}this.$boundsChanged=!1,this.$scrollPane&&this.$scrollPane.dispose(),super.dispose()}get displayListContainer(){return this.$container}addChild(e){return this.addChildAt(e,this.$children.length),e}addChildAt(e,i=0){if(!e)throw new Error("Invalid child");let t=this.$children.length;if(i>=0&&i<=t){if(e.parent==this)this.setChildIndex(e,i);else{e.removeFromParent(),e.parent=this;let s=this.$children.length;e.sortingOrder!=0?(this.$sortingChildCount++,i=this.getInsertPosForSortingChild(e)):this.$sortingChildCount>0&&i>s-this.$sortingChildCount&&(i=s-this.$sortingChildCount),i==s?this.$children.push(e):this.$children.splice(i,0,e),this.childStateChanged(e),this.setBoundsChangedFlag()}return e}else throw new Error("Invalid child index")}getInsertPosForSortingChild(e){let i=this.$children.length,t=0;for(t=0;t<i;t++){let s=this.$children[t];if(s!=e&&e.sortingOrder<s.sortingOrder)break}return t}removeChild(e,i=!1){let t=this.$children.indexOf(e);return t!=-1&&this.removeChildAt(t,i),e}removeChildAt(e,i=!1){if(e>=0&&e<this.numChildren){let t=this.$children[e];if(!t)debugger;return t.parent=null,t.sortingOrder!=0&&this.$sortingChildCount--,this.$children.splice(e,1),t.inContainer&&this.$container.removeChild(t.displayObject),i===!0&&t.dispose(),this.setBoundsChangedFlag(),t}else throw new Error("Invalid child index")}removeChildren(e=0,i=-1,t=!1){i<0||i>=this.numChildren,i=this.numChildren-1;for(let s=i;s>=e;s--)this.removeChildAt(e,t)}getChildAt(e=0){if(e>=0&&e<this.numChildren)return this.$children[e];throw new Error("Invalid child index")}getChild(e){let i=this.$children.length;for(let t=0;t<i;++t)if(this.$children[t].name==e)return this.$children[t];return null}getChildInGroup(e,i){let t=this.$children.length;for(let s=0;s<t;++s){let h=this.$children[s];if(h.group==i&&h.name==e)return h}return null}getChildById(e){let i=this.$children.length;for(let t=0;t<i;++t)if(this.$children[t].id==e)return this.$children[t];return null}getChildIndex(e){return this.$children.indexOf(e)}setChildIndex(e,i=0){let t=this.$children.indexOf(e);if(t==-1)throw new Error("no such child found");if(e.sortingOrder!=0)return;let s=this.$children.length;this.$sortingChildCount>0&&i>s-this.$sortingChildCount-1&&(i=s-this.$sortingChildCount-1),this.$setChildIndex(e,t,i)}setChildIndexBefore(e,i){let t=this.$children.indexOf(e);if(t==-1)throw new Error("no such child found");if(e.sortingOrder!=0)return t;let s=this.$children.length;return this.$sortingChildCount>0&&i>s-this.$sortingChildCount-1&&(i=s-this.$sortingChildCount-1),t<i?this.$setChildIndex(e,t,i-1):this.$setChildIndex(e,t,i)}$setChildIndex(e,i,t=0){let s=this.$children.length;if(t>s&&(t=s),i==t)return i;if(this.$children.splice(i,1),this.$children.splice(t,0,e),e.inContainer){let h=0,n=this.$container.children.length;for(let l=0;l<t;l++)this.$children[l].inContainer&&h++;h==n&&h--,this.$container.setChildIndex(e.displayObject,h),this.setBoundsChangedFlag()}return t}swapChildren(e,i){let t=this.$children.indexOf(e),s=this.$children.indexOf(i);if(t==-1||s==-1)throw new Error("no such child found");this.swapChildrenAt(t,s)}swapChildrenAt(e,i=0){let t=this.$children[e],s=this.$children[i];this.setChildIndex(t,i),this.setChildIndex(s,e)}get numChildren(){return this.$children.length}isAncestorOf(e){if(e==null)return!1;let i=e.parent;for(;i;){if(i==this)return!0;i=i.parent}return!1}addController(e){this.$controllers.push(e),e.$parent=this,this.applyController(e)}getControllerAt(e){return this.$controllers[e]}getController(e){let i=this.$controllers.length;for(let t=0;t<i;++t){let s=this.$controllers[t];if(s.name==e)return s}return null}removeController(e){let i=this.$controllers.indexOf(e);if(i==-1)throw new Error("controller not exists");e.$parent=null,this.$controllers.splice(i,1),this.$children.forEach(t=>{t.handleControllerChanged(e)})}get controllers(){return this.$controllers}childStateChanged(e){if(!this.$buildingDisplayList){if(e instanceof r.GGroup){this.$children.forEach(i=>{i.group==e&&this.childStateChanged(i)},this);return}if(!!e.displayObject)if(e.finalVisible){if(!e.displayObject.parent){let i=0,t=this.$children.length;for(let s=0;s<t;s++){let h=this.$children[s];if(h==e)break;h.displayObject&&h.displayObject.parent&&i++}this.$container.addChildAt(e.displayObject,i)}}else e.displayObject.parent&&this.$container.removeChild(e.displayObject)}}applyController(e){this.$applyingController=e,this.$children.forEach(i=>{i.handleControllerChanged(e)}),this.$applyingController=null,e.executeActions()}applyAllControllers(){this.$controllers.forEach(e=>{this.applyController(e)},this)}adjustRadioGroupDepth(e,i){let t=-1,s=-1;this.$children.forEach((h,n)=>{h==e?t=n:h instanceof r.GButton&&h.relatedController==i&&n>s&&(s=n)}),t<s&&(this.$applyingController!=null&&this.$children[s].handleControllerChanged(this.$applyingController),this.swapChildrenAt(t,s))}getTransitionAt(e){return this.$transitions[e]}getTransition(e){let i=this.$transitions.length;for(let t=0;t<i;++t){let s=this.$transitions[t];if(s.name==e)return s}return null}isChildInView(e){return this.$rootContainer.scrollRect!=null?e.x+e.width>=0&&e.x<=this.width&&e.y+e.height>=0&&e.y<=this.height:this.$scrollPane!=null?this.$scrollPane.isChildInView(e):!0}getFirstChildInView(){let e=this.$children.length;for(let i=0;i<e;++i){let t=this.$children[i];if(this.isChildInView(t))return i}return-1}get scrollPane(){return this.$scrollPane}get opaque(){return this.$opaque}set opaque(e){this.$opaque!=e&&(this.$opaque=e,this.$opaque?this.updateOpaque():this.$rootContainer.hitArea&&this.$rootContainer.hitArea instanceof f.Rectangle&&(this.$rootContainer.hitArea.width=this.$rootContainer.hitArea.height=0))}get margin(){return this.$margin}set margin(e){this.$margin.copy(e),this.$rootContainer.scrollRect!=null&&(this.$container.x=this.$margin.left+this.$alignOffset.x,this.$container.y=this.$margin.top+this.$alignOffset.y),this.handleSizeChanged()}get mask(){return this.$rootContainer.mask}set mask(e){!e||(e instanceof f.Container&&(e.interactive=!1),e instanceof f.Graphics&&(e.isMask=!0),this.$rootContainer.mask=e)}updateOpaque(){this.$rootContainer.hitArea||(this.$rootContainer.hitArea=new f.Rectangle);let e=this.$rootContainer.hitArea;e.x=e.y=0,e.width=this.width,e.height=this.height}updateScrollRect(){let e=this.$rootContainer.scrollRect;e==null&&(e=new f.Rectangle);let i=this.width-this.$margin.right,t=this.height-this.$margin.bottom;e.x=e.y=0,e.width=i,e.height=t,this.$rootContainer.scrollRect=e}setupScroll(e,i,t,s,h,n,l,o){this.$rootContainer==this.$container&&(this.$container=new f.Container,this.$rootContainer.addChild(this.$container)),this.$scrollPane=new r.ScrollPane(this,i,e,t,s,h,n,l,o)}setupOverflow(e){e==1?(this.$rootContainer==this.$container&&(this.$container=new f.Container,this.$rootContainer.addChild(this.$container)),this.updateScrollRect(),this.$container.x=this.$margin.left,this.$container.y=this.$margin.top):(this.$margin.left!=0||this.$margin.top!=0)&&(this.$rootContainer==this.$container&&(this.$container=new f.Container,this.$rootContainer.addChild(this.$container)),this.$container.x=this.$margin.left,this.$container.y=this.$margin.top),this.setBoundsChangedFlag()}handleSizeChanged(){this.$scrollPane?this.$scrollPane.onOwnerSizeChanged():this.$rootContainer.scrollRect!=null&&this.updateScrollRect(),this.$opaque&&this.updateOpaque()}handleGrayedChanged(){let e=this.getController("grayed");e!=null?e.selectedIndex=this.grayed?1:0:super.handleGrayedChanged()}setBoundsChangedFlag(){!this.$scrollPane&&!this.$trackBounds||this.$boundsChanged||(this.$boundsChanged=!0,r.GTimer.inst.callLater(this.$validate,this))}$validate(e){this.$boundsChanged&&this.updateBounds()}ensureBoundsCorrect(){this.$boundsChanged&&this.updateBounds()}updateBounds(){let e=0,i=0,t=0,s=0;if(this.$children.length>0){e=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY;let n=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY,o=0;this.$children.forEach($=>{$.ensureSizeCorrect(),o=$.x,o<e&&(e=o),o=$.y,o<i&&(i=o),o=$.x+$.actualWidth,o>n&&(n=o),o=$.y+$.actualHeight,o>l&&(l=o)}),t=n-e,s=l-i}this.setBounds(e,i,t,s)}setBounds(e,i,t,s=0){this.$boundsChanged=!1,this.$scrollPane&&this.$scrollPane.setContentSize(Math.round(e+t),Math.round(i+s))}get viewWidth(){return this.$scrollPane!=null?this.$scrollPane.viewWidth:this.width-this.$margin.left-this.$margin.right}set viewWidth(e){this.$scrollPane!=null?this.$scrollPane.viewWidth=e:this.width=e+this.$margin.left+this.$margin.right}get viewHeight(){return this.$scrollPane!=null?this.$scrollPane.viewHeight:this.height-this.$margin.top-this.$margin.bottom}set viewHeight(e){this.$scrollPane!=null?this.$scrollPane.viewHeight=e:this.height=e+this.$margin.top+this.$margin.bottom}getSnappingPosition(e,i,t){t||(t=new f.Point);let s=this.$children.length;if(s<=0)return t.x=0,t.y=0,t;this.ensureBoundsCorrect();let h=null,n=null,l=0;if(i!=0){for(;l<s;l++)if(h=this.$children[l],i<h.y)if(l==0){i=0;break}else{n=this.$children[l-1],i<n.y+n.actualHeight/2?i=n.y:i=h.y;break}l==s&&(i=h.y)}if(e!=0){for(l>0&&l--;l<s;l++)if(h=this.$children[l],e<h.x)if(l==0){e=0;break}else{n=this.$children[l-1],e<n.x+n.actualWidth/2?e=n.x:e=h.x;break}l==s&&(e=h.x)}return t.x=e,t.y=i,t}childSortingOrderChanged(e,i,t=0){if(t==0)this.$sortingChildCount--,this.setChildIndex(e,this.$children.length);else{i==0&&this.$sortingChildCount++;let s=this.$children.indexOf(e),h=this.getInsertPosForSortingChild(e);s<h?this.$setChildIndex(e,s,h-1):this.$setChildIndex(e,s,h)}}constructFromResource(){this.constructInternal(null,0)}constructInternal(e,i){let t=this.packageItem.owner.getItemAsset(this.packageItem);this.$inProgressBuilding=!0;let s,h;s=t.attributes.size,h=s.split(","),this.$sourceWidth=parseInt(h[0]),this.$sourceHeight=parseInt(h[1]),this.$initWidth=this.$sourceWidth,this.$initHeight=this.$sourceHeight,this.setSize(this.$sourceWidth,this.$sourceHeight),s=t.attributes.pivot,s&&(h=s.split(","),s=t.attributes.anchor,this.internalSetPivot(parseFloat(h[0]),parseFloat(h[1]),s=="true")),s=t.attributes.opaque,this.opaque=s!="false";let n;if(s=t.attributes.overflow,s?n=r.ParseOverflowType(s):n=0,s=t.attributes.margin,s&&this.$margin.parse(s),n==2){let $;s=t.attributes.scroll,s?$=r.ParseScrollType(s):$=1;let d;s=t.attributes.scrollBar,s?d=r.ParseScrollBarDisplayType(s):d=0;let p;s=t.attributes.scrollBarFlags,s?p=parseInt(s):p=0;let w=new r.utils.Margin;s=t.attributes.scrollBarMargin,s&&w.parse(s);let C,I;s=t.attributes.scrollBarRes,s&&(h=s.split(","),C=h[0],I=h[1]);let m,b;s=t.attributes.ptrRes,s&&(h=s.split(","),m=h[0],b=h[1]),this.setupScroll(w,$,d,p,C,I,m,b)}else this.setupOverflow(n);this.$buildingDisplayList=!0;let l=t.children;l.forEach($=>{if($.nodeName=="controller"){let d=new r.Controller;this.$controllers.push(d),d.$parent=this,d.setup($)}});let o=this.packageItem.displayList;if(o.forEach(($,d)=>{let p;e!=null?p=e[i+d]:$.packageItem?(p=r.UIObjectFactory.newObject($.packageItem),p.packageItem=$.packageItem,p.constructFromResource()):p=r.UIObjectFactory.newObjectDirectly($.type),p.$inProgressBuilding=!0,p.setupBeforeAdd($.desc),p.parent=this,this.$children.push(p)},this),this.relations.setup(t),this.$children.forEach(($,d)=>{$.relations.setup(o[d].desc),$.setupAfterAdd(o[d].desc),$.$inProgressBuilding=!1}),s=t.attributes.mask,s){let $=this.getChildById(s).displayObject;if($ instanceof f.Graphics||$ instanceof f.Sprite)this.mask=$;else throw new Error("only PIXI.Sprite or PIXI.Graphics can be applied as mask object")}l.forEach($=>{if($.nodeName=="transition"){let d=new r.Transition(this);this.$transitions.push(d),d.setup($)}},this),this.$transitions.length>0&&(this.on("added",this.$added,this),this.on("removed",this.$removed,this)),this.applyAllControllers(),this.$buildingDisplayList=!1,this.$inProgressBuilding=!1,this.appendChildrenList(),this.setBoundsChangedFlag(),this.constructFromXML(t),this.onConstruct()}appendChildrenList(){this.$children.forEach(e=>{e.displayObject!=null&&e.finalVisible&&this.$container.addChild(e.displayObject)},this)}constructFromXML(e){}$added(e){this.$transitions.forEach(i=>{i.autoPlay&&i.play({times:i.autoPlayRepeat,delay:i.autoPlayDelay})})}$removed(e){this.$transitions.forEach(i=>{i.stop(!1,!1)})}}r.GComponent=a})(fgui||(fgui={}));(function(r){class a extends r.GComponent{constructor(){super(),this.$mode=0,this.$title="",this.$icon="",this.$pageOption=new r.PageOption,this.$changeStateOnClick=!0,this.$downEffect=0,this.$downEffectValue=.8}setDisplayObject(e){super.setDisplayObject(e),this.$displayObject.buttonMode=!0}get icon(){return this.$icon}set icon(e){this.$icon=e,e=this.$selected&&this.$selectedIcon?this.$selectedIcon:this.$icon,this.$iconObject!=null&&(this.$iconObject.icon=e),this.updateGear(7)}get selectedIcon(){return this.$selectedIcon}set selectedIcon(e){this.$selectedIcon=e,e=this.$selected&&this.$selectedIcon?this.$selectedIcon:this.$icon,this.$iconObject!=null&&(this.$iconObject.icon=e)}get title(){return this.$title}set title(e){this.$title=e,this.$titleObject&&(this.$titleObject.text=this.$selected&&this.$selectedTitle?this.$selectedTitle:this.$title),this.updateGear(6)}get text(){return this.title}set text(e){this.title=e}get selectedTitle(){return this.$selectedTitle}set selectedTitle(e){this.$selectedTitle=e,this.$titleObject&&(this.$titleObject.text=this.$selected&&this.$selectedTitle?this.$selectedTitle:this.$title)}get titleColor(){return r.isColorableTitle(this.$titleObject)?this.$titleObject.titleColor:0}set titleColor(e){r.isColorableTitle(this.$titleObject)&&(this.$titleObject.titleColor=e)}get fontSize(){return r.isColorableTitle(this.$titleObject)?this.$titleObject.fontSize:0}set fontSize(e){r.isColorableTitle(this.$titleObject)&&(this.$titleObject.fontSize=e)}set selected(e){if(this.$mode!=0&&this.$selected!=e){if(this.$selected=e,this.grayed&&this.$buttonController&&this.$buttonController.hasPage(a.DISABLED)?this.$selected?this.setState(a.SELECTED_DISABLED):this.setState(a.DISABLED):this.$selected?this.setState(this.$over?a.SELECTED_OVER:a.DOWN):this.setState(this.$over?a.OVER:a.UP),this.$selectedTitle&&this.$titleObject&&(this.$titleObject.text=this.$selected?this.$selectedTitle:this.$title),this.$selectedIcon){let i=this.$selected?this.$selectedIcon:this.$icon;this.$iconObject!=null&&(this.$iconObject.icon=i)}this.$relatedController&&this.$parent&&!this.$parent.$buildingDisplayList&&(this.$selected?(this.$relatedController.selectedPageId=this.$pageOption.id,this.$relatedController.$autoRadioGroupDepth&&this.$parent.adjustRadioGroupDepth(this,this.$relatedController)):this.$mode==1&&this.$relatedController.selectedPageId==this.$pageOption.id&&(this.$relatedController.oppositePageId=this.$pageOption.id))}}get selected(){return this.$selected}get mode(){return this.$mode}set mode(e){this.$mode!=e&&(e==0&&(this.selected=!1),this.$mode=e)}get relatedController(){return this.$relatedController}set relatedController(e){e!=this.$relatedController&&(this.$relatedController=e,this.$pageOption.controller=e,this.$pageOption.clear())}get pageOption(){return this.$pageOption}get changeStateOnClick(){return this.$changeStateOnClick}set changeStateOnClick(e){this.$changeStateOnClick=e}get linkedPopup(){return this.$linkedPopup}set linkedPopup(e){this.$linkedPopup=e}addStateListener(e,i){this.on(r.StateChangeEvent.CHANGED,e,i)}removeStateListener(e,i){this.off(r.StateChangeEvent.CHANGED,e,i)}fireClick(e=!0){e&&this.$mode==0&&(this.setState(a.OVER),r.GTimer.inst.add(100,1,this.setState,this,a.DOWN),r.GTimer.inst.add(200,1,this.setState,this,a.UP)),this.$click(null)}setState(e){if(this.$buttonController&&(this.$buttonController.selectedPage=e),this.$downEffect==1)if(e==a.DOWN||e==a.SELECTED_OVER||e==a.SELECTED_DISABLED){let i=this.$downEffectValue*255,t=(i<<16)+(i<<8)+i;this.$children.forEach(s=>{r.isColorGear(s)&&(s.color=t)})}else this.$children.forEach(i=>{r.isColorGear(i)&&(i.color=16777215)});else this.$downEffect==2&&(e==a.DOWN||e==a.SELECTED_OVER||e==a.SELECTED_DISABLED?this.setScale(this.$downEffectValue,this.$downEffectValue):this.setScale(1,1))}handleControllerChanged(e){super.handleControllerChanged(e),this.$relatedController==e&&(this.selected=this.$pageOption.id==e.selectedPageId)}handleGrayedChanged(){this.$buttonController&&this.$buttonController.hasPage(a.DISABLED)?this.grayed?this.$selected&&this.$buttonController.hasPage(a.SELECTED_DISABLED)?this.setState(a.SELECTED_DISABLED):this.setState(a.DISABLED):this.$selected?this.setState(a.DOWN):this.setState(a.UP):super.handleGrayedChanged()}constructFromXML(e){super.constructFromXML(e),e=e.getChildNodes("Button")[0];let i;i=e.attributes.mode,i&&(this.$mode=r.ParseButtonMode(i)),i=e.attributes.downEffect,i&&(this.$downEffect=i=="dark"?1:i=="scale"?2:0,i=e.attributes.downEffectValue,this.$downEffectValue=parseFloat(i),this.$downEffect==2&&this.setPivot(.5,.5)),this.$buttonController=this.getController("button"),this.$titleObject=this.getChild("title"),this.$iconObject=this.getChild("icon"),this.$titleObject!=null&&(this.$title=this.$titleObject.text),this.$iconObject!=null&&(this.$icon=this.$iconObject.icon),this.$mode==0&&this.setState(a.UP),this.on(r.InteractiveEvents.Over,this.$rollover,this),this.on(r.InteractiveEvents.Out,this.$rollout,this),this.on(r.InteractiveEvents.Down,this.$mousedown,this),this.on(r.InteractiveEvents.Click,this.$click,this)}setupAfterAdd(e){if(super.setupAfterAdd(e),e=e.getChildNodes("Button")[0],e){let i;i=e.attributes.title,i&&(this.title=i),i=e.attributes.icon,i&&(this.icon=i),i=e.attributes.selectedTitle,i&&(this.selectedTitle=i),i=e.attributes.selectedIcon,i&&(this.selectedIcon=i),i=e.attributes.titleColor,i&&(this.titleColor=r.utils.StringUtil.convertFromHtmlColor(i)),i=e.attributes.titleFontSize,i&&(this.fontSize=parseInt(i)),i=e.attributes.controller,i?this.$relatedController=this.$parent.getController(i):this.$relatedController=null,i=e.attributes.sound,i?this.$clicksound=i:this.$clicksound=null,this.$pageOption.id=e.attributes.page,this.selected=e.attributes.checked=="true"}}$rollover(e){!this.$buttonController||!this.$buttonController.hasPage(a.OVER)||(this.$over=!0,!this.$down&&this.setState(this.$selected?a.SELECTED_OVER:a.OVER))}$rollout(e){!this.$buttonController||!this.$buttonController.hasPage(a.OVER)||(this.$over=!1,!this.$down&&this.setState(this.$selected?a.DOWN:a.UP))}$mousedown(e){this.$down=!0,r.GRoot.inst.on(r.InteractiveEvents.Up,this.$mouseup,this),this.$mode==0&&(this.grayed&&this.$buttonController&&this.$buttonController.hasPage(a.DISABLED)?this.setState(a.SELECTED_DISABLED):this.setState(a.DOWN)),this.$linkedPopup!=null&&(this.$linkedPopup instanceof r.Window?this.$linkedPopup.toggleVisible():this.root.togglePopup(this.$linkedPopup,this))}$mouseup(e){this.$down&&(r.GRoot.inst.off(r.InteractiveEvents.Up,this.$mouseup,this),this.$down=!1,this.$mode==0&&(this.grayed&&this.$buttonController&&this.$buttonController.hasPage(a.DISABLED)?this.setState(a.DISABLED):this.$over?this.setState(a.OVER):this.setState(a.UP)))}$click(e){if(!!this.$changeStateOnClick)if(this.$mode==1?(this.selected=!this.$selected,this.emit(r.StateChangeEvent.CHANGED,this)):this.$mode==2&&(this.$selected||(this.selected=!0,this.emit(r.StateChangeEvent.CHANGED,this))),this.$clicksound){var i=this.packageItem.owner.name,t=r.UIPackage.getItemByURL(this.$clicksound);if(t){var s=r.utils.Assets.get(`${i}@${t.id}`);this.playSound(s)}}else r.UIConfig.defaultButtonSound&&this.playSound(r.UIConfig.defaultButtonSound)}playSound(e){return bt(this,void 0,void 0,function*(){if(f.sound){let i=f.sound.Sound;e.sound?e.play():i.from(e).play(s=>s.destroy())}})}dispose(){r.GTimer.inst.remove(this.setState,this),r.GTimer.inst.remove(this.setState,this),r.GRoot.inst.off(r.InteractiveEvents.Up,this.$mouseup,this),super.dispose()}}a.UP="up",a.DOWN="down",a.OVER="over",a.SELECTED_OVER="selectedOver",a.DISABLED="disabled",a.SELECTED_DISABLED="selectedDisabled",r.GButton=a})(fgui||(fgui={}));(function(r){class a extends r.GComponent{constructor(){super(),this.$visibleItemCount=0,this.$selectedIndex=0,this.$popupDir=1,this.$visibleItemCount=r.UIConfig.defaultComboBoxVisibleItemCount,this.$itemsUpdated=!0,this.$selectedIndex=-1,this.$items=[],this.$values=[]}get text(){return this.$titleObject?this.$titleObject.text:null}set text(e){this.$titleObject&&(this.$titleObject.text=e),this.updateGear(6)}get icon(){return this.$iconObject?this.$iconObject.icon:null}set icon(e){this.$iconObject&&(this.$iconObject.icon=e),this.updateGear(7)}get titleColor(){return r.isColorableTitle(this.$titleObject)?this.$titleObject.titleColor:0}set titleColor(e){r.isColorableTitle(this.$titleObject)&&(this.$titleObject.titleColor=e)}get visibleItemCount(){return this.$visibleItemCount}set visibleItemCount(e){this.$visibleItemCount=e}get popupDirection(){return this.$popupDir}set popupDirection(e){this.$popupDir=e}get items(){return this.$items}set items(e){e?this.$items=e.concat():this.$items.length=0,this.$items.length>0?(this.$selectedIndex>=this.$items.length?this.$selectedIndex=this.$items.length-1:this.$selectedIndex==-1&&(this.$selectedIndex=0),this.text=this.$items[this.$selectedIndex],this.$icons!=null&&this.$selectedIndex<this.$icons.length&&(this.icon=this.$icons[this.$selectedIndex])):(this.text="",this.$icons!=null&&(this.icon=null),this.$selectedIndex=-1),this.$itemsUpdated=!0}get icons(){return this.$icons}set icons(e){this.$icons=e,this.$icons!=null&&this.$selectedIndex!=-1&&this.$selectedIndex<this.$icons.length&&(this.icon=this.$icons[this.$selectedIndex])}get values(){return this.$values}set values(e){e?this.$values=e.concat():this.$values.length=0}get selectedIndex(){return this.$selectedIndex}set selectedIndex(e){this.$selectedIndex!=e&&(this.$selectedIndex=e,this.selectedIndex>=0&&this.selectedIndex<this.$items.length?(this.text=this.$items[this.$selectedIndex],this.$icons!=null&&this.$selectedIndex<this.$icons.length&&(this.icon=this.$icons[this.$selectedIndex])):(this.text="",this.$icons!=null&&(this.icon=null)))}get value(){return this.$values[this.$selectedIndex]}set value(e){this.selectedIndex=this.$values.indexOf(e)}setState(e){this.$buttonController&&(this.$buttonController.selectedPage=e)}constructFromXML(e){super.constructFromXML(e),e=e.getChildNodes("ComboBox")[0];let i;if(this.$buttonController=this.getController("button"),this.$titleObject=this.getChild("title"),this.$iconObject=this.getChild("icon"),i=e.attributes.dropdown,i){if(this.$dropdown=r.UIPackage.createObjectFromURL(i),!this.$dropdown)throw new Error("the 'dropdown' is not specified, it must be a component definied in the package pool");if(this.$dropdown.name="this.dropdown",this.$list=this.$dropdown.getChild("list"),this.$list==null)throw new Error(`${this.resourceURL}: the dropdown component must have a GList child and named 'list'.`);this.$list.on(r.ListEvent.ItemClick,this.$clickItem,this),this.$list.addRelation(this.$dropdown,14),this.$list.removeRelation(this.$dropdown,15),this.$dropdown.addRelation(this.$list,15),this.$dropdown.removeRelation(this.$list,14),this.$dropdown.on("removed",this.$popupWinClosed,this)}f.utils.isMobile.any||(this.on(r.InteractiveEvents.Over,this.$rollover,this),this.on(r.InteractiveEvents.Out,this.$rollout,this)),this.on(r.InteractiveEvents.Down,this.$mousedown,this)}dispose(){r.GTimer.inst.remove(this.delayedClickItem,this),this.$list.off(r.ListEvent.ItemClick,this.$clickItem,this),this.$dropdown.off("removed",this.$popupWinClosed,this),this.$owner.off(r.InteractiveEvents.Up,this.$mouseup,this),this.$popupWinClosed(null),this.$dropdown&&(this.$dropdown.dispose(),this.$dropdown=null),super.dispose()}setupAfterAdd(e){if(super.setupAfterAdd(e),e=e.getChildNodes("ComboBox")[0],e){let i;i=e.attributes.titleColor,i&&(this.titleColor=r.utils.StringUtil.convertFromHtmlColor(i)),i=e.attributes.visibleItemCount,i&&(this.$visibleItemCount=parseInt(i));let t=e.children;t&&t.forEach((s,h)=>{s.nodeName=="item"&&(this.$items.push(s.attributes.title),this.$values.push(s.attributes.value),i=s.attributes.icon,i&&(this.$icons||(this.$icons=new Array(length)),this.$icons[h]=i))}),i=e.attributes.title,i?(this.text=i,this.$selectedIndex=this.$items.indexOf(i)):this.$items.length>0?(this.$selectedIndex=0,this.text=this.$items[0]):this.$selectedIndex=-1,i=e.attributes.icon,i&&(this.icon=i),i=e.attributes.direction,i&&(i=="up"?this.$popupDir=2:i=="auto"&&(this.$popupDir=0))}}showDropdown(){this.$itemsUpdated&&(this.$itemsUpdated=!1,this.$list.removeChildrenToPool(),this.$items.forEach((e,i)=>{let t=this.$list.addItemFromPool();t.name=i<this.$values.length?this.$values[i]:"",t.text=this.$items[i],t.icon=this.$icons!=null&&i<this.$icons.length?this.$icons[i]:null},this),this.$list.resizeToFit(this.$visibleItemCount)),this.$list.selectedIndex=-1,this.$dropdown.width=this.width,this.root.togglePopup(this.$dropdown,this,this.$popupDir),this.$dropdown.parent&&this.setState(r.GButton.DOWN)}$popupWinClosed(e){this.$over?this.setState(r.GButton.OVER):this.setState(r.GButton.UP)}$clickItem(e,i){r.GTimer.inst.add(100,1,this.delayedClickItem,this,this.$list.getChildIndex(i))}delayedClickItem(e){this.$dropdown.parent instanceof r.GRoot&&this.$dropdown.parent.hidePopup(),this.$selectedIndex=e,this.$selectedIndex>=0?this.text=this.$items[this.$selectedIndex]:this.text="",this.emit(r.StateChangeEvent.CHANGED,this)}$rollover(e){this.$over=!0,!(this.$down||this.$dropdown&&this.$dropdown.parent)&&this.setState(r.GButton.OVER)}$rollout(e){this.$over=!1,!(this.$down||this.$dropdown&&this.$dropdown.parent)&&this.setState(r.GButton.UP)}$mousedown(e){e.stopPropagation(),r.GRoot.inst.checkPopups(e.target),this.$down=!0,this.$owner.on(r.InteractiveEvents.Up,this.$mouseup,this),this.$dropdown&&this.showDropdown()}$mouseup(e){this.$down&&(this.$down=!1,this.$owner.off(r.InteractiveEvents.Up,this.$mouseup,this),this.$dropdown&&!this.$dropdown.parent&&(this.$over?this.setState(r.GButton.OVER):this.setState(r.GButton.UP)))}}r.GComboBox=a})(fgui||(fgui={}));(function(r){class a extends r.GObject{constructor(){super(),this.$type=0,this.$lineSize=0,this.$lineColor=0,this.$fillColor=0,this.$lineSize=1,this.$lineAlpha=1,this.$fillAlpha=1,this.$fillColor=16777215}drawRect(e,i,t,s,h,n=null){this.$type=1,this.$lineSize=e,this.$lineColor=i,this.$lineAlpha=t,this.$fillColor=s,this.$fillAlpha=h,this.$corner=n,this.drawGraph()}drawEllipse(e,i,t,s,h){this.$type=2,this.$lineSize=e,this.$lineColor=i,this.$lineAlpha=t,this.$fillColor=s,this.$fillAlpha=h,this.$corner=null,this.drawGraph()}get color(){return this.$fillColor}set color(e){this.$fillColor=e,this.$type!=0&&this.drawGraph()}drawGraph(){let e=this.$displayObject;e.interactive=this.touchable,e.clear();let i=this.width,t=this.height;if(!(i==0||t==0)){if(this.$lineSize==0?e.lineStyle(0,0,0):e.lineStyle(this.$lineSize,this.$lineColor,this.$lineAlpha),e.beginFill(this.$fillColor,this.$fillAlpha),this.$type==1)this.$corner&&this.$corner.length>=1?e.drawRoundedRect(0,0,i,t,this.$corner[0]):e.drawRect(0,0,i,t);else{let s=i*.5,h=t*.5;i==t?e.drawCircle(s,s,s):e.drawEllipse(s,h,s,h)}e.endFill()}}replaceMe(e){if(!this.$parent)throw new Error("parent not set");e.name=this.name,e.alpha=this.alpha,e.rotation=this.rotation,e.visible=this.visible,e.touchable=this.touchable,e.grayed=this.grayed,e.setXY(this.x,this.y),e.setSize(this.width,this.height);let i=this.$parent.getChildIndex(this);this.$parent.addChildAt(e,i),e.relations.copyFrom(this.relations),this.$parent.removeChild(this,!0)}addBeforeMe(e){if(this.$parent==null)throw new Error("parent not set");let i=this.$parent.getChildIndex(this);this.$parent.addChildAt(e,i)}addAfterMe(e){if(this.$parent==null)throw new Error("parent not set");let i=this.$parent.getChildIndex(this);i++,this.$parent.addChildAt(e,i)}setNativeObject(e){this.$type=0;let i=this.$displayObject;i.interactive=this.touchable,i.clear(),i.removeChildren(),i.addChild(e)}createDisplayObject(){this.$displayObject=new r.UISprite(this)}handleSizeChanged(){this.$type!=0&&this.drawGraph()}setupBeforeAdd(e){super.setupBeforeAdd(e);let i=e.attributes.type;if(i&&i!="empty"){let t;t=e.attributes.lineSize,t&&(this.$lineSize=parseInt(t));let s;t=e.attributes.lineColor,t&&(s=r.utils.StringUtil.convertFromHtmlColor(t,!0),this.$lineColor=s&16777215,this.$lineAlpha=(s>>24&255)/255),t=e.attributes.fillColor,t&&(s=r.utils.StringUtil.convertFromHtmlColor(t,!0),this.$fillColor=s&16777215,this.$fillAlpha=(s>>24&255)/255);let h;t=e.attributes.corner,t&&(h=t.split(","),h.length>1?this.$corner=[parseInt(h[0]),parseInt(h[1]),parseInt(h[2]),parseInt(h[3])]:this.$corner=[parseInt(h[0])]),i=="rect"?this.$type=1:this.$type=2,this.drawGraph()}}}r.GGraph=a})(fgui||(fgui={}));(function(r){class a extends r.GObject{createDisplayObject(){let e=new r.UIContainer(this);e.interactive=!1,this.setDisplayObject(e)}updateBounds(){if(this.$updating||!this.parent)return;let e=this.$parent.numChildren,i=0,t=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY;this.$empty=!0;let l,o=0;for(i=0;i<e;i++)l=this.$parent.getChildAt(i),l.group==this&&(o=l.x,o<t&&(t=o),o=l.y,o<s&&(s=o),o=l.x+l.width,o>h&&(h=o),o=l.y+l.height,o>n&&(n=o),this.$empty=!1);this.$updating=!0,this.$empty?this.setSize(0,0):(this.setXY(t,s),this.setSize(h-t,n-s)),this.$updating=!1}setXY(e,i){if(this.$x!=e||this.$y!=i){let t=e-this.$x,s=i-this.$y;super.setXY(e,i),this.moveChildren(t,s)}}moveChildren(e,i){if(this.$updating||!this.$parent)return;this.$updating=!0;let t=this.$parent.numChildren,s=0,h;for(s=0;s<t;s++)h=this.$parent.getChildAt(s),h.group==this&&h.setXY(h.x+e,h.y+i);this.$updating=!1}updateAlpha(){if(super.updateAlpha(),this.$inProgressBuilding)return;let e=this.$parent.numChildren,i,t;for(i=0;i<e;i++)t=this.$parent.getChildAt(i),t.group==this&&(t.alpha=this.alpha)}}r.GGroup=a})(fgui||(fgui={}));(function(r){class a extends r.GObject{constructor(){super()}get touchable(){return!1}set touchable(e){this.$touchable=!1}get color(){return this.$content.tint}set color(e){this.color!=e&&(this.updateGear(4),this.$content.tint=e)}get flip(){return this.$flip}set flip(e){if(this.$flip!=e){this.$flip=e;let i=!1,t=!1;(this.$flip==1||this.$flip==3)&&(i=!0),(this.$flip==2||this.$flip==3)&&(t=!0),this.$content.flipX=i,this.$content.flipY=t}}get texture(){return this.$content.texture}set texture(e){e!=null?(this.$sourceWidth=e.orig.width,this.$sourceHeight=e.orig.height):this.$sourceWidth=this.$sourceHeight=0,this.$initWidth=this.$sourceWidth,this.$initHeight=this.$sourceHeight,this.$content.texture=e}createDisplayObject(){this.$content=new r.UIImage(this),this.setDisplayObject(this.$content)}dispose(){this.$content.destroy(),super.dispose()}constructFromResource(){this.$sourceWidth=this.packageItem.width,this.$sourceHeight=this.packageItem.height,this.$initWidth=this.$sourceWidth,this.$initHeight=this.$sourceHeight,this.$content.$initDisp(this.packageItem),this.setSize(this.$sourceWidth,this.$sourceHeight)}handleXYChanged(){super.handleXYChanged(),this.$flip!=0&&(this.$content.scale.x==-1&&(this.$content.x+=this.width),this.$content.scale.y==-1&&(this.$content.y+=this.height))}handleSizeChanged(){this.$content.width=this.width,this.$content.height=this.height}setupBeforeAdd(e){super.setupBeforeAdd(e);let i;i=e.attributes.color,i&&(this.color=r.utils.StringUtil.convertFromHtmlColor(i)),i=e.attributes.flip,i&&(this.flip=r.ParseFlipType(i))}}r.GImage=a})(fgui||(fgui={}));(function(r){class a extends r.GComponent{constructor(){super()}get icon(){return this.$iconObject!=null?this.$iconObject.icon:null}set icon(e){this.$iconObject!=null&&(this.$iconObject.icon=e),this.updateGear(7)}get title(){return this.$titleObject?this.$titleObject.text:null}set title(e){this.$titleObject&&(this.$titleObject.text=e),this.updateGear(6)}get text(){return this.title}set text(e){this.title=e}get titleColor(){return r.isColorableTitle(this.$titleObject)?this.$titleObject.titleColor:0}set titleColor(e){r.isColorableTitle(this.$titleObject)&&(this.$titleObject.titleColor=e)}get fontSize(){return r.isColorableTitle(this.$titleObject)?this.$titleObject.fontSize:0}set fontSize(e){r.isColorableTitle(this.$titleObject)&&(this.$titleObject.fontSize=e)}set editable(e){this.$titleObject&&(this.$titleObject.editable=e)}get editable(){return this.$titleObject&&this.$titleObject instanceof r.GTextInput?this.$titleObject.editable:!1}constructFromXML(e){super.constructFromXML(e),this.$titleObject=this.getChild("title"),this.$iconObject=this.getChild("icon")}setupAfterAdd(e){super.setupAfterAdd(e);let i=e.getChildNodes("Label");if(i&&i.length>0){e=i[0];let t;if(t=e.attributes.title,t&&(this.text=t),t=e.attributes.icon,t&&(this.icon=t),t=e.attributes.titleColor,t&&(this.titleColor=r.utils.StringUtil.convertFromHtmlColor(t)),this.$titleObject instanceof r.GTextInput){t=e.attributes.prompt;let s=this.$titleObject;t&&(s.promptText=t),t=e.attributes.maxLength,t&&(s.maxLength=parseInt(t)),t=e.attributes.restrict,t&&(s.restrict=t),t=e.attributes.password,t&&(s.password=t=="true")}}}}r.GLabel=a})(fgui||(fgui={}));(function(r){class a{constructor(){this.width=0,this.height=0,this.updateFlag=0,this.selected=!1}}class c extends r.GComponent{constructor(){super(),this.$lineCount=0,this.$columnCount=0,this.$lineGap=0,this.$columnGap=0,this.$lastSelectedIndex=0,this.$numItems=0,this.$firstIndex=0,this.$curLineItemCount=0,this.$virtualListChanged=0,this.$apexIndex=0,this.$childrenRenderOrder=0,this.$itemInfoVer=0,this.$enterCounter=0,this.$trackBounds=!0,this.$pool=new r.utils.GObjectRecycler,this.$layout=0,this.$autoResizeItem=!0,this.$lastSelectedIndex=-1,this.$selectionMode=0,this.opaque=!0,this.scrollItemToViewOnClick=!0,this.$align="left",this.$verticalAlign=0,this.$container=new r.UIContainer,this.$rootContainer.addChild(this.$container)}get childrenRenderOrder(){return this.$childrenRenderOrder}set childrenRenderOrder(i){this.$childrenRenderOrder!=i&&(this.$childrenRenderOrder=i,this.appendChildrenList())}get apexIndex(){return this.$apexIndex}set apexIndex(i){this.$apexIndex!=i&&(this.$apexIndex=i,this.$childrenRenderOrder==2&&this.appendChildrenList())}appendChildrenList(){let i=this.$children.length;if(i==0)return;let t,s;switch(this.$childrenRenderOrder){case 0:for(t=0;t<i;t++)s=this.$children[t],s.displayObject!=null&&s.finalVisible&&this.$container.addChild(s.displayObject);break;case 1:for(t=i-1;t>=0;t--)s=this.$children[t],s.displayObject!=null&&s.finalVisible&&this.$container.addChild(s.displayObject);break;case 2:{for(t=0;t<this.$apexIndex;t++)s=this.$children[t],s.displayObject!=null&&s.finalVisible&&this.$container.addChild(s.displayObject);for(t=i-1;t>=this.$apexIndex;t--)s=this.$children[t],s.displayObject!=null&&s.finalVisible&&this.$container.addChild(s.displayObject)}break}}setXY(i,t){(this.$x!=i||this.$y!=t)&&(this.$x=i,this.$y=t,this.handleXYChanged(),this.updateGear(1),r.GObject.draggingObject==this&&!r.GObject.sUpdatingWhileDragging&&this.localToGlobalRect(0,0,this.width,this.height,r.GObject.sGlobalRect))}$setChildIndex(i,t,s=0){let h=this.$children.length;if(s>h&&(s=h),t==s)return t;if(this.$children.splice(t,1),this.$children.splice(s,0,i),i.inContainer){let n=0,l,o;if(this.$childrenRenderOrder==0){for(o=0;o<s;o++)l=this.$children[o],l.inContainer&&n++;n==this.$container.children.length&&n--,this.$container.setChildIndex(i.displayObject,n)}else if(this.$childrenRenderOrder==1){for(o=h-1;o>s;o--)l=this.$children[o],l.inContainer&&n++;n==this.$container.children.length&&n--,this.$container.setChildIndex(i.displayObject,n)}else r.GTimer.inst.callLater(this.appendChildrenList,this);this.setBoundsChangedFlag()}return s}childStateChanged(i){if(!this.$buildingDisplayList){if(i instanceof r.GGroup){this.$children.forEach(t=>{t.group==i&&this.childStateChanged(t)},this);return}if(!!i.displayObject)if(i.finalVisible){let t,s,h=this.$children.length;if(!i.displayObject.parent){let n=0;if(this.$childrenRenderOrder==0){for(let l=0;l<h&&(s=this.$children[l],s!=i);l++)s.displayObject!=null&&s.displayObject.parent!=null&&n++;this.$container.addChildAt(i.displayObject,n)}else if(this.$childrenRenderOrder==1){for(t=h-1;t>=0&&(s=this.$children[t],s!=i);t--)s.displayObject!=null&&s.displayObject.parent!=null&&n++;this.$container.addChildAt(i.displayObject,n)}else this.$container.addChild(i.displayObject),r.GTimer.inst.callLater(this.appendChildrenList,this)}}else i.displayObject.parent&&this.$container.removeChild(i.displayObject)}}dispose(){r.GTimer.inst.remove(this.$refreshVirtualList,this),this.$pool.clear(),this.$scrollPane&&this.$scrollPane.off(r.ScrollEvent.SCROLL,this.$scrolled,this),super.dispose()}get layout(){return this.$layout}set layout(i){this.$layout!=i&&(this.$layout=i,this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0))}get lineCount(){return this.$lineCount}set lineCount(i){this.$lineCount!=i&&(this.$lineCount=i,(this.$layout==3||this.$layout==4)&&(this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0)))}get columnCount(){return this.$columnCount}set columnCount(i){this.$columnCount!=i&&(this.$columnCount=i,(this.$layout==2||this.$layout==4)&&(this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0)))}get lineGap(){return this.$lineGap}set lineGap(i){this.$lineGap!=i&&(this.$lineGap=i,this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0))}get columnGap(){return this.$columnGap}set columnGap(i){this.$columnGap!=i&&(this.$columnGap=i,this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0))}get align(){return this.$align}set align(i){this.$align!=i&&(this.$align=i,this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0))}get verticalAlign(){return this.$verticalAlign}set verticalAlign(i){this.$verticalAlign!=i&&(this.$verticalAlign=i,this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0))}get virtualItemSize(){return this.$itemSize}set virtualItemSize(i){this.$virtual&&(this.$itemSize==null&&(this.$itemSize=new f.Point),this.$itemSize.copyFrom(i),this.setVirtualListChangedFlag(!0))}get defaultItem(){return this.$defaultItem}set defaultItem(i){this.$defaultItem=i}get autoResizeItem(){return this.$autoResizeItem}set autoResizeItem(i){this.$autoResizeItem!=i&&(this.$autoResizeItem=i,this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0))}get selectionMode(){return this.$selectionMode}set selectionMode(i){this.$selectionMode=i}get selectionController(){return this.$selectionController}set selectionController(i){this.$selectionController=i}get itemPool(){return this.$pool}getFromPool(i=null){i||(i=this.$defaultItem);let t=this.$pool.get(i);return t!=null&&(t.visible=!0),t}returnToPool(i){this.$pool.recycle(i.resourceURL,i)}addChildAt(i,t=0){return super.addChildAt(i,t),i instanceof r.GButton&&(i.selected=!1,i.changeStateOnClick=!1),i.click(this.$clickItem,this),i}addItem(i=null){return i||(i=this.$defaultItem),this.addChild(r.UIPackage.createObjectFromURL(i))}addItemFromPool(i=null){return this.addChild(this.getFromPool(i))}removeChildAt(i,t=!1){if(i>=0&&i<this.numChildren){let s=this.$children[i];if(!s)debugger;return s.parent=null,s.sortingOrder!=0&&this.$sortingChildCount--,this.$children.splice(i,1),s.inContainer&&(this.$container.removeChild(s.displayObject),this.$childrenRenderOrder==2&&r.GTimer.inst.callLater(this.appendChildrenList,this)),t===!0&&s.dispose(),this.setBoundsChangedFlag(),s.removeClick(this.$clickItem,this),s}else throw new Error("Invalid child index")}removeChildToPoolAt(i){let t=this.removeChildAt(i);this.returnToPool(t)}removeChildToPool(i){super.removeChild(i),this.returnToPool(i)}removeChildrenToPool(i=0,t=-1){(t<0||t>=this.$children.length)&&(t=this.$children.length-1);for(let s=i;s<=t;++s)this.removeChildToPoolAt(i)}get selectedIndex(){let i;if(this.$virtual)for(i=0;i<this.$realNumItems;i++){let t=this.$virtualItems[i];if(t.obj instanceof r.GButton&&t.obj.selected||t.obj==null&&t.selected)return this.$loop?i%this.$numItems:i}else{let t=this.$children.length;for(i=0;i<t;i++){let s=this.$children[i];if(s!=null&&s.selected)return i}}return-1}set selectedIndex(i){i>=0&&i<this.numItems?(this.selectionMode!=0&&this.clearSelection(),this.addSelection(i)):this.clearSelection()}getSelection(){let i=[],t;if(this.$virtual)for(t=0;t<this.$realNumItems;t++){let s=this.$virtualItems[t];if(s.obj instanceof r.GButton&&s.obj.selected||s.obj==null&&s.selected){let h=t;if(this.$loop&&(h=t%this.$numItems,i.indexOf(h)!=-1))continue;i.push(h)}}else{let s=this.$children.length;for(t=0;t<s;t++){let h=this.$children[t];h!=null&&h.selected&&i.push(t)}}return i}addSelection(i,t=!1){if(this.$selectionMode==3)return;this.checkVirtualList(),this.$selectionMode==0&&this.clearSelection(),t&&this.scrollToView(i),this.$lastSelectedIndex=i;let s=null;if(this.$virtual){let h=this.$virtualItems[i];h.obj!=null&&(s=h.obj),h.selected=!0}else s=this.getChildAt(i);s!=null&&!s.selected&&(s.selected=!0,this.updateSelectionController(i))}removeSelection(i){if(this.$selectionMode==3)return;let t=null;if(this.$virtual){let s=this.$virtualItems[i];s.obj!=null&&(t=s.obj),s.selected=!1}else t=this.getChildAt(i);t!=null&&(t.selected=!1)}clearSelection(){let i;if(this.$virtual)for(i=0;i<this.$realNumItems;i++){let t=this.$virtualItems[i];t.obj instanceof r.GButton&&(t.obj.selected=!1),t.selected=!1}else{let t=this.$children.length;for(i=0;i<t;i++){let s=this.$children[i];s!=null&&(s.selected=!1)}}}clearSelectionExcept(i){let t;if(this.$virtual)for(t=0;t<this.$realNumItems;t++){let s=this.$virtualItems[t];s.obj!=i&&(s.obj instanceof r.GButton&&(s.obj.selected=!1),s.selected=!1)}else{let s=this.$children.length;for(t=0;t<s;t++){let h=this.$children[t];h!=null&&h!=i&&(h.selected=!1)}}}selectAll(){this.checkVirtualList();let i=-1,t;if(this.$virtual)for(t=0;t<this.$realNumItems;t++){let s=this.$virtualItems[t];s.obj instanceof r.GButton&&!s.obj.selected&&(s.obj.selected=!0,i=t),s.selected=!0}else{let s=this.$children.length;for(t=0;t<s;t++){let h=this.$children[t];h!=null&&!h.selected&&(h.selected=!0,i=t)}}i!=-1&&this.updateSelectionController(i)}selectNone(){this.clearSelection()}selectReverse(){this.checkVirtualList();let i=-1,t;if(this.$virtual)for(t=0;t<this.$realNumItems;t++){let s=this.$virtualItems[t];s.obj instanceof r.GButton&&(s.obj.selected=!s.obj.selected,s.obj.selected&&(i=t)),s.selected=!s.selected}else{let s=this.$children.length;for(t=0;t<s;t++){let h=this.$children[t];h!=null&&(h.selected=!h.selected,h.selected&&(i=t))}}i!=-1&&this.updateSelectionController(i)}handleArrowKey(i){let t=this.selectedIndex;if(t==-1)return;let s,h,n,l;switch(i){case 38:if(this.$layout==0||this.$layout==3)t--,t>=0&&(this.clearSelection(),this.addSelection(t,!0));else if(this.$layout==2||this.$layout==4){for(s=this.$children[t],h=0,n=t-1;n>=0;n--){if(l=this.$children[n],l.y!=s.y){s=l;break}h++}for(;n>=0;n--)if(l=this.$children[n],l.y!=s.y){this.clearSelection(),this.addSelection(n+h+1,!0);break}}break;case 39:if(this.$layout==1||this.$layout==2||this.$layout==4)t++,t<this.$children.length&&(this.clearSelection(),this.addSelection(t,!0));else if(this.$layout==3){s=this.$children[t],h=0;let o=this.$children.length;for(n=t+1;n<o;n++){if(l=this.$children[n],l.x!=s.x){s=l;break}h++}for(;n<o;n++)if(l=this.$children[n],l.x!=s.x){this.clearSelection(),this.addSelection(n-h-1,!0);break}}break;case 40:if(this.$layout==0||this.$layout==3)t++,t<this.$children.length&&(this.clearSelection(),this.addSelection(t,!0));else if(this.$layout==2||this.$layout==4){s=this.$children[t],h=0;let o=this.$children.length;for(n=t+1;n<o;n++){if(l=this.$children[n],l.y!=s.y){s=l;break}h++}for(;n<o;n++)if(l=this.$children[n],l.y!=s.y){this.clearSelection(),this.addSelection(n-h-1,!0);break}}break;case 37:if(this.$layout==1||this.$layout==2||this.$layout==4)t--,t>=0&&(this.clearSelection(),this.addSelection(t,!0));else if(this.$layout==3){for(s=this.$children[t],h=0,n=t-1;n>=0;n--){if(l=this.$children[n],l.x!=s.x){s=l;break}h++}for(;n>=0;n--)if(l=this.$children[n],l.x!=s.x){this.clearSelection(),this.addSelection(n+h+1,!0);break}}break}}$clickItem(i){if(this.$scrollPane!=null&&this.$scrollPane.isDragging)return;let t=r.GObject.castFromNativeObject(i.currentTarget);!t||(this.setSelectionOnEvent(t),this.$scrollPane&&this.scrollItemToViewOnClick&&this.$scrollPane.scrollToView(t,!0),this.emit(r.ListEvent.ItemClick,i,t))}setSelectionOnEvent(i){if(!(i instanceof r.GButton)||this.$selectionMode==3)return;let t=!1,s=this.childIndexToItemIndex(this.getChildIndex(i));if(this.$selectionMode==0)i.selected||(this.clearSelectionExcept(i),i.selected=!0);else if(r.utils.DOMEventManager.inst.isKeyPressed(16)){if(!i.selected)if(this.$lastSelectedIndex!=-1){let h=Math.min(this.$lastSelectedIndex,s),n=Math.min(Math.max(this.$lastSelectedIndex,s),this.numItems-1),l;if(this.$virtual)for(l=h;l<=n;l++){let o=this.$virtualItems[l];o.obj instanceof r.GButton&&(o.obj.selected=!0),o.selected=!0}else for(l=h;l<=n;l++){let o=this.getChildAt(l);o!=null&&(o.selected=!0)}t=!0}else i.selected=!0}else r.utils.DOMEventManager.inst.isKeyPressed(17)||this.$selectionMode==2?i.selected=!i.selected:i.selected?this.clearSelectionExcept(i):(this.clearSelectionExcept(i),i.selected=!0);t||(this.$lastSelectedIndex=s),i.selected&&this.updateSelectionController(s)}resizeToFit(i=1e6,t=0){this.ensureBoundsCorrect();let s=this.numItems;if(i>s&&(i=s),this.$virtual){let h=Math.ceil(i/this.$curLineItemCount);this.$layout==0||this.$layout==2?this.viewHeight=h*this.$itemSize.y+Math.max(0,h-1)*this.$lineGap:this.viewWidth=h*this.$itemSize.x+Math.max(0,h-1)*this.$columnGap}else if(i==0)this.$layout==0||this.$layout==2?this.viewHeight=t:this.viewWidth=t;else{let h=i-1,n;for(;h>=0&&(n=this.getChildAt(h),!(!this.foldInvisibleItems||n.visible));)h--;if(h<0)this.$layout==0||this.$layout==2?this.viewHeight=t:this.viewWidth=t;else{let l=0;this.$layout==0||this.$layout==2?(l=n.y+n.height,l<t&&(l=t),this.viewHeight=l):(l=n.x+n.width,l<t&&(l=t),this.viewWidth=l)}}}getMaxItemWidth(){let i=this.$children.length,t=0;for(let s=0;s<i;s++){let h=this.getChildAt(s);h.width>t&&(t=h.width)}return t}handleSizeChanged(){super.handleSizeChanged(),this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0)}handleControllerChanged(i){super.handleControllerChanged(i),this.$selectionController==i&&(this.selectedIndex=i.selectedIndex)}updateSelectionController(i){if(this.$selectionController!=null&&!this.$selectionController.$updating&&i<this.$selectionController.pageCount){let t=this.$selectionController;this.$selectionController=null,t.selectedIndex=i,this.$selectionController=t}}getSnappingPosition(i,t,s=null){if(this.$virtual){s||(s=new f.Point);let h,n;return this.$layout==0||this.$layout==2?(h=t,c.$lastPosHelper=t,n=this.getIndexOnPos1(!1),t=c.$lastPosHelper,n<this.$virtualItems.length&&h-t>this.$virtualItems[n].height/2&&n<this.$realNumItems&&(t+=this.$virtualItems[n].height+this.$lineGap)):this.$layout==1||this.$layout==3?(h=i,c.$lastPosHelper=i,n=this.getIndexOnPos2(!1),i=c.$lastPosHelper,n<this.$virtualItems.length&&h-i>this.$virtualItems[n].width/2&&n<this.$realNumItems&&(i+=this.$virtualItems[n].width+this.$columnGap)):(h=i,c.$lastPosHelper=i,n=this.getIndexOnPos3(!1),i=c.$lastPosHelper,n<this.$virtualItems.length&&h-i>this.$virtualItems[n].width/2&&n<this.$realNumItems&&(i+=this.$virtualItems[n].width+this.$columnGap)),s.x=i,s.y=t,s}else return super.getSnappingPosition(i,t,s)}scrollToView(i,t=!1,s=!1){if(this.$virtual){if(this.$numItems==0)return;if(this.checkVirtualList(),i>=this.$virtualItems.length)throw new Error(`Invalid child index: ${i} is larger than max length: ${this.$virtualItems.length}`);this.$loop&&(i=Math.floor(this.$firstIndex/this.$numItems)*this.$numItems+i);let h,n=this.$virtualItems[i],l=0,o;if(this.$layout==0||this.$layout==2){for(o=0;o<i;o+=this.$curLineItemCount)l+=this.$virtualItems[o].height+this.$lineGap;h=new f.Rectangle(0,l,this.$itemSize.x,n.height)}else if(this.$layout==1||this.$layout==3){for(o=0;o<i;o+=this.$curLineItemCount)l+=this.$virtualItems[o].width+this.$columnGap;h=new f.Rectangle(l,0,n.width,this.$itemSize.y)}else{let $=i/(this.$curLineItemCount*this.$curLineItemCount2);h=new f.Rectangle($*this.viewWidth+i%this.$curLineItemCount*(n.width+this.$columnGap),i/this.$curLineItemCount%this.$curLineItemCount2*(n.height+this.$lineGap),n.width,n.height)}s=!0,this.$scrollPane!=null&&this.$scrollPane.scrollToView(h,t,s)}else{let h=this.getChildAt(i);this.$scrollPane!=null?this.$scrollPane.scrollToView(h,t,s):this.parent!=null&&this.parent.scrollPane!=null&&this.parent.scrollPane.scrollToView(h,t,s)}}getFirstChildInView(){return this.childIndexToItemIndex(super.getFirstChildInView())}childIndexToItemIndex(i){if(!this.$virtual)return i;if(this.$layout==4){for(let t=this.$firstIndex;t<this.$realNumItems;t++)if(this.$virtualItems[t].obj!=null&&(i--,i<0))return t;return i}else return i+=this.$firstIndex,this.$loop&&this.$numItems>0&&(i=i%this.$numItems),i}itemIndexToChildIndex(i){if(!this.$virtual)return i;if(this.$layout==4)return this.getChildIndex(this.$virtualItems[i].obj);if(this.$loop&&this.$numItems>0){let t=this.$firstIndex%this.$numItems;i>=t?i=this.$firstIndex+(i-t):i=this.$firstIndex+this.$numItems+(t-i)}else i-=this.$firstIndex;return i}setVirtual(){this.$setVirtual(!1)}setVirtualAndLoop(){this.$setVirtual(!0)}$setVirtual(i){if(!this.$virtual){if(this.$scrollPane==null)throw new Error("Virtual list must be scrollable");if(i){if(this.$layout==2||this.$layout==3)throw new Error("Virtual list with loop mode is not supported for both FlowHorizontal and FlowVertical layout");this.$scrollPane.bouncebackEffect=!1}if(this.$virtual=!0,this.$loop=i,this.$virtualItems=[],this.removeChildrenToPool(),this.$itemSize==null){this.$itemSize=new f.Point;let t=this.getFromPool(null);if(t==null)throw new Error("Virtual list must have a default list item resource specified through list.defaultItem = resUrl.");this.$itemSize.x=t.width,this.$itemSize.y=t.height,this.returnToPool(t)}this.$layout==0||this.$layout==2?(this.$scrollPane.scrollSpeed=this.$itemSize.y,this.$loop&&(this.$scrollPane.$loop=2)):(this.$scrollPane.scrollSpeed=this.$itemSize.x,this.$loop&&(this.$scrollPane.$loop=1)),this.$scrollPane.on(r.ScrollEvent.SCROLL,this.$scrolled,this),this.setVirtualListChangedFlag(!0)}}get numItems(){return this.$virtual?this.$numItems:this.$children.length}set numItems(i){let t;if(this.$virtual){if(this.itemRenderer==null)throw new Error("list.itemRenderer is required");this.$numItems=i,this.$loop?this.$realNumItems=this.$numItems*6:this.$realNumItems=this.$numItems;let s=this.$virtualItems.length;if(this.$realNumItems>s)for(t=s;t<this.$realNumItems;t++){let h=new a;h.width=this.$itemSize.x,h.height=this.$itemSize.y,this.$virtualItems.push(h)}else for(t=this.$realNumItems;t<s;t++)this.$virtualItems[t].selected=!1;this.$virtualListChanged!=0&&r.GTimer.inst.remove(this.$refreshVirtualList,this),this.$refreshVirtualList()}else{let s=this.$children.length;if(i>s)for(t=s;t<i;t++)this.itemProvider==null?this.addItemFromPool():this.addItemFromPool(this.itemProvider(t));else this.removeChildrenToPool(i,s);if(this.itemRenderer!=null)for(t=0;t<i;t++)this.itemRenderer(t,this.getChildAt(t))}}refreshVirtualList(){this.setVirtualListChangedFlag(!1)}checkVirtualList(){this.$virtualListChanged!=0&&(this.$refreshVirtualList(),r.GTimer.inst.remove(this.$refreshVirtualList,this))}setVirtualListChangedFlag(i=!1){i?this.$virtualListChanged=2:this.$virtualListChanged==0&&(this.$virtualListChanged=1),r.GTimer.inst.callLater(this.$refreshVirtualList,this)}$refreshVirtualList(){let i=this.$virtualListChanged==2;this.$virtualListChanged=0,this.$eventLocked=!0,i&&(this.$layout==0||this.$layout==1?this.$curLineItemCount=1:this.$layout==2?this.$columnCount>0?this.$curLineItemCount=this.$columnCount:(this.$curLineItemCount=Math.floor((this.$scrollPane.viewWidth+this.$columnGap)/(this.$itemSize.x+this.$columnGap)),this.$curLineItemCount<=0&&(this.$curLineItemCount=1)):this.$layout==3?this.$lineCount>0?this.$curLineItemCount=this.$lineCount:(this.$curLineItemCount=Math.floor((this.$scrollPane.viewHeight+this.$lineGap)/(this.$itemSize.y+this.$lineGap)),this.$curLineItemCount<=0&&(this.$curLineItemCount=1)):(this.$columnCount>0?this.$curLineItemCount=this.$columnCount:(this.$curLineItemCount=Math.floor((this.$scrollPane.viewWidth+this.$columnGap)/(this.$itemSize.x+this.$columnGap)),this.$curLineItemCount<=0&&(this.$curLineItemCount=1)),this.$lineCount>0?this.$curLineItemCount2=this.$lineCount:(this.$curLineItemCount2=Math.floor((this.$scrollPane.viewHeight+this.$lineGap)/(this.$itemSize.y+this.$lineGap)),this.$curLineItemCount2<=0&&(this.$curLineItemCount2=1))));let t=0,s=0;if(this.$realNumItems>0){let h,n=Math.ceil(this.$realNumItems/this.$curLineItemCount)*this.$curLineItemCount,l=Math.min(this.$curLineItemCount,this.$realNumItems);if(this.$layout==0||this.$layout==2){for(h=0;h<n;h+=this.$curLineItemCount)t+=this.$virtualItems[h].height+this.$lineGap;if(t>0&&(t-=this.$lineGap),this.$autoResizeItem)s=this.$scrollPane.viewWidth;else{for(h=0;h<l;h++)s+=this.$virtualItems[h].width+this.$columnGap;s>0&&(s-=this.$columnGap)}}else if(this.$layout==1||this.$layout==3){for(h=0;h<n;h+=this.$curLineItemCount)s+=this.$virtualItems[h].width+this.$columnGap;if(s>0&&(s-=this.$columnGap),this.$autoResizeItem)t=this.$scrollPane.viewHeight;else{for(h=0;h<l;h++)t+=this.$virtualItems[h].height+this.$lineGap;t>0&&(t-=this.$lineGap)}}else s=Math.ceil(n/(this.$curLineItemCount*this.$curLineItemCount2))*this.viewWidth,t=this.viewHeight}this.handleAlign(s,t),this.$scrollPane.setContentSize(s,t),this.$eventLocked=!1,this.handleScroll(!0)}$scrolled(){this.handleScroll(!1)}getIndexOnPos1(i){if(this.$realNumItems<this.$curLineItemCount)return c.$lastPosHelper=0,0;let t,s,h;if(this.numChildren>0&&!i)if(s=this.getChildAt(0).y,s>c.$lastPosHelper){for(t=this.$firstIndex-this.$curLineItemCount;t>=0;t-=this.$curLineItemCount)if(s-=this.$virtualItems[t].height+this.$lineGap,s<=c.$lastPosHelper)return c.$lastPosHelper=s,t;return c.$lastPosHelper=0,0}else{for(t=this.$firstIndex;t<this.$realNumItems;t+=this.$curLineItemCount){if(h=s+this.$virtualItems[t].height+this.$lineGap,h>c.$lastPosHelper)return c.$lastPosHelper=s,t;s=h}return c.$lastPosHelper=s,this.$realNumItems-this.$curLineItemCount}else{for(s=0,t=0;t<this.$realNumItems;t+=this.$curLineItemCount){if(h=s+this.$virtualItems[t].height+this.$lineGap,h>c.$lastPosHelper)return c.$lastPosHelper=s,t;s=h}return c.$lastPosHelper=s,this.$realNumItems-this.$curLineItemCount}}getIndexOnPos2(i){if(this.$realNumItems<this.$curLineItemCount)return c.$lastPosHelper=0,0;let t,s,h;if(this.numChildren>0&&!i)if(s=this.getChildAt(0).x,s>c.$lastPosHelper){for(t=this.$firstIndex-this.$curLineItemCount;t>=0;t-=this.$curLineItemCount)if(s-=this.$virtualItems[t].width+this.$columnGap,s<=c.$lastPosHelper)return c.$lastPosHelper=s,t;return c.$lastPosHelper=0,0}else{for(t=this.$firstIndex;t<this.$realNumItems;t+=this.$curLineItemCount){if(h=s+this.$virtualItems[t].width+this.$columnGap,h>c.$lastPosHelper)return c.$lastPosHelper=s,t;s=h}return c.$lastPosHelper=s,this.$realNumItems-this.$curLineItemCount}else{for(s=0,t=0;t<this.$realNumItems;t+=this.$curLineItemCount){if(h=s+this.$virtualItems[t].width+this.$columnGap,h>c.$lastPosHelper)return c.$lastPosHelper=s,t;s=h}return c.$lastPosHelper=s,this.$realNumItems-this.$curLineItemCount}}getIndexOnPos3(i){if(this.$realNumItems<this.$curLineItemCount)return c.$lastPosHelper=0,0;let t=this.viewWidth,s=Math.floor(c.$lastPosHelper/t),h=s*(this.$curLineItemCount*this.$curLineItemCount2),n,l,o=s*t;for(n=0;n<this.$curLineItemCount;n++){if(l=o+this.$virtualItems[h+n].width+this.$columnGap,l>c.$lastPosHelper)return c.$lastPosHelper=o,h+n;o=l}return c.$lastPosHelper=o,h+this.$curLineItemCount-1}handleScroll(i){this.$eventLocked||(this.$enterCounter=0,this.$layout==0||this.$layout==2?(this.handleScroll1(i),this.handleArchOrder1()):this.$layout==1||this.$layout==3?(this.handleScroll2(i),this.handleArchOrder2()):this.handleScroll3(i),this.$boundsChanged=!1)}handleScroll1(i){if(this.$enterCounter++,this.$enterCounter>3){console.warn("this list view cannot be filled full as the itemRenderer function always returns an item with different size.");return}let t=this.$scrollPane.scrollingPosY,s=t+this.$scrollPane.viewHeight,h=s==this.$scrollPane.contentHeight;c.$lastPosHelper=t;let n=this.getIndexOnPos1(i);if(n==this.$firstIndex&&!i)return;t=c.$lastPosHelper;let l=this.$firstIndex;this.$firstIndex=n;let o=n,$=l>n,d=this.numChildren,p=l+d-1,w=$?p:l,C=0,I=t,m,b=0,g=0,T=this.defaultItem,u,y,x,P,D=(this.$scrollPane.viewWidth-this.$columnGap*(this.$curLineItemCount-1))/this.$curLineItemCount;for(this.$itemInfoVer++;o<this.$realNumItems&&(h||I<s);){if(u=this.$virtualItems[o],(u.obj==null||i)&&(this.itemProvider!=null&&(T=this.itemProvider(o%this.$numItems),T==null&&(T=this.$defaultItem),T=r.UIPackage.normalizeURL(T)),u.obj!=null&&u.obj.resourceURL!=T&&(u.obj instanceof r.GButton&&(u.selected=u.obj.selected),this.removeChildToPool(u.obj),u.obj=null)),u.obj==null){if($){for(P=w;P>=l;P--)if(y=this.$virtualItems[P],y.obj!=null&&y.updateFlag!=this.$itemInfoVer&&y.obj.resourceURL==T){y.obj instanceof r.GButton&&(y.selected=y.obj.selected),u.obj=y.obj,y.obj=null,P==w&&w--;break}}else for(P=w;P<=p;P++)if(y=this.$virtualItems[P],y.obj!=null&&y.updateFlag!=this.$itemInfoVer&&y.obj.resourceURL==T){y.obj instanceof r.GButton&&(y.selected=y.obj.selected),u.obj=y.obj,y.obj=null,P==w&&w++;break}u.obj!=null?this.setChildIndex(u.obj,$?o-n:this.numChildren):(u.obj=this.$pool.get(T),$?this.addChildAt(u.obj,o-n):this.addChild(u.obj)),u.obj instanceof r.GButton&&(u.obj.selected=u.selected),m=!0}else m=i;m&&(this.$autoResizeItem&&(this.$layout==0||this.$columnCount>0)&&u.obj.setSize(D,u.obj.height,!0),this.itemRenderer(o%this.$numItems,u.obj),o%this.$curLineItemCount==0&&(b+=Math.ceil(u.obj.height)-u.height,o==n&&l>n&&(g=Math.ceil(u.obj.height)-u.height)),u.width=Math.ceil(u.obj.width),u.height=Math.ceil(u.obj.height)),u.updateFlag=this.$itemInfoVer,u.obj.setXY(C,I),o==n&&(s+=u.height),C+=u.width+this.$columnGap,o%this.$curLineItemCount==this.$curLineItemCount-1&&(C=0,I+=u.height+this.$lineGap),o++}for(x=0;x<d;x++)u=this.$virtualItems[l+x],u.updateFlag!=this.$itemInfoVer&&u.obj!=null&&(u.obj instanceof r.GButton&&(u.selected=u.obj.selected),this.removeChildToPool(u.obj),u.obj=null);(b!=0||g!=0)&&this.$scrollPane.changeContentSizeOnScrolling(0,b,0,g),o>0&&this.numChildren>0&&this.$container.y<0&&this.getChildAt(0).y>-this.$container.y&&this.handleScroll1(!1)}handleScroll2(i){if(this.$enterCounter++,this.$enterCounter>3){console.warn("this list view cannot be filled full as the itemRenderer function always returns an item with different size.");return}let t=this.$scrollPane.scrollingPosX,s=t+this.$scrollPane.viewWidth,h=t==this.$scrollPane.contentWidth;c.$lastPosHelper=t;let n=this.getIndexOnPos2(i);if(n==this.$firstIndex&&!i)return;t=c.$lastPosHelper;let l=this.$firstIndex;this.$firstIndex=n;let o=n,$=l>n,d=this.numChildren,p=l+d-1,w=$?p:l,C=t,I=0,m,b=0,g=0,T=this.defaultItem,u,y,x,P,D=(this.$scrollPane.viewHeight-this.$lineGap*(this.$curLineItemCount-1))/this.$curLineItemCount;for(this.$itemInfoVer++;o<this.$realNumItems&&(h||C<s);){if(u=this.$virtualItems[o],(u.obj==null||i)&&(this.itemProvider!=null&&(T=this.itemProvider(o%this.$numItems),T==null&&(T=this.$defaultItem),T=r.UIPackage.normalizeURL(T)),u.obj!=null&&u.obj.resourceURL!=T&&(u.obj instanceof r.GButton&&(u.selected=u.obj.selected),this.removeChildToPool(u.obj),u.obj=null)),u.obj==null){if($){for(P=w;P>=l;P--)if(y=this.$virtualItems[P],y.obj!=null&&y.updateFlag!=this.$itemInfoVer&&y.obj.resourceURL==T){y.obj instanceof r.GButton&&(y.selected=y.obj.selected),u.obj=y.obj,y.obj=null,P==w&&w--;break}}else for(P=w;P<=p;P++)if(y=this.$virtualItems[P],y.obj!=null&&y.updateFlag!=this.$itemInfoVer&&y.obj.resourceURL==T){y.obj instanceof r.GButton&&(y.selected=y.obj.selected),u.obj=y.obj,y.obj=null,P==w&&w++;break}u.obj!=null?this.setChildIndex(u.obj,$?o-n:this.numChildren):(u.obj=this.$pool.get(T),$?this.addChildAt(u.obj,o-n):this.addChild(u.obj)),u.obj instanceof r.GButton&&(u.obj.selected=u.selected),m=!0}else m=i;m&&(this.$autoResizeItem&&(this.$layout==1||this.$lineCount>0)&&u.obj.setSize(u.obj.width,D,!0),this.itemRenderer(o%this.$numItems,u.obj),o%this.$curLineItemCount==0&&(b+=Math.ceil(u.obj.width)-u.width,o==n&&l>n&&(g=Math.ceil(u.obj.width)-u.width)),u.width=Math.ceil(u.obj.width),u.height=Math.ceil(u.obj.height)),u.updateFlag=this.$itemInfoVer,u.obj.setXY(C,I),o==n&&(s+=u.width),I+=u.height+this.$lineGap,o%this.$curLineItemCount==this.$curLineItemCount-1&&(I=0,C+=u.width+this.$columnGap),o++}for(x=0;x<d;x++)u=this.$virtualItems[l+x],u.updateFlag!=this.$itemInfoVer&&u.obj!=null&&(u.obj instanceof r.GButton&&(u.selected=u.obj.selected),this.removeChildToPool(u.obj),u.obj=null);(b!=0||g!=0)&&this.$scrollPane.changeContentSizeOnScrolling(b,0,g,0),o>0&&this.numChildren>0&&this.$container.x<0&&this.getChildAt(0).x>-this.$container.x&&this.handleScroll2(!1)}handleScroll3(i){let t=this.$scrollPane.scrollingPosX;c.$lastPosHelper=t;let s=this.getIndexOnPos3(i);if(s==this.$firstIndex&&!i)return;t=c.$lastPosHelper;let h=this.$firstIndex;this.$firstIndex=s;let n=h,l=this.$virtualItems.length,o=this.$curLineItemCount*this.$curLineItemCount2,$=s%this.$curLineItemCount,d=this.viewWidth,w=Math.floor(s/o)*o,C=w+o*2,I,m,b,g,T,u=this.$defaultItem,y=(this.$scrollPane.viewWidth-this.$columnGap*(this.$curLineItemCount-1))/this.$curLineItemCount,x=(this.$scrollPane.viewHeight-this.$lineGap*(this.$curLineItemCount2-1))/this.$curLineItemCount2;for(this.$itemInfoVer++,m=w;m<C;m++)if(!(m>=this.$realNumItems)){if(T=m%this.$curLineItemCount,m-w<o){if(T<$)continue}else if(T>$)continue;b=this.$virtualItems[m],b.updateFlag=this.$itemInfoVer}let P=null,D=0;for(m=w;m<C;m++)if(!(m>=this.$realNumItems)&&(b=this.$virtualItems[m],b.updateFlag==this.$itemInfoVer)){if(b.obj==null){for(;n<l;){if(g=this.$virtualItems[n],g.obj!=null&&g.updateFlag!=this.$itemInfoVer){g.obj instanceof r.GButton&&(g.selected=g.obj.selected),b.obj=g.obj,g.obj=null;break}n++}D==-1&&(D=this.getChildIndex(P)+1),b.obj==null?(this.itemProvider!=null&&(u=this.itemProvider(m%this.$numItems),u==null&&(u=this.$defaultItem),u=r.UIPackage.normalizeURL(u)),b.obj=this.$pool.get(u),this.addChildAt(b.obj,D)):D=this.setChildIndexBefore(b.obj,D),D++,b.obj instanceof r.GButton&&(b.obj.selected=b.selected),I=!0}else I=i,D=-1,P=b.obj;I&&(this.$autoResizeItem&&(this.$curLineItemCount==this.$columnCount&&this.$curLineItemCount2==this.$lineCount?b.obj.setSize(y,x,!0):this.$curLineItemCount==this.$columnCount?b.obj.setSize(y,b.obj.height,!0):this.$curLineItemCount2==this.$lineCount&&b.obj.setSize(b.obj.width,x,!0)),this.itemRenderer(m%this.$numItems,b.obj),b.width=Math.ceil(b.obj.width),b.height=Math.ceil(b.obj.height))}let M=w/o*d,L=M,A=0,j=0;for(m=w;m<C;m++)m>=this.$realNumItems||(b=this.$virtualItems[m],b.updateFlag==this.$itemInfoVer&&b.obj.setXY(L,A),b.height>j&&(j=b.height),m%this.$curLineItemCount==this.$curLineItemCount-1?(L=M,A+=j+this.$lineGap,j=0,m==w+o-1&&(M+=d,L=M,A=0)):L+=b.width+this.$columnGap);for(m=n;m<l;m++)b=this.$virtualItems[m],b.updateFlag!=this.$itemInfoVer&&b.obj!=null&&(b.obj instanceof r.GButton&&(b.selected=b.obj.selected),this.removeChildToPool(b.obj),b.obj=null)}handleArchOrder1(){if(this.$childrenRenderOrder==2){let i=this.$scrollPane.posY+this.viewHeight/2,t=Number.POSITIVE_INFINITY,s=0,h=0,n=this.numChildren;for(let l=0;l<n;l++){let o=this.getChildAt(l);(!this.foldInvisibleItems||o.visible)&&(s=Math.abs(i-o.y-o.height/2),s<t&&(t=s,h=l))}this.apexIndex=h}}handleArchOrder2(){if(this.childrenRenderOrder==2){let i=this.$scrollPane.posX+this.viewWidth/2,t=Number.POSITIVE_INFINITY,s=0,h=0,n=this.numChildren;for(let l=0;l<n;l++){let o=this.getChildAt(l);(!this.foldInvisibleItems||o.visible)&&(s=Math.abs(i-o.x-o.width/2),s<t&&(t=s,h=l))}this.apexIndex=h}}handleAlign(i,t){let s=0,h=0;t<this.viewHeight&&(this.$verticalAlign==1?h=Math.floor((this.viewHeight-t)/2):this.$verticalAlign==2&&(h=this.viewHeight-t)),i<this.viewWidth&&(this.$align=="center"?s=Math.floor((this.viewWidth-i)/2):this.$align=="right"&&(s=this.viewWidth-i)),(s!=this.$alignOffset.x||h!=this.$alignOffset.y)&&(this.$alignOffset.set(s,h),this.$scrollPane!=null?this.$scrollPane.adjustMaskContainer():(this.$container.x=this.$margin.left+this.$alignOffset.x,this.$container.y=this.$margin.top+this.$alignOffset.y))}updateBounds(){if(this.$virtual)return;let i,t,s=0,h=0,n=0,l=0,o=0,$=0,d=0,p=0,w=0,C=this.$children.length,I=this.viewWidth,m=this.viewHeight,b=0,g=0,T;if(this.$layout==0){for(i=0;i<C;i++)t=this.getChildAt(i),!(this.foldInvisibleItems&&!t.visible)&&(h!=0&&(h+=this.$lineGap),t.y=h,this.$autoResizeItem&&t.setSize(I,t.height,!0),h+=Math.ceil(t.height),t.width>n&&(n=t.width));o=Math.ceil(n),$=h}else if(this.$layout==1){for(i=0;i<C;i++)t=this.getChildAt(i),!(this.foldInvisibleItems&&!t.visible)&&(s!=0&&(s+=this.$columnGap),t.x=s,this.$autoResizeItem&&t.setSize(t.width,m,!0),s+=Math.ceil(t.width),t.height>l&&(l=t.height));o=s,$=Math.ceil(l)}else if(this.$layout==2)if(this.$autoResizeItem&&this.$columnCount>0){for(i=0;i<C;i++)if(t=this.getChildAt(i),!(this.foldInvisibleItems&&!t.visible)&&(b+=t.sourceWidth,d++,d==this.$columnCount||i==C-1)){for(T=(I-b-(d-1)*this.$columnGap)/b,s=0,d=g;d<=i;d++)t=this.getChildAt(d),!(this.foldInvisibleItems&&!t.visible)&&(t.setXY(s,h),d<i?(t.setSize(t.sourceWidth+Math.round(t.sourceWidth*T),t.height,!0),s+=Math.ceil(t.width)+this.$columnGap):t.setSize(I-s,t.height,!0),t.height>l&&(l=t.height));h+=Math.ceil(l)+this.$lineGap,l=0,d=0,g=i+1,b=0}$=h+Math.ceil(l),o=I}else{for(i=0;i<C;i++)t=this.getChildAt(i),!(this.foldInvisibleItems&&!t.visible)&&(s!=0&&(s+=this.$columnGap),(this.$columnCount!=0&&d>=this.$columnCount||this.$columnCount==0&&s+t.width>I&&l!=0)&&(s=0,h+=Math.ceil(l)+this.$lineGap,l=0,d=0),t.setXY(s,h),s+=Math.ceil(t.width),s>n&&(n=s),t.height>l&&(l=t.height),d++);$=h+Math.ceil(l),o=Math.ceil(n)}else if(this.$layout==3)if(this.$autoResizeItem&&this.$lineCount>0){for(i=0;i<C;i++)if(t=this.getChildAt(i),!(this.foldInvisibleItems&&!t.visible)&&(b+=t.sourceHeight,d++,d==this.$lineCount||i==C-1)){for(T=(m-b-(d-1)*this.$lineGap)/b,h=0,d=g;d<=i;d++)t=this.getChildAt(d),!(this.foldInvisibleItems&&!t.visible)&&(t.setXY(s,h),d<i?(t.setSize(t.width,t.sourceHeight+Math.round(t.sourceHeight*T),!0),h+=Math.ceil(t.height)+this.$lineGap):t.setSize(t.width,m-h,!0),t.width>n&&(n=t.width));s+=Math.ceil(n)+this.$columnGap,n=0,d=0,g=i+1,b=0}o=s+Math.ceil(n),$=m}else{for(i=0;i<C;i++)t=this.getChildAt(i),!(this.foldInvisibleItems&&!t.visible)&&(h!=0&&(h+=this.$lineGap),(this.$lineCount!=0&&d>=this.$lineCount||this.$lineCount==0&&h+t.height>m&&n!=0)&&(h=0,s+=Math.ceil(n)+this.$columnGap,n=0,d=0),t.setXY(s,h),h+=Math.ceil(t.height),h>l&&(l=h),t.width>n&&(n=t.width),d++);o=s+Math.ceil(n),$=Math.ceil(l)}else{let u;if(this.$autoResizeItem&&this.$lineCount>0&&(u=Math.floor((m-(this.$lineCount-1)*this.$lineGap)/this.$lineCount)),this.$autoResizeItem&&this.$columnCount>0){for(i=0;i<C;i++)if(t=this.getChildAt(i),!(this.foldInvisibleItems&&!t.visible)&&(b+=t.sourceWidth,d++,d==this.$columnCount||i==C-1)){for(T=(I-b-(d-1)*this.$columnGap)/b,s=0,d=g;d<=i;d++)t=this.getChildAt(d),!(this.foldInvisibleItems&&!t.visible)&&(t.setXY(p*I+s,h),d<i?(t.setSize(t.sourceWidth+Math.round(t.sourceWidth*T),this.$lineCount>0?u:t.height,!0),s+=Math.ceil(t.width)+this.$columnGap):t.setSize(I-s,this.$lineCount>0?u:t.height,!0),t.height>l&&(l=t.height));h+=Math.ceil(l)+this.$lineGap,l=0,d=0,g=i+1,b=0,w++,(this.$lineCount!=0&&w>=this.$lineCount||this.$lineCount==0&&h+t.height>m)&&(p++,h=0,w=0)}}else for(i=0;i<C;i++)t=this.getChildAt(i),!(this.foldInvisibleItems&&!t.visible)&&(s!=0&&(s+=this.$columnGap),this.$autoResizeItem&&this.$lineCount>0&&t.setSize(t.width,u,!0),(this.$columnCount!=0&&d>=this.$columnCount||this.$columnCount==0&&s+t.width>I&&l!=0)&&(s=0,h+=Math.ceil(l)+this.$lineGap,l=0,d=0,w++,(this.$lineCount!=0&&w>=this.$lineCount||this.$lineCount==0&&h+t.height>m&&n!=0)&&(p++,h=0,w=0)),t.setXY(p*I+s,h),s+=Math.ceil(t.width),s>n&&(n=s),t.height>l&&(l=t.height),d++);$=p>0?m:h+Math.ceil(l),o=(p+1)*I}this.handleAlign(o,$),this.setBounds(0,0,o,$)}setupBeforeAdd(i){super.setupBeforeAdd(i);let t,s;t=i.attributes.layout,t&&(this.$layout=r.ParseListLayoutType(t));let h;if(t=i.attributes.overflow,t?h=r.ParseOverflowType(t):h=0,t=i.attributes.margin,t&&this.$margin.parse(t),t=i.attributes.align,t&&(this.$align=r.ParseAlignType(t)),t=i.attributes.vAlign,t&&(this.$verticalAlign=r.ParseVertAlignType(t)),h==2){let l;t=i.attributes.scroll,t?l=r.ParseScrollType(t):l=1;let o;t=i.attributes.scrollBar,t?o=r.ParseScrollBarDisplayType(t):o=0;let $;t=i.attributes.scrollBarFlags,t?$=parseInt(t):$=0;let d=new r.utils.Margin;t=i.attributes.scrollBarMargin,t&&d.parse(t);let p,w;t=i.attributes.scrollBarRes,t&&(s=t.split(","),p=s[0],w=s[1]);let C,I;t=i.attributes.ptrRes,t&&(s=t.split(","),C=s[0],I=s[1]),this.setupScroll(d,l,o,$,p,w,C,I)}else this.setupOverflow(h);t=i.attributes.lineGap,t&&(this.$lineGap=parseInt(t)),t=i.attributes.colGap,t&&(this.$columnGap=parseInt(t)),t=i.attributes.lineItemCount,t&&(this.$layout==2||this.$layout==4?this.$columnCount=parseInt(t):this.$layout==3&&(this.$lineCount=parseInt(t))),t=i.attributes.lineItemCount2,t&&(this.$lineCount=parseInt(t)),t=i.attributes.selectionMode,t&&(this.$selectionMode=r.ParseListSelectionMode(t)),t=i.attributes.defaultItem,t&&(this.$defaultItem=t),t=i.attributes.autoItemSize,this.$layout==1||this.$layout==0?this.$autoResizeItem=t!="false":this.$autoResizeItem=t=="true",t=i.attributes.renderOrder,t&&(this.$childrenRenderOrder=r.ParseListChildrenRenderOrder(t),this.$childrenRenderOrder==2&&(t=i.attributes.apex,t&&(this.$apexIndex=parseInt(t)))),i.children.forEach(l=>{if(l.nodeName!="item")return;let o=l.attributes.url;if(o||(o=this.$defaultItem),!o)return;let $=this.getFromPool(o);$!=null&&(this.addChild($),t=l.attributes.title,t&&($.text=t),t=l.attributes.icon,t&&($.icon=t),t=l.attributes.name,t&&($.name=t),t=l.attributes.selectedIcon,t&&$ instanceof r.GButton&&($.selectedIcon=t))},this)}setupAfterAdd(i){super.setupAfterAdd(i);let t;t=i.attributes.selectionController,t&&(this.$selectionController=this.parent.getController(t))}}c.$lastPosHelper=0,r.GList=c})(fgui||(fgui={}));(function(r){var a;(function(c){class e{constructor(){this.$count=0,this.$pool={}}get count(){return this.$count}clear(){for(let t in this.$pool){let s=this.$pool[t];s&&(s.length=0,s=null)}this.$pool={},this.$count=0}get(t){let s=this.$pool[t];return s==null&&(s=[],this.$pool[t]=s),s.length?(this.$count--,s.shift()):this.createObject(t)}recycle(t,s){if(!t)return;let h=this.$pool[t];h==null&&(h=[],this.$pool[t]=h),this.$count++,h.push(s)}}c.Recycler=e})(a=r.utils||(r.utils={}))})(fgui||(fgui={}));(function(r){var a;(function(c){class e extends c.Recycler{constructor(){super()}clear(){for(let t in this.$pool){let s=this.$pool[t];s&&s.forEach(h=>{h.dispose()})}super.clear()}createObject(t){return r.UIPackage.createObjectFromURL(t)}}c.GObjectRecycler=e})(a=r.utils||(r.utils={}))})(fgui||(fgui={}));(function(r){class a extends r.GObject{constructor(){super(),this.$frame=0,this.$color=0,this.$contentSourceWidth=0,this.$contentSourceHeight=0,this.$contentWidth=0,this.$contentHeight=0,this.$loadingTexture=null,this.$playing=!0,this.$url="",this.$fill=0,this.$align="left",this.$verticalAlign=0,this.$showErrorSign=!0,this.$color=16777215}createDisplayObject(){this.$container=new r.UIContainer(this),this.$container.hitArea=new f.Rectangle,this.setDisplayObject(this.$container),this.$container.interactiveChildren=!1}dispose(){this.clearContent(),super.dispose()}get url(){return this.$url}set url(e){this.$url!=e&&(this.$url=e,this.loadContent(),this.updateGear(7))}get icon(){return this.$url}set icon(e){this.url=e}get align(){return this.$align}set align(e){this.$align!=e&&(this.$align=e,this.updateLayout())}get verticalAlign(){return this.$verticalAlign}set verticalAlign(e){this.$verticalAlign!=e&&(this.$verticalAlign=e,this.updateLayout())}get fill(){return this.$fill}set fill(e){this.$fill!=e&&(this.$fill=e,this.updateLayout())}get autoSize(){return this.$autoSize}set autoSize(e){this.$autoSize!=e&&(this.$autoSize=e,this.updateLayout())}get playing(){return this.$playing}set playing(e){this.$playing!=e&&(this.$playing=e,this.$content instanceof r.MovieClip&&(this.$content.playing=e),this.updateGear(5))}get frame(){return this.$frame}set frame(e){this.$frame!=e&&(this.$frame=e,this.$content instanceof r.MovieClip&&(this.$content.currentFrame=e),this.updateGear(5))}get color(){return this.$color}set color(e){this.$color!=e&&(this.$color=e,this.updateGear(4),this.applyColor())}applyColor(){this.$content&&(this.$content.tint=this.$color)}get showErrorSign(){return this.$showErrorSign}set showErrorSign(e){this.$showErrorSign=e}get content(){return this.$content}get texture(){return this.$content instanceof r.UIImage?this.$content.texture:null}set texture(e){this.url=null,this.$content?this.$container.addChild(this.$content):(this.$content=new r.UIImage(null),this.$content.$initDisp(),this.$container.addChild(this.$content)),this.switchToMovieMode(!1),this.$content instanceof r.UIImage&&(this.$content.texture=e),e?(this.$contentSourceWidth=e.orig.width,this.$contentSourceHeight=e.orig.height):this.$contentSourceWidth=this.$contentHeight=0,this.updateLayout()}loadContent(){this.clearContent(),this.$url&&(r.utils.StringUtil.startsWith(this.$url,"ui://")?this.loadFromPackage(this.$url):this.loadExternal())}loadFromPackage(e){if(this.$contentItem=r.UIPackage.getItemByURL(e),this.$contentItem)if(this.$contentItem.load(),this.$contentItem.type==0)this.$contentItem.texture==null?this.setErrorState():(this.switchToMovieMode(!1),this.$content.$initDisp(this.$contentItem),this.$contentSourceWidth=this.$contentItem.width,this.$contentSourceHeight=this.$contentItem.height,this.updateLayout());else if(this.$contentItem.type==2){this.switchToMovieMode(!0),this.$contentSourceWidth=this.$contentItem.width,this.$contentSourceHeight=this.$contentItem.height;let i=this.$content;i.interval=this.$contentItem.interval,i.swing=this.$contentItem.swing,i.repeatDelay=this.$contentItem.repeatDelay,i.frames=this.$contentItem.frames,i.boundsRect=new f.Rectangle(0,0,this.$contentSourceWidth,this.$contentSourceHeight),this.updateLayout()}else this.setErrorState();else this.setErrorState()}switchToMovieMode(e){this.$container.removeChildren(),e?this.$content instanceof r.MovieClip||(this.$content=new r.MovieClip(this)):this.$content instanceof r.UIImage||(this.$content=new r.UIImage(null)),this.$container.addChild(this.$content)}loadExternal(){this.$container.removeChildren(),!this.$content||!(this.$content instanceof r.UIImage)?(this.$content=new r.UIImage(null),this.$content.$initDisp(),this.$container.addChild(this.$content)):this.$container.addChild(this.$content),this.$content.texture=f.Texture.from(this.$url,{scaleMode:f.SCALE_MODES.LINEAR});let e=()=>{this.$content&&this.$content.texture&&(this.$content.texture.frame=new f.Rectangle(0,0,this.$content.texture.baseTexture.width,this.$content.texture.baseTexture.height),this.$contentSourceWidth=this.$content.texture.width,this.$contentSourceHeight=this.$content.texture.height,this.updateLayout())};this.$content.texture.once("update",()=>{e()}),e()}__loadExternal(){let e=f.Texture.from(this.$url,{scaleMode:f.SCALE_MODES.LINEAR});this.$loadingTexture=e,e.width>1&&e.height>1?this.$loadResCompleted(e):e.once("update",()=>{!e.width||!e.height?this.$loadResCompleted(null):this.$loadResCompleted(e)})}freeExternal(e){f.Texture.removeFromCache(e),e.destroy(e.baseTexture!=null)}$loadResCompleted(e){e?this.onExternalLoadSuccess(e):(this.onExternalLoadFailed(),this.$loadingTexture&&(this.$loadingTexture.removeAllListeners(),this.freeExternal(this.$loadingTexture)),this.$loadingTexture=null),this.$loadingTexture=null}onExternalLoadSuccess(e){this.$container.removeChildren(),!this.$content||!(this.$content instanceof r.UIImage)?(this.$content=new r.UIImage(null),this.$content.$initDisp(),this.$container.addChild(this.$content)):this.$container.addChild(this.$content),e.frame=new f.Rectangle(0,0,e.baseTexture.width,e.baseTexture.height),this.$content.texture=e,this.$contentSourceWidth=e.width,this.$contentSourceHeight=e.height,this.updateLayout()}onExternalLoadFailed(){this.setErrorState()}setErrorState(){!this.$showErrorSign||(this.$errorSign==null&&r.UIConfig.loaderErrorSign&&(this.$errorSign=a.$errorSignPool.get(r.UIConfig.loaderErrorSign)),this.$errorSign&&(this.$errorSign.width=this.width,this.$errorSign.height=this.height,this.$container.addChild(this.$errorSign.displayObject)))}clearErrorState(){this.$errorSign&&(this.$container.removeChild(this.$errorSign.displayObject),a.$errorSignPool.recycle(this.$errorSign.resourceURL,this.$errorSign),this.$errorSign=null)}updateLayout(){if(this.$content==null){this.$autoSize&&(this.$updatingLayout=!0,this.setSize(50,30),this.$updatingLayout=!1);return}if(this.$content.position.set(0,0),this.$content.scale.set(1,1),this.$contentWidth=this.$contentSourceWidth,this.$contentHeight=this.$contentSourceHeight,this.$autoSize)this.$updatingLayout=!0,this.$contentWidth==0&&(this.$contentWidth=50),this.$contentHeight==0&&(this.$contentHeight=30),this.setSize(this.$contentWidth,this.$contentHeight),this.$updatingLayout=!1;else{let e=1,i=1;this.$fill!=0&&(e=this.width/this.$contentSourceWidth,i=this.height/this.$contentSourceHeight,(e!=1||i!=1)&&(this.$fill==2?e=i:this.$fill==3?i=e:this.$fill==1?e>i?e=i:i=e:this.$fill==5&&(e>i?i=e:e=i),this.$contentWidth=this.$contentSourceWidth*e,this.$contentHeight=this.$contentSourceHeight*i)),this.$content instanceof r.UIImage?(this.$content.width=this.$contentWidth,this.$content.height=this.$contentHeight):this.$content.scale.set(e,i),this.$align=="center"?this.$content.x=Math.floor((this.width-this.$contentWidth)/2):this.$align=="right"&&(this.$content.x=this.width-this.$contentWidth),this.$verticalAlign==1?this.$content.y=Math.floor((this.height-this.$contentHeight)/2):this.$verticalAlign==2&&(this.$content.y=this.height-this.$contentHeight)}}clearContent(e=!1){this.clearErrorState(),this.$content&&this.$content.parent&&this.$container.removeChild(this.$content),this.$contentItem==null&&this.$content instanceof r.UIImage&&e&&this.freeExternal(this.$content.texture),this.$content&&this.$content.destroy(),this.$content=null,this.$contentItem=null}handleSizeChanged(){this.$updatingLayout||this.updateLayout();let e=this.$container.hitArea;e.x=e.y=0,e.width=this.width,e.height=this.height}setupBeforeAdd(e){super.setupBeforeAdd(e);let i;i=e.attributes.url,i&&(this.$url=i),i=e.attributes.align,i&&(this.$align=r.ParseAlignType(i)),i=e.attributes.vAlign,i&&(this.$verticalAlign=r.ParseVertAlignType(i)),i=e.attributes.fill,i&&(this.$fill=r.ParseLoaderFillType(i)),this.$autoSize=e.attributes.autoSize=="true",i=e.attributes.errorSign,i&&(this.$showErrorSign=i=="true"),this.$playing=e.attributes.playing!="false",i=e.attributes.color,i&&(this.color=r.utils.StringUtil.convertFromHtmlColor(i)),this.$url&&this.loadContent()}}a.$errorSignPool=new r.utils.GObjectRecycler,r.GLoader=a})(fgui||(fgui={}));(function(r){class a extends r.GObject{constructor(){super()}mapPivotWidth(e){return e*this.$sourceWidth}mapPivotHeight(e){return e*this.$sourceHeight}handleSizeChanged(){this.$displayObject!=null&&this.$sourceWidth!=0&&this.$sourceHeight!=0&&this.$displayObject.scale.set(this.$width/this.$sourceWidth*this.$scaleX,this.$height/this.$sourceHeight*this.$scaleY)}handleScaleChanged(){this.$displayObject!=null&&this.$displayObject.scale.set(this.$width/this.$sourceWidth*this.$scaleX,this.$height/this.$sourceHeight*this.$scaleY)}get touchable(){return!1}set touchable(e){this.$touchable=!1}get color(){return this.$movieClip.tint}set color(e){this.$movieClip.tint=e}createDisplayObject(){this.$movieClip=new r.MovieClip(this),this.setDisplayObject(this.$movieClip)}get playing(){return this.$movieClip.playing}set playing(e){this.$movieClip.playing!=e&&(this.$movieClip.playing=e,this.updateGear(5))}get frame(){return this.$movieClip.currentFrame}set frame(e){this.$movieClip.currentFrame!=e&&(this.$movieClip.currentFrame=e,this.updateGear(5))}setPlaySettings(...e){this.$movieClip.setPlaySettings.apply(this.$movieClip,e)}constructFromResource(){this.$sourceWidth=this.packageItem.width,this.$sourceHeight=this.packageItem.height,this.$initWidth=this.$sourceWidth,this.$initHeight=this.$sourceHeight,this.setSize(this.$sourceWidth,this.$sourceHeight),this.packageItem.load(),this.$movieClip.interval=this.packageItem.interval,this.$movieClip.swing=this.packageItem.swing,this.$movieClip.repeatDelay=this.packageItem.repeatDelay,this.$movieClip.frames=this.packageItem.frames,this.$movieClip.boundsRect=new f.Rectangle(0,0,this.$sourceWidth,this.$sourceHeight)}setupBeforeAdd(e){super.setupBeforeAdd(e);let i;i=e.attributes.frame,i&&(this.$movieClip.currentFrame=parseInt(i)),i=e.attributes.playing,this.$movieClip.playing=i!="false",i=e.attributes.color,i&&(this.color=r.utils.StringUtil.convertFromHtmlColor(i))}}r.GMovieClip=a})(fgui||(fgui={}));(function(r){class a extends r.GComponent{constructor(){super(),this.$max=0,this.$value=0,this.$barMaxWidth=0,this.$barMaxHeight=0,this.$barMaxWidthDelta=0,this.$barMaxHeightDelta=0,this.$barStartX=0,this.$barStartY=0,this.$tweenValue=0,this.$titleType=0,this.$value=50,this.$max=100}get titleType(){return this.$titleType}set titleType(e){this.$titleType!=e&&(this.$titleType=e,this.update(this.$value))}get max(){return this.$max}set max(e){this.$max!=e&&(this.$max=e,this.update(this.$value))}get value(){return this.$value}set value(e){this.$tweener!=null&&(this.$tweener.pause(),this.$tweener=null),this.$value!=e&&(this.$value=e,this.update(this.$value))}tweenValue(e,i){return this.$value!=e?(this.$tweener&&(this.$tweener.stop(),TWEEN.remove(this.$tweener)),this.$tweenValue=this.$value,this.$value=e,this.$tweener=new TWEEN.Tween(this).onUpdate(r.utils.Binder.create(this.onUpdateTween,this)).to({$tweenValue:e},i*1e3).easing(a.easeLinear).start(),this.$tweener):null}onUpdateTween(){this.update(this.$tweenValue)}update(e){let i=this.$max!=0?Math.min(e/this.$max,1):0;if(this.$titleObject)switch(this.$titleType){case 0:this.$titleObject.text=`${Math.round(i*100)}%`;break;case 1:this.$titleObject.text=`${Math.round(e)}/${Math.round(this.$max)}`;break;case 2:this.$titleObject.text=`${Math.round(e)}`;break;case 3:this.$titleObject.text=`${Math.round(this.$max)}`;break}let t=this.width-this.$barMaxWidthDelta,s=this.height-this.$barMaxHeightDelta;this.$reverse?(this.$barObjectH&&(this.$barObjectH.width=t*i,this.$barObjectH.x=this.$barStartX+(t-this.$barObjectH.width)),this.$barObjectV&&(this.$barObjectV.height=s*i,this.$barObjectV.y=this.$barStartY+(s-this.$barObjectV.height))):(this.$barObjectH&&(this.$barObjectH.width=t*i),this.$barObjectV&&(this.$barObjectV.height=s*i)),this.$aniObject instanceof r.GMovieClip&&(this.$aniObject.frame=Math.round(i*100))}constructFromXML(e){super.constructFromXML(e),e=e.getChildNodes("ProgressBar")[0];let i;i=e.attributes.titleType,i&&(this.$titleType=r.ParseProgressTitleType(i)),this.$reverse=e.attributes.reverse=="true",this.$titleObject=this.getChild("title"),this.$barObjectH=this.getChild("bar"),this.$barObjectV=this.getChild("bar_v"),this.$aniObject=this.getChild("ani"),this.$barObjectH&&(this.$barMaxWidth=this.$barObjectH.width,this.$barMaxWidthDelta=this.width-this.$barMaxWidth,this.$barStartX=this.$barObjectH.x),this.$barObjectV&&(this.$barMaxHeight=this.$barObjectV.height,this.$barMaxHeightDelta=this.height-this.$barMaxHeight,this.$barStartY=this.$barObjectV.y)}handleSizeChanged(){super.handleSizeChanged(),this.$barObjectH&&(this.$barMaxWidth=this.width-this.$barMaxWidthDelta),this.$barObjectV&&(this.$barMaxHeight=this.height-this.$barMaxHeightDelta),this.$inProgressBuilding||this.update(this.$value)}setupAfterAdd(e){super.setupAfterAdd(e),e=e.getChildNodes("ProgressBar")[0],e&&(this.$value=parseInt(e.attributes.value)||0,this.$max=parseInt(e.attributes.max)||0),this.update(this.$value)}dispose(){this.$tweener&&(this.$tweener.stop(),TWEEN.remove(this.$tweener)),this.$tweener=null,super.dispose()}}a.easeLinear=r.ParseEaseType("linear"),r.GProgressBar=a})(fgui||(fgui={}));(function(r){class a{constructor(){this.width=0,this.height=0,this.textHeight=0,this.y=0}static get(){if(a.pool.length){let i=a.pool.pop();return i.width=0,i.height=0,i.textHeight=0,i.text=null,i.y=0,i}else return new a}static recycle(i){a.pool.push(i)}static recycleMany(i){i&&i.length&&i.forEach(t=>{a.pool.push(t)},this),i.length=0}}a.pool=[],r.LineInfo=a;class c extends r.GObject{constructor(){super(),this.$verticalAlign=0,this.$offset=new f.Point,this.$singleLine=!0,this.$text="",this.$textWidth=0,this.$textHeight=0,this.$style=new f.TextStyle({fontSize:12,fontFamily:r.UIConfig.defaultFont,align:"left",leading:3,fill:0}),this.$verticalAlign=0,this.$text="",this.$autoSize=1,this.$widthAutoSize=!0,this.$heightAutoSize=!0,this.$bitmapPool=[],this.touchable=!1}createDisplayObject(){this.$textField=new r.UITextField(this),this.setDisplayObject(this.$textField)}switchBitmapMode(i){i&&this.displayObject==this.$textField?(this.$btContainer==null&&(this.$btContainer=new r.UIContainer(this)),this.switchDisplayObject(this.$btContainer)):!i&&this.displayObject==this.$btContainer&&this.switchDisplayObject(this.$textField)}dispose(){r.GTimer.inst.remove(this.$render,this),this.$bitmapFont=null,this.$bitmapPool&&(this.$bitmapPool.length=0),this.$bitmapPool=null,this.$style=null,super.dispose()}set text(i){this.setText(i)}setText(i){i==null&&(i=""),this.$text!=i&&(this.$text=i,this.updateGear(6),this.parent&&this.parent.$inProgressBuilding?this.renderNow():this.render())}get text(){return this.getText()}getText(){return this.$text}set color(i){this.setColor(i)}get color(){return this.getColor()}set colors(i){this.setColor(i)}get colors(){return this.getColor()}getColor(){return this.$color}setColor(i){this.$color!=i&&(this.$color=i,this.updateGear(4),this.$style.fill=this.$color,this.render())}get titleColor(){return this.color}set titleColor(i){this.color=i}get lineHeight(){return this.$style.lineHeight>0?this.$style.lineHeight:this.$fontProperties?this.$fontProperties.fontSize+this.$style.strokeThickness+this.$style.leading:+this.$style.fontSize+this.$style.strokeThickness}set lineHeight(i){this.$style.lineHeight=i}get font(){return this.$font||r.UIConfig.defaultFont}set font(i){this.$font!=i&&(this.$font=i,this.$font&&r.utils.StringUtil.startsWith(this.$font,"ui://")?this.$bitmapFont=r.UIPackage.getBitmapFontByURL(this.$font):this.$style.fontFamily=this.$font||r.UIConfig.defaultFont,this.render())}get fontSize(){return+this.$style.fontSize}set fontSize(i){i<=0||this.$style.fontSize!=i&&(this.$style.fontSize=i,this.render())}get align(){return this.$style.align}set align(i){this.$style.align!=i&&(this.$style.align=i,this.render())}get verticalAlign(){return this.$verticalAlign}set verticalAlign(i){this.$verticalAlign!=i&&(this.$verticalAlign=i,this.$inProgressBuilding||this.layoutAlign())}get leading(){return this.$style.leading}set leading(i){this.$style.leading!=i&&(this.$style.leading=i,this.render())}get letterSpacing(){return this.$style.letterSpacing}set letterSpacing(i){this.$style.letterSpacing!=i&&(this.$style.letterSpacing=i,this.render())}get underline(){return!1}set underline(i){}get bold(){return this.$style.fontWeight=="bold"}set bold(i){let t=i===!0?"bold":"normal";this.$style.fontWeight!=t&&(this.$style.fontWeight=t,this.render())}get weight(){return this.$style.fontWeight}set weight(i){this.$style.fontWeight!=i&&(this.$style.fontWeight=i,this.render())}get variant(){return this.$style.fontVariant}set variant(i){this.$style.fontVariant!=i&&(this.$style.fontVariant=i,this.render())}get italic(){return this.$style.fontStyle=="italic"}set italic(i){let t=i===!0?"italic":"normal";this.$style.fontStyle!=t&&(this.$style.fontStyle=t,this.render())}get multipleLine(){return!this.$singleLine}set multipleLine(i){i=!i,this.$singleLine!=i&&(this.$singleLine=i,this.render())}get stroke(){return+this.$style.strokeThickness}set stroke(i){this.$style.strokeThickness!=i&&(this.$style.strokeThickness=i)}get strokeColor(){return this.$style.stroke}set strokeColor(i){this.$style.stroke!=i&&(this.$style.stroke=i)}set autoSize(i){this.$autoSize!=i&&(this.$autoSize=i,this.$widthAutoSize=i==1||i==3,this.$heightAutoSize=i==1||i==2,this.render())}get autoSize(){return this.$autoSize}get textWidth(){return this.$requireRender&&this.renderNow(),this.$textWidth}get textHeight(){return this.$requireRender&&this.renderNow(),this.$textHeight}set cacheAsBitmap(i){this.$cacheAsBitmap=i}get cacheAsBitmap(){return this.$cacheAsBitmap}ensureSizeCorrect(){this.$sizeDirty&&this.$requireRender&&this.renderNow()}render(){this.$requireRender||(this.$requireRender=!0,r.GTimer.inst.callLater(this.$render,this)),!this.$sizeDirty&&(this.$widthAutoSize||this.$heightAutoSize)&&(this.$sizeDirty=!0,this.emit(r.DisplayObjectEvent.SIZE_DELAY_CHANGE,this))}applyStyle(){!this.$style||(this.$textField.style.stroke=this.$style.stroke,this.$textField.style.strokeThickness=this.$style.strokeThickness,this.$textField.style.fontStyle=this.$style.fontStyle,this.$textField.style.fontVariant=this.$style.fontVariant,this.$textField.style.fontWeight=this.$style.fontWeight,this.$textField.style.letterSpacing=this.$style.letterSpacing,this.$textField.style.align=this.$style.align,this.$textField.style.fontSize=this.$style.fontSize,this.$textField.style.fontFamily=this.$style.fontFamily,this.$textField.style.fill=this.$style.fill,this.$textField.style.leading=this.$style.leading)}$render(){this.$requireRender&&this.renderNow()}renderNow(i=!0){if(this.disposed)return;if(this.$cacheAsBitmap&&(this.$textField.cacheAsBitmap=!1),this.$requireRender=!1,this.$sizeDirty=!1,this.$bitmapFont!=null){this.renderWithBitmapFont(i);return}this.switchBitmapMode(!1),this.applyStyle(),this.$textField.$updateMinHeight();let t=!this.$widthAutoSize&&this.multipleLine;this.$textField.width=this.$textField.style.wordWrapWidth=t||this.autoSize==0?Math.ceil(this.width):1e4,this.$textField.style.wordWrap=t,this.$textField.style.breakWords=t,this.$textField.text=this.$text,this.$fontProperties=f.TextMetrics.measureFont(this.$style.toFontString()),this.$textWidth=Math.ceil(this.$textField.textWidth),this.$textWidth>0&&(this.$textWidth+=c.GUTTER_X*2),this.$textHeight=Math.ceil(this.$textField.textHeight),this.$textHeight>0&&(this.$textHeight+=c.GUTTER_Y*2);let s=this.width,h=this.height;this.autoSize==3?this.shrinkTextField():(this.$textField.scale.set(1,1),this.$widthAutoSize&&(s=this.$textWidth,this.$textField.width=s),this.$heightAutoSize?(h=this.$textHeight,this.$textField.height!=this.$textHeight&&(this.$textField.height=this.$textHeight)):(h=this.height,this.$textHeight>h&&(this.$textHeight=h))),i&&(this.$updatingSize=!0,this.setSize(s,h),this.$updatingSize=!1),this.layoutAlign(),this.$cacheAsBitmap&&(this.$textField.cacheAsBitmap=!0)}renderWithBitmapFont(i){this.switchBitmapMode(!0),this.$btContainer.children.forEach((L,A)=>{this.$bitmapPool.push(this.$btContainer.getChildAt(A))},this),this.$btContainer.removeChildren(),this.$lines?a.recycleMany(this.$lines):this.$lines=[];let t=this.letterSpacing,s=this.leading-1,h=this.width-c.GUTTER_X*2,n=0,l=0,o=0,$=0,d=0,p=0,w=0,C=0,I=0,m="",b=c.GUTTER_Y,g,T=!this.$widthAutoSize&&this.multipleLine,u=this.$bitmapFont.resizable?this.fontSize/this.$bitmapFont.size:1,y;this.$textWidth=0,this.$textHeight=0;let x=this.text.length;for(let L=0;L<x;++L){let A=this.$text.charAt(L),j=A.charCodeAt(L);if(A==`
`){m+=A,g=a.get(),g.width=n,o==0&&(I==0&&(I=Math.ceil(this.fontSize*u)),l==0&&(l=I),o=l),g.height=l,I=l,g.textHeight=o,g.text=m,g.y=b,b+=g.height+s,g.width>this.$textWidth&&(this.$textWidth=g.width),this.$lines.push(g),m="",n=0,l=0,o=0,p=0,w=0,C=0;continue}if(j>256||j<=32?(p>0&&(C=n),p=0):(p==0&&(w=n),p++),A==" "?($=Math.ceil(this.fontSize/2),d=Math.ceil(this.fontSize)):(y=this.$bitmapFont.glyphs[A],y?($=Math.ceil(y.advance*u),d=Math.ceil(y.lineHeight*u)):A==" "?($=Math.ceil(this.$bitmapFont.size*u/2),d=Math.ceil(this.$bitmapFont.size*u)):($=0,d=0)),d>o&&(o=d),d>l&&(l=d),n!=0&&(n+=t),n+=$,!T||n<=h)m+=A;else{if(g=a.get(),g.height=l,g.textHeight=o,m.length==0)g.text=A;else if(p>0&&C>0){m+=A;let Q=m.length-p;g.text=r.utils.StringUtil.trimRight(m.substr(0,Q)),g.width=C,m=m.substr(Q+1),n-=w}else g.text=m,g.width=n-($+t),m=A,n=$,l=d,o=d;g.y=b,b+=g.height+s,g.width>this.$textWidth&&(this.$textWidth=g.width),p=0,w=0,C=0,this.$lines.push(g)}}(m.length>0||this.$lines.length>0&&r.utils.StringUtil.endsWith(this.$lines[this.$lines.length-1].text,`
`))&&(g=a.get(),g.width=n,l==0&&(l=I),o==0&&(o=l),g.height=l,g.textHeight=o,g.text=m,g.y=b,g.width>this.$textWidth&&(this.$textWidth=g.width),this.$lines.push(g)),this.$textWidth>0&&(this.$textWidth+=c.GUTTER_X*2),this.$lines.length==0?this.$textHeight=0:(g=this.$lines[this.$lines.length-1],this.$textHeight=g.y+g.height+c.GUTTER_Y);let D,M=0;this.$widthAutoSize?this.$textWidth==0?D=0:D=this.$textWidth:D=this.width,this.$heightAutoSize?this.$textHeight==0?M=0:M=this.$textHeight:M=this.height,i&&(this.$updatingSize=!0,this.setSize(D,M),this.$updatingSize=!1),!(D==0||M==0)&&(h=this.width-c.GUTTER_X*2,this.$lines.forEach(L=>{let A=c.GUTTER_X,j=0,Q=0;this.align=="center"?j=(h-L.width)/2:this.align=="right"?j=h-L.width:j=0,x=L.text.length;for(let R=0;R<x;R++){let rt=L.text.charAt(R);if(y=this.$bitmapFont.glyphs[rt],y!=null){Q=(L.height+L.textHeight)/2-Math.ceil(y.lineHeight*u);let W;this.$bitmapPool.length?W=this.$bitmapPool.pop():W=new f.Sprite,W.x=A+j+Math.ceil(y.offsetX*u),W.y=L.y+Q+Math.ceil(y.offsetY*u),W.texture=y.texture,W.scale.set(u,u),W.tint=this.$bitmapFont.colorable===!0?this.$color:16777215,this.$btContainer.addChild(W),A+=t+Math.ceil(y.advance*u)}else rt==" "?A+=t+Math.ceil(this.$bitmapFont.size*u/2):A+=t}}))}localToGlobal(i=0,t=0,s){return i-=this.$offset.x,t-=this.$offset.y,super.localToGlobal(i,t,s)}globalToLocal(i=0,t=0,s){let h=super.globalToLocal(i,t,s);return h.x-=this.$offset.x,h.y-=this.$offset.y,h}handleSizeChanged(){this.$updatingSize||(this.$bitmapFont!=null?this.$widthAutoSize||this.render():this.$inProgressBuilding?(this.$textField.width=this.width,this.$textField.height=this.height):this.$autoSize==3?this.shrinkTextField():this.$widthAutoSize||(this.$heightAutoSize?this.$textField.width=this.width:(this.$textField.width=this.width,this.$textField.height=this.height)),this.layoutAlign())}shrinkTextField(){let i=Math.min(1,this.width/this.$textWidth);this.$textField.scale.set(i,i)}layoutAlign(){let i=this.$textWidth,t=this.$textHeight;if(this.autoSize==3&&(i*=this.displayObject.scale.x,t*=this.displayObject.scale.y),this.$verticalAlign==0||t==0)this.$offset.y=c.GUTTER_Y;else{let h=Math.max(0,this.height-t);this.$verticalAlign==1?this.$offset.y=h*.5:this.$verticalAlign==2&&(this.$offset.y=h)}let s=0;switch(this.$style.align){case"center":s=(this.width-i)*.5;break;case"right":s=this.width-i;break}this.$offset.x=s,this.updatePosition()}updatePosition(){this.displayObject.position.set(Math.floor(this.x+this.$offset.x),Math.floor(this.y+this.$offset.y))}handleXYChanged(){super.handleXYChanged(),this.$displayObject&&this.updatePosition()}setupBeforeAdd(i){super.setupBeforeAdd(i);let t=i.attributes.font;t&&(this.font=t),t=i.attributes.vAlign,t&&(this.verticalAlign=r.ParseVertAlignType(t)),t=i.attributes.leading,t&&(this.$style.leading=parseInt(t)),t=i.attributes.letterSpacing,t&&(this.$style.letterSpacing=parseInt(t)),t=i.attributes.fontSize,t&&(this.$style.fontSize=parseInt(t)),t=i.attributes.color,t&&(this.color=r.utils.StringUtil.convertFromHtmlColor(t)),t=i.attributes.align,t&&(this.align=r.ParseAlignType(t)),t=i.attributes.autoSize,t&&(this.autoSize=r.ParseAutoSizeType(t),this.$widthAutoSize=this.$autoSize==1||this.$autoSize==3,this.$heightAutoSize=this.$autoSize==1||this.$autoSize==2),this.underline=i.attributes.underline=="true",this.italic=i.attributes.italic=="true",this.bold=i.attributes.bold=="true",this.multipleLine=i.attributes.singleLine!="true",t=i.attributes.strokeColor,t&&(this.strokeColor=r.utils.StringUtil.convertFromHtmlColor(t),t=i.attributes.strokeSize,t?this.stroke=parseInt(t)+1:this.stroke=2)}setupAfterAdd(i){super.setupAfterAdd(i);let t=i.attributes.text;t!=null&&t.length>0&&(this.text=t),this.$sizeDirty=!1}}c.GUTTER_X=2,c.GUTTER_Y=2,r.GTextField=c})(fgui||(fgui={}));(function(r){class a{}r.TextBlock=a;class c extends r.GTextField{constructor(){super(),this.$textField.interactive=!0,this.$textField.interactiveChildren=!1,this.on(r.TextEvent.LinkClick,this.$clickLink,this)}set ubbEnabled(i){this.$ubbEnabled!=i&&(this.$ubbEnabled=i,this.render())}get ubbEnabled(){return this.$ubbEnabled}setupBeforeAdd(i){super.setupBeforeAdd(i),this.$ubbEnabled=i.attributes.ubb=="true"}set textFlow(i){Object.assign(this.$style,i.style),this.$textFlow=i,this.text=i.text,this.render()}set text(i){this.$text=i,this.$text==null&&(this.$text=""),this.$textField.width=this.width,this.updateGear(6),this.render()}$clickLink(i){this.emit(r.TextEvent.LinkClick,i.text,this)}dispose(){this.off(r.TextEvent.LinkClick,this.$clickLink,this),super.dispose()}}r.GRichTextField=c})(fgui||(fgui={}));(function(r){class a{constructor(){this.touchDown=!1,this.mouseX=0,this.mouseY=0}}r.GRootMouseStatus=a;class c extends r.GComponent{constructor(){super(),c.$inst==null&&(c.$inst=this),this.opaque=!1,this.$popupStack=[],this.$justClosedPopups=[],this.$uid=c.uniqueID++,r.utils.DOMEventManager.inst.on(r.DisplayObjectEvent.MOUSE_WHEEL,this.dispatchMouseWheel,this)}static get inst(){return c.$inst==null&&new c,c.$inst}static get globalMouseStatus(){return c.$gmStatus}attachTo(i,t){r.GTimer.inst.setTicker(f.Ticker.shared),this.$uiStage&&(this.$uiStage.off(r.DisplayObjectEvent.SIZE_CHANGED,this.$winResize,this),this.$uiStage.nativeStage.off(r.InteractiveEvents.Down,this.$stageDown,this),this.$uiStage.nativeStage.off(r.InteractiveEvents.Up,this.$stageUp,this),this.$uiStage.nativeStage.off(r.InteractiveEvents.Move,this.$stageMove,this),this.$uiStage.nativeStage.removeChild(this.$displayObject),this.$uiStage.dispose()),this.$uiStage=new r.UIStage(i,t),this.$uiStage.nativeStage.on(r.InteractiveEvents.Down,this.$stageDown,this),this.$uiStage.nativeStage.on(r.InteractiveEvents.Up,this.$stageUp,this),this.$uiStage.nativeStage.on(r.InteractiveEvents.Move,this.$stageMove,this),this.$uiStage.nativeStage.addChild(this.$displayObject),this.$modalLayer||(this.$modalLayer=new r.GGraph,this.$modalLayer.setSize(this.width,this.height),this.$modalLayer.drawRect(0,0,0,r.UIConfig.modalLayerColor,r.UIConfig.modalLayerAlpha),this.$modalLayer.addRelation(this,24))}get uniqueID(){return this.$uid}get stageWidth(){return this.$uiStage.stageWidth}get stageHeight(){return this.$uiStage.stageHeight}get contentScaleFactor(){return this.$uiStage.resolution}get applicationContext(){return this.$uiStage.applicationContext}get nativeStage(){return this.$uiStage.nativeStage}get orientation(){return this.$uiStage.orientation}get stageWrapper(){return this.$uiStage}get view(){return this.getChildAt(0)}dispatchMouseWheel(i){let t=this.getObjectUnderPoint(c.globalMouseStatus.mouseX,c.globalMouseStatus.mouseY);if(t!=null)for(t.emit(r.DisplayObjectEvent.MOUSE_WHEEL,i);t.parent&&t.parent!=this;)t=t.parent}getObjectUnderPoint(i,t){c.sHelperPoint.set(i,t);let h=this.$uiStage.$appContext.renderer.events.rootBoundary.hitTest(i,t);return h&&(r.GObject.castFromNativeObject(h)||h.parent)}showWindow(i){this.addChild(i),i.requestFocus(),i.x>this.width?i.x=this.width-i.width:i.x+i.width<0&&(i.x=0),i.y>this.height?i.y=this.height-i.height:i.y+i.height<0&&(i.y=0),this.adjustModalLayer()}hideWindow(i){i.hide()}hideWindowImmediately(i){i.parent==this&&this.removeChild(i),this.adjustModalLayer()}bringToFront(i){let t;for(this.$modalLayer.parent!=null&&!i.modal?t=this.getChildIndex(this.$modalLayer)-1:t=this.numChildren-1;t>=0;t--){let s=this.getChildAt(t);if(s==i)return;if(s instanceof r.Window)break}t>=0&&this.setChildIndex(i,t)}showModalWait(i=null){r.UIConfig.globalModalWaiting!=null&&(this.$modalWaitPane==null&&(this.$modalWaitPane=r.UIPackage.createObjectFromURL(r.UIConfig.globalModalWaiting),this.$modalWaitPane.addRelation(this,24)),this.$modalWaitPane.setSize(this.width,this.height),this.addChild(this.$modalWaitPane),this.$modalWaitPane.text=i)}closeModalWait(){this.$modalWaitPane!=null&&this.$modalWaitPane.parent!=null&&this.removeChild(this.$modalWaitPane)}closeAllExceptModals(){this.$children.slice().forEach(t=>{t instanceof r.Window&&!t.modal&&t.hide()},this)}closeAllWindows(){this.$children.slice().forEach(t=>{t instanceof r.Window&&t.hide()},this)}getTopWindow(){let i=this.numChildren;for(let t=i-1;t>=0;t--){let s=this.getChildAt(t);if(s instanceof r.Window)return s}return null}get hasModalWindow(){return this.$modalLayer.parent!=null}get modalWaiting(){return this.$modalWaitPane&&this.$modalWaitPane.inContainer}showPopup(i,t=null,s=0){if(this.$popupStack.length>0){let d=this.$popupStack.indexOf(i);if(d!=-1)for(let p=this.$popupStack.length-1;p>=d;p--)this.removeChild(this.$popupStack.pop())}this.$popupStack.push(i),this.addChild(i),this.adjustModalLayer();let h,n=0,l=0;t?(h=t.localToRoot(),n=t.width,l=t.height):h=this.globalToLocal(c.$gmStatus.mouseX,c.$gmStatus.mouseY);let o,$;o=h.x,o+i.width>this.width&&(o=o+n-i.width),$=h.y+l,(s==0&&$+i.height>this.height||s==2)&&($=h.y-i.height-1,$<0&&($=0,o+=n*.5)),i.x=o,i.y=$}togglePopup(i,t=null,s){this.$justClosedPopups.indexOf(i)==-1&&this.showPopup(i,t,s)}hidePopup(i=null){let t;if(i!=null){let s=this.$popupStack.indexOf(i);if(s!=-1)for(t=this.$popupStack.length-1;t>=s;t--)this.closePopup(this.$popupStack.pop())}else{let s=this.$popupStack.length;for(t=s-1;t>=0;t--)this.closePopup(this.$popupStack[t]);this.$popupStack.length=0}}get hasAnyPopup(){return this.$popupStack.length!=0}closePopup(i){i.parent!=null&&(i instanceof r.Window?i.hide():this.removeChild(i))}showTooltips(i){if(this.$defaultTooltipWin==null){let t=r.UIConfig.tooltipsWin;if(!t){console.error("UIConfig.tooltipsWin not defined");return}this.$defaultTooltipWin=r.UIPackage.createObjectFromURL(t)}this.$defaultTooltipWin.text=i,this.showTooltipsWin(this.$defaultTooltipWin)}showTooltipsWin(i,t=null){this.hideTooltips(),this.$tooltipWin=i;let s=0,h=0;t==null?(s=c.$gmStatus.mouseX+10,h=c.$gmStatus.mouseY+20):(s=t.x,h=t.y);let n=this.globalToLocal(s,h);s=n.x,h=n.y,s+this.$tooltipWin.width>this.width&&(s=s-this.$tooltipWin.width-1,s<0&&(s=10)),h+this.$tooltipWin.height>this.height&&(h=h-this.$tooltipWin.height-1,s-this.$tooltipWin.width-1>0&&(s=s-this.$tooltipWin.width-1),h<0&&(h=10)),this.$tooltipWin.x=s,this.$tooltipWin.y=h,this.addChild(this.$tooltipWin)}hideTooltips(){this.$tooltipWin!=null&&(this.$tooltipWin.parent&&this.removeChild(this.$tooltipWin),this.$tooltipWin=null)}get focus(){return this.$focusedObject&&!this.$focusedObject.onStage&&(this.$focusedObject=null),this.$focusedObject}set focus(i){if(i&&(!i.focusable||!i.onStage))throw new Error("Invalid target to focus");this.setFocus(i)}setFocus(i){this.$focusedObject!=i&&(this.$focusedObject=i,this.emit(r.FocusEvent.CHANGED,this))}adjustModalLayer(){let i=this.numChildren;this.$modalWaitPane!=null&&this.$modalWaitPane.parent!=null&&this.setChildIndex(this.$modalWaitPane,i-1);for(let t=i-1;t>=0;t--){let s=this.getChildAt(t);if(s instanceof r.Window&&s.modal){this.$modalLayer.parent==null?this.addChildAt(this.$modalLayer,t):this.setChildIndexBefore(this.$modalLayer,t);return}}this.$modalLayer.parent!=null&&this.removeChild(this.$modalLayer)}$stageDown(i){c.$gmStatus.mouseX=i.data.global.x,c.$gmStatus.mouseY=i.data.global.y,c.$gmStatus.touchDown=!0;let t=i.target;for(;t&&t!=this.nativeStage;){if(r.isUIObject(t)){let s=t.UIOwner;if(s.touchable&&s.focusable){this.setFocus(s);break}}t=t.parent}this.$tooltipWin!=null&&this.hideTooltips(),this.checkPopups(i.target)}checkPopups(i){if(!this.$checkingPopups&&(this.$checkingPopups=!0,this.$justClosedPopups.length=0,this.$popupStack.length>0)){let t=i;for(;t&&t!=this.nativeStage;){if(r.isUIObject(t)){let n=this.$popupStack.indexOf(t.UIOwner);if(n!=-1){let l;for(let o=this.$popupStack.length-1;o>n;o--)l=this.$popupStack.pop(),this.closePopup(l),this.$justClosedPopups.push(l);return}}t=t.parent}let s=this.$popupStack.length,h;for(let n=s-1;n>=0;n--)h=this.$popupStack[n],this.closePopup(h),this.$justClosedPopups.push(h);this.$popupStack.length=0}}$stageMove(i){c.$gmStatus.mouseX=i.data.global.x,c.$gmStatus.mouseY=i.data.global.y}$stageUp(i){c.$gmStatus.touchDown=!1,this.$checkingPopups=!1}$winResize(i){this.setSize(i.stageWidth,i.stageHeight)}}c.uniqueID=0,c.$gmStatus=new a,r.GRoot=c})(fgui||(fgui={}));(function(r){class a extends r.GComponent{constructor(){super(),this.$dragOffset=new f.Point,this.$scrollPerc=0}setScrollPane(e,i){this.$target=e,this.$vertical=i}set displayPerc(e){this.$vertical?(this.$fixedGripSize||(this.$grip.height=e*this.$bar.height),this.$grip.y=this.$bar.y+(this.$bar.height-this.$grip.height)*this.$scrollPerc):(this.$fixedGripSize||(this.$grip.width=e*this.$bar.width),this.$grip.x=this.$bar.x+(this.$bar.width-this.$grip.width)*this.$scrollPerc)}get scrollPerc(){return this.$scrollPerc}set scrollPerc(e){this.$scrollPerc=e,this.$vertical?this.$grip.y=this.$bar.y+(this.$bar.height-this.$grip.height)*this.$scrollPerc:this.$grip.x=this.$bar.x+(this.$bar.width-this.$grip.width)*this.$scrollPerc}get minSize(){return this.$vertical?(this.$arrowButton1!=null?this.$arrowButton1.height:0)+(this.$arrowButton2!=null?this.$arrowButton2.height:0):(this.$arrowButton1!=null?this.$arrowButton1.width:0)+(this.$arrowButton2!=null?this.$arrowButton2.width:0)}constructFromXML(e){if(super.constructFromXML(e),e=e.getChildNodes("ScrollBar")[0],e!=null&&(this.$fixedGripSize=e.attributes.fixedGripSize=="true"),this.$grip=this.getChild("grip"),!this.$grip){console.error("please create and define 'grip' in the Editor for the scrollbar");return}if(this.$bar=this.getChild("bar"),!this.$bar){console.error("please create and define 'bar' in the Editor for the scrollbar");return}this.$arrowButton1=this.getChild("arrow1"),this.$arrowButton2=this.getChild("arrow2"),this.$grip.on(r.InteractiveEvents.Down,this.$gripMouseDown,this),this.$arrowButton1&&this.$arrowButton1.on(r.InteractiveEvents.Down,this.$arrowButton1Click,this),this.$arrowButton2&&this.$arrowButton2.on(r.InteractiveEvents.Down,this.$arrowButton2Click,this),this.on(r.InteractiveEvents.Down,this.$barMouseDown,this)}$gripMouseDown(e){if(!this.$bar)return;e.stopPropagation(),this.$dragOffset=e.data.getLocalPosition(this.displayObject,this.$dragOffset),this.$dragOffset.x-=this.$grip.x,this.$dragOffset.y-=this.$grip.y;let i=r.GRoot.inst.view;i.on(r.InteractiveEvents.Move,this.$gripDragging,this),i.on(r.InteractiveEvents.Up,this.$gripDraggingEnd,this)}$gripDragging(e){let i=e.data.getLocalPosition(this.displayObject,a.sScrollbarHelperPoint);if(this.$vertical){let t=i.y-this.$dragOffset.y;this.$target.setPercY((t-this.$bar.y)/(this.$bar.height-this.$grip.height),!1)}else{let t=i.x-this.$dragOffset.x;this.$target.setPercX((t-this.$bar.x)/(this.$bar.width-this.$grip.width),!1)}}$gripDraggingEnd(e){let i=r.GRoot.inst.view;i.off(r.InteractiveEvents.Move,this.$gripDragging,this),i.off(r.InteractiveEvents.Up,this.$gripDraggingEnd,this)}$arrowButton1Click(e){e.stopPropagation(),this.$vertical?this.$target.scrollUp():this.$target.scrollLeft()}$arrowButton2Click(e){e.stopPropagation(),this.$vertical?this.$target.scrollDown():this.$target.scrollRight()}$barMouseDown(e){let i=e.data.getLocalPosition(this.$grip.displayObject,a.sScrollbarHelperPoint);this.$vertical?i.y<0?this.$target.scrollUp(4):this.$target.scrollDown(4):i.x<0?this.$target.scrollLeft(4):this.$target.scrollRight(4)}dispose(){this.off(r.InteractiveEvents.Down,this.$barMouseDown,this),this.$arrowButton1&&this.$arrowButton1.off(r.InteractiveEvents.Down,this.$arrowButton1Click,this),this.$arrowButton2&&this.$arrowButton2.off(r.InteractiveEvents.Down,this.$arrowButton2Click,this),this.$grip.off(r.InteractiveEvents.Down,this.$gripMouseDown,this),this.$gripDraggingEnd(null),super.dispose()}}a.sScrollbarHelperPoint=new f.Point,r.GScrollBar=a})(fgui||(fgui={}));(function(r){class a extends r.GComponent{constructor(){super(),this.$max=0,this.$value=0,this.$barMaxWidth=0,this.$barMaxHeight=0,this.$barMaxWidthDelta=0,this.$barMaxHeightDelta=0,this.$titleType=0,this.$value=50,this.$max=100,this.$clickPos=new f.Point}get titleType(){return this.$titleType}set titleType(e){this.$titleType=e}get max(){return this.$max}set max(e){this.$max!=e&&(this.$max=e,this.update())}get value(){return this.$value}set value(e){this.$value!=e&&(this.$value=e,this.update())}update(){let e=Math.min(this.$value/this.$max,1);this.updateWidthPercent(e)}updateWidthPercent(e){if(this.$titleObject)switch(this.$titleType){case 0:this.$titleObject.text=`${Math.round(e*100)}%`;break;case 1:this.$titleObject.text=`${this.$value}/${this.$max}`;break;case 2:this.$titleObject.text=`${this.$value}`;break;case 3:this.$titleObject.text=`${this.$max}`;break}this.$barObjectH&&(this.$barObjectH.width=(this.width-this.$barMaxWidthDelta)*e),this.$barObjectV&&(this.$barObjectV.height=(this.height-this.$barMaxHeightDelta)*e),this.$aniObject instanceof r.GMovieClip&&(this.$aniObject.frame=Math.round(e*100))}handleSizeChanged(){super.handleSizeChanged(),this.$barObjectH&&(this.$barMaxWidth=this.width-this.$barMaxWidthDelta),this.$barObjectV&&(this.$barMaxHeight=this.height-this.$barMaxHeightDelta),this.$inProgressBuilding||this.update()}setupAfterAdd(e){super.setupAfterAdd(e),e=e.getChildNodes("Slider")[0],e&&(this.$value=parseInt(e.attributes.value),this.$max=parseInt(e.attributes.max)),this.update()}constructFromXML(e){super.constructFromXML(e),e=e.getChildNodes("Slider")[0];let i;e&&(i=e.attributes.titleType,i&&(this.$titleType=r.ParseProgressTitleType(i))),this.$titleObject=this.getChild("title"),this.$barObjectH=this.getChild("bar"),this.$barObjectV=this.getChild("bar_v"),this.$aniObject=this.getChild("ani"),this.$gripObject=this.getChild("grip"),this.$barObjectH&&(this.$barMaxWidth=this.$barObjectH.width,this.$barMaxWidthDelta=this.width-this.$barMaxWidth),this.$barObjectV&&(this.$barMaxHeight=this.$barObjectV.height,this.$barMaxHeightDelta=this.height-this.$barMaxHeight),this.$gripObject&&this.$gripObject.on(r.InteractiveEvents.Down,this.$gripMouseDown,this)}$gripMouseDown(e){this.$clickPos=this.globalToLocal(e.data.global.x,e.data.global.y),this.$clickPercent=this.$value/this.$max,r.GRoot.inst.view&&(r.GRoot.inst.view.on(r.InteractiveEvents.Move,this.$gripMouseMove,this),r.GRoot.inst.view.on(r.InteractiveEvents.Up,this.$gripMouseUp,this))}$gripMouseMove(e){let i=this.globalToLocal(e.data.global.x,e.data.global.y,a.sSilderHelperPoint),t=i.x-this.$clickPos.x,s=i.y-this.$clickPos.y,h;this.$barObjectH?h=this.$clickPercent+t/this.$barMaxWidth:h=this.$clickPercent+s/this.$barMaxHeight,h>1?h=1:h<0&&(h=0);let n=Math.round(this.$max*h);n!=this.$value&&(this.$value=n,this.emit(r.StateChangeEvent.CHANGED,this)),this.updateWidthPercent(h)}$gripMouseUp(e){let i=this.$value/this.$max;this.updateWidthPercent(i),r.GRoot.inst.view&&(r.GRoot.inst.view.off(r.InteractiveEvents.Move,this.$gripMouseMove,this),r.GRoot.inst.view.off(r.InteractiveEvents.Up,this.$gripMouseUp,this))}dispose(){this.$gripObject&&this.$gripObject.off(r.InteractiveEvents.Down,this.$gripMouseDown,this),r.GRoot.inst.view&&(r.GRoot.inst.view.off(r.InteractiveEvents.Move,this.$gripMouseMove,this),r.GRoot.inst.view.off(r.InteractiveEvents.Up,this.$gripMouseUp,this)),super.dispose()}}a.sSilderHelperPoint=new f.Point,r.GSlider=a})(fgui||(fgui={}));(function(r){var a;(function(c){class e{constructor(t){this.$inited=!1,this.$restrictString=null,this.$restrictRegex=null,this.$focused=!1,this.$textField=t,this.$input=new r.InputElement(t)}initialize(){this.$inited||(this.$input.$addToStage(),this.$input.on("updateText",this.updateText,this),this.$input.on(r.FocusEvent.CHANGED,this.focusHandler,this),this.$textField.on(r.InteractiveEvents.Down,this.textFieldDownHandler,this),this.$inited=!0)}textFieldDownHandler(){this.$onFocus()}destroy(){!this.$inited||(this.$input.$removeFromStage(),this.$textField.off(r.InteractiveEvents.Down,this.textFieldDownHandler,this),r.GRoot.inst.off(r.InteractiveEvents.Down,this.onStageDown,this),this.$input.off("updateText",this.updateText,this),this.$input.off(r.FocusEvent.CHANGED,this.focusHandler,this),this.$inited=!1)}get text(){return this.$input.text}set text(t){this.$input.text=t}setColor(t){return this.$input.setColor(t)}updateText(){let t=this.$input.text,s=!1;if(this.$restrictRegex!=null){let h=t.match(this.$restrictRegex);h?t=h.join(""):t="",s=!0}s&&this.$input.text!=t&&(this.$input.text=t),this.$textField.text=this.$input.text,this.$textField.emit(r.TextEvent.Change,this.$textField)}onStageDown(t){r.GObject.castFromNativeObject(t.currentTarget)!=this.$textField&&this.$input.$hide()}focusHandler(t){t=="focus"?this.$focused||(this.$focused=!0,this.$textField.$isTyping=!0,this.$textField.alpha=0,this.$textField.emit(r.FocusEvent.CHANGED,"focus",this.$textField),this.$textField.emit(r.TextEvent.FocusIn,this.$textField)):t=="blur"&&this.$focused&&(this.$focused=!1,r.GRoot.inst.off(r.InteractiveEvents.Down,this.onStageDown,this),this.$textField.$isTyping=!1,this.$textField.alpha=1,this.$input.$onBlur(),this.$textField.emit(r.FocusEvent.CHANGED,"blur",this.$textField),this.$textField.emit(r.TextEvent.FocusOut,this.$textField))}get isFocused(){return this.$focused}$getProperty(t){return this.$inited&&this.$input.getAttribute(t)||null}$setProperty(t,s){!this.$inited||this.$input.setAttribute(t,s)}get $restrict(){return this.$restrictString}set $restrict(t){this.$restrictString=t,this.$restrictString!=null&&this.$restrictString.length>0?this.$restrictRegex=new RegExp(this.$restrictString):this.$restrictRegex=null}get type(){return this.$type}set type(t){t!=this.$type&&(this.$type=t)}tryHideInput(){!this.$textField.visible&&this.$input&&this.$input.$removeFromStage()}$updateProperties(){if(this.isFocused){this.$input.resetInput(),this.tryHideInput();return}this.$input.text=this.$textField.text,this.$input.resetInput(),this.tryHideInput()}$onFocus(){!this.$textField.visible||this.$focused||(r.GRoot.inst.off(r.InteractiveEvents.Down,this.onStageDown,this),r.GTimer.inst.callLater(()=>{r.GRoot.inst.on(r.InteractiveEvents.Down,this.onStageDown,this)},this),this.$input.$show())}}c.InputDelegate=e})(a=r.utils||(r.utils={}))})(fgui||(fgui={}));(function(r){class a extends r.GTextField{constructor(){super(),this.$util=null,this.$isTyping=!1,this.focusable=!0,this.editable=!0,this.type="text",this.on("removed",this.removed,this),this.on("added",this.added,this),this.$util.initialize()}createDisplayObject(){super.createDisplayObject(),this.$displayObject.hitArea=new f.Rectangle}handleSizeChanged(){super.handleSizeChanged();let e=this.$displayObject.hitArea;e.x=e.y=0,e.width=this.width,e.height=this.height}removed(e){this.$util&&this.$util.destroy()}added(e){this.$util&&this.$util.initialize()}requestFocus(){this.root.focus=this,this.$util.$onFocus()}get editable(){return this.$editable}set editable(e){e!=this.$editable&&(this.$editable=e,this.$editable?(this.$util||(this.$util=new r.utils.InputDelegate(this)),this.$util.initialize()):this.$util&&this.$util.destroy(),this.touchable=this.$editable)}changeToPassText(e){let i="";for(let t=0,s=e.length;t<s;t++)switch(e.charAt(t)){case`
`:i+=`
`;break;case"\r":break;default:i+="*"}return i}getText(){return this.$util.text}setText(e){e==null&&(e=""),this.$text!=e&&(this.$util.text=e,super.setText(e))}setColor(e){super.setColor(e),this.$util.setColor(e)}get promptText(){return this.$util.$getProperty("placeholder")}set promptText(e){e==null&&(e=""),this.$util.$setProperty("placeholder",e)}get maxLength(){return parseInt(this.$util.$getProperty("maxlength"))||0}set maxLength(e){this.$util.$setProperty("maxlength",String(e))}get restrict(){return this.$util.$restrict}set restrict(e){this.$util.$restrict=e}get password(){return this.type=="password"}set password(e){this.type="password"}get type(){return this.$util.type}set type(e){this.$util.type=e}dispose(){super.dispose(),this.off("removed",this.removed,this),this.off("added",this.added,this),this.$util.destroy(),this.$util=null}renderNow(e=!0){this.$requireRender=!1,this.$sizeDirty=!1,this.$util.$updateProperties(),this.$isTyping&&this.decorateInputbox();let i=this.$text;this.type=="password"&&(this.$text=this.changeToPassText(this.$text)),super.renderNow(e),this.$text=i}decorateInputbox(){}setupBeforeAdd(e){super.setupBeforeAdd(e);var i=e.attributes.maxLength;i!=null&&(this.maxLength=parseInt(i)),i=e.attributes.restrict,i!=null&&(this.restrict=i),i=e.attributes.password,i=="true"?this.password=!0:(i=e.attributes.keyboardType,i=="4"?this.type="number":i=="3"?this.type="url":i=="5"?this.type="tel":i=="6"&&(this.type="email"))}}r.GTextInput=a})(fgui||(fgui={}));(function(r){class a{constructor(){this.$enumIdx=0,this.$enumCount=0,this.$curTime=Date.now(),this.$startedTime=0,this.$items=[],this.$itemPool=[],TWEEN.setupNow&&TWEEN.setupNow(()=>this.$startedTime)}getItem(){return this.$itemPool.length?this.$itemPool.pop():new c}findItem(i,t){let s=this.$items.length;for(let h=0;h<s;h++){let n=this.$items[h];if(n.callback==i&&n.thisObj==t)return n}return null}add(i,t,s,h,n){let l=this.findItem(s,h);l||(l=this.getItem(),l.callback=s,l.thisObj=h,this.$items.push(l)),l.delay=i,l.counter=0,l.repeat=t,l.param=n,l.end=!1}addLoop(i,t,s,h){this.add(i,0,t,s,h)}callLater(i,t,s){this.add(1,1,i,t,s)}callDelay(i,t,s,h){this.add(i,1,t,s,h)}exists(i,t){return this.findItem(i,t)!=null}remove(i,t){let s=this.findItem(i,t);if(s){let h=this.$items.indexOf(s);this.$items.splice(h,1),h<this.$enumIdx&&this.$enumIdx--,this.$enumCount--,s.callback=null,s.param=null,this.$itemPool.push(s)}}get ticker(){return this.$ticker}get curTime(){return this.$curTime}advance(){for(this.$enumIdx=0,this.$enumCount=this.$items.length;this.$enumIdx<this.$enumCount;){let i=this.$items[this.$enumIdx];this.$enumIdx++;let t=this.$ticker.deltaTime/f.settings.TARGET_FPMS;if(this.$curTime+=t,i.advance(t)){if(i.end&&(this.$enumIdx--,this.$enumCount--,this.$items.splice(this.$enumIdx,1),this.$itemPool.push(i)),i.callback){let s=[t];i.param&&i.param instanceof Array?s=i.param.concat(s):i.param!==void 0&&s.unshift(i.param),i.callback.apply(i.thisObj,s)}i.end&&(i.callback=i.thisObj=i.param=null)}}}tickTween(){this.$startedTime+=this.$ticker.deltaTime/f.settings.TARGET_FPMS,TWEEN.update(this.$startedTime,!this.$ticker.started)}setTicker(i){this.$ticker&&(this.$ticker.remove(this.advance),this.$ticker.remove(this.tickTween)),this.$ticker=i,this.$ticker.add(this.advance,this,f.UPDATE_PRIORITY.NORMAL),this.$ticker.add(this.tickTween,this,f.UPDATE_PRIORITY.HIGH),this.$ticker.started||this.$ticker.start()}}a.inst=new a,r.GTimer=a;class c{constructor(){this.delay=0,this.counter=0,this.repeat=0}advance(i=0){return this.counter+=i,this.counter>=this.delay?(this.counter-=this.delay,this.counter>this.delay&&(this.counter=this.delay),this.repeat>0&&(this.repeat--,this.repeat==0&&(this.end=!0)),!0):!1}}})(fgui||(fgui={}));(function(r){class a{constructor(e){this.$lockToken=0,this.$owner=e,this.$easeType=r.ParseEaseType("Quad.Out"),this.$tweenTime=.3,this.$tweenDelay=0}get controller(){return this.$controller}set controller(e){e!=this.$controller&&(this.$controller=e,this.$controller&&this.init())}get tween(){return this.$tween}set tween(e){this.$tween=e}get tweenDelay(){return this.$tweenDelay}set tweenDelay(e){this.$tweenDelay=e}get tweenTime(){return this.$tweenTime}set tweenTime(e){this.$tweenTime=e}get easeType(){return this.$easeType}set easeType(e){this.$easeType=e}setup(e){if(this.$controller=this.$owner.parent.getController(e.attributes.controller),this.$controller==null)return;this.init();let i;if(i=e.attributes.tween,i&&(this.$tween=!0),i=e.attributes.ease,i&&(this.$easeType=r.ParseEaseType(i)),i=e.attributes.duration,i&&(this.$tweenTime=parseFloat(i)),i=e.attributes.delay,i&&(this.$tweenDelay=parseFloat(i)),this instanceof r.GearDisplay)i=e.attributes.pages,i&&(this.pages=i.split(","));else{let t,s;i=e.attributes.pages,i&&(t=i.split(",")),i=e.attributes.values,i&&(s=i.split("|")),t&&s&&s.forEach((h,n)=>{this.addStatus(t[n],h)}),i=e.attributes.default,i&&this.addStatus(null,i)}}updateFromRelations(e,i){}addStatus(e,i){}init(){}apply(){}updateState(){}}a.disableAllTweenEffect=!1,r.GearBase=a})(fgui||(fgui={}));(function(r){class a extends r.GearBase{constructor(i){super(i)}init(){this.$default=new c(this.$owner.playing,this.$owner.frame),this.$storage={}}addStatus(i,t){if(t=="-")return;let s;i==null?s=this.$default:(s=new c,this.$storage[i]=s);let h=t.split(",");s.frame=parseInt(h[0]),s.playing=h[1]=="p"}apply(){this.$owner.$gearLocked=!0;let i=this.$storage[this.$controller.selectedPageId];i||(i=this.$default),this.$owner.frame=i.frame,this.$owner.playing=i.playing,this.$owner.$gearLocked=!1}updateState(){if(this.$controller==null||this.$owner.$gearLocked||this.$owner.$inProgressBuilding)return;let i=this.$storage[this.$controller.selectedPageId];i||(i=new c,this.$storage[this.$controller.selectedPageId]=i),i.frame=this.$owner.frame,i.playing=this.$owner.playing}}r.GearAnimation=a;class c{constructor(i=!0,t=0){this.playing=i,this.frame=t}}})(fgui||(fgui={}));(function(r){class a extends r.GearBase{constructor(e){super(e),this.$default=0}init(){"color"in this.$owner?this.$default=this.$owner.color:"titleColor"in this.$owner&&(this.$default=this.$owner.titleColor),this.$storage={}}addStatus(e,i){if(i=="-")return;let t=r.utils.StringUtil.convertFromHtmlColor(i);e==null?this.$default=t:this.$storage[e]=t}apply(){this.$owner.$gearLocked=!0;let e=this.$storage[this.$controller.selectedPageId],i=e!=null?Math.floor(e):Math.floor(this.$default);"color"in this.$owner?this.$owner.color=i:"titleColor"in this.$owner&&(this.$owner.titleColor=i),this.$owner.$gearLocked=!1}updateState(){this.$controller==null||this.$owner.$gearLocked||this.$owner.$inProgressBuilding||("color"in this.$owner?this.$storage[this.$controller.selectedPageId]=this.$owner.color:"titleColor"in this.$owner&&(this.$storage[this.$controller.selectedPageId]=this.$owner.titleColor))}}r.GearColor=a})(fgui||(fgui={}));(function(r){class a extends r.GearBase{constructor(e){super(e),this.$vid=0,this.$lockToken=1}init(){this.pages=null}lock(){return this.$vid++,this.$lockToken}release(e){e==this.$lockToken&&this.$vid--}get connected(){return this.controller==null||this.$vid>0}apply(){this.$lockToken++,this.$lockToken<=0&&(this.$lockToken=1),this.pages==null||this.pages.length==0||this.pages.indexOf(this.$controller.selectedPageId)!=-1?this.$vid=1:this.$vid=0}}r.GearDisplay=a})(fgui||(fgui={}));(function(r){class a extends r.GearBase{constructor(e){super(e)}init(){this.$default=this.$owner.icon,this.$storage={}}addStatus(e,i){e==null?this.$default=i:this.$storage[e]=i}apply(){this.$owner.$gearLocked=!0;let e=this.$storage[this.$controller.selectedPageId];e!=null?this.$owner.icon=e:this.$owner.icon=this.$default,this.$owner.$gearLocked=!1}updateState(){this.$controller==null||this.$owner.$gearLocked||this.$owner.$inProgressBuilding||(this.$storage[this.$controller.selectedPageId]=this.$owner.icon)}}r.GearIcon=a})(fgui||(fgui={}));(function(r){class a extends r.GearBase{constructor(i){super(i)}init(){this.$default=new c(this.$owner.alpha,this.$owner.rotation,this.$owner.grayed),this.$storage={}}addStatus(i,t){if(t=="-")return;let s=t.split(","),h;i==null?h=this.$default:(h=new c,this.$storage[i]=h),h.alpha=parseFloat(s[0]),h.rotation=parseInt(s[1]),h.grayed=s[2]=="1"}apply(){let i=this.$storage[this.$controller.selectedPageId];if(i||(i=this.$default),this.$tween&&!r.UIPackage.$constructingObjects&&!r.GearBase.disableAllTweenEffect){if(this.$owner.$gearLocked=!0,this.$owner.grayed=i.grayed,this.$owner.$gearLocked=!1,this.$tweener){if(this.$tweenTarget.alpha===i.alpha&&this.$tweenTarget.rotation===i.rotation)return;this.$tweener.end().stop(),this.$tweener=null}let t=i.alpha!=this.$owner.alpha,s=i.rotation!=this.$owner.rotation;if(t||s){this.$owner.hasGearController(0,this.$controller)&&(this.$lockToken=this.$owner.lockGearDisplay()),this.$tweenTarget=i;let h={onChange:()=>{this.$owner.$gearLocked=!0,t&&(this.$owner.alpha=this.$tweenValue.x),s&&(this.$owner.rotation=this.$tweenValue.y),this.$owner.$gearLocked=!1}};this.$tweenValue==null&&(this.$tweenValue=new f.Point),this.$tweenValue.x=this.$owner.alpha,this.$tweenValue.y=this.$owner.rotation,this.$tweener=new TWEEN.Tween(this.$tweenValue).delay(this.$tweenDelay*1e3).to({x:i.alpha,y:i.rotation},this.$tweenTime*1e3).easing(this.$easeType).onUpdate(h.onChange).onComplete(this.tweenComplete).start()}}else this.$owner.$gearLocked=!0,this.$owner.grayed=i.grayed,this.$owner.alpha=i.alpha,this.$owner.rotation=i.rotation,this.$owner.$gearLocked=!1}tweenComplete(){this.$lockToken!=0&&(this.$owner&&this.$owner.releaseGearDisplay(this.$lockToken),this.$lockToken=0),this.$tweener=null,this.$owner&&this.$owner.emit(r.GearEvent.GEAR_STOP,this)}updateState(){if(this.$controller==null||this.$owner.$gearLocked||this.$owner.$inProgressBuilding)return;let i=this.$storage[this.$controller.selectedPageId];i||(i=new c,this.$storage[this.$controller.selectedPageId]=i),i.alpha=this.$owner.alpha,i.rotation=this.$owner.rotation,i.grayed=this.$owner.grayed}}r.GearLook=a;class c{constructor(i=0,t=0,s=!1){this.alpha=i,this.rotation=t,this.grayed=s}}})(fgui||(fgui={}));(function(r){class a extends r.GearBase{constructor(i){super(i)}init(){this.$default=new c(this.$owner.width,this.$owner.height,this.$owner.scaleX,this.$owner.scaleY),this.$storage={}}addStatus(i,t){if(t=="-")return;let s=t.split(","),h;i==null?h=this.$default:(h=new c,this.$storage[i]=h),h.width=parseInt(s[0]),h.height=parseInt(s[1]),s.length>2&&(h.scaleX=parseFloat(s[2]),h.scaleY=parseFloat(s[3]))}apply(){let i=this.$storage[this.$controller.selectedPageId];if(i||(i=this.$default),this.$tween&&!r.UIPackage.$constructingObjects&&!r.GearBase.disableAllTweenEffect){if(this.$tweener)if(this.$tweenTarget.width!=i.width||this.$tweenTarget.height!=i.height||this.$tweenTarget.scaleX!=i.scaleX||this.$tweenTarget.scaleY!=i.scaleY)this.$tweener.end().stop(),this.$tweener=null;else return;let t=i.width!=this.$owner.width||i.height!=this.$owner.height,s=i.scaleX!=this.$owner.scaleX||i.scaleY!=this.$owner.scaleY;if(t||s){this.$owner.hasGearController(0,this.$controller)&&(this.$lockToken=this.$owner.lockGearDisplay()),this.$tweenTarget=i;let h={onChange:()=>{this.$owner.$gearLocked=!0,t&&this.$owner.setSize(this.$tweenValue.width,this.$tweenValue.height,this.$owner.gearXY.controller==this.$controller),s&&this.$owner.setScale(this.$tweenValue.scaleX,this.$tweenValue.scaleY),this.$owner.$gearLocked=!1}};this.$tweenValue==null&&(this.$tweenValue=new c),this.$tweenValue.width=this.$owner.width,this.$tweenValue.height=this.$owner.height,this.$tweenValue.scaleX=this.$owner.scaleX,this.$tweenValue.scaleY=this.$owner.scaleY,this.$tweener=new TWEEN.Tween(this.$tweenValue).delay(this.$tweenDelay*1e3).to({width:i.width,height:i.height,scaleX:i.scaleX,scaleY:i.scaleY},this.$tweenTime*1e3).easing(this.$easeType).onUpdate(h.onChange).onComplete(this.tweenComplete).start()}}else this.$owner.$gearLocked=!0,this.$owner.setSize(i.width,i.height,this.$owner.gearXY.controller==this.$controller),this.$owner.setScale(i.scaleX,i.scaleY),this.$owner.$gearLocked=!1}tweenComplete(){this.$lockToken!=0&&(this.$owner.releaseGearDisplay(this.$lockToken),this.$lockToken=0),this.$tweener=null,this.$owner.emit(r.GearEvent.GEAR_STOP,this)}updateState(){if(this.$controller==null||this.$owner.$gearLocked||this.$owner.$inProgressBuilding)return;let i=this.$storage[this.$controller.selectedPageId];i||(i=new c,this.$storage[this.$controller.selectedPageId]=i),i.width=this.$owner.width,i.height=this.$owner.height,i.scaleX=this.$owner.scaleX,i.scaleY=this.$owner.scaleY}updateFromRelations(i,t){if(!(this.$controller==null||this.$storage==null)){for(let s in this.$storage){let h=this.$storage[s];h.width+=i,h.height+=t}this.$default.width+=i,this.$default.height+=t,this.updateState()}}}r.GearSize=a;class c{constructor(i=0,t=0,s=0,h=0){this.width=i,this.height=t,this.scaleX=s,this.scaleY=h}}})(fgui||(fgui={}));(function(r){class a extends r.GearBase{constructor(e){super(e)}init(){this.$default=this.$owner.text,this.$storage={}}addStatus(e,i){e==null?this.$default=i:this.$storage[e]=i}apply(){this.$owner.$gearLocked=!0;let e=this.$storage[this.$controller.selectedPageId];e!=null?this.$owner.text=e:this.$owner.text=this.$default,this.$owner.$gearLocked=!1}updateState(){this.$controller==null||this.$owner.$gearLocked||this.$owner.$inProgressBuilding||(this.$storage[this.$controller.selectedPageId]=this.$owner.text)}}r.GearText=a})(fgui||(fgui={}));(function(r){class a extends r.GearBase{constructor(e){super(e)}init(){this.$default=new f.Point(this.$owner.x,this.$owner.y),this.$storage={}}addStatus(e,i){if(i=="-")return;let t=i.split(","),s;e==null?s=this.$default:(s=new f.Point,this.$storage[e]=s),s.x=parseInt(t[0]),s.y=parseInt(t[1])}apply(){let e=this.$storage[this.$controller.selectedPageId];if(e||(e=this.$default),this.$tween&&!r.UIPackage.$constructingObjects&&!r.GearBase.disableAllTweenEffect){if(this.$tweener){if(this.$tweenTarget.x===e.x&&this.$tweenTarget.y===e.y)return;this.$tweener.end().stop(),this.$tweener=null}if(this.$owner.x!=e.x||this.$owner.y!=e.y){this.$owner.hasGearController(0,this.$controller),this.$lockToken=this.$owner.lockGearDisplay(),this.$tweenTarget=e;let i={onChange:()=>{this.$owner.$gearLocked=!0,this.$owner.setXY(this.$tweenValue.x,this.$tweenValue.y),this.$owner.$gearLocked=!1}};this.$tweenValue==null&&(this.$tweenValue=new f.Point),this.$tweenValue.x=this.$owner.x,this.$tweenValue.y=this.$owner.y,this.$tweener=new TWEEN.Tween(this.$tweenValue).onUpdate(i.onChange).delay(this.$tweenDelay*1e3).to({x:e.x,y:e.y},this.$tweenTime*1e3).easing(this.$easeType).onComplete(this.tweenComplete).start()}}else this.$owner.$gearLocked=!0,this.$owner.setXY(e.x,e.y),this.$owner.$gearLocked=!1}tweenComplete(){var e;this.$lockToken!=0&&((e=this.$owner)==null||e.releaseGearDisplay(this.$lockToken),this.$lockToken=0),this.$tweener=null,this.$owner&&this.$owner.emit(r.GearEvent.GEAR_STOP,this)}updateState(){if(this.$controller==null||this.$owner.$gearLocked||this.$owner.$inProgressBuilding)return;let e=this.$storage[this.$controller.selectedPageId];e||(e=new f.Point,this.$storage[this.$controller.selectedPageId]=e),e.x=this.$owner.x,e.y=this.$owner.y}updateFromRelations(e,i){if(!(this.$controller==null||this.$storage==null)){for(let t in this.$storage){let s=this.$storage[t];s.x+=e,s.y+=i}this.$default.x+=e,this.$default.y+=i,this.updateState()}}}r.GearXY=a})(fgui||(fgui={}));(function(r){r.isAnimationGear=function(a){return a&&"playing"in a&&"frame"in a}})(fgui||(fgui={}));(function(r){r.isColorGear=function(a){return a&&("color"in a||"titleColor"in a)}})(fgui||(fgui={}));(function(r){r.isColorableTitle=function(a){return a&&"titleColor"in a&&"fontSize"in a}})(fgui||(fgui={}));(function(r){class a{constructor(e=null){if(!e&&(e=r.UIConfig.popupMenu,!e))throw new Error("UIConfig.popupMenu not defined");this.$contentPane=r.UIPackage.createObjectFromURL(e),this.$contentPane.on("added",this.$addedToStage,this),this.$list=this.$contentPane.getChild("list"),this.$list.removeChildrenToPool(),this.$list.addRelation(this.$contentPane,14),this.$list.removeRelation(this.$contentPane,15),this.$contentPane.addRelation(this.$list,15),this.$list.on(r.ListEvent.ItemClick,this.$clickItem,this)}dispose(){r.GTimer.inst.remove(this.$delayClickItem,this),this.$list.off(r.ListEvent.ItemClick,this.$clickItem,this),this.$contentPane.off("added",this.$addedToStage,this),this.$contentPane.dispose()}addItem(e,i){let t=this.$list.addItemFromPool();t.title=e,t.data=i,t.grayed=!1;let s=t.getController("checked");return s!=null&&(s.selectedIndex=0),t}addItemAt(e,i,t){let s=this.$list.getFromPool();this.$list.addChildAt(s,i),s.title=e,s.data=t,s.grayed=!1;let h=s.getController("checked");return h!=null&&(h.selectedIndex=0),s}addSeperator(){if(r.UIConfig.popupMenuSeperator==null)throw new Error("UIConfig.popupMenuSeperator not defined");this.$list.addItemFromPool(r.UIConfig.popupMenuSeperator)}getItemName(e){return this.$list.getChildAt(e).name}setItemText(e,i){let t=this.$list.getChild(e);t.title=i}setItemVisible(e,i){let t=this.$list.getChild(e);t.visible!=i&&(t.visible=i,this.$list.setBoundsChangedFlag())}setItemGrayed(e,i){let t=this.$list.getChild(e);t.grayed=i}setItemCheckable(e,i){let s=this.$list.getChild(e).getController("checked");s!=null&&(i?s.selectedIndex==0&&(s.selectedIndex=1):s.selectedIndex=0)}setItemChecked(e,i){let s=this.$list.getChild(e).getController("checked");s!=null&&(s.selectedIndex=i?2:1)}isItemChecked(e){let t=this.$list.getChild(e).getController("checked");return t!=null?t.selectedIndex==2:!1}removeItem(e){let i=this.$list.getChild(e);if(i!=null){let t=this.$list.getChildIndex(i);return this.$list.removeChildToPoolAt(t),!0}else return!1}clearItems(){this.$list.removeChildrenToPool()}get itemCount(){return this.$list.numChildren}get contentPane(){return this.$contentPane}get list(){return this.$list}show(e=null,i){(e!=null?e.root:r.GRoot.inst).showPopup(this.contentPane,e instanceof r.GRoot?null:e,i)}$clickItem(e,i){r.GTimer.inst.add(100,1,this.$delayClickItem,this,i)}$delayClickItem(e){if(!(e instanceof r.GButton))return;if(e.grayed){this.$list.selectedIndex=-1;return}let i=e.getController("checked");i!=null&&i.selectedIndex!=0&&(i.selectedIndex==1?i.selectedIndex=2:i.selectedIndex=1);let t=this.$contentPane.parent;t&&t.hidePopup(this.contentPane),e.data!=null&&e.data.call(null),r.GTimer.inst.remove(this.$delayClickItem,this)}$addedToStage(){this.$list.selectedIndex=-1,this.$list.resizeToFit(1e5,10)}}r.PopupMenu=a})(fgui||(fgui={}));(function(r){class a{constructor(i){this.$owner=i,this.$defs=[]}get owner(){return this.$owner}set target(i){this.$target!=i&&(this.$target&&this.releaseRefTarget(this.$target),this.$target=i,this.$target&&this.addRefTarget(this.$target))}get target(){return this.$target}add(i,t){if(i==24){this.add(14,t),this.add(15,t);return}let s=this.$defs.length;for(let h=0;h<s;h++)if(this.$defs[h].type==i)return;this.internalAdd(i,t)}internalAdd(i,t){if(i==24){this.internalAdd(14,t),this.internalAdd(15,t);return}let s=new c;s.percent=t,s.type=i,this.$defs.push(s),(t||i==1||i==3||i==5||i==8||i==10||i==12)&&(this.$owner.pixelSnapping=!0)}remove(i=0){if(i==24){this.remove(14),this.remove(15);return}let t=this.$defs.length;for(let s=t-1;s>=0;s--)if(this.$defs[s].type==i){this.$defs.splice(s,1);break}}copyFrom(i){this.target=i.target,this.$defs.length=0,i.$defs.forEach(t=>{let s=new c;s.copyFrom(t),this.$defs.push(s)},this)}dispose(){this.$target!=null&&(this.releaseRefTarget(this.$target),this.$target=null)}get isEmpty(){return this.$defs.length==0}applyOnSelfResized(i,t){let s=this.$owner.x,h=this.$owner.y;this.$defs.forEach(n=>{switch(n.type){case 3:case 5:this.$owner.x-=i/2;break;case 4:case 6:this.$owner.x-=i;break;case 10:case 12:this.$owner.y-=t/2;break;case 11:case 13:this.$owner.y-=t;break}},this),(s!=this.$owner.x||h!=this.$owner.y)&&(s=this.$owner.x-s,h=this.$owner.y-h,this.$owner.updateGearFromRelations(1,s,h),this.$owner.parent!=null&&this.$owner.parent.$transitions.length>0&&this.$owner.parent.$transitions.forEach(n=>{n.updateFromRelations(this.$owner.id,s,h)},this))}applyOnXYChanged(i,t,s){let h;switch(i.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:this.$owner.x+=t;break;case 7:case 8:case 9:case 10:case 11:case 12:case 13:this.$owner.y+=s;break;case 14:case 15:break;case 16:case 17:h=this.$owner.x,this.$owner.x+=t,this.$owner.width=this.$owner.$rawWidth-(this.$owner.x-h);break;case 18:case 19:this.$owner.width=this.$owner.$rawWidth+t;break;case 20:case 21:h=this.$owner.y,this.$owner.y+=s,this.$owner.height=this.$owner.$rawHeight-(this.$owner.y-h);break;case 22:case 23:this.$owner.height=this.$owner.$rawHeight+s;break}}applyOnSizeChanged(i){let t,s;this.$target!=this.$owner.parent?(t=this.$target.x,s=this.$target.y):(t=0,s=0);let h,n;switch(i.type){case 0:break;case 1:h=this.$owner.x-(t+this.$targetWidth/2),i.percent&&(h=h/this.$targetWidth*this.$target.$rawWidth),this.$owner.x=t+this.$target.$rawWidth/2+h;break;case 2:h=this.$owner.x-(t+this.$targetWidth),i.percent&&(h=h/this.$targetWidth*this.$target.$rawWidth),this.$owner.x=t+this.$target.$rawWidth+h;break;case 3:h=this.$owner.x+this.$owner.$rawWidth/2-(t+this.$targetWidth/2),i.percent&&(h=h/this.$targetWidth*this.$target.$rawWidth),this.$owner.x=t+this.$target.$rawWidth/2+h-this.$owner.$rawWidth/2;break;case 4:h=this.$owner.x+this.$owner.$rawWidth-t,i.percent&&(h=h/this.$targetWidth*this.$target.$rawWidth),this.$owner.x=t+h-this.$owner.$rawWidth;break;case 5:h=this.$owner.x+this.$owner.$rawWidth-(t+this.$targetWidth/2),i.percent&&(h=h/this.$targetWidth*this.$target.$rawWidth),this.$owner.x=t+this.$target.$rawWidth/2+h-this.$owner.$rawWidth;break;case 6:h=this.$owner.x+this.$owner.$rawWidth-(t+this.$targetWidth),i.percent&&(h=h/this.$targetWidth*this.$target.$rawWidth),this.$owner.x=t+this.$target.$rawWidth+h-this.$owner.$rawWidth;break;case 7:break;case 8:h=this.$owner.y-(s+this.$targetHeight/2),i.percent&&(h=h/this.$targetHeight*this.$target.$rawHeight),this.$owner.y=s+this.$target.$rawHeight/2+h;break;case 9:h=this.$owner.y-(s+this.$targetHeight),i.percent&&(h=h/this.$targetHeight*this.$target.$rawHeight),this.$owner.y=s+this.$target.$rawHeight+h;break;case 10:h=this.$owner.y+this.$owner.$rawHeight/2-(s+this.$targetHeight/2),i.percent&&(h=h/this.$targetHeight*this.$target.$rawHeight),this.$owner.y=s+this.$target.$rawHeight/2+h-this.$owner.$rawHeight/2;break;case 11:h=this.$owner.y+this.$owner.$rawHeight-s,i.percent&&(h=h/this.$targetHeight*this.$target.$rawHeight),this.$owner.y=s+h-this.$owner.$rawHeight;break;case 12:h=this.$owner.y+this.$owner.$rawHeight-(s+this.$targetHeight/2),i.percent&&(h=h/this.$targetHeight*this.$target.$rawHeight),this.$owner.y=s+this.$target.$rawHeight/2+h-this.$owner.$rawHeight;break;case 13:h=this.$owner.y+this.$owner.$rawHeight-(s+this.$targetHeight),i.percent&&(h=h/this.$targetHeight*this.$target.$rawHeight),this.$owner.y=s+this.$target.$rawHeight+h-this.$owner.$rawHeight;break;case 14:this.$owner.$inProgressBuilding&&this.$owner==this.$target.parent?h=this.$owner.sourceWidth-this.$target.$initWidth:h=this.$owner.$rawWidth-this.$targetWidth,i.percent&&(h=h/this.$targetWidth*this.$target.$rawWidth),this.$target==this.$owner.parent?this.$owner.setSize(this.$target.$rawWidth+h,this.$owner.$rawHeight,!0):this.$owner.width=this.$target.$rawWidth+h;break;case 15:this.$owner.$inProgressBuilding&&this.$owner==this.$target.parent?h=this.$owner.sourceHeight-this.$target.$initHeight:h=this.$owner.$rawHeight-this.$targetHeight,i.percent&&(h=h/this.$targetHeight*this.$target.$rawHeight),this.$target==this.$owner.parent?this.$owner.setSize(this.$owner.$rawWidth,this.$target.$rawHeight+h,!0):this.$owner.height=this.$target.$rawHeight+h;break;case 16:break;case 17:h=this.$owner.x-(t+this.$targetWidth),i.percent&&(h=h/this.$targetWidth*this.$target.$rawWidth),n=this.$owner.x,this.$owner.x=t+this.$target.$rawWidth+h,this.$owner.width=this.$owner.$rawWidth-(this.$owner.x-n);break;case 18:break;case 19:this.$owner.$inProgressBuilding&&this.$owner==this.$target.parent?h=this.$owner.sourceWidth-(t+this.$target.$initWidth):h=this.$owner.width-(t+this.$targetWidth),this.$owner!=this.$target.parent&&(h+=this.$owner.x),i.percent&&(h=h/this.$targetWidth*this.$target.$rawWidth),this.$owner!=this.$target.parent?this.$owner.width=t+this.$target.$rawWidth+h-this.$owner.x:this.$owner.width=t+this.$target.$rawWidth+h;break;case 20:break;case 21:h=this.$owner.y-(s+this.$targetHeight),i.percent&&(h=h/this.$targetHeight*this.$target.$rawHeight),n=this.$owner.y,this.$owner.y=s+this.$target.$rawHeight+h,this.$owner.height=this.$owner.$rawHeight-(this.$owner.y-n);break;case 22:break;case 23:this.$owner.$inProgressBuilding&&this.$owner==this.$target.parent?h=this.$owner.sourceHeight-(s+this.$target.$initHeight):h=this.$owner.$rawHeight-(s+this.$targetHeight),this.$owner!=this.$target.parent&&(h+=this.$owner.y),i.percent&&(h=h/this.$targetHeight*this.$target.$rawHeight),this.$owner!=this.$target.parent?this.$owner.height=s+this.$target.$rawHeight+h-this.$owner.y:this.$owner.height=s+this.$target.$rawHeight+h;break}}addRefTarget(i){i!=this.$owner.parent&&i.on(r.DisplayObjectEvent.XY_CHANGED,this.$targetXYChanged,this),i.on(r.DisplayObjectEvent.SIZE_CHANGED,this.$targetSizeChanged,this),i.on(r.DisplayObjectEvent.SIZE_DELAY_CHANGE,this.$targetSizeWillChange,this),this.$targetX=this.$target.x,this.$targetY=this.$target.y,this.$targetWidth=this.$target.$rawWidth,this.$targetHeight=this.$target.$rawHeight}releaseRefTarget(i){i.off(r.DisplayObjectEvent.XY_CHANGED,this.$targetXYChanged,this),i.off(r.DisplayObjectEvent.SIZE_CHANGED,this.$targetSizeChanged,this),i.off(r.DisplayObjectEvent.SIZE_DELAY_CHANGE,this.$targetSizeWillChange,this)}$targetXYChanged(i){if(this.$owner.relations.$dealing!=null||this.$owner.group!=null&&this.$owner.group.$updating){this.$targetX=this.$target.x,this.$targetY=this.$target.y;return}this.$owner.relations.$dealing=this.$target;let t=this.$owner.x,s=this.$owner.y,h=this.$target.x-this.$targetX,n=this.$target.y-this.$targetY;this.$defs.forEach(l=>{this.applyOnXYChanged(l,h,n)},this),this.$targetX=this.$target.x,this.$targetY=this.$target.y,(t!=this.$owner.x||s!=this.$owner.y)&&(t=this.$owner.x-t,s=this.$owner.y-s,this.$owner.updateGearFromRelations(1,t,s),this.$owner.parent!=null&&this.$owner.parent.$transitions.length>0&&this.$owner.parent.$transitions.forEach(l=>{l.updateFromRelations(this.$owner.id,t,s)},this)),this.$owner.relations.$dealing=null}$targetSizeChanged(i){if(this.$owner.relations.$dealing!=null)return;this.$owner.relations.$dealing=this.$target;let t=this.$owner.x,s=this.$owner.y,h=this.$owner.$rawWidth,n=this.$owner.$rawHeight;this.$defs.forEach(l=>{this.applyOnSizeChanged(l)},this),this.$targetWidth=this.$target.$rawWidth,this.$targetHeight=this.$target.$rawHeight,(t!=this.$owner.x||s!=this.$owner.y)&&(t=this.$owner.x-t,s=this.$owner.y-s,this.$owner.updateGearFromRelations(1,t,s),this.$owner.parent!=null&&this.$owner.parent.$transitions.length>0&&this.$owner.parent.$transitions.forEach(l=>{l.updateFromRelations(this.$owner.id,t,s)},this)),(h!=this.$owner.$rawWidth||n!=this.$owner.$rawHeight)&&(h=this.$owner.$rawWidth-h,n=this.$owner.$rawHeight-n,this.$owner.updateGearFromRelations(2,h,n)),this.$owner.relations.$dealing=null}$targetSizeWillChange(i){this.$owner.relations.sizeDirty=!0}}r.RelationItem=a;class c{copyFrom(i){this.percent=i.percent,this.type=i.type}}r.RelationDef=c})(fgui||(fgui={}));(function(r){class a{constructor(e){this.sizeDirty=!1,this.$owner=e,this.$items=[]}add(e,i,t=!1){let s=this.$items.length;for(let n=0;n<s;n++){let l=this.$items[n];if(l.target==e){l.add(i,t);return}}let h=new r.RelationItem(this.$owner);h.target=e,h.add(i,t),this.$items.push(h)}addItems(e,i){let t=i.split(","),s,h;for(let n=0;n<2;n++){if(s=t[n],!s)continue;s.charAt(s.length-1)=="%"?(s=s.substr(0,s.length-1),h=!0):h=!1,s.indexOf("-")==-1&&(s=`${s}-${s}`);let l=a.RELATION_NAMES.indexOf(s);if(l==-1)throw new Error("Invalid relation type");this.add(e,l,h)}}remove(e,i=0){let t=this.$items.length,s=0;for(;s<t;){let h=this.$items[s];h.target==e?(h.remove(i),h.isEmpty?(h.dispose(),this.$items.splice(s,1),t--):s++):s++}}contains(e){let i=this.$items.length;for(let t=0;t<i;t++)if(this.$items[t].target==e)return!0;return!1}clearFor(e){let i=this.$items.length,t=0;for(;t<i;){let s=this.$items[t];s.target==e?(s.dispose(),this.$items.splice(t,1),i--):t++}}clearAll(){this.$items.forEach(e=>{e.dispose()},this),this.$items.length=0}copyFrom(e){this.clearAll(),e.$items.forEach(i=>{let t=new r.RelationItem(this.$owner);t.copyFrom(i),this.$items.push(t)},this)}dispose(){this.clearAll()}onOwnerSizeChanged(e,i){this.$items.length<=0||this.$items.forEach(t=>{t.applyOnSelfResized(e,i)},this)}ensureRelationsSizeCorrect(){this.$items.length!=0&&(this.sizeDirty=!1,this.$items.forEach(e=>{e.target.ensureSizeCorrect()},this))}get empty(){return this.$items.length==0}setup(e){e.children.forEach(i=>{if(i.nodeName!="relation")return;let t,s;t=i.attributes.target,this.$owner.parent?t?s=this.$owner.parent.getChildById(t):s=this.$owner.parent:s=this.$owner.getChildById(t),s&&this.addItems(s,i.attributes.sidePair)},this)}}a.RELATION_NAMES=["left-left","left-center","left-right","center-center","right-left","right-center","right-right","top-top","top-middle","top-bottom","middle-middle","bottom-top","bottom-middle","bottom-bottom","width-width","height-height","leftext-left","leftext-right","rightext-left","rightext-right","topext-top","topext-bottom","bottomext-top","bottomext-bottom"],r.Relations=a})(fgui||(fgui={}));(function(r){class a extends f.utils.EventEmitter{constructor(e,i,t,s,h,n,l,o,$){super(),this.$isDragging=!1,this.$owner=e,this.$maskContainer=new r.UIContainer(null),this.$owner.$rootContainer.addChild(this.$maskContainer),this.$container=this.$owner.$container,this.$container.x=0,this.$container.y=0,this.$maskContainer.addChild(this.$container),this.$scrollBarMargin=t,this.$scrollType=i,this.$scrollSpeed=r.UIConfig.defaultScrollSpeed,this.$mouseWheelSpeed=this.$scrollSpeed*2,this.$decelerationRate=r.UIConfig.defaultScrollDecelerationRate,this.$displayOnLeft=(h&1)!=0,this.$snapToItem=(h&2)!=0,this.$displayOnDemand=(h&4)!=0,this.$pageMode=(h&8)!=0,h&16?this.$touchEffect=!0:h&32?this.$touchEffect=!1:this.$touchEffect=r.UIConfig.defaultScrollTouchEffect,h&64?this.$bouncebackEffect=!0:h&128?this.$bouncebackEffect=!1:this.$bouncebackEffect=r.UIConfig.defaultScrollBounceEffect,this.$inertiaDisabled=(h&256)!=0,(h&512)==0&&(this.$maskContainer.scrollRect=new f.Rectangle),this.$scrollBarVisible=!0,this.$mouseWheelEnabled=!0,this.$xPos=0,this.$yPos=0,this.$aniFlag=0,this.$footerLockedSize=0,this.$headerLockedSize=0,s==0&&(s=r.UIConfig.defaultScrollBarDisplay),this.$viewSize=new f.Point,this.$contentSize=new f.Point,this.$pageSize=new f.Point(1,1),this.$overlapSize=new f.Point,this.$tweening=0,this.$tweenTime=new f.Point,this.$tweenStart=new f.Point,this.$tweenDuration=new f.Point,this.$tweenChange=new f.Point,this.$velocity=new f.Point,this.$containerPos=new f.Point,this.$beginTouchPos=new f.Point,this.$lastTouchPos=new f.Point,this.$lastTouchGlobalPos=new f.Point;let d;if(s!=3){if(this.$scrollType==2||this.$scrollType==1){let w=n||r.UIConfig.verticalScrollBar;if(w){if(this.$vtScrollBar=r.UIPackage.createObjectFromURL(w),!this.$vtScrollBar)throw new Error(`Cannot creatrootContainere scrollbar from ${w}`);this.$vtScrollBar.setScrollPane(this,!0),this.$owner.$rootContainer.addChild(this.$vtScrollBar.displayObject)}}if((this.$scrollType==2||this.$scrollType==0)&&(d=l||r.UIConfig.horizontalScrollBar,d)){if(this.$hzScrollBar=r.UIPackage.createObjectFromURL(d),!this.$hzScrollBar)throw new Error(`Cannot create scrollbar from ${d}`);this.$hzScrollBar.setScrollPane(this,!1),this.$owner.$rootContainer.addChild(this.$hzScrollBar.displayObject)}this.$scrollBarDisplayAuto=s==2,this.$scrollBarDisplayAuto&&(this.$scrollBarVisible=!1,this.$vtScrollBar&&(this.$vtScrollBar.displayObject.visible=!1),this.$hzScrollBar&&(this.$hzScrollBar.displayObject.visible=!1))}else this.$mouseWheelEnabled=!1;if(o&&(this.$header=r.UIPackage.createObjectFromURL(o),this.$header==null))throw new Error(`Cannot create scrollPane.header from ${d}`);if($&&(this.$footer=r.UIPackage.createObjectFromURL($),this.$footer==null))throw new Error(`Cannot create scrollPane.footer from ${d}`);(this.$header!=null||this.$footer!=null)&&(this.$refreshBarAxis=this.$scrollType==2||this.$scrollType==1?"y":"x"),this.setSize(e.width,e.height),this.$owner.on(r.InteractiveEvents.Over,this.$rollOver,this),this.$owner.on(r.InteractiveEvents.Out,this.$rollOut,this),this.$owner.on(r.InteractiveEvents.Down,this.$mouseDown,this),this.$owner.on(r.DisplayObjectEvent.MOUSE_WHEEL,this.$mouseWheel,this),this.boundary=new f.EventBoundary(this.owner.$container),["pointerdown","pointerup","pointermove","pointerover","pointerout","wheel"].forEach(w=>{this.$owner.on(w,C=>this.boundary.mapEvent(C))})}dispose(){this.$tweening!=0&&r.GTimer.inst.remove(this.tweenUpdate,this),this.$pageController=null,this.$hzScrollBar!=null&&this.$hzScrollBar.dispose(),this.$vtScrollBar!=null&&this.$vtScrollBar.dispose(),this.$header!=null&&this.$header.dispose(),this.$footer!=null&&this.$footer.dispose(),this.$owner.off(r.InteractiveEvents.Move,this.$mouseMove,this),this.$owner.off(r.InteractiveEvents.Up,this.$mouseUp,this),this.$owner.off(r.InteractiveEvents.Over,this.$rollOver,this),this.$owner.off(r.InteractiveEvents.Out,this.$rollOut,this),this.$owner.off(r.InteractiveEvents.Down,this.$mouseDown,this),this.$owner.off(r.DisplayObjectEvent.MOUSE_WHEEL,this.$mouseWheel,this)}get owner(){return this.$owner}get horzScrollBar(){return this.$hzScrollBar}get vertScrollBar(){return this.$vtScrollBar}get header(){return this.$header}get footer(){return this.$footer}get bouncebackEffect(){return this.$bouncebackEffect}set bouncebackEffect(e){this.$bouncebackEffect=e}get touchEffect(){return this.$touchEffect}set touchEffect(e){this.$touchEffect=e}set scrollSpeed(e){this.$scrollSpeed=e,this.$scrollSpeed==0&&(this.$scrollSpeed=r.UIConfig.defaultScrollSpeed),this.$mouseWheelSpeed=this.$scrollSpeed*2}get scrollSpeed(){return this.$scrollSpeed}get snapToItem(){return this.$snapToItem}set snapToItem(e){this.$snapToItem=e}get mouseWheelEnabled(){return this.$mouseWheelEnabled}set mouseWheelEnabled(e){this.$mouseWheelEnabled=e}get decelerationRate(){return this.$decelerationRate}set decelerationRate(e){this.$decelerationRate=e}get percX(){return this.$overlapSize.x==0?0:this.$xPos/this.$overlapSize.x}set percX(e){this.setPercX(e,!1)}setPercX(e,i=!1){this.$owner.ensureBoundsCorrect(),this.setPosX(this.$overlapSize.x*r.utils.NumberUtil.clamp01(e),i)}get percY(){return this.$overlapSize.y==0?0:this.$yPos/this.$overlapSize.y}set percY(e){this.setPercY(e,!1)}setPercY(e,i=!1){this.$owner.ensureBoundsCorrect(),this.setPosY(this.$overlapSize.y*r.utils.NumberUtil.clamp01(e),i)}get posX(){return this.$xPos}set posX(e){this.setPosX(e,!1)}setPosX(e,i=!1){this.$owner.ensureBoundsCorrect(),this.$loop==1&&(e=this.loopCheckingNewPos(e,"x")),e=r.utils.NumberUtil.clamp(e,0,this.$overlapSize.x),e!=this.$xPos&&(this.$xPos=e,this.posChanged(i))}get posY(){return this.$yPos}set posY(e){this.setPosY(e,!1)}setPosY(e,i=!1){this.$owner.ensureBoundsCorrect(),this.$loop==1&&(e=this.loopCheckingNewPos(e,"y")),e=r.utils.NumberUtil.clamp(e,0,this.$overlapSize.y),e!=this.$yPos&&(this.$yPos=e,this.posChanged(i))}get contentWidth(){return this.$contentSize.x}get contentHeight(){return this.$contentSize.y}get viewWidth(){return this.$viewSize.x}set viewWidth(e){e=e+this.$owner.margin.left+this.$owner.margin.right,this.$vtScrollBar!=null&&(e+=this.$vtScrollBar.width),this.$owner.width=e}get viewHeight(){return this.$viewSize.y}set viewHeight(e){e=e+this.$owner.margin.top+this.$owner.margin.bottom,this.$hzScrollBar!=null&&(e+=this.$hzScrollBar.height),this.$owner.height=e}get currentPageX(){if(!this.$pageMode)return 0;var e=Math.floor(this.$xPos/this.$pageSize.x);return this.$xPos-e*this.$pageSize.x>this.$pageSize.x*.5&&e++,e}set currentPageX(e){this.$pageMode&&this.$overlapSize.x>0&&this.setPosX(e*this.$pageSize.x,!1)}get currentPageY(){if(!this.$pageMode)return 0;let e=Math.floor(this.$yPos/this.$pageSize.y);return this.$yPos-e*this.$pageSize.y>this.$pageSize.y*.5&&e++,e}set currentPageY(e){this.$pageMode&&this.$overlapSize.y>0&&this.setPosY(e*this.$pageSize.y,!1)}get isBottomMost(){return this.$yPos==this.$overlapSize.y||this.$overlapSize.y==0}get isRightMost(){return this.$xPos==this.$overlapSize.x||this.$overlapSize.x==0}get pageController(){return this.$pageController}set pageController(e){this.$pageController=e}get scrollingPosX(){return r.utils.NumberUtil.clamp(-this.$container.x,0,this.$overlapSize.x)}get scrollingPosY(){return r.utils.NumberUtil.clamp(-this.$container.y,0,this.$overlapSize.y)}scrollTop(e=!1){this.setPercY(0,e)}scrollBottom(e=!1){this.setPercY(1,e)}scrollUp(e=1,i=!1){this.$pageMode?this.setPosY(this.$yPos-this.$pageSize.y*e,i):this.setPosY(this.$yPos-this.$scrollSpeed*e,i)}scrollDown(e=1,i=!1){this.$pageMode?this.setPosY(this.$yPos+this.$pageSize.y*e,i):this.setPosY(this.$yPos+this.$scrollSpeed*e,i)}scrollLeft(e=1,i=!1){this.$pageMode?this.setPosX(this.$xPos-this.$pageSize.x*e,i):this.setPosX(this.$xPos-this.$scrollSpeed*e,i)}scrollRight(e=1,i=!1){this.$pageMode?this.setPosX(this.$xPos+this.$pageSize.x*e,i):this.setPosX(this.$xPos+this.$scrollSpeed*e,i)}scrollToView(e,i=!1,t=!1){this.$owner.ensureBoundsCorrect(),this.$needRefresh&&this.refresh();let s;if(e instanceof r.GObject?e.parent!=this.$owner?(e.parent.localToGlobalRect(e.x,e.y,e.width,e.height,a.sHelperRect),s=this.$owner.globalToLocalRect(a.sHelperRect.x,a.sHelperRect.y,a.sHelperRect.width,a.sHelperRect.height,a.sHelperRect)):(s=a.sHelperRect,s.x=e.x,s.y=e.y,s.width=e.width,s.height=e.height):s=e,this.$overlapSize.y>0){let h=this.$yPos+this.$viewSize.y;t||s.y<=this.$yPos||s.height>=this.$viewSize.y?this.$pageMode?this.setPosY(Math.floor(s.y/this.$pageSize.y)*this.$pageSize.y,i):this.setPosY(s.y,i):s.y+s.height>h&&(this.$pageMode?this.setPosY(Math.floor(s.y/this.$pageSize.y)*this.$pageSize.y,i):s.height<=this.$viewSize.y/2?this.setPosY(s.y+s.height*2-this.$viewSize.y,i):this.setPosY(s.y+s.height-this.$viewSize.y,i))}if(this.$overlapSize.x>0){let h=this.$xPos+this.$viewSize.x;t||s.x<=this.$xPos||s.width>=this.$viewSize.x?this.$pageMode?this.setPosX(Math.floor(s.x/this.$pageSize.x)*this.$pageSize.x,i):this.setPosX(s.x,i):s.x+s.width>h&&(this.$pageMode?this.setPosX(Math.floor(s.x/this.$pageSize.x)*this.$pageSize.x,i):s.width<=this.$viewSize.x/2?this.setPosX(s.x+s.width*2-this.$viewSize.x,i):this.setPosX(s.x+s.width-this.$viewSize.x,i))}!i&&this.$needRefresh&&this.refresh()}isChildInView(e){if(this.$overlapSize.y>0){var i=e.y+this.$container.y;if(i<-e.height||i>this.$viewSize.y)return!1}return!(this.$overlapSize.x>0&&(i=e.x+this.$container.x,i<-e.width||i>this.$viewSize.x))}cancelDragging(){this.$owner.off(r.InteractiveEvents.Move,this.$mouseMove,this),this.$owner.off(r.InteractiveEvents.Up,this.$mouseUp,this),a.draggingPane==this&&(a.draggingPane=null),a.$gestureFlag=0,this.$isDragging=!1,this.$maskContainer.interactive=!0}get isDragging(){return this.$isDragging}lockHeader(e){this.$headerLockedSize!=e&&(this.$headerLockedSize=e,!this.$refreshEventDispatching&&this.$container[this.$refreshBarAxis]>=0&&(this.$tweenStart.set(this.$container.x,this.$container.y),this.$tweenChange.set(0,0),this.$tweenChange[this.$refreshBarAxis]=this.$headerLockedSize-this.$tweenStart[this.$refreshBarAxis],this.$tweenDuration.set(a.TWEEN_DEFAULT_DURATION,a.TWEEN_DEFAULT_DURATION),this.$tweenTime.set(0,0),this.$tweening=2,r.GTimer.inst.addLoop(1,this.tweenUpdate,this)))}lockFooter(e){if(this.$footerLockedSize!=e&&(this.$footerLockedSize=e,!this.$refreshEventDispatching&&this.$container[this.$refreshBarAxis]<=-this.$overlapSize[this.$refreshBarAxis])){this.$tweenStart.set(this.$container.x,this.$container.y),this.$tweenChange.set(0,0);let i=this.$overlapSize[this.$refreshBarAxis];i==0?i=Math.max(this.$contentSize[this.$refreshBarAxis]+this.$footerLockedSize-this.$viewSize[this.$refreshBarAxis],0):i+=this.$footerLockedSize,this.$tweenChange[this.$refreshBarAxis]=-i-this.$tweenStart[this.$refreshBarAxis],this.$tweenDuration.set(a.TWEEN_DEFAULT_DURATION,a.TWEEN_DEFAULT_DURATION),this.$tweenTime.set(0,0),this.$tweening=2,r.GTimer.inst.addLoop(1,this.tweenUpdate,this)}}onOwnerSizeChanged(){this.setSize(this.$owner.width,this.$owner.height),this.posChanged(!1)}handleControllerChanged(e){this.$pageController==e&&(this.$scrollType==0?this.currentPageX=e.selectedIndex:this.currentPageY=e.selectedIndex)}updatePageController(){if(this.$pageController!=null&&!this.$pageController.$updating){let e;if(this.$scrollType==0?e=this.currentPageX:e=this.currentPageY,e<this.$pageController.pageCount){let i=this.$pageController;this.$pageController=null,i.selectedIndex=e,this.$pageController=i}}}adjustMaskContainer(){let e,i;this.$displayOnLeft&&this.$vtScrollBar!=null?e=Math.floor(this.$owner.margin.left+this.$vtScrollBar.width):e=Math.floor(this.$owner.margin.left),i=Math.floor(this.$owner.margin.top),this.$maskContainer.position.set(e,i),this.$owner.$alignOffset.x!=0||this.$owner.$alignOffset.y!=0?(this.$alignContainer==null&&(this.$alignContainer=new f.Container,this.$maskContainer.addChild(this.$alignContainer),this.$alignContainer.addChild(this.$container)),this.$alignContainer.position.set(this.$owner.$alignOffset.x,this.$owner.$alignOffset.y)):this.$alignContainer&&this.$alignContainer.position.set(0,0)}setSize(e,i){this.adjustMaskContainer(),this.$hzScrollBar&&(this.$hzScrollBar.y=i-this.$hzScrollBar.height,this.$vtScrollBar&&!this.$vScrollNone?(this.$hzScrollBar.width=e-this.$vtScrollBar.width-this.$scrollBarMargin.left-this.$scrollBarMargin.right,this.$displayOnLeft?this.$hzScrollBar.x=this.$scrollBarMargin.left+this.$vtScrollBar.width:this.$hzScrollBar.x=this.$scrollBarMargin.left):(this.$hzScrollBar.width=e-this.$scrollBarMargin.left-this.$scrollBarMargin.right,this.$hzScrollBar.x=this.$scrollBarMargin.left)),this.$vtScrollBar&&(this.$displayOnLeft||(this.$vtScrollBar.x=e-this.$vtScrollBar.width),this.$hzScrollBar?this.$vtScrollBar.height=i-this.$hzScrollBar.height-this.$scrollBarMargin.top-this.$scrollBarMargin.bottom:this.$vtScrollBar.height=i-this.$scrollBarMargin.top-this.$scrollBarMargin.bottom,this.$vtScrollBar.y=this.$scrollBarMargin.top),this.$viewSize.x=e,this.$viewSize.y=i,this.$hzScrollBar&&!this.$hScrollNone&&(this.$viewSize.y-=this.$hzScrollBar.height),this.$vtScrollBar&&!this.$vScrollNone&&(this.$viewSize.x-=this.$vtScrollBar.width),this.$viewSize.x-=this.$owner.margin.left+this.$owner.margin.right,this.$viewSize.y-=this.$owner.margin.top+this.$owner.margin.bottom,this.$viewSize.x=Math.max(1,this.$viewSize.x),this.$viewSize.y=Math.max(1,this.$viewSize.y),this.$pageSize.x=this.$viewSize.x,this.$pageSize.y=this.$viewSize.y,this.handleSizeChanged()}setContentSize(e,i){this.$contentSize.x==e&&this.$contentSize.y==i||(this.$contentSize.x=e,this.$contentSize.y=i,this.handleSizeChanged())}changeContentSizeOnScrolling(e,i,t,s){let h=this.$xPos==this.$overlapSize.x,n=this.$yPos==this.$overlapSize.y;this.$contentSize.x+=e,this.$contentSize.y+=i,this.handleSizeChanged(),this.$tweening==1?(e!=0&&h&&this.$tweenChange.x<0&&(this.$xPos=this.$overlapSize.x,this.$tweenChange.x=-this.$xPos-this.$tweenStart.x),i!=0&&n&&this.$tweenChange.y<0&&(this.$yPos=this.$overlapSize.y,this.$tweenChange.y=-this.$yPos-this.$tweenStart.y)):this.$tweening==2?(t!=0&&(this.$container.x-=t,this.$tweenStart.x-=t,this.$xPos=-this.$container.x),s!=0&&(this.$container.y-=s,this.$tweenStart.y-=s,this.$yPos=-this.$container.y)):this.$isDragging?(t!=0&&(this.$container.x-=t,this.$containerPos.x-=t,this.$xPos=-this.$container.x),s!=0&&(this.$container.y-=s,this.$containerPos.y-=s,this.$yPos=-this.$container.y)):(e!=0&&h&&(this.$xPos=this.$overlapSize.x,this.$container.x=-this.$xPos),i!=0&&n&&(this.$yPos=this.$overlapSize.y,this.$container.y=-this.$yPos)),this.$pageMode&&this.updatePageController()}handleSizeChanged(e=!1){this.$displayOnDemand&&(this.$vtScrollBar&&(this.$contentSize.y<=this.$viewSize.y?this.$vScrollNone||(this.$vScrollNone=!0,this.$viewSize.x+=this.$vtScrollBar.width):this.$vScrollNone&&(this.$vScrollNone=!1,this.$viewSize.x-=this.$vtScrollBar.width)),this.$hzScrollBar&&(this.$contentSize.x<=this.$viewSize.x?this.$hScrollNone||(this.$hScrollNone=!0,this.$viewSize.y+=this.$hzScrollBar.height):this.$hScrollNone&&(this.$hScrollNone=!1,this.$viewSize.y-=this.$hzScrollBar.height))),this.$vtScrollBar&&(this.$viewSize.y<this.$vtScrollBar.minSize?this.$vtScrollBar.displayObject.visible=!1:(this.$vtScrollBar.displayObject.visible=this.$scrollBarVisible&&!this.$vScrollNone,this.$contentSize.y==0?this.$vtScrollBar.displayPerc=0:this.$vtScrollBar.displayPerc=Math.min(1,this.$viewSize.y/this.$contentSize.y))),this.$hzScrollBar&&(this.$viewSize.x<this.$hzScrollBar.minSize?this.$hzScrollBar.displayObject.visible=!1:(this.$hzScrollBar.displayObject.visible=this.$scrollBarVisible&&!this.$hScrollNone,this.$contentSize.x==0?this.$hzScrollBar.displayPerc=0:this.$hzScrollBar.displayPerc=Math.min(1,this.$viewSize.x/this.$contentSize.x)));let i=this.$maskContainer.scrollRect;if(i&&(i.width=this.$viewSize.x,i.height=this.$viewSize.y,this.$maskContainer.scrollRect=i),this.$scrollType==0||this.$scrollType==2?this.$overlapSize.x=Math.ceil(Math.max(0,this.$contentSize.x-this.$viewSize.x)):this.$overlapSize.x=0,this.$scrollType==1||this.$scrollType==2?this.$overlapSize.y=Math.ceil(Math.max(0,this.$contentSize.y-this.$viewSize.y)):this.$overlapSize.y=0,this.$xPos=r.utils.NumberUtil.clamp(this.$xPos,0,this.$overlapSize.x),this.$yPos=r.utils.NumberUtil.clamp(this.$yPos,0,this.$overlapSize.y),this.$refreshBarAxis!=null){var t=this.$overlapSize[this.$refreshBarAxis];t==0?t=Math.max(this.$contentSize[this.$refreshBarAxis]+this.$footerLockedSize-this.$viewSize[this.$refreshBarAxis],0):t+=this.$footerLockedSize,this.$refreshBarAxis=="x"?this.$container.position.set(r.utils.NumberUtil.clamp(this.$container.x,-t,this.$headerLockedSize),r.utils.NumberUtil.clamp(this.$container.y,-this.$overlapSize.y,0)):this.$container.position.set(r.utils.NumberUtil.clamp(this.$container.x,-this.$overlapSize.x,0),r.utils.NumberUtil.clamp(this.$container.y,-t,this.$headerLockedSize)),this.$header!=null&&(this.$refreshBarAxis=="x"?this.$header.height=this.$viewSize.y:this.$header.width=this.$viewSize.x),this.$footer!=null&&(this.$refreshBarAxis=="y"?this.$footer.height=this.$viewSize.y:this.$footer.width=this.$viewSize.x)}else this.$container.position.set(r.utils.NumberUtil.clamp(this.$container.x,-this.$overlapSize.x,0),r.utils.NumberUtil.clamp(this.$container.y,-this.$overlapSize.y,0));this.syncScrollBar(),this.checkRefreshBar(),this.$pageMode&&this.updatePageController()}posChanged(e){this.$aniFlag==0?this.$aniFlag=e?1:-1:this.$aniFlag==1&&!e&&(this.$aniFlag=-1),this.$needRefresh=!0,r.GTimer.inst.callLater(this.refresh,this)}refresh(){this.$needRefresh=!1,r.GTimer.inst.remove(this.refresh,this),(this.$pageMode||this.$snapToItem)&&(a.sEndPos.set(-this.$xPos,-this.$yPos),this.alignPosition(a.sEndPos,!1),this.$xPos=-a.sEndPos.x,this.$yPos=-a.sEndPos.y),this.refresh2(),this.emit(r.ScrollEvent.SCROLL,this),this.$needRefresh&&(this.$needRefresh=!1,r.GTimer.inst.remove(this.refresh,this),this.refresh2()),this.syncScrollBar(),this.$aniFlag=0}refresh2(){if(this.$aniFlag==1&&!this.$isDragging){let e,i;this.$overlapSize.x>0?e=-Math.floor(this.$xPos):(this.$container.x!=0&&(this.$container.x=0),e=0),this.$overlapSize.y>0?i=-Math.floor(this.$yPos):(this.$container.y!=0&&(this.$container.y=0),i=0),e!=this.$container.x||i!=this.$container.y?(this.$tweening=1,this.$tweenTime.set(0,0),this.$tweenDuration.set(a.TWEEN_MANUALLY_SET_DURATION,a.TWEEN_MANUALLY_SET_DURATION),this.$tweenStart.set(this.$container.x,this.$container.y),this.$tweenChange.set(e-this.$tweenStart.x,i-this.$tweenStart.y),r.GTimer.inst.addLoop(1,this.tweenUpdate,this)):this.$tweening!=0&&this.killTween()}else this.$tweening!=0&&this.killTween(),this.$container.position.set(Math.floor(-this.$xPos),Math.floor(-this.$yPos)),this.loopCheckingCurrent();this.$pageMode&&this.updatePageController()}syncScrollBar(e=!1){this.$vtScrollBar!=null&&(this.$vtScrollBar.scrollPerc=this.$overlapSize.y==0?0:r.utils.NumberUtil.clamp(-this.$container.y,0,this.$overlapSize.y)/this.$overlapSize.y,this.$scrollBarDisplayAuto&&this.showScrollBar(!e)),this.$hzScrollBar!=null&&(this.$hzScrollBar.scrollPerc=this.$overlapSize.x==0?0:r.utils.NumberUtil.clamp(-this.$container.x,0,this.$overlapSize.x)/this.$overlapSize.x,this.$scrollBarDisplayAuto&&this.showScrollBar(!e)),e&&(this.$maskContainer.interactive=!0)}$mouseDown(e){if(!this.$touchEffect)return;this.$tweening!=0?(this.killTween(),this.$isDragging=!1):this.$isDragging=!1,r.GRoot.globalMouseStatus.mouseX=e.clientX,r.GRoot.globalMouseStatus.mouseY=e.clientY;let i=f.utils.isMobile.any?this.$owner.globalToLocal(e.data.global.x,e.data.global.y):this.$owner.globalToLocal(r.GRoot.globalMouseStatus.mouseX,r.GRoot.globalMouseStatus.mouseY,a.sHelperPoint);this.$containerPos.set(this.$container.x,this.$container.y),this.$beginTouchPos.copyFrom(i),this.$lastTouchPos.copyFrom(i),this.$lastTouchGlobalPos.copyFrom(i),this.$isHoldAreaDone=!1,this.$velocity.set(0,0),this.$velocityScale=1,this.$lastMoveTime=r.GTimer.inst.curTime/1e3,this.$owner.on(r.InteractiveEvents.Move,this.$mouseMove,this),this.$owner.on(r.InteractiveEvents.Up,this.$mouseUp,this),this.$owner.on(r.InteractiveEvents.UpOutside,this.$mouseUp,this)}$mouseMove(){if(this.$isDragging=!0,!this.$touchEffect||a.draggingPane!=null&&a.draggingPane!=this||r.GObject.draggingObject!=null)return;let e=r.UIConfig.touchScrollSensitivity,i=this.$owner.globalToLocal(r.GRoot.globalMouseStatus.mouseX,r.GRoot.globalMouseStatus.mouseY,a.sHelperPoint),t,s,h,n;if(this.$scrollType==1){if(!this.$isHoldAreaDone&&(a.$gestureFlag|=1,t=Math.abs(this.$beginTouchPos.y-i.y),t<e||(a.$gestureFlag&2)!=0&&(s=Math.abs(this.$beginTouchPos.x-i.x),t<s)))return;h=!0}else if(this.$scrollType==0){if(!this.$isHoldAreaDone&&(a.$gestureFlag|=2,t=Math.abs(this.$beginTouchPos.x-i.x),t<e||(a.$gestureFlag&1)!=0&&(s=Math.abs(this.$beginTouchPos.y-i.y),t<s)))return;n=!0}else{if(a.$gestureFlag=3,!this.$isHoldAreaDone&&(t=Math.abs(this.$beginTouchPos.y-i.y),t<e&&(t=Math.abs(this.$beginTouchPos.x-i.x),t<e)))return;h=n=!0}let l=Math.floor(this.$containerPos.x+i.x-this.$beginTouchPos.x),o=Math.floor(this.$containerPos.y+i.y-this.$beginTouchPos.y);h&&(o>0?this.$bouncebackEffect?this.$header!=null&&this.$header.height!=0?this.$container.y=Math.floor(Math.min(o*.5,this.$header.height)):this.$container.y=Math.floor(Math.min(o*.5,this.$viewSize.y*a.PULL_DIST_RATIO)):this.$container.y=0:o<-this.$overlapSize.y?this.$bouncebackEffect?this.$footer!=null&&this.$footer.height>0?this.$container.y=Math.floor(Math.max((o+this.$overlapSize.y)*.5,-this.$footer.height)-this.$overlapSize.y):this.$container.y=Math.floor(Math.max((o+this.$overlapSize.y)*.5,-this.$viewSize.y*a.PULL_DIST_RATIO)-this.$overlapSize.y):this.$container.y=-this.$overlapSize.y:this.$container.y=o),n&&(l>0?this.$bouncebackEffect?this.$header!=null&&this.$header.width!=0?this.$container.x=Math.floor(Math.min(l*.5,this.$header.width)):this.$container.x=Math.floor(Math.min(l*.5,this.$viewSize.x*a.PULL_DIST_RATIO)):this.$container.x=0:l<0-this.$overlapSize.x?this.$bouncebackEffect?this.$footer!=null&&this.$footer.width>0?this.$container.x=Math.floor(Math.max((l+this.$overlapSize.x)*.5,-this.$footer.width)-this.$overlapSize.x):this.$container.x=Math.floor(Math.max((l+this.$overlapSize.x)*.5,-this.$viewSize.x*a.PULL_DIST_RATIO)-this.$overlapSize.x):this.$container.x=-this.$overlapSize.x:this.$container.x=l);let $=f.Ticker.shared.FPS,d=r.GTimer.inst.curTime/1e3,p=Math.max(d-this.$lastMoveTime,1/$),w=i.x-this.$lastTouchPos.x,C=i.y-this.$lastTouchPos.y;if(n||(w=0),h||(C=0),p!=0){let b=p*$-1;if(b>1){let g=Math.pow(.833,b);this.$velocity.x=this.$velocity.x*g,this.$velocity.y=this.$velocity.y*g}this.$velocity.x=r.utils.NumberUtil.lerp(this.$velocity.x,w*60/$/p,p*10),this.$velocity.y=r.utils.NumberUtil.lerp(this.$velocity.y,C*60/$/p,p*10)}let I=this.$lastTouchGlobalPos.x-i.x,m=this.$lastTouchGlobalPos.y-i.y;w!=0?this.$velocityScale=Math.abs(I/w):C!=0&&(this.$velocityScale=Math.abs(m/C)),this.$lastTouchPos.copyFrom(i),this.$lastTouchGlobalPos.copyFrom(i),this.$lastMoveTime=d,this.$overlapSize.x>0&&(this.$xPos=r.utils.NumberUtil.clamp(-this.$container.x,0,this.$overlapSize.x)),this.$overlapSize.y>0&&(this.$yPos=r.utils.NumberUtil.clamp(-this.$container.y,0,this.$overlapSize.y)),this.$loop!=0&&(l=this.$container.x,o=this.$container.y,this.loopCheckingCurrent()&&(this.$containerPos.x+=this.$container.x-l,this.$containerPos.y+=this.$container.y-o)),a.draggingPane=this,this.$isHoldAreaDone=!0,this.$isDragging=!0,this.$maskContainer.interactive=!1,this.syncScrollBar(),this.checkRefreshBar(),this.$pageMode&&this.updatePageController(),this.emit(r.ScrollEvent.SCROLL,this)}$mouseUp(){if(this.$owner.off(r.InteractiveEvents.Move,this.$mouseMove,this),this.$owner.off(r.InteractiveEvents.UpOutside,this.$mouseUp,this),this.$owner.off(r.InteractiveEvents.Up,this.$mouseUp,this),a.draggingPane==this&&(a.draggingPane=null),a.$gestureFlag=0,!this.$isDragging||!this.$touchEffect){this.$isDragging=!1,this.$maskContainer.interactive=!0;return}this.$isDragging=!1,this.$maskContainer.interactive=!0,this.$tweenStart.set(this.$container.x,this.$container.y),a.sEndPos.set(this.$tweenStart.x,this.$tweenStart.y);let e=!1;if(this.$container.x>0?(a.sEndPos.x=0,e=!0):this.$container.x<-this.$overlapSize.x&&(a.sEndPos.x=-this.$overlapSize.x,e=!0),this.$container.y>0?(a.sEndPos.y=0,e=!0):this.$container.y<-this.$overlapSize.y&&(a.sEndPos.y=-this.$overlapSize.y,e=!0),e){if(this.$tweenChange.set(a.sEndPos.x-this.$tweenStart.x,a.sEndPos.y-this.$tweenStart.y),this.$tweenChange.x<-r.UIConfig.touchDragSensitivity||this.$tweenChange.y<-r.UIConfig.touchDragSensitivity?(this.$refreshEventDispatching=!0,this.emit(r.ScrollEvent.PULL_DOWN_RELEASE),this.$refreshEventDispatching=!1):(this.$tweenChange.x>r.UIConfig.touchDragSensitivity||this.$tweenChange.y>r.UIConfig.touchDragSensitivity)&&(this.$refreshEventDispatching=!0,this.emit(r.ScrollEvent.PULL_UP_RELEASE),this.$refreshEventDispatching=!1),this.$headerLockedSize>0&&a.sEndPos[this.$refreshBarAxis]==0)a.sEndPos[this.$refreshBarAxis]=this.$headerLockedSize,this.$tweenChange.x=a.sEndPos.x-this.$tweenStart.x,this.$tweenChange.y=a.sEndPos.y-this.$tweenStart.y;else if(this.$footerLockedSize>0&&a.sEndPos[this.$refreshBarAxis]==-this.$overlapSize[this.$refreshBarAxis]){var i=this.$overlapSize[this.$refreshBarAxis];i==0?i=Math.max(this.$contentSize[this.$refreshBarAxis]+this.$footerLockedSize-this.$viewSize[this.$refreshBarAxis],0):i+=this.$footerLockedSize,a.sEndPos[this.$refreshBarAxis]=-i,this.$tweenChange.x=a.sEndPos.x-this.$tweenStart.x,this.$tweenChange.y=a.sEndPos.y-this.$tweenStart.y}this.$tweenDuration.set(a.TWEEN_DEFAULT_DURATION,a.TWEEN_DEFAULT_DURATION)}else{if(this.$inertiaDisabled)this.$tweenDuration.set(a.TWEEN_DEFAULT_DURATION,a.TWEEN_DEFAULT_DURATION);else{let t=f.Ticker.shared.FPS,s=(r.GTimer.inst.curTime/1e3-this.$lastMoveTime)*t-1;if(s>1){let h=Math.pow(.833,s);this.$velocity.x=this.$velocity.x*h,this.$velocity.y=this.$velocity.y*h}this.updateTargetAndDuration(this.$tweenStart,a.sEndPos)}if(a.sOldChange.set(a.sEndPos.x-this.$tweenStart.x,a.sEndPos.y-this.$tweenStart.y),this.loopCheckingTarget(a.sEndPos),(this.$pageMode||this.$snapToItem)&&this.alignPosition(a.sEndPos,!0),this.$tweenChange.x=a.sEndPos.x-this.$tweenStart.x,this.$tweenChange.y=a.sEndPos.y-this.$tweenStart.y,this.$tweenChange.x==0&&this.$tweenChange.y==0){this.$scrollBarDisplayAuto&&this.showScrollBar(!1);return}(this.$pageMode||this.$snapToItem)&&(this.fixDuration("x",a.sOldChange.x),this.fixDuration("y",a.sOldChange.y))}this.$tweening=2,this.$tweenTime.set(0,0),r.GTimer.inst.addLoop(1,this.tweenUpdate,this)}$click(e){this.$isDragging=!1;let i=r.GRoot.globalMouseStatus.mouseX,t=r.GRoot.globalMouseStatus.mouseY,s=this.owner.$displayObject}$mouseWheel(e){if(!this.$mouseWheelEnabled)return;let i=e.delta>0?-1:e.delta<0?1:0;this.$overlapSize.x>0&&this.$overlapSize.y==0?this.$pageMode?this.setPosX(this.$xPos+this.$pageSize.x*i,!1):this.setPosX(this.$xPos+this.$mouseWheelSpeed*i,!1):this.$pageMode?this.setPosY(this.$yPos+this.$pageSize.y*i,!1):this.setPosY(this.$yPos+this.$mouseWheelSpeed*i,!1)}$rollOver(){this.showScrollBar(!0)}$rollOut(){this.showScrollBar(!1)}showScrollBar(e){e?(r.GTimer.inst.remove(this.setScrollBarVisible,this),this.setScrollBarVisible(!0)):r.GTimer.inst.add(500,1,this.setScrollBarVisible,this,e)}setScrollBarVisible(e){this.$scrollBarVisible=e&&this.$viewSize.x>0&&this.$viewSize.y>0,this.$vtScrollBar&&(this.$vtScrollBar.displayObject.visible=this.$scrollBarVisible&&!this.$vScrollNone),this.$hzScrollBar&&(this.$hzScrollBar.displayObject.visible=this.$scrollBarVisible&&!this.$hScrollNone)}getLoopPartSize(e,i){let t=0;return this.$owner instanceof r.GList&&(t=i=="x"?this.$owner.columnGap:this.$owner.lineGap),(this.$contentSize[i]+t)/e}loopCheckingCurrent(){let e=!1;return this.$loop==1&&this.$overlapSize.x>0?this.$xPos<.001?(this.$xPos+=this.getLoopPartSize(2,"x"),e=!0):this.$xPos>=this.$overlapSize.x&&(this.$xPos-=this.getLoopPartSize(2,"x"),e=!0):this.$loop==2&&this.$overlapSize.y>0&&(this.$yPos<.001?(this.$yPos+=this.getLoopPartSize(2,"y"),e=!0):this.$yPos>=this.$overlapSize.y&&(this.$yPos-=this.getLoopPartSize(2,"y"),e=!0)),e&&this.$container.position.set(Math.floor(-this.$xPos),Math.floor(-this.$yPos)),e}loopCheckingTarget(e){this.$loop==1&&this.loopCheckingTarget2(e,"x"),this.$loop==2&&this.loopCheckingTarget2(e,"y")}loopCheckingTarget2(e,i){var t,s;e[i]>0?(t=this.getLoopPartSize(2,i),s=this.$tweenStart[i]-t,s<=0&&s>=-this.$overlapSize[i]&&(e[i]-=t,this.$tweenStart[i]=s)):e[i]<-this.$overlapSize[i]&&(t=this.getLoopPartSize(2,i),s=this.$tweenStart[i]+t,s<=0&&s>=-this.$overlapSize[i]&&(e[i]+=t,this.$tweenStart[i]=s))}loopCheckingNewPos(e,i){if(this.$overlapSize[i]==0)return e;let t=i=="x"?this.$xPos:this.$yPos,s=!1,h;return e<.001?(e+=this.getLoopPartSize(2,i),e>t&&(h=this.getLoopPartSize(6,i),h=Math.ceil((e-t)/h)*h,t=r.utils.NumberUtil.clamp(t+h,0,this.$overlapSize[i]),s=!0)):e>=this.$overlapSize[i]&&(e-=this.getLoopPartSize(2,i),e<t&&(h=this.getLoopPartSize(6,i),h=Math.ceil((t-e)/h)*h,t=r.utils.NumberUtil.clamp(t-h,0,this.$overlapSize[i]),s=!0)),s&&(i=="x"?this.$container.x=-Math.floor(t):this.$container.y=-Math.floor(t)),e}alignPosition(e,i){if(this.$pageMode)e.x=this.alignByPage(e.x,"x",i),e.y=this.alignByPage(e.y,"y",i);else if(this.$snapToItem){var t=this.$owner.getSnappingPosition(-e.x,-e.y,a.sHelperPoint);e.x<0&&e.x>-this.$overlapSize.x&&(e.x=-t.x),e.y<0&&e.y>-this.$overlapSize.y&&(e.y=-t.y)}}alignByPage(e,i,t){let s;if(e>0)s=0;else if(e<-this.$overlapSize[i])s=Math.ceil(this.$contentSize[i]/this.$pageSize[i])-1;else{s=Math.floor(-e/this.$pageSize[i]);var h=t?e-this.$containerPos[i]:e-this.$container[i],n=Math.min(this.$pageSize[i],this.$contentSize[i]-(s+1)*this.$pageSize[i]),l=-e-s*this.$pageSize[i];Math.abs(h)>this.$pageSize[i]?l>n*.5&&s++:l>n*(h<0?.3:.7)&&s++;let p=this.$pageSize[i];e=-s*p,e<-p&&(e=-p)}if(t){var o=this.$tweenStart[i],$;o>0?$=0:o<-this.$overlapSize[i]?$=Math.ceil(this.$contentSize[i]/this.$pageSize[i])-1:$=Math.floor(-o/this.$pageSize[i]);var d=Math.floor(-this.$containerPos[i]/this.$pageSize[i]);Math.abs(s-d)>1&&Math.abs($-d)<=1&&(s>d?s=d+1:s=d-1,e=-s*this.$pageSize[i])}return e}updateTargetAndDuration(e,i){i.x=this.updateTargetAndDuration2(e.x,"x"),i.y=this.updateTargetAndDuration2(e.y,"y")}updateTargetAndDuration2(e,i){let t=this.$velocity[i];var s=0;if(e>0)e=0;else if(e<-this.$overlapSize[i])e=-this.$overlapSize[i];else{var h=f.utils.isMobile.any;let n=Math.abs(t)*this.$velocityScale;h&&(n*=Math.max(r.GRoot.inst.stageWrapper.designWidth,r.GRoot.inst.stageWrapper.designHeight)/Math.max(r.GRoot.inst.stageWidth,r.GRoot.inst.stageHeight));let l=0;if(this.$pageMode||!h?n>500&&(l=Math.pow((n-500)/500,2)):n>1e3&&(l=Math.pow((n-1e3)/1e3,2)),l!=0){l>1&&(l=1),n*=l,t*=l,this.$velocity[i]=t,s=Math.log(60/n)/Math.log(this.$decelerationRate)/60;let o=(t/60-1)/(1-this.$decelerationRate);e+=o}}return s<a.TWEEN_DEFAULT_DURATION&&(s=a.TWEEN_DEFAULT_DURATION),this.$tweenDuration[i]=s,e}fixDuration(e,i){if(this.$tweenChange[e]==0||Math.abs(this.$tweenChange[e])>=Math.abs(i))return;let t=Math.abs(this.$tweenChange[e]/i)*this.$tweenDuration[e];t<a.TWEEN_DEFAULT_DURATION&&(t=a.TWEEN_DEFAULT_DURATION),this.$tweenDuration[e]=t}killTween(){this.$tweening==1&&(this.$container.position.set(this.$tweenStart.x+this.$tweenChange.x,this.$tweenStart.y+this.$tweenChange.y),this.emit(r.ScrollEvent.SCROLL,this)),this.$tweening=0,r.GTimer.inst.remove(this.tweenUpdate,this),this.emit(r.ScrollEvent.SCROLL_END,this)}checkRefreshBar(){if(this.$header==null&&this.$footer==null)return;let e=this.$container[this.$refreshBarAxis];if(this.$header!=null)if(e>0){this.$header.displayObject.parent==null&&this.$maskContainer.addChildAt(this.$header.displayObject,0);let t=a.sHelperPoint;t.set(this.$header.width,this.$header.height),t[this.$refreshBarAxis]=e,this.$header.setSize(t.x,t.y)}else this.$header.displayObject.parent!=null&&this.$maskContainer.removeChild(this.$header.displayObject);if(this.$footer!=null){var i=this.$overlapSize[this.$refreshBarAxis];if(e<-i||i==0&&this.$footerLockedSize>0){this.$footer.displayObject.parent==null&&this.$maskContainer.addChildAt(this.$footer.displayObject,0);let t=a.sHelperPoint;t.set(this.$footer.x,this.$footer.y),i>0?t[this.$refreshBarAxis]=e+this.$contentSize[this.$refreshBarAxis]:t[this.$refreshBarAxis]=Math.max(Math.min(e+this.$viewSize[this.$refreshBarAxis],this.$viewSize[this.$refreshBarAxis]-this.$footerLockedSize),this.$viewSize[this.$refreshBarAxis]-this.$contentSize[this.$refreshBarAxis]),this.$footer.setXY(t.x,t.y),t.set(this.$footer.width,this.$footer.height),i>0?t[this.$refreshBarAxis]=-i-e:t[this.$refreshBarAxis]=this.$viewSize[this.$refreshBarAxis]-this.$footer[this.$refreshBarAxis],this.$footer.setSize(t.x,t.y)}else this.$footer.displayObject.parent!=null&&this.$maskContainer.removeChild(this.$footer.displayObject)}}tweenUpdate(){var e=this.runTween("x"),i=this.runTween("y");this.$container.position.set(e,i),this.$tweening==2&&(this.$overlapSize.x>0&&(this.$xPos=r.utils.NumberUtil.clamp(-e,0,this.$overlapSize.x)),this.$overlapSize.y>0&&(this.$yPos=r.utils.NumberUtil.clamp(-i,0,this.$overlapSize.y)),this.$pageMode&&this.updatePageController()),this.$tweenChange.x==0&&this.$tweenChange.y==0?(this.$tweening=0,r.GTimer.inst.remove(this.tweenUpdate,this),this.loopCheckingCurrent(),this.syncScrollBar(!0),this.checkRefreshBar(),this.emit(r.ScrollEvent.SCROLL,this),this.emit(r.ScrollEvent.SCROLL_END,this)):(this.syncScrollBar(!1),this.checkRefreshBar(),this.emit(r.ScrollEvent.SCROLL,this))}runTween(e){let i=r.GTimer.inst.ticker.deltaTime,t;if(this.$tweenChange[e]!=0){if(this.$tweenTime[e]+=i*f.settings.TARGET_FPMS,this.$tweenTime[e]>=this.$tweenDuration[e])t=this.$tweenStart[e]+this.$tweenChange[e],this.$tweenChange[e]=0;else{let l=a.$easeTypeFunc(this.$tweenTime[e],this.$tweenDuration[e]);t=this.$tweenStart[e]+Math.floor(this.$tweenChange[e]*l)}var s=0,h=-this.$overlapSize[e];if(this.$headerLockedSize>0&&this.$refreshBarAxis==e&&(s=this.$headerLockedSize),this.$footerLockedSize>0&&this.$refreshBarAxis==e){var n=this.$overlapSize[this.$refreshBarAxis];n==0?n=Math.max(this.$contentSize[this.$refreshBarAxis]+this.$footerLockedSize-this.$viewSize[this.$refreshBarAxis],0):n+=this.$footerLockedSize,h=-n}this.$tweening==2&&this.$bouncebackEffect?t>20+s&&this.$tweenChange[e]>0||t>s&&this.$tweenChange[e]==0?(this.$tweenTime[e]=0,this.$tweenDuration[e]=a.TWEEN_DEFAULT_DURATION,this.$tweenChange[e]=-t+s,this.$tweenStart[e]=t):(t<h-20&&this.$tweenChange[e]<0||t<h&&this.$tweenChange[e]==0)&&(this.$tweenTime[e]=0,this.$tweenDuration[e]=a.TWEEN_DEFAULT_DURATION,this.$tweenChange[e]=h-t,this.$tweenStart[e]=t):t>s?(t=s,this.$tweenChange[e]=0):t<h&&(t=h,this.$tweenChange[e]=0)}else t=this.$container[e];return t}}a.$easeTypeFunc=(c,e)=>(c=c/e-1)*c*c+1,a.$gestureFlag=0,a.sHelperPoint=new f.Point,a.sHelperRect=new f.Rectangle,a.sEndPos=new f.Point,a.sOldChange=new f.Point,a.TWEEN_DEFAULT_DURATION=.4,a.TWEEN_MANUALLY_SET_DURATION=.5,a.PULL_DIST_RATIO=.5,r.ScrollPane=a})(fgui||(fgui={}));(function(r){class a{constructor(t){this.autoPlayRepeat=1,this.autoPlayDelay=0,this.$ownerBaseX=0,this.$ownerBaseY=0,this.$totalTimes=0,this.$totalTasks=0,this.$playing=!1,this.$options=0,this.$maxTime=0,this.$owner=t,this.$items=[],this.$owner.on(r.DisplayObjectEvent.VISIBLE_CHANGED,this.$ownerVisibleChanged,this)}$ownerVisibleChanged(t,s){(this.$options&a.OPTION_AUTO_STOP_DISABLED)==0&&t===!1&&this.stop((this.$options&a.OPTION_AUTO_STOP_AT_END)!=0,!1)}get autoPlay(){return this.$autoPlay}set autoPlay(t){this.$autoPlay!=t&&(this.$autoPlay=t,this.$autoPlay?this.$owner.onStage&&this.play({times:this.autoPlayRepeat,delay:this.autoPlayDelay}):this.$owner.onStage||this.stop(!1,!0))}changeRepeat(t){this.$totalTimes=t|0}play(...t){if(t.length&&typeof t[0]=="object"){let s=t[0];this.$play(s.onComplete,s.onCompleteObj,s.onCompleteParam,s.times||1,s.delay||0,!1)}else this.$play(t[0],t[1],t[2],t[3]||1,t[4]||0,!1)}playReverse(...t){if(t.length&&typeof t[0]=="object"){let s=t[0];this.$play(s.onComplete,s.onCompleteObj,s.onCompleteParam,s.times||1,s.delay||0,!0)}else this.$play(t[0],t[1],t[2],t[3]||1,t[4]||0,!0)}$play(t,s,h,n,l,o=!1){this.stop(),n==0?n=1:n==-1&&(n=Number.MAX_VALUE),this.$totalTimes=n,this.$reversed=o,this.internalPlay(l),this.$playing=this.$totalTasks>0,this.$playing?(this.$onComplete=t,this.$onCompleteParam=h,this.$onCompleteObj=s,(this.$options&a.OPTION_IGNORE_DISPLAY_CONTROLLER)!=0&&this.$items.forEach($=>{$.target!=null&&$.target!=this.$owner&&($.lockToken=$.target.lockGearDisplay())},this)):t!=null&&(h&&h.length?t.apply(s,h):t.call(s,h))}stop(t=!0,s=!1){if(this.$playing){this.$playing=!1,this.$totalTasks=0,this.$totalTimes=0;let h=this.$onComplete,n=this.$onCompleteParam,l=this.$onCompleteObj;this.$onComplete=null,this.$onCompleteParam=null,this.$onCompleteObj=null;let o=this.$items.length,$;if(this.$reversed)for(let d=o-1;d>=0;d--)$=this.$items[d],$.target!=null&&this.stopItem($,t);else for(let d=0;d<o;d++)$=this.$items[d],$.target!=null&&this.stopItem($,t);s&&h!=null&&(n&&n.length>0?h.apply(l,n):h.call(l,n))}}stopItem(t,s){if(t.lockToken!=0&&(t.target.releaseGearDisplay(t.lockToken),t.lockToken=0),t.type==12&&t.filterCreated&&(t.target.filters=null),!t.completed)if(this.disposeTween(t),t.type==10){let h=t.target.getTransition(t.value.s);h!=null&&h.stop(s,!1)}else t.type==11?(r.GTimer.inst.remove(t.$shake,t),t.target.$gearLocked=!0,t.target.setXY(t.target.x-t.startValue.f1,t.target.y-t.startValue.f2),t.target.$gearLocked=!1):s&&(t.tween?!t.yoyo||t.repeat%2==0?this.applyValue(t,this.$reversed?t.startValue:t.endValue):this.applyValue(t,this.$reversed?t.endValue:t.startValue):t.type!=9&&this.applyValue(t,t.value))}dispose(){r.GTimer.inst.remove(this.internalPlay,this),this.$owner.off(r.DisplayObjectEvent.VISIBLE_CHANGED,this.$ownerVisibleChanged,this),this.$playing=!1,this.$items.forEach(t=>{if(!(t.target==null||t.completed))if(this.disposeTween(t),t.type==10){let s=t.target.getTransition(t.value.s);s!=null&&s.dispose()}else t.type==11&&r.GTimer.inst.remove(t.$shake,t)},this)}get playing(){return this.$playing}setValue(t,...s){this.$items.forEach(h=>{if(h.label==null&&h.label2==null)return;let n;if(h.label==t)h.tween?n=h.startValue:n=h.value;else if(h.label2==t)n=h.endValue;else return;switch(h.type){case 0:case 1:case 3:case 2:case 13:n.b1=!0,n.b2=!0,n.f1=parseFloat(s[0]),n.f2=parseFloat(s[1]);break;case 4:n.f1=parseFloat(s[0]);break;case 5:n.i=parseInt(s[0]);break;case 6:n.c=parseFloat(s[0]);break;case 7:n.i=parseInt(s[0]),s.length>1&&(n.b=s[1]);break;case 8:n.b=s[0];break;case 9:n.s=s[0],s.length>1&&(n.f1=parseFloat(s[1]));break;case 10:n.s=s[0],s.length>1&&(n.i=parseInt(s[1]));break;case 11:n.f1=parseFloat(s[0]),s.length>1&&(n.f2=parseFloat(s[1]));break;case 12:n.f1=parseFloat(s[0]),n.f2=parseFloat(s[1]),n.f3=parseFloat(s[2]),n.f4=parseFloat(s[3]);break}},this)}setHook(t,s,h){let n=this.$items.length;for(let l=0;l<n;l++){let o=this.$items[l];if(o.label==t){o.hook=s,o.hookObj=h;break}else if(o.label2==t){o.hook2=s,o.hook2Obj=h;break}}}clearHooks(){this.$items.forEach(t=>{t.hook=null,t.hookObj=null,t.hook2=null,t.hook2Obj=null},this)}setTarget(t,s){this.$items.forEach(h=>{h.label==t&&(h.targetId=s.id)},this)}setDuration(t,s){this.$items.forEach(h=>{h.tween&&h.label==t&&(h.duration=s)},this)}updateFromRelations(t,s,h){this.$items.forEach(n=>{n.type==0&&n.targetId==t&&(n.tween?(n.startValue.f1+=s,n.startValue.f2+=h,n.endValue.f1+=s,n.endValue.f2+=h):(n.value.f1+=s,n.value.f2+=h))},this)}internalPlay(t=0){this.$ownerBaseX=this.$owner.x,this.$ownerBaseY=this.$owner.y,this.$totalTasks=0,this.$items.forEach(s=>{if(s.targetId?s.target=this.$owner.getChildById(s.targetId):s.target=this.$owner,s.target==null)return;let h;this.disposeTween(s),s.tween?(this.$reversed?h=t+this.$maxTime-s.time-s.duration:h=t+s.time,h>0?(this.$totalTasks++,s.completed=!1,s.tweener=new TWEEN.Tween(s.value).duration(h*1e3).onComplete(()=>{this.$delayCall(s)}).start()):this.startTween(s)):(this.$reversed?h=t+this.$maxTime-s.time:h=t+s.time,h<=0?this.applyValue(s,s.value):(this.$totalTasks++,s.completed=!1,s.tweener=new TWEEN.Tween(s.value).duration(h*1e3).onComplete(()=>this.$delayCall2(s)).start()))},this)}prepareValue(t,s,h=!1){let n,l;switch(h?(n=t.endValue,l=t.startValue):(n=t.startValue,l=t.endValue),t.type){case 0:case 1:t.type==0?t.target==this.$owner?(n.b1||(n.f1=0),n.b2||(n.f2=0)):(n.b1||(n.f1=t.target.x),n.b2||(n.f2=t.target.y)):(n.b1||(n.f1=t.target.width),n.b2||(n.f2=t.target.height)),t.value.f1=n.f1,t.value.f2=n.f2,l.b1||(l.f1=t.value.f1),l.b2||(l.f2=t.value.f2),t.value.b1=n.b1||l.b1,t.value.b2=n.b2||l.b2,s.f1=l.f1,s.f2=l.f2;break;case 2:case 13:t.value.f1=n.f1,t.value.f2=n.f2,s.f1=l.f1,s.f2=l.f2;break;case 4:t.value.f1=n.f1,s.f1=l.f1;break;case 5:t.value.i=n.i,s.i=l.i;break;case 12:t.value.f1=n.f1,t.value.f2=n.f2,t.value.f3=n.f3,t.value.f4=n.f4,s.f1=l.f1,s.f2=l.f2,s.f3=l.f3,s.f4=l.f4;break}}startTween(t){let s=new e;this.prepareValue(t,s,this.$reversed),this.applyValue(t,t.value);let h;t.repeat!=0?(t.tweenTimes=0,h=r.utils.Binder.create(this.$tweenRepeatComplete,this,t)):h=r.utils.Binder.create(this.$tweenComplete,this,t),this.$totalTasks++,t.completed=!1,this.prepareValue(t,s,this.$reversed);let n=r.utils.Binder.create(this.$tweenUpdate,this,t);t.tweener=new TWEEN.Tween(t.value).onUpdate(()=>{n(null)}).to(s,t.duration*1e3).onComplete(()=>h(t.tweener)).easing(t.easeType).start(),t.hook!=null&&t.hook.call(t.hookObj)}$delayCall(t){this.disposeTween(t),this.$totalTasks--,this.startTween(t)}$delayCall2(t){this.disposeTween(t),this.$totalTasks--,t.completed=!0,this.applyValue(t,t.value),t.hook!=null&&t.hook.call(t.hookObj),this.checkAllComplete()}$tweenUpdate(t,s){this.applyValue(s,s.value)}$tweenComplete(t,s){this.disposeTween(s),this.$totalTasks--,s.completed=!0,s.hook2!=null&&s.hook2.call(s.hook2Obj),this.checkAllComplete()}$tweenRepeatComplete(t,s){if(s.tweenTimes++,s.repeat==-1||s.tweenTimes<s.repeat+1){let h=new e,n;s.yoyo?this.$reversed?n=s.tweenTimes%2==0:n=s.tweenTimes%2==1:n=this.$reversed,this.prepareValue(s,h,n),this.disposeTween(s);let l=r.utils.Binder.create(this.$tweenUpdate,this,s);s.tweener=new TWEEN.Tween(s.value).onUpdate(()=>{l(null)}).to(h,s.duration*1e3).easing(s.easeType).delay(0).onComplete(()=>{this.$tweenRepeatComplete(null,s)}).start()}else this.$tweenComplete(null,s)}disposeTween(t){!t||t.tweener&&(t.tweener.stop(),TWEEN.remove(t.tweener),t.tweener=null)}$playTransComplete(t){this.disposeTween(t),this.$totalTasks--,t.completed=!0,this.checkAllComplete()}checkAllComplete(){if(this.$playing&&this.$totalTasks==0){if(this.$totalTimes<0)r.GTimer.inst.callLater(this.internalPlay,this,0);else if(this.$totalTimes--,this.$totalTimes>0)r.GTimer.inst.callLater(this.internalPlay,this,0);else if(this.$playing=!1,this.$items.forEach(t=>{t.target!=null&&(t.lockToken!=0&&(t.target.releaseGearDisplay(t.lockToken),t.lockToken=0),t.filterCreated&&(t.filterCreated=!1,t.target.filters=null),this.disposeTween(t))}),this.$onComplete!=null){let t=this.$onComplete,s=this.$onCompleteParam,h=this.$onCompleteObj;this.$onComplete=null,this.$onCompleteParam=null,this.$onCompleteObj=null,s&&s.length?t.apply(h,s):t.call(h,s)}}}applyValue(t,s){switch(t.target.$gearLocked=!0,t.type){case 0:if(t.target==this.$owner){let n=0,l=0;s.b1?n=s.f1+this.$ownerBaseX:n=t.target.x,s.b2?l=s.f2+this.$ownerBaseY:l=t.target.y,t.target.setXY(n,l)}else s.b1||(s.f1=t.target.x),s.b2||(s.f2=t.target.y),t.target.setXY(s.f1,s.f2);break;case 1:s.b1||(s.f1=t.target.width),s.b2||(s.f2=t.target.height),t.target.setSize(s.f1,s.f2);break;case 3:t.target.setPivot(s.f1,s.f2);break;case 4:t.target.alpha=s.f1;break;case 5:t.target.rotation=s.i;break;case 2:t.target.setScale(s.f1,s.f2);break;case 13:t.target.setSkew(s.f1,s.f2);break;case 6:r.isColorGear(t.target)&&(t.target.color=s.c);break;case 7:r.isAnimationGear(t.target)&&(s.b1||(s.i=t.target.frame),t.target.frame=s.i,t.target.playing=s.b);break;case 8:t.target.visible=s.b;break;case 10:let h=t.target.getTransition(s.s);h!=null&&(s.i==0?h.stop(!1,!0):h.playing?h.$totalTimes=s.i==-1?Number.MAX_VALUE:s.i:(t.completed=!1,this.$totalTasks++,this.$reversed?h.playReverse(this.$playTransComplete,this,t,t.value.i):h.play(this.$playTransComplete,this,t,t.value.i)));break;case 9:break;case 11:t.startValue.f1=0,t.startValue.f2=0,t.startValue.f3=t.value.f2,r.GTimer.inst.add(1,0,t.$shake,t,[this]),this.$totalTasks++,t.completed=!1;break;case 12:t.target.updateColorComponents(s.f1,s.f2,s.f3,s.f4);break}t.target.$gearLocked=!1}$shakeItem(t,s){let h=Math.ceil(t.value.f1*t.startValue.f3/t.value.f2),n=(Math.random()*2-1)*h,l=(Math.random()*2-1)*h;n=n>0?Math.ceil(n):Math.floor(n),l=l>0?Math.ceil(l):Math.floor(l),t.target.$gearLocked=!0,t.target.setXY(t.target.x-t.startValue.f1+n,t.target.y-t.startValue.f2+l),t.target.$gearLocked=!1,t.startValue.f1=n,t.startValue.f2=l,t.startValue.f3-=s/1e3,t.startValue.f3<=0&&(t.target.$gearLocked=!0,t.target.setXY(t.target.x-t.startValue.f1,t.target.y-t.startValue.f2),t.target.$gearLocked=!1,t.completed=!0,this.$totalTasks--,r.GTimer.inst.remove(t.$shake,t),this.checkAllComplete())}setup(t){this.name=t.attributes.name;let s=t.attributes.options;s&&(this.$options=parseInt(s)),this.$autoPlay=t.attributes.autoPlay=="true",this.$autoPlay&&(s=t.attributes.autoPlayRepeat,s&&(this.autoPlayRepeat=parseInt(s)),s=t.attributes.autoPlayDelay,s&&(this.autoPlayDelay=parseFloat(s))),t.children.forEach(n=>{if(n.nodeName!="item")return;let l=new c;switch(this.$items.push(l),l.time=parseInt(n.attributes.time)/a.FRAME_RATE,l.targetId=n.attributes.target,s=n.attributes.type,s){case"XY":l.type=0;break;case"Size":l.type=1;break;case"Scale":l.type=2;break;case"Pivot":l.type=3;break;case"Alpha":l.type=4;break;case"Rotation":l.type=5;break;case"Color":l.type=6;break;case"Animation":l.type=7;break;case"Visible":l.type=8;break;case"Sound":l.type=9;break;case"Transition":l.type=10;break;case"Shake":l.type=11;break;case"ColorFilter":l.type=12;break;case"Skew":l.type=13;break;default:l.type=14;break}if(l.tween=n.attributes.tween=="true",l.label=n.attributes.label,l.tween){l.duration=parseInt(n.attributes.duration)/a.FRAME_RATE,l.time+l.duration>this.$maxTime&&(this.$maxTime=l.time+l.duration),s=n.attributes.ease,s&&(l.easeType=r.ParseEaseType(s)),s=n.attributes.repeat,s&&(l.repeat=parseInt(s)),l.yoyo=n.attributes.yoyo=="true",l.label2=n.attributes.label2;let o=n.attributes.endValue;o?(this.decodeValue(l.type,n.attributes.startValue,l.startValue),this.decodeValue(l.type,o,l.endValue)):(l.tween=!1,this.decodeValue(l.type,n.attributes.startValue,l.value))}else l.time>this.$maxTime&&(this.$maxTime=l.time),this.decodeValue(l.type,n.attributes.value,l.value)},this)}decodeValue(t,s,h){let n;switch(t){case 0:case 1:case 3:case 13:n=s.split(","),n[0]=="-"?h.b1=!1:(h.f1=parseFloat(n[0]),h.b1=!0),n[1]=="-"?h.b2=!1:(h.f2=parseFloat(n[1]),h.b2=!0);break;case 4:h.f1=parseFloat(s);break;case 5:h.i=parseInt(s);break;case 2:n=s.split(","),h.f1=parseFloat(n[0]),h.f2=parseFloat(n[1]);break;case 6:h.c=r.utils.StringUtil.convertFromHtmlColor(s);break;case 7:n=s.split(","),n[0]=="-"?h.b1=!1:(h.i=parseInt(n[0]),h.b1=!0),h.b=n[1]=="p";break;case 8:h.b=s=="true";break;case 9:if(n=s.split(","),h.s=n[0],n.length>1){let l=parseInt(n[1]);l==0||l==100?h.f1=1:h.f1=l/100}else h.f1=1;break;case 10:n=s.split(","),h.s=n[0],n.length>1?h.i=parseInt(n[1]):h.i=1;break;case 11:n=s.split(","),h.f1=parseFloat(n[0]),h.f2=parseFloat(n[1]);break;case 12:n=s.split(","),h.f1=parseFloat(n[0]),h.f2=parseFloat(n[1]),h.f3=parseFloat(n[2]),h.f4=parseFloat(n[3]);break}}}a.OPTION_IGNORE_DISPLAY_CONTROLLER=1,a.OPTION_AUTO_STOP_DISABLED=0,a.OPTION_AUTO_STOP_AT_END=0,a.FRAME_RATE=24,r.Transition=a;class c{constructor(){this.time=0,this.type=0,this.duration=0,this.repeat=0,this.yoyo=!1,this.tween=!1,this.tweenTimes=0,this.completed=!1,this.lockToken=0,this.easeType=r.ParseEaseType("Quad.Out"),this.value=new e,this.startValue=new e,this.endValue=new e}$shake(t,s){t.$shakeItem(this,s)}}class e{constructor(){this.f1=0,this.f2=0,this.f3=0,this.f4=0,this.i=0,this.c=0,this.b=!1,this.b1=!0,this.b2=!0}}})(fgui||(fgui={}));(function(r){class a extends r.GComponent{constructor(){super(),this.$requestingCmd=0,this.focusable=!0,this.$uiSources=[],this.bringToFrontOnClick=r.UIConfig.bringWindowToFrontOnClick,this.on("added",this.$onShown,this),this.on("removed",this.$onHidden,this),this.on(r.InteractiveEvents.Down,this.$mouseDown,this)}addUISource(e){this.$uiSources.push(e)}set contentPane(e){this.$contentPane!=e&&(this.$contentPane!=null&&this.removeChild(this.$contentPane),this.$contentPane=e,this.$contentPane!=null&&(this.addChild(this.$contentPane),this.setSize(this.$contentPane.width,this.$contentPane.height),this.$contentPane.addRelation(this,24),this.$frame=this.$contentPane.getChild("frame"),this.$frame!=null&&(this.closeButton=this.$frame.getChild("closeButton"),this.dragArea=this.$frame.getChild("dragArea"),this.contentArea=this.$frame.getChild("contentArea"))))}get contentPane(){return this.$contentPane}get frame(){return this.$frame}get closeButton(){return this.$closeButton}set closeButton(e){this.$closeButton!=null&&this.$closeButton.removeClick(this.closeEventHandler,this),this.$closeButton=e,this.$closeButton!=null&&this.$closeButton.click(this.closeEventHandler,this)}get dragArea(){return this.$dragArea}set dragArea(e){this.$dragArea!=e&&(this.$dragArea!=null&&(this.$dragArea.draggable=!1,this.$dragArea.off(r.DragEvent.START,this.$dragStart,this)),this.$dragArea=e,this.$dragArea!=null&&(this.$dragArea instanceof r.GGraph&&this.$dragArea.drawRect(0,0,0,0,0),this.$dragArea.draggable=!0,this.$dragArea.on(r.DragEvent.START,this.$dragStart,this)))}get contentArea(){return this.$contentArea}set contentArea(e){this.$contentArea=e}show(){r.GRoot.inst.showWindow(this)}showOn(e){e.showWindow(this)}hide(){this.isShowing&&this.doHideAnimation()}hideImmediately(){(this.parent&&this.parent instanceof r.GRoot?this.parent:r.GRoot.inst).hideWindowImmediately(this)}centerOn(e,i=!1){this.setXY(Math.round((e.width-this.width)*.5),Math.round((e.height-this.height)*.5)),i&&(this.addRelation(e,3),this.addRelation(e,10))}toggleVisible(){this.isTop?this.hide():this.show()}get isShowing(){return this.parent!=null}get isTop(){return this.parent!=null&&this.parent.getChildIndex(this)==this.parent.numChildren-1}get modal(){return this.$modal}set modal(e){this.$modal=e}bringToFront(){this.root.bringToFront(this)}showModalWait(e,i=0){i!=0&&(this.$requestingCmd=i),r.UIConfig.windowModalWaiting&&(this.$modalWaitPane||(this.$modalWaitPane=r.UIPackage.createObjectFromURL(r.UIConfig.windowModalWaiting)),this.layoutModalWaitPane(e),this.addChild(this.$modalWaitPane))}layoutModalWaitPane(e){if(this.$contentArea!=null){let i=this.$frame.localToGlobal();i=this.globalToLocal(i.x,i.y,i),this.$modalWaitPane.setXY(i.x+this.$contentArea.x,i.y+this.$contentArea.y),this.$modalWaitPane.setSize(this.$contentArea.width,this.$contentArea.height),e&&e.length&&(this.$modalWaitPane.text=e)}else this.$modalWaitPane.setSize(this.width,this.height)}closeModalWait(e=0){return e!=0&&this.$requestingCmd!=e?!1:(this.$requestingCmd=0,this.$modalWaitPane&&this.$modalWaitPane.parent!=null&&this.removeChild(this.$modalWaitPane),!0)}get modalWaiting(){return this.$modalWaitPane&&this.$modalWaitPane.parent!=null}init(){this.$inited||this.$loading||(this.$uiSources.length>0?(this.$loading=!1,this.$uiSources.forEach(e=>{e.loaded||(e.load(this.$uiLoadComplete,this),this.$loading=!0)},this),this.$loading||this.$init()):this.$init())}onInit(){}onShown(){}onHide(){}doShowAnimation(){this.onShown()}doHideAnimation(){this.hideImmediately()}$uiLoadComplete(){let e=this.$uiSources.length;for(let i=0;i<e;i++)if(!this.$uiSources[i].loaded)return;this.$loading=!1,this.$init()}$init(){this.$inited=!0,this.onInit(),this.isShowing&&this.doShowAnimation()}dispose(){this.off("added",this.$onShown,this),this.off("removed",this.$onHidden,this),this.off(r.InteractiveEvents.Down,this.$mouseDown,this),this.$dragArea&&this.$dragArea.off(r.DragEvent.START,this.$dragStart,this),this.parent!=null&&this.hideImmediately(),this.$modalWaitPane&&this.$modalWaitPane.dispose(),this.$contentPane&&this.$contentPane.dispose(),super.dispose()}closeEventHandler(e){this.hide()}$onShown(e){this.$inited?this.doShowAnimation():this.init()}$onHidden(e){this.closeModalWait(),this.onHide()}$mouseDown(e){this.isShowing&&this.bringToFrontOnClick&&this.bringToFront()}$dragStart(e){r.GObject.castFromNativeObject(e.currentTarget).stopDrag(),this.startDrag(e.data.pointerId)}}r.Window=a})(fgui||(fgui={}));var f;(function(r){var a;(function(c){class e extends r.NineSlicePlane{constructor(){super(...arguments),this.$flipX=!1,this.$flipY=!1}updateHorizontalVertices(){let t=this.vertices,s=this.topHeight+this.bottomHeight,h=this._height>s?1:this._height/s;t[9]=t[11]=t[13]=t[15]=(this.$flipY?this.bottomHeight:this.topHeight)*h,t[17]=t[19]=t[21]=t[23]=this._height-(this.$flipY?this.topHeight:this.bottomHeight)*h,t[25]=t[27]=t[29]=t[31]=this._height}updateVerticalVertices(){let t=this.vertices,s=this.leftWidth+this.rightWidth,h=this._width>s?1:this._width/s;t[2]=t[10]=t[18]=t[26]=(this.$flipX?this.rightWidth:this.leftWidth)*h,t[4]=t[12]=t[20]=t[28]=this._width-(this.$flipX?this.leftWidth:this.rightWidth)*h,t[6]=t[14]=t[22]=t[30]=this._width}_refresh(){if(isNaN(this.leftWidth)||isNaN(this.topHeight)||isNaN(this.rightWidth)||isNaN(this.bottomHeight))return;super._refresh();let t=this.geometry.buffers[1].data;if(this.$flipX){let s=t[0],h=t[2];t[0]=t[6],t[2]=t[4],t[6]=s,t[4]=h,s=t[8],h=t[10],t[8]=t[14],t[10]=t[12],t[14]=s,t[12]=h,s=t[16],h=t[18],t[16]=t[22],t[18]=t[20],t[22]=s,t[20]=h,s=t[24],h=t[26],t[24]=t[30],t[26]=t[28],t[30]=s,t[28]=h}if(this.$flipY){let s=t[1],h=t[9];t[1]=t[25],t[9]=t[17],t[25]=s,t[17]=h,s=t[3],h=t[11],t[3]=t[27],t[11]=t[19],t[27]=s,t[19]=h,s=t[5],h=t[13],t[5]=t[29],t[13]=t[21],t[29]=s,t[21]=h,s=t[7],h=t[15],t[7]=t[31],t[15]=t[23],t[31]=s,t[23]=h}}get flipX(){return this.$flipX}get flipY(){return this.$flipY}set flipX(t){this.$flipX!=t&&(this.$flipX=t,this._refresh())}set flipY(t){this.$flipY!=t&&(this.$flipY=t,this._refresh())}}c.NineSlicePlane=e})(a=r.extras||(r.extras={}))})(f||(f={}));var f;(function(r){var a;(function(c){class e extends r.Sprite{constructor(t,s){super(s),this.$flipX=!1,this.$flipY=!1,this.$frameId=t}get flipX(){return this.$flipX}get flipY(){return this.$flipY}set flipX(t){this.$flipX!=t&&(this.$flipX=t,fgui.GTimer.inst.callLater(this.updateUvs,this))}set flipY(t){this.$flipY!=t&&(this.$flipY=t,fgui.GTimer.inst.callLater(this.updateUvs,this))}combineCacheId(t,s){return!this.$frameId||this.$frameId==""?null:`${this.$frameId}${t?"_fx":""}${s?"_fy":""}`}getTextureFromCache(t,s){let h=this.combineCacheId(t,s);if(h==null)return this.texture;let n=e.$cachedTexturePool[h];return n?n.refCount++:(n={refCount:1,texture:this.createFlippedTexture(this.texture,t,s)},e.$cachedTexturePool[h]=n),n.texture}tryRemoveTextureCache(t,s){let h=this.combineCacheId(t,s);if(!h)return!1;let n=e.$cachedTexturePool[h];return n?(n.refCount--,n.refCount<=0&&(n.texture.destroy(),delete e.$cachedTexturePool[h]),!0):!1}createFlippedTexture(t,s,h){let n=t.clone(),l=n._uvs;if(this.$flipX){let o=l.x0,$=l.x3;l.x0=l.x1,l.x1=o,l.x3=l.x2,l.x2=$}if(this.$flipY){let o=l.y0,$=l.y1;l.y0=l.y3,l.y3=o,l.y1=l.y2,l.y2=$}return l.uvsFloat32[0]=(l.y0*65535&65535)<<16|l.x0*65535&65535,l.uvsFloat32[1]=(l.y1*65535&65535)<<16|l.x1*65535&65535,l.uvsFloat32[2]=(l.y2*65535&65535)<<16|l.x2*65535&65535,l.uvsFloat32[3]=(l.y3*65535&65535)<<16|l.x3*65535&65535,n}updateUvs(){if(!!this.texture&&(this.$flipX||this.$flipY)){let t=this.getTextureFromCache(this.$flipX,this.$flipY);this.texture!=t&&(this.texture=t)}}destroy(t){this.tryRemoveTextureCache(this.$flipX,this.$flipY),super.destroy(t)}}e.$cachedTexturePool={},c.Sprite=e})(a=r.extras||(r.extras={}))})(f||(f={}));var f;(function(r){var a;(function(c){class e extends r.TilingSprite{constructor(t,s){super(s),this.$flipX=!1,this.$flipY=!1,this.$frameId=t}get flipX(){return this.$flipX}get flipY(){return this.$flipY}set flipX(t){this.$flipX!=t&&(this.$flipX=t,fgui.GTimer.inst.callLater(this.updateUvs,this))}set flipY(t){this.$flipY!=t&&(this.$flipY=t,fgui.GTimer.inst.callLater(this.updateUvs,this))}combineCacheId(t,s){return!this.$frameId||this.$frameId==""?null:`${this.$frameId}${t?"_fx":""}${s?"_fy":""}`}getTextureFromCache(t,s){let h=this.combineCacheId(t,s);if(h==null)return this.texture;let n=e.$cachedTexturePool[h];return n?n.refCount++:(n={refCount:1,texture:this.createFlippedTexture(this.texture,t,s)},e.$cachedTexturePool[h]=n),n.texture}tryRemoveTextureCache(t,s){let h=this.combineCacheId(t,s);if(!h)return!1;let n=e.$cachedTexturePool[h];return n?(n.refCount--,n.refCount<=0&&(n.texture.destroy(),delete e.$cachedTexturePool[h]),!0):!1}createFlippedTexture(t,s,h){let n=t.clone(),l=n._uvs;if(this.$flipX){let o=l.x0,$=l.x3;l.x0=l.x1,l.x1=o,l.x3=l.x2,l.x2=$}if(this.$flipY){let o=l.y0,$=l.y1;l.y0=l.y3,l.y3=o,l.y1=l.y2,l.y2=$}return l.uvsFloat32[0]=(l.y0*65535&65535)<<16|l.x0*65535&65535,l.uvsFloat32[1]=(l.y1*65535&65535)<<16|l.x1*65535&65535,l.uvsFloat32[2]=(l.y2*65535&65535)<<16|l.x2*65535&65535,l.uvsFloat32[3]=(l.y3*65535&65535)<<16|l.x3*65535&65535,n}updateUvs(){if(!!this.texture&&(this.$flipX||this.$flipY)){let t=this.getTextureFromCache(this.$flipX,this.$flipY);this.texture!=t&&(this.texture=t)}}destroy(t){this.tryRemoveTextureCache(this.$flipX,this.$flipY),super.destroy(t)}}e.$cachedTexturePool={},c.TilingSprite=e})(a=r.extras||(r.extras={}))})(f||(f={}));(function(r){class a{}a.defaultFont="Arial",a.modalLayerColor=3355443,a.modalLayerAlpha=.2,a.defaultScrollSpeed=25,a.defaultScrollBarDisplay=1,a.defaultScrollTouchEffect=!0,a.defaultScrollBounceEffect=!0,a.defaultScrollDecelerationRate=.967,a.defaultComboBoxVisibleItemCount=10,a.touchScrollSensitivity=20,a.touchDragSensitivity=10,a.bringWindowToFrontOnClick=!0,r.UIConfig=a})(fgui||(fgui={}));(function(r){class a{static create(e){switch(e){case"play_transition":return new r.PlayTransitionAction;case"change_page":return new r.ChangePageAction}return null}execute(e,i,t){(!this.fromPage||this.fromPage.length==0||this.fromPage.indexOf(i)!=-1)&&(!this.toPage||this.toPage.length==0||this.toPage.indexOf(t)!=-1)?this.enter(e):this.leave(e)}enter(e){}leave(e){}setup(e){let i;i=e.attributes.fromPage,i&&(this.fromPage=i.split(",")),i=e.attributes.toPage,i&&(this.toPage=i.split(","))}}r.Action=a})(fgui||(fgui={}));(function(r){class a extends r.Action{enter(e){if(!this.controllerName)return;let i;if(this.objectId?i=e.parent.getChildById(this.objectId):i=e.parent,i){let t=i.getController(this.controllerName);t&&t!=e&&!t.$updating&&(t.selectedPageId=this.targetPage)}}setup(e){super.setup(e),this.objectId=e.attributes.objectId,this.controllerName=e.attributes.controller,this.targetPage=e.attributes.targetPage}}r.ChangePageAction=a})(fgui||(fgui={}));(function(r){class a{}a.CHANGED="__stateChanged",r.StateChangeEvent=a})(fgui||(fgui={}));(function(r){class a extends f.utils.EventEmitter{constructor(){super(),this.$selectedIndex=0,this.$previousIndex=0,this.$pageIds=[],this.$pageNames=[],this.$selectedIndex=-1,this.$previousIndex=-1}get name(){return this.$name}set name(e){this.$name=e}get parent(){return this.$parent}get selectedIndex(){return this.$selectedIndex}set selectedIndex(e){this.$selectedIndex!=e&&(e>this.$pageIds.length-1&&(console.error(this,`index out of range: ${e}`),e=this.$pageIds.length-1),this.$updating=!0,this.$previousIndex=this.$selectedIndex,this.$selectedIndex=e,this.$parent.applyController(this),this.emit(r.StateChangeEvent.CHANGED,this),this.$updating=!1)}setSelectedIndex(e=0){if(this.$selectedIndex!=e){if(e>this.$pageIds.length-1)throw new Error(`index out of range: ${e}`);this.$updating=!0,this.$previousIndex=this.$selectedIndex,this.$selectedIndex=e,this.$parent.applyController(this),this.$updating=!1}}get previsousIndex(){return this.$previousIndex}get selectedPage(){return this.$selectedIndex==-1?null:this.$pageNames[this.$selectedIndex]}set selectedPage(e){this.selectedIndex=Math.max(0,this.$pageNames.indexOf(e))}setSelectedPage(e){this.setSelectedIndex(Math.max(0,this.$pageNames.indexOf(e)))}get previousPage(){return this.$previousIndex==-1?null:this.$pageNames[this.$previousIndex]}get pageCount(){return this.$pageIds.length}getPageName(e=0){return this.$pageNames[e]}addPage(e=""){this.addPageAt(e,this.$pageIds.length)}addPageAt(e,i=0){let t=`${a.$nextPageId++}`;i==this.$pageIds.length?(this.$pageIds.push(t),this.$pageNames.push(e)):(this.$pageIds.splice(i,0,t),this.$pageNames.splice(i,0,e))}removePage(e){let i=this.$pageNames.indexOf(e);i!=-1&&(this.$pageIds.splice(i,1),this.$pageNames.splice(i,1),this.$selectedIndex>=this.$pageIds.length?this.selectedIndex=this.$selectedIndex-1:this.$parent.applyController(this))}removePageAt(e=0){this.$pageIds.splice(e,1),this.$pageNames.splice(e,1),this.$selectedIndex>=this.$pageIds.length?this.selectedIndex=this.$selectedIndex-1:this.$parent.applyController(this)}clearPages(){this.$pageIds.length=0,this.$pageNames.length=0,this.$selectedIndex!=-1?this.selectedIndex=-1:this.$parent.applyController(this)}hasPage(e){return this.$pageNames.indexOf(e)>=0}getPageIndexById(e){return this.$pageIds.indexOf(e)}getPageIdByName(e){let i=this.$pageNames.indexOf(e);return i!=-1?this.$pageIds[i]:null}getPageNameById(e){let i=this.$pageIds.indexOf(e);return i!=-1?this.$pageNames[i]:null}getPageId(e=0){return this.$pageIds[e]}get selectedPageId(){return this.$selectedIndex==-1?null:this.$pageIds[this.$selectedIndex]}set selectedPageId(e){this.selectedIndex=this.$pageIds.indexOf(e)}set oppositePageId(e){this.$pageIds.indexOf(e)>0?this.selectedIndex=0:this.$pageIds.length>1&&(this.selectedIndex=1)}get previousPageId(){return this.$previousIndex==-1?null:this.$pageIds[this.$previousIndex]}executeActions(){this.$actions&&this.$actions.length>0&&this.$actions.forEach(e=>{e.execute(this,this.previousPageId,this.selectedPageId)})}setup(e){this.$name=e.attributes.name,this.$autoRadioGroupDepth=e.attributes.autoRadioGroupDepth=="true";let i=e.attributes.pages;if(i){let s=i.split(","),h=s.length;for(let n=0;n<h;n+=2)this.$pageIds.push(s[n]),this.$pageNames.push(s[n+1])}let t=e.children;if(t.length>0&&(this.$actions=this.$actions||[],t.forEach(s=>{let h=r.Action.create(s.attributes.type);h.setup(s),this.$actions.push(h)})),i=e.attributes.transitions,i){this.$actions=this.$actions||[];let s,h;i.split(",").forEach(n=>{if(n&&n.length){let l=new r.PlayTransitionAction;s=n.indexOf("="),l.transitionName=n.substr(s+1),n=n.substring(0,s),s=n.indexOf("-"),h=parseInt(n.substring(s+1)),h<this.$pageIds.length&&(l.toPage=[this.$pageIds[h]]),n=n.substring(0,s),n!="*"&&(h=parseInt(n),h<this.$pageIds.length&&(l.fromPage=[this.$pageIds[h]])),l.stopOnExit=!0,this.$actions.push(l)}})}this.$parent&&this.$pageIds.length>0?this.$selectedIndex=0:this.$selectedIndex=-1}}a.$nextPageId=0,r.Controller=a})(fgui||(fgui={}));(function(r){class a{set controller(e){this.$controller=e}set name(e){this.$id=this.$controller.getPageIdByName(e)}get name(){return this.$id?this.$controller.getPageNameById(this.$id):null}set index(e){this.$id=this.$controller.getPageId(e)}get index(){return this.$id?this.$controller.getPageIndexById(this.$id):-1}clear(){this.$id=null}set id(e){this.$id=e}get id(){return this.$id}}r.PageOption=a})(fgui||(fgui={}));(function(r){var a;(function(c){class e{constructor(s){this.nodeName=s.nodeName,this.context=s,this.type=s.nodeType,this.text=this.type==Node.COMMENT_NODE||this.type==Node.TEXT_NODE||this.type==Node.ELEMENT_NODE?this.context.textContent:null}get children(){return this.$children||(this.$children=this.__parseChildNodes(this)),this.$children}get attributes(){return this.$attributes||(this.$attributes=this.__parseNodeAttributes(this)),this.$attributes}getChildNodes(s=null){let h=this.children,n=[];if(!h||h.length<=0)return n;let l=h.length;for(let o=0;o<l;o++){let $=h[o];$.type!=Node.TEXT_NODE&&(!s||s&&s.length>0&&$.nodeName.toLowerCase()==s.toLowerCase())&&n.push($)}return n}__parseChildNodes(s,h=null){let n=s.context.childNodes,l=[];if(!n||n.length<=0)return l;let o=n.length;for(let $=0;$<o;$++){let d=n.item($);d.nodeType!=Node.TEXT_NODE&&(!h||h&&h.length>0&&d.nodeName.toLowerCase()==h.toLowerCase())&&l.push(new e(d))}return l}__parseNodeAttributes(s){let h=s.context.attributes,n={};if(!h||h.length<=0)return n;let l=h.length;for(let o=0;o<l;o++){let $=h.item(o);n[$.nodeName]=$.nodeValue}return n}}c.XmlNode=e;class i{static tryParse(s,h="text/xml"){let n=i.$parser.parseFromString(s,h);return n&&n.childNodes&&n.childNodes.length>=1?new e(n.firstChild):null}static getXmlRoot(s){if(!s||!s.context)throw new Error("Invalid xml node");let h=s.context;for(;h.parentNode!=null;)h=h.parentNode;return h==s.context?s:new e(h)}}i.$parser=new DOMParser,c.XmlParser=i})(a=r.utils||(r.utils={}))})(fgui||(fgui={}));(function(r){class a extends r.Action{constructor(){super(...arguments),this.repeat=1,this.delay=0,this.stopOnExit=!1}enter(e){let i=e.parent.getTransition(this.transitionName);i&&(this.$currentTransition&&this.$currentTransition.playing?i.changeRepeat(this.repeat):i.play({times:this.repeat,delay:this.delay}),this.$currentTransition=i)}leave(e){this.stopOnExit&&this.$currentTransition&&(this.$currentTransition.stop(),this.$currentTransition=null)}setup(e){super.setup(e),this.transitionName=e.attributes.transition;let i;i=e.attributes.repeat,i&&(this.repeat=parseInt(i)),i=e.attributes.delay,i&&(this.delay=parseFloat(i)),this.stopOnExit=e.attributes.stopOnExit=="true"}}r.PlayTransitionAction=a})(fgui||(fgui={}));(function(r){class a{constructor(){this.x=0,this.y=0,this.offsetX=0,this.offsetY=0,this.width=0,this.height=0,this.advance=0,this.lineHeight=0,this.channel=0}}r.BMGlyph=a})(fgui||(fgui={}));(function(r){class a{constructor(){this.size=0,this.glyphs={}}}r.BitmapFont=a})(fgui||(fgui={}));(function(r){class a extends f.Sprite{constructor(e){super(e),this._fillDir=0,this._flip=0,this._percent=0}get flip(){return this._flip}set flip(e){e!=this._flip&&(this._flip=e)}get fillAmount(){return typeof this._fillAmount=="number"?this._fillAmount:100}set fillAmount(e){e!=this._fillAmount&&(this._fillAmount=e)}get fillBegin(){return this._fillBegin}set fillBegin(e){e!=this._fillBegin&&(this._fillBegin=e)}get fillMode(){return this._fillMode}set fillMode(e){e!=this._fillMode&&(this._fillMode=e,this.checkAndFixFillBegin())}get fillDirection(){return this._fillDir}set fillDirection(e){e!=this._fillDir&&(this._fillDir=e,this.checkAndFixFillBegin())}checkAndFixFillBegin(){switch(this._fillMode){case 1:this._fillBegin!=0&&this._fillBegin!=1&&(this._fillBegin=0);break;case 2:this._fillBegin!=2&&this._fillBegin!=3&&(this._fillBegin=2);break;case 3:this._fillBegin!=4&&this._fillBegin!=6&&this._fillBegin!=5&&this._fillBegin!=7&&(this._fillBegin=4);break;case 4:case 5:this._fillBegin!=0&&this._fillBegin!=1&&this._fillBegin!=2&&this._fillBegin!=3&&(this._fillBegin=2);break}}set amount(e){this._percent=e}get amount(){return this._percent}}r.FillSprite=a})(fgui||(fgui={}));(function(r){class a{constructor(){this.addDelay=0}}r.Frame=a})(fgui||(fgui={}));(function(r){var a;(function(c){class e{static encodeHTML(t){return t?t.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace("'","&apos;"):""}static getFileName(t){let s=t.lastIndexOf("/");return s!=-1&&(t=t.substr(s+1)),s=t.lastIndexOf("\\"),s!=-1&&(t=t.substr(s+1)),s=t.lastIndexOf("."),s!=-1?t.substring(0,s):t}static startsWith(t,s,h=!1){return t?t.length<s.length?!1:(t=t.substring(0,s.length),h?t.toLowerCase()==s.toLowerCase():t==s):!1}static endsWith(t,s,h=!1){return t?t.length<s.length?!1:(t=t.substring(t.length-s.length),h?t.toLowerCase()==s.toLowerCase():t==s):!1}static trim(t){return e.trimLeft(e.trimRight(t))}static trimLeft(t){let s="",h;for(h=0;h<t.length&&(s=t.charAt(h),!(s!=" "&&s!=`
`&&s!="\r"));h++);return t.substr(h)}static trimRight(t){let s="",h;for(h=t.length-1;h>=0&&(s=t.charAt(h),!(s!=" "&&s!=`
`&&s!="\r"));h--);return t.substring(0,h+1)}static convertToHtmlColor(t,s=!1){let h;s?h=(t>>24&255).toString(16):h="";let n=(t>>16&255).toString(16),l=(t>>8&255).toString(16),o=(t&255).toString(16);return h.length==1&&(h=`0${h}`),n.length==1&&(n=`0${n}`),l.length==1&&(l=`0${l}`),o.length==1&&(o=`0${o}`),`#${h}${n}${l}${o}`}static convertFromHtmlColor(t,s=!1){return t.length<1?0:(t.charAt(0)=="#"&&(t=t.substr(1)),t.length==8?(parseInt(t.substr(0,2),16)<<24)+parseInt(t.substr(2),16):s?4278190080+parseInt(t,16):parseInt(t,16))}}c.StringUtil=e})(a=r.utils||(r.utils={}))})(fgui||(fgui={}));(function(r){var a;(function(c){class e{static create(t,s,...h){return s?function(){let n=arguments.length>0?[].concat(Array.prototype.slice.call(arguments)).concat(h):[].concat(h);t.apply(s,n)}:t}}c.Binder=e})(a=r.utils||(r.utils={}))})(fgui||(fgui={}));(function(r){class a{}a.CHANGED="__focusChanged",r.FocusEvent=a})(fgui||(fgui={}));(function(r){class a extends f.utils.EventEmitter{constructor(e){super(),this.$requestToShow=!1,this.inputElement=null,this.inputDiv=null,this.$scaleX=0,this.$scaleY=0,this.textValue="",this.colorValue=16777215,this.$attrsCache={},this.$textfield=e}$addToStage(){this.htmlInput=r.HTMLInput.inst}initElement(){let e=this.$textfield.localToGlobal(0,0),i=e.x,t=e.y,s=this.htmlInput.$scaleX,h=this.htmlInput.$scaleY;this.$textfield.multipleLine||(this.inputElement.style.top=-this.$textfield.leading*h+"px"),this.inputDiv.style.top=(t+1)*h+"px",this.inputDiv.style.left=i*s+"px";let n=this.$textfield,l=1,o=1,$=0;for(;n.parent;)l*=n.scaleX,o*=n.scaleY,$+=n.rotation,n=n.parent;let d=this.inputDiv.style;d.transform=d.webkitTransform=d.msTransform=d.mozTransform=d.oTransform="rotate("+$+"deg)",this.$scaleX=s*l,this.$scaleY=h*o}get textField(){return this.$textfield}$show(){if(this.htmlInput.isCurrentInput(this))this.inputElement.onblur=null;else{this.inputElement=this.htmlInput.requestInput(this),this.$textfield.multipleLine||(this.inputElement.type=this.$textfield.type);for(let e in this.$attrsCache)this.inputElement.setAttribute(e,this.$attrsCache[e]);this.inputDiv=this.htmlInput.$wrapper}this.htmlInput.$requestToShow=!0,this.$requestToShow=!0,this.initElement()}onBlurHandler(){this.htmlInput.clearInputElement(),this.htmlInput.clearAttributes(this.$attrsCache),window.scrollTo(0,0)}$hide(){}get text(){return this.textValue||(this.textValue=""),this.textValue}set text(e){this.textValue=e,this.inputElement&&(this.inputElement.value=this.textValue)}setColor(e){this.colorValue=e,this.inputElement&&this.setElementStyle("color",r.utils.StringUtil.convertToHtmlColor(this.colorValue))}$onBlur(){}onInputHandler(){window.setTimeout(()=>{this.inputElement&&this.inputElement.selectionStart==this.inputElement.selectionEnd&&(this.textValue=this.inputElement.value,this.emit("updateText"))},0)}setAreaHeight(){let e=this.$textfield;if(e.multipleLine){let i=e.textHeight;if(e.height<=e.fontSize)this.setElementStyle("height",e.fontSize*this.$scaleY+"px"),this.setElementStyle("padding","0px"),this.setElementStyle("lineHeight",e.lineHeight*this.$scaleY+"px");else if(e.height<i)this.setElementStyle("height",e.height*this.$scaleY+"px"),this.setElementStyle("padding","0px"),this.setElementStyle("lineHeight",e.lineHeight*this.$scaleY+"px");else{this.setElementStyle("height",(i+e.leading)*this.$scaleY+"px");let t=(e.height-i)*this.$scaleY,s=this.getVAlignFactor(e),h=t*s,n=t-h;this.setElementStyle("padding",h+"px 0px "+n+"px 0px"),this.setElementStyle("lineHeight",e.lineHeight*this.$scaleY+"px")}}}getVAlignFactor(e){let i=0;switch(e.verticalAlign){case 0:break;case 1:i=.5;break;case 2:i=1;break}return i}onClickHandler(e){this.$requestToShow&&(this.$requestToShow=!1,this.inputElement.value=this.text,this.inputElement.onblur==null&&(this.inputElement.onblur=r.utils.Binder.create(this.onBlurHandler,this)),this.resetInput(),this.$textfield.maxLength>0?this.inputElement.setAttribute("maxlength",String(this.$textfield.maxLength)):this.inputElement.removeAttribute("maxlength"),this.inputElement.selectionStart=this.inputElement.value.length,this.inputElement.selectionEnd=this.inputElement.value.length,this.inputElement.focus(),this.emit(r.FocusEvent.CHANGED,"focus",this.inputElement))}onDisconnect(){this.inputElement=null,this.emit(r.FocusEvent.CHANGED,"blur",this.inputElement)}setElementStyle(e,i){if(i!=null&&this.inputElement){let t=this.inputElement.style;t[e]=i}}setAttribute(e,i){e==null||i==null||(this.$attrsCache[e]=i)}getAttribute(e){return this.$attrsCache[e]}$removeFromStage(){this.inputElement&&this.htmlInput.disconnect(this)}resetInput(){if(this.inputElement){let e=this.$textfield;this.setElementStyle("fontFamily",e.font),this.setElementStyle("fontStyle",e.italic?"italic":"normal"),this.setElementStyle("fontWeight",e.bold?"bold":"normal"),this.setElementStyle("textAlign",e.align),this.setElementStyle("fontSize",e.fontSize*this.$scaleY+"px"),this.setElementStyle("color",r.utils.StringUtil.convertToHtmlColor(e.color)),this.setElementStyle("width",e.width*this.$scaleX+"px");let i="middle",t=0;switch(e.verticalAlign){case 0:i="top";break;case 1:i="middle",t=.5;break;case 2:i="bottom",t=1;break}if(this.setElementStyle("verticalAlign",i),e.multipleLine)this.setAreaHeight();else if(this.setElementStyle("lineHeight",e.lineHeight*this.$scaleY+"px"),e.height<e.fontSize)this.setElementStyle("height",e.fontSize*this.$scaleY+"px"),this.setElementStyle("padding","0px 0px "+e.fontSize*.5*this.$scaleX+"px 0px");else{this.setElementStyle("height",e.fontSize*this.$scaleY+"px");let s=(e.height-e.fontSize)*this.$scaleY,h=s*t,n=s-h,l=e.fontSize*.5*this.$scaleY;n<l&&(n=l),this.setElementStyle("padding",h+"px 0px "+n+"px 0px")}this.inputDiv.style.clip="rect(0px "+e.width*this.$scaleX+"px "+e.height*this.$scaleY+"px 0px)",this.inputDiv.style.height=e.height*this.$scaleY+"px",this.inputDiv.style.width=e.width*this.$scaleX+"px"}}}r.InputElement=a})(fgui||(fgui={}));(function(r){class a{constructor(){this.$requestToShow=!1,this.$scaleX=1,this.$scaleY=1}static get inst(){return a.$instance||(a.$instance=new a),a.$instance}initialize(e,i){this.$canvas=i;let t;this.$delegateDiv||(t=document.createElement("div"),this.$delegateDiv=t,t.id="__delegateDiv",e.appendChild(t),this.initDomPos(t),this.$wrapper=document.createElement("div"),this.initDomPos(this.$wrapper),this.$wrapper.style.width="0px",this.$wrapper.style.height="0px",this.$wrapper.style.left="0px",this.$wrapper.style.top="-100px",this.setTransform(this.$wrapper,"0% 0% 0px"),t.appendChild(this.$wrapper),r.GRoot.inst.on(r.InteractiveEvents.Click,this.canvasClickHandler,this),this.initInputElement(!0),this.initInputElement(!1))}isInputOn(){return this.$input!=null}canvasClickHandler(e){this.$requestToShow?(this.$requestToShow=!1,this.$input.onClickHandler(e),this.show()):this.$curEle&&(this.clearInputElement(),this.$curEle.blur(),this.$curEle=null)}isInputShown(){return this.$input!=null}isCurrentInput(e){return this.$input==e}initDomPos(e){e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.border="none",e.style.padding="0"}setTransform(e,i,t){let s=e.style;s.transformOrigin=s.webkitTransformOrigin=s.msTransformOrigin=s.mozTransformOrigin=s.oTransformOrigin=i,t&&t.length>0&&(s.transform=s.webkitTransform=s.msTransform=s.mozTransform=s.oTransform=t)}updateSize(e,i){if(!this.$canvas)return;this.$scaleX=e,this.$scaleY=i,this.$delegateDiv.style.left=this.$canvas.style.left,this.$delegateDiv.style.top=this.$canvas.style.top;let t=this.$canvas.style;this.setTransform(this.$delegateDiv,"0% 0% 0px",t.transform||t.webkitTransform||t.msTransform||t.mozTransform||t.oTransform)}initInputElement(e){let i;e?(i=document.createElement("textarea"),i.style.resize="none",this.$multiLine=i,i.id="stageTextAreaEle"):(i=document.createElement("input"),this.$singleLine=i,i.type="text",i.id="stageInputEle"),this.$wrapper.appendChild(i),i.setAttribute("tabindex","-1"),i.style.width="1px",i.style.height="12px",this.initDomPos(i);let t=i.style;t.outline="thin",t.background="none",t.overflow="hidden",t.wordBreak="break-all",t.opacity=0,i.oninput=s=>{this.$input&&this.$input.onInputHandler()}}show(){r.GTimer.inst.callLater(()=>{this.$curEle.style.opacity="1"},this)}disconnect(e){(this.$input==null||this.$input==e)&&(this.clearInputElement(),this.$curEle&&this.$curEle.blur())}clearAttributes(e){if(this.$curEle)for(let i in e)this.$curEle.removeAttribute(i)}clearInputElement(){if(this.$curEle){this.$curEle.value="",this.$curEle.onblur=null;let e=this.$curEle.style;e.width="1px",e.height="12px",e.left="0px",e.top="0px",e.opacity="0";let i;this.$singleLine==this.$curEle?i=this.$multiLine:i=this.$singleLine,i.style.display="block",this.$wrapper.style.left="0px",this.$wrapper.style.top="-100px",this.$wrapper.style.height="0px",this.$wrapper.style.width="0px"}this.$input&&(this.$input.onDisconnect(),this.$input=null,a.isTyping=!1)}requestInput(e){this.clearInputElement(),this.$input=e,a.isTyping=!0;let i;return this.$input.textField.multipleLine?(this.$curEle=this.$multiLine,i=this.$singleLine):(this.$curEle=this.$singleLine,i=this.$multiLine),i.style.display="none",this.$curEle}}a.isTyping=!1,r.HTMLInput=a})(fgui||(fgui={}));(function(r){r.isUIObject=function(a){return a&&"UIOwner"in a&&a.UIOwner!=null}})(fgui||(fgui={}));(function(r){class a{constructor(){this.startFrame=0,this.endFrame=-1,this.repeatCount=0,this.loopEndAt=-1,this.endCallback=null,this.endCallbackContext=null}mix(e){let i=this;for(let t in e)t!="mix"&&(i[t]=e[t]);return this}}r.DefaultMovieClipSettings=a})(fgui||(fgui={}));(function(r){class a{constructor(){this.repeatedCount=0,this.$curFrame=0,this.$lastTime=0,this.$curFrameDelay=0,this.$lastTime=Date.now()}update(e){let i=Date.now(),t=i-this.$lastTime;this.$lastTime=i;let s=this.$curFrame;s>=e.frameCount&&(s=e.frameCount-1),this.reachesEnd=!1,this.$curFrameDelay+=t;let h=e.interval+e.frames[s].addDelay+(s==0&&this.repeatedCount>0?e.repeatDelay:0);this.$curFrameDelay<h||(this.$curFrameDelay-=h,this.$curFrameDelay>e.interval&&(this.$curFrameDelay=e.interval),e.swing?this.reversed?(this.$curFrame--,this.$curFrame<0&&(this.$curFrame=Math.min(1,e.frameCount-1),this.repeatedCount++,this.reversed=!this.reversed)):(this.$curFrame++,this.$curFrame>e.frameCount-1&&(this.$curFrame=Math.max(0,e.frameCount-2),this.repeatedCount++,this.reachesEnd=!0,this.reversed=!this.reversed)):(this.$curFrame++,this.$curFrame>e.frameCount-1&&(this.$curFrame=0,this.repeatedCount++,this.reachesEnd=!0)))}get currentFrame(){return this.$curFrame}set currentFrame(e){this.$curFrame=e,this.$curFrameDelay=0}rewind(){this.$curFrame=0,this.$curFrameDelay=0,this.reversed=!1,this.reachesEnd=!1}reset(){this.$curFrame=0,this.$curFrameDelay=0,this.repeatedCount=0,this.reachesEnd=!1,this.reversed=!1}copy(e){this.$curFrame=e.$curFrame,this.$curFrameDelay=e.$curFrameDelay,this.repeatedCount=e.repeatedCount,this.reachesEnd=e.reachesEnd,this.reversed=e.reversed}}r.MovieClipData=a})(fgui||(fgui={}));(function(r){var a;(function(c){class e{static clamp(t,s,h){return t<s?t=s:t>h&&(t=h),t}static clamp01(t){return t>1?t=1:t<0&&(t=0),t}static isNumber(t){return!(typeof t!="number"||isNaN(t))}static sign(t){return t=Number(t),t===0||isNaN(t)?t:t>0?1:-1}static angleToRadian(t){return t*e.RADIAN}static lerp(t,s,h){return t+h*(s-t)}}e.RADIAN=Math.PI/180,c.NumberUtil=e})(a=r.utils||(r.utils={}))})(fgui||(fgui={}));(function(r){class a extends f.Sprite{constructor(e){super(),this.interval=0,this.repeatDelay=0,this.$frameCount=0,this.$currentFrame=0,this.$status=0,this.UIOwner=e,this.data=new r.MovieClipData,this.$playing=!0,this.interactive=this.interactiveChildren=!1,this.$settings=new r.DefaultMovieClipSettings,this.visible,this.on("added",this.added,this),this.on("removed",this.removed,this)}get frames(){return this.$frames}set frames(e){this.$frames=e,this.$frames!=null?this.$frameCount=this.$frames.length:this.$frameCount=0,(this.$settings.endFrame==-1||this.$settings.endFrame>this.$frameCount-1)&&(this.$settings.endFrame=this.$frameCount-1),(this.$settings.loopEndAt==-1||this.$settings.loopEndAt>this.$frameCount-1)&&(this.$settings.loopEndAt=this.$frameCount-1),(this.$currentFrame<0||this.$currentFrame>this.$frameCount-1)&&(this.$currentFrame=this.$frameCount-1),this.$frameCount>0?this.setFrame(this.$frames[this.$currentFrame]):this.setFrame(null),this.data.rewind()}get frameCount(){return this.$frameCount}get boundsRect(){return this._bounds.getRectangle(f.Rectangle.EMPTY)}set boundsRect(e){this._bounds.addBoundsArea(new f.Bounds,e)}get currentFrame(){return this.$currentFrame}set currentFrame(e){this.$currentFrame!=e&&(this.$currentFrame=e,this.data.currentFrame=e,this.setFrame(this.$currentFrame<this.$frameCount?this.$frames[this.$currentFrame]:null))}get playing(){return this.$playing}set playing(e){this.$playing=e,e&&r.GObject.isDisplayObjectOnStage(this)?r.GTimer.inst.add(0,0,this.update,this):r.GTimer.inst.remove(this.update,this)}setPlaySettings(...e){if(e.length==1&&typeof e[0]=="object")this.$settings.mix(e[0]);else{let i=e[0],t=e[1],s=e[2],h=e[3],n=e[4],l=e[5],o={};r.utils.NumberUtil.isNumber(i)&&(o.startFrame=i),r.utils.NumberUtil.isNumber(t)&&(o.endFrame=t),r.utils.NumberUtil.isNumber(s)&&(o.repeatCount=s),r.utils.NumberUtil.isNumber(h)&&(o.loopEndAt=h),n&&typeof n=="function"&&(o.endCallback=n),l&&(o.endCallbackContext=l),this.$settings.mix(o)}(this.$settings.endFrame==-1||this.$settings.endFrame>this.$frameCount-1)&&(this.$settings.endFrame=this.$frameCount-1),this.$settings.loopEndAt==-1&&(this.$settings.loopEndAt=this.$settings.endFrame),this.$status=0,this.currentFrame=this.$settings.startFrame}update(){this.UIOwner.$inProgressBuilding||this.$playing&&this.$frameCount!=0&&this.$status!=3&&(this.data.update(this),this.$currentFrame!=this.data.currentFrame&&(this.$status==1?(this.$currentFrame=this.$settings.startFrame,this.data.currentFrame=this.$currentFrame,this.$status=0):this.$status==2?(this.$currentFrame=this.$settings.loopEndAt,this.data.currentFrame=this.$currentFrame,this.$status=3,this.$settings.endCallback!=null&&r.GTimer.inst.callLater(this.$playEnd,this)):(this.$currentFrame=this.data.currentFrame,this.$currentFrame==this.$settings.endFrame&&this.$settings.repeatCount>0&&(this.$settings.repeatCount--,this.$settings.repeatCount==0?this.$status=2:this.$status=1)),this.setFrame(this.$frames[this.$currentFrame])))}$playEnd(){if(this.$settings.endCallback!=null){let e=this.$settings.endCallback,i=this.$settings.endCallbackContext;this.$settings.endCallback=this.$settings.endCallbackContext=null,this.$settings.endCallbackContext=null,e&&e.call(i,this)}}setFrame(e){this.texture=e==null?null:e.texture,this._textureID=-1}added(e){this.$playing&&r.GTimer.inst.add(0,0,this.update,this)}removed(e){this.$playing&&r.GTimer.inst.remove(this.update,this)}destroy(){r.GTimer.inst.remove(this.update,this),this.off("added",this.added,this),this.off("removed",this.removed,this),super.destroy()}}r.MovieClip=a})(fgui||(fgui={}));(function(r){class a extends f.Container{constructor(e){super(),this.UIOwner=e,this.interactive=!0,this.interactiveChildren=!0}get scrollRect(){return this.$scrollRect}set scrollRect(e){this.$scrollRect=e,e!=null?(this.$rectMask||(this.$rectMask=new f.Graphics,this.$rectMask.isMask=!0,this.addChild(this.$rectMask),this.mask=this.$rectMask),this.$rectMask.clear(),e.width>0&&e.height>0&&(this.$rectMask.beginFill(0,1),this.$rectMask.drawRect(this.$scrollRect.x,this.$scrollRect.y,this.$scrollRect.width,this.$scrollRect.height),this.$rectMask.endFill())):this.mask=null}}r.UIContainer=a})(fgui||(fgui={}));(function(r){class a extends f.Container{constructor(e){super(),this.UIOwner=e,this.interactive=this.interactiveChildren=!1}$initDisp(e){if(!this.$disp){if(e)if(e.load(),e.scaleByTile){let i=new f.extras.TilingSprite(e.id,e.texture);this.$disp=i}else e.scale9Grid?(this.$disp=new f.extras.NineSlicePlane(e.texture,e.scale9Grid.left,e.scale9Grid.top,Math.max(0,e.texture.width-e.scale9Grid.width-e.scale9Grid.x),Math.max(0,e.texture.height-e.scale9Grid.height-e.scale9Grid.y)),this.tiledSlices=e.tiledSlices):this.$disp=new f.extras.Sprite(e.id,e.texture);else this.$disp=new f.extras.Sprite;this.addChild(this.$disp)}}get tint(){return this.$disp.tint}set tint(e){this.$disp.tint=e}get height(){return this.$disp.height}set height(e){this.$disp.height=e}get width(){return this.$disp.width}set width(e){this.$disp.width=e}get texture(){return this.$disp.texture}set texture(e){this.$disp.texture=e}get scale9Grid(){return this.$disp instanceof f.NineSlicePlane?new f.Rectangle(this.$disp.leftWidth,this.$disp.topHeight,this.$disp.rightWidth,this.$disp.bottomHeight):null}set scale9Grid(e){this.$disp instanceof f.NineSlicePlane&&(e.left!=this.$disp.leftWidth&&(this.$disp.leftWidth=e.left),e.top!=this.$disp.topHeight&&(this.$disp.topHeight=e.top),e.right!=this.$disp.rightWidth&&(this.$disp.rightWidth=e.right),e.bottom!=this.$disp.bottomHeight&&(this.$disp.bottomHeight=e.bottom))}get tiledSlices(){return 0}set tiledSlices(e){}get flipX(){return this.$disp.flipX}get flipY(){return this.$disp.flipY}set flipX(e){r.GRoot.inst.applicationContext.renderer.type==f.RENDERER_TYPE.WEBGL&&(this.$disp.flipX=e)}set flipY(e){r.GRoot.inst.applicationContext.renderer.type==f.RENDERER_TYPE.WEBGL&&(this.$disp.flipY=e)}destroy(e){this.$disp&&(this.$disp.destroy(e),this.$disp=null),super.destroy(e)}}r.UIImage=a})(fgui||(fgui={}));(function(r){class a extends f.Graphics{constructor(e){super(),this.UIOwner=e,this.interactive=!1,this.interactiveChildren=!1}}r.UISprite=a})(fgui||(fgui={}));(function(r){var a;(function(c){class e extends f.utils.EventEmitter{constructor(){super(),this.retEvent={},this.nullLowestDeltaTimeout=NaN,this.$pressedKeys={},this.$releasedKeys={},this.$downKeys=[],window.addEventListener("resize",s=>this.notifyResizeEvents(s),!1),window.addEventListener("keydown",s=>this.onWindowKeyDown(s),!1),window.addEventListener("keyup",s=>this.onWindowKeyUp(s),!1);let t="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];for(let s=t.length;s;)window.addEventListener(t[--s],h=>this.onMouseWheel(h),!1)}notifyResizeEvents(t){this.emit("resize")}onMouseWheel(t){let s=t||window.event,h=0,n=0,l=0,o=0;"detail"in s&&(l=s.detail*-1),"wheelDelta"in s&&(l=s.wheelDelta),"wheelDeltaY"in s&&(l=s.wheelDeltaY),"wheelDeltaX"in s&&(n=s.wheelDeltaX*-1),"axis"in s&&s.axis===s.HORIZONTAL_AXIS&&(n=l*-1,l=0),h=l===0?n:l,"deltaY"in s&&(l=s.deltaY*-1,h=l),"deltaX"in s&&(n=s.deltaX,l===0&&(h=n*-1)),!(l===0&&n===0)&&((s.deltaMode===1||s.deltaMode===2)&&(h*=16,l*=16,n*=16),o=Math.max(Math.abs(l),Math.abs(n)),(!this.lowestDelta||o<this.lowestDelta)&&(this.lowestDelta=o,s.type==="mousewheel"&&o%120===0&&(this.lowestDelta/=40)),s.type==="mousewheel"&&o%120===0&&(h/=40,n/=40,l/=40),h=Math[h>=1?"floor":"ceil"](h/this.lowestDelta),n=Math[n>=1?"floor":"ceil"](n/this.lowestDelta),l=Math[l>=1?"floor":"ceil"](l/this.lowestDelta),this.retEvent.delta=h,this.retEvent.deltaX=n,this.retEvent.deltaY=l,this.retEvent.deltaFactor=this.lowestDelta,this.retEvent.deltaMode=0,this.nullLowestDeltaTimeout&&clearTimeout(this.nullLowestDeltaTimeout),this.nullLowestDeltaTimeout=setTimeout(()=>this.nullLowestDelta(),200),this.emit(r.DisplayObjectEvent.MOUSE_WHEEL,this.retEvent))}nullLowestDelta(){this.lowestDelta=null}isKeyDown(t){return this.$downKeys.indexOf(t)>=0}isKeyPressed(t){return!!this.$pressedKeys[t]}isKeyReleased(t){return!!this.$releasedKeys[t]}onWindowKeyDown(t){let s=t.which||t.keyCode;this.isKeyDown(s)||(this.$downKeys.push(s),this.$pressedKeys[s]=!0,this.emit("keyPressed",s))}onWindowKeyUp(t){let s=t.which||t.keyCode;if(this.isKeyDown(s)){this.$pressedKeys[s]=!1,this.$releasedKeys[s]=!0;let h=this.$downKeys.indexOf(s);h>=0&&this.$downKeys.splice(h,1),this.emit("keyReleased",s)}}}e.inst=new e,c.DOMEventManager=e})(a=r.utils||(r.utils={}))})(fgui||(fgui={}));(function(r){class a{constructor(){this.scaleMode="showAll",this.orientation="auto",this.resolution=1,this.designWidth=800,this.designHeight=600,this.alignV=4,this.alignH=1,this.fallbackWidth=0,this.fallbackHeight=0,this.initliazeHTMLInput=void 0}}r.DefaultUIStageOptions=a;class c{getRect(h,n,l){let o=h.parentElement;if(!o)throw new Error("Your view of PIXI are still in memory but not appended to DOM yet? it's necessary that there is a parent element to wrap your view up.");let $=o.getBoundingClientRect(),d={x:0,y:0,width:0,height:0};return!$||$.width<=0||$.height<=0?(console.warn("It seems that you did not set a explicit size for the parent element of your view, now fall back to window size instead."),d.width=window.innerWidth,d.height=window.innerHeight,d.x=0,d.y=0):(d.x=$.left,d.y=$.top,d.width=$.width,d.height=$.height),(d.width<=0||d.height<=0)&&(console.warn("fetch container size to initialize PIXI in all ways have failed, now use default size (fallbackWidth / fallbackHeight) specified in the options instead."),d.width=n,d.height=l),d}}class e extends f.utils.EventEmitter{constructor(h,n){super(),this.$width=0,this.$height=0,this.$scaleX=1,this.$scaleY=1,this.$canvasMatrix=new f.Matrix,this.offsetX=0,this.offsetY=0,this.$sizeCalcer=new c,i.push(this),this.$appContext=h,this.$appStage=h.stage,this.$appStage.interactive=!0;let l;if(n instanceof a)l=n;else if(l=new a,n!=null)for(let o in n)l[o]=n[o];if(!l.designWidth||!l.designHeight)throw new Error("Invalid designWidth / designHeight in the parameter 'stageOptions'.");if(this.$options=l,l.initliazeHTMLInput==null||l.initliazeHTMLInput){this.$appContext.view.style.position="absolute";let o=this.$appContext.view.parentElement,$=o.style;o.tagName!="DIV"&&(o=document.createElement("DIV"),$.position="relative",$.left=$.top="0px",$.width=$.height="100%",$.overflow="hidden",this.$appContext.view.parentElement.appendChild(o),o.appendChild(this.$appContext.view));let d;document.defaultView&&document.defaultView.getComputedStyle?d=document.defaultView.getComputedStyle(o).position:d=$.position,(d==""||d=="static")&&(d="relative",o.style.position=d),r.HTMLInput.inst.initialize(o,this.$appContext.view),this.updateScreenSize()}}get orientation(){return this.$options.orientation}get stageWidth(){return this.$width}get stageHeight(){return this.$height}get applicationContext(){return this.$appContext}get nativeStage(){return this.$appStage}get resolution(){return this.$options.resolution}set resolution(h){this.$options.resolution=h,this.updateScreenSize()}get scaleX(){return this.$scaleX}get scaleY(){return this.$scaleY}get designWidth(){return this.$options.designWidth}get designHeight(){return this.$options.designHeight}setDesignSize(h,n){let l=this.$options;l.designWidth=h,l.designHeight=n,this.updateScreenSize()}calculateStageSize(h,n,l,o,$){let d=n,p=l,w=o,C=$,I=n/w||0,m=l/C||0;switch(h){case"exactFit":break;case"fixedHeight":w=Math.round(n/m);break;case"fixedWidth":C=Math.round(l/I);break;case"noBorder":I>m?p=Math.round(C*I):d=Math.round(w*m);break;case"showAll":I>m?d=Math.round(w*m):p=Math.round(C*I);break;case"fixedAuto":d/p<w/C?(m=I,C=Math.round(l/I)):(I=m,w=Math.round(n/m));break;default:w=n,C=l;break}return{stageWidth:w,stageHeight:C,displayWidth:d,displayHeight:p}}updateScreenSize(){if(r.HTMLInput.isTyping)return;let h=this.$appContext.view,n=h.style,l=this.$sizeCalcer.getRect(h,this.$options.fallbackWidth,this.$options.fallbackHeight),o=!1,$=this.$options.orientation;$!="auto"&&(o=$!="portrait"&&l.height>l.width||$=="portrait"&&l.width>l.height);let d=o?l.height:l.width,p=o?l.width:l.height,w=this.calculateStageSize(this.$options.scaleMode,d,p,this.$options.designWidth,this.$options.designHeight),C=w.stageWidth,I=w.stageHeight,m=w.displayWidth,b=w.displayHeight;h.width!==C&&(h.width=C),h.height!==I&&(h.height=I),n.transformOrigin=n.webkitTransformOrigin=n.msTransformOrigin=n.mozTransformOrigin=n.oTransformOrigin="0px 0px 0px",n.width=m+"px",n.height=b+"px",this.$appContext.renderer.resize(C,I);let g=this.$canvasMatrix.identity(),T=o?b:m,u=o?m:b,y,x;this.$options.alignH==0?y=0:this.$options.alignH==2?y=l.width-T:y=(l.width-T)*.5,this.$options.alignV==3?x=0:this.$options.alignV==5?x=l.height-u:x=(l.height-u)*.5;let P=0;o?this.$options.orientation=="landscape"?(g.rotate(Math.PI/2),g.translate(p-y,x),P=90):(g.rotate(-Math.PI/2),g.translate(y,d-x),P=-90):g.translate(y,x),o?(g.tx+=this.offsetY,g.ty+=this.offsetX):(g.tx+=this.offsetX,g.ty+=this.offsetY),g.a=this.formatData(g.a),g.d=this.formatData(g.d),g.tx=this.formatData(g.tx),g.ty=this.formatData(g.ty),n.transformOrigin=n.webkitTransformOrigin=n.msTransformOrigin=n.mozTransformOrigin=n.oTransformOrigin="0px 0px 0px",n.transform=n.webkitTransform=n.msTransform=n.mozTransform=n.oTransform=`matrix(${g.a},${g.b},${g.c},${g.d},${g.tx},${g.ty})`,this.$width=C,this.$height=I,this.$scaleX=C/m,this.$scaleY=I/b;let D=this.$appContext.renderer.plugins.interaction;D.stageRotation=P,D.stageScaleX=this.$scaleX,D.stageScaleY=this.$scaleY,this.$appContext.renderer.resize(C,I),r.HTMLInput.inst.updateSize(m/C,b/I),this.emit(r.DisplayObjectEvent.SIZE_CHANGED,this)}formatData(h){return Math.abs(h)<1e-6?0:Math.abs(1-h)<.001?h>0?1:-1:h}dispose(){let h=i.length;for(;h-->=0;)i[h]===this&&i.splice(h,1)}}r.UIStage=e;let i=[],t=NaN})(fgui||(fgui={}));(function(r){let a=function(e,i){let t=e,s=typeof i=="number"&&!isNaN(i)&&i>0;if(t>=55296&&t<=56319){if(s){let h=(t-55296)*1024+(i-56320)+65536;if(h>=118784&&h<=128895)return 2}}else{if(t>=8448&&t<=10239||t>=11013&&t<=11015||t>=10548&&t<=10549||t>=12951&&t<=12953||t===169||t===174||t===12349||t===12336||t===11093||t===11036||t===11035||t===11088||t===8986)return 1;if(s&&(i===8419||i===65039||i===55356))return 2}return 0};f.TextMetrics.canBreakChars=function(e,i,t,s,h){return a(e.charCodeAt(0),i&&i.charCodeAt(0))!=2},f.TextMetrics.isBreakingSpace=function(e){return typeof e!="string"||e===" "?!1:f.TextMetrics._breakingSpaces.indexOf(e.charCodeAt(0))>=0};class c extends f.Text{constructor(i){super(""),this.$minHeightID=-1,this.$width=0,this.$height=0,this.UIOwner=i,this.interactive=this.interactiveChildren=!1,this.texture.noFrame=!1,this.$width=this.texture.frame.width,this.$height=this.texture.frame.height,this.$minHeight=-1,this.texture.on("update",this.updateFrame,this)}get minHeight(){return this.$minHeight}$updateMinHeight(){(this.style&&this.style.styleID!=this.$minHeightID||this.$minHeight<=0)&&(this.$minHeight=f.TextMetrics.measureText("",this.style,!1).lineHeight,this.$minHeightID=this.style.styleID)}updateFrame(){r.GTimer.inst.callLater(this.internalUpdateFrame,this)}internalUpdateFrame(){if(this.texture){let i=this.texture.frame;this.$height=Math.max(this.$height,this.$minHeight);let t=i.x+this.$width,s=i.y+this.$height;t>this.texture.baseTexture.width&&(t=this.texture.baseTexture.width-i.x),s>this.texture.baseTexture.height&&(s=this.texture.baseTexture.height-i.y),i.width=t/this.resolution,i.height=s/this.resolution,this.texture.trim.width=i.width,this.texture.trim.height=i.height;let h=this.style.trim?0:this.style.padding;this.texture.trim.x=-h,this.texture.trim.y=-h,this.texture.frame=i}}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1}get width(){return this.$width}set width(i){this.$width=i,this.updateFrame()}get height(){return this.$height}set height(i){this.$height=i,this.updateFrame()}get textHeight(){return this.updateText(!0),this.texture.orig.height}set textHeight(i){}get textWidth(){return this.updateText(!0),this.texture.orig.width}set textWidth(i){i!=this.style.wordWrapWidth&&(this.style.wordWrapWidth=i)}}r.UITextField=c})(fgui||(fgui={}));(function(r){class a{}a.XY_CHANGED="__xyChanged",a.SIZE_CHANGED="__sizeChanged",a.VISIBLE_CHANGED="__visibleChanged",a.SIZE_DELAY_CHANGE="__sizeDelayChange",a.MOUSE_WHEEL="__mouseWheel",r.DisplayObjectEvent=a})(fgui||(fgui={}));(function(r){class a{}a.START="__dragStart",a.END="__dragEnd",a.MOVING="__dragMoving",a.DROP="__dragDrop",r.DragEvent=a})(fgui||(fgui={}));(function(r){class a{}a.GEAR_STOP="__gearStop",r.GearEvent=a})(fgui||(fgui={}));(function(r){class a{}a.ItemClick="__itemClick",r.ListEvent=a})(fgui||(fgui={}));(function(r){class a{}a.SCROLL="__scroll",a.SCROLL_END="__scrollEnd",a.PULL_DOWN_RELEASE="__pullDownRelease",a.PULL_UP_RELEASE="__pullUpRelease",r.ScrollEvent=a})(fgui||(fgui={}));(function(r){class a{}a.LinkClick="__linkClick",a.Change="__textChange",a.FocusIn="__textFocusIn",a.FocusOut="__textFocusOut",r.TextEvent=a})(fgui||(fgui={}));(function(r){class a{constructor(e,i){this.packageItem=e,this.type=i}}r.DisplayListItem=a})(fgui||(fgui={}));(function(r){class a{constructor(){this.width=0,this.height=0,this.tiledSlices=0,this.interval=0,this.repeatDelay=0}load(){return this.owner.getItemAsset(this)}toString(){return this.name}}r.PackageItem=a})(fgui||(fgui={}));(function(r){class a{static setPackageItemExtension(e,i){a.packageItemExtensions[e.substring(5)]=i}static setLoaderExtension(e){a.loaderExtension=e}static newObject(e){switch(e.type){case 0:return new r.GImage;case 2:return new r.GMovieClip;case 4:let i=a.packageItemExtensions[e.owner.id+e.id]||a.packageItemExtensions[e.owner.name+"/"+e.name];if(i)return new i;let s=e.owner.getItemAsset(e).attributes.extention;if(s!=null)switch(s){case"Button":return new r.GButton;case"ProgressBar":return new r.GProgressBar;case"Label":return new r.GLabel;case"Slider":return new r.GSlider;case"ScrollBar":return new r.GScrollBar;case"ComboBox":return new r.GComboBox;default:return new r.GComponent}else return new r.GComponent}return null}static newObjectDirectly(e){switch(e){case"image":return new r.GImage;case"movieclip":return new r.GMovieClip;case"component":return new r.GComponent;case"text":return new r.GTextField;case"list":return new r.GList;case"richtext":return new r.GRichTextField;case"inputtext":return new r.GTextInput;case"group":return new r.GGroup;case"graph":return new r.GGraph;case"loader":return a.loaderExtension!=null?new a.loaderExtension:new r.GLoader}return null}}a.packageItemExtensions={},r.UIObjectFactory=a})(fgui||(fgui={}));(function(r){let a=function(){var i=Uint8Array,t=Uint16Array,s=Uint32Array;let h=new i([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),n=new i([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]);var l=new i([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(S,E){for(var v=new t(31),k=0;k<31;++k)v[k]=E+=1<<S[k-1];for(var F=new s(v[30]),k=1;k<30;++k)for(var H=v[k];H<v[k+1];++H)F[H]=H-v[k]<<5|k;return[v,F]},$=o(h,2),d=$[0],p=$[1];d[28]=258,p[258]=28;var w=o(n,0),C=w[0],I=w[1],m=new t(32768);for(y=0;y<32768;++y)b=(y&43690)>>>1|(y&21845)<<1,b=(b&52428)>>>2|(b&13107)<<2,b=(b&61680)>>>4|(b&3855)<<4,m[y]=((b&65280)>>>8|(b&255)<<8)>>>1;var b,y,g=function(S,E,v){for(var k=S.length,F=0,H=new t(E);F<k;++F)S[F]&&++H[S[F]-1];var K=new t(E);for(F=0;F<E;++F)K[F]=K[F-1]+H[F-1]<<1;var N;if(v){N=new t(1<<E);var O=15-E;for(F=0;F<k;++F)if(S[F])for(var z=F<<4|S[F],G=E-S[F],X=K[S[F]-1]++<<G,Z=X|(1<<G)-1;X<=Z;++X)N[m[X]>>>O]=z}else for(N=new t(k),F=0;F<k;++F)S[F]&&(N[F]=m[K[S[F]-1]++]>>>15-S[F]);return N},T=new i(288);for(y=0;y<144;++y)T[y]=8;var y;for(y=144;y<256;++y)T[y]=9;var y;for(y=256;y<280;++y)T[y]=7;var y;for(y=280;y<288;++y)T[y]=8;var y,u=new i(32);for(y=0;y<32;++y)u[y]=5;var y,x=g(T,9,1),P=g(u,5,1),D=function(S){for(var E=S[0],v=1;v<S.length;++v)S[v]>E&&(E=S[v]);return E},M=function(S,E,v){var k=E/8|0;return(S[k]|S[k+1]<<8)>>(E&7)&v},L=function(S,E){var v=E/8|0;return(S[v]|S[v+1]<<8|S[v+2]<<16)>>(E&7)},A=function(S){return(S+7)/8|0},j=function(S,E,v){(E==null||E<0)&&(E=0),(v==null||v>S.length)&&(v=S.length);var k=new(S.BYTES_PER_ELEMENT==2?t:S.BYTES_PER_ELEMENT==4?s:i)(v-E);return k.set(S.subarray(E,v)),k},Q=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"];let R=(S,E,v)=>{let k=new Error(E||Q[S]);if(k.code=S,Error.captureStackTrace&&Error.captureStackTrace(k,R),!v)throw k;return k},rt=(S,E,v)=>{let k=S.length;if(!k||v&&v.f&&!v.l)return E||new i(0);let F=!E||v,H=!v||v.i;v||(v={}),E||(E=new i(k*3));let K=nt=>{let lt=E.length;if(nt>lt){let et=new i(Math.max(lt*2,nt));et.set(E),E=et}},N=v.f||0,O=v.p||0,z=v.b||0,G=v.l,X=v.d,Z=v.m,it=v.n,$t=k*8;do{if(!G){N=M(S,O,1);let J=M(S,O+1,3);if(O+=3,J)if(J==1)G=x,X=P,Z=9,it=5;else if(J==2){let B=M(S,O,31)+257,Y=M(S,O+10,15)+4,U=B+M(S,O+5,31)+1;O+=14;let V=new i(U),q=new i(19);for(let _=0;_<Y;++_)q[l[_]]=M(S,O+_*3,7);O+=Y*3;let st=D(q),tt=(1<<st)-1,at=g(q,st,1);for(let _=0;_<U;){let ft=at[M(S,O,tt)];O+=ft&15;let ht=ft>>>4;if(ht<16)V[_++]=ht;else{let pt=0,ot=0;for(ht==16?(ot=3+M(S,O,3),O+=2,pt=V[_-1]):ht==17?(ot=3+M(S,O,7),O+=3):ht==18&&(ot=11+M(S,O,127),O+=7);ot--;)V[_++]=pt}}let dt=V.subarray(0,B),ut=V.subarray(B);Z=D(dt),it=D(ut),G=g(dt,Z,1),X=g(ut,it,1)}else R(1);else{let B=A(O)+4,Y=S[B-4]|S[B-3]<<8,U=B+Y;if(U>k){H&&R(0);break}F&&K(z+Y),E.set(S.subarray(B,U),z),v.b=z+=Y,v.p=O=U*8,v.f=N;continue}if(O>$t){H&&R(0);break}}F&&K(z+131072);let nt=(1<<Z)-1,lt=(1<<it)-1,et=O;for(;;et=O){let J=G[L(S,O)&nt],B=J>>>4;if(O+=J&15,O>$t){H&&R(0);break}if(J||R(2),B<256)E[z++]=B;else if(B==256){et=O,G=null;break}else{let Y=B-254;if(B>264){let tt=B-257,at=h[tt];Y=M(S,O,(1<<at)-1)+d[tt],O+=at}let U=X[L(S,O)&lt],V=U>>>4;U||R(3),O+=U&15;let q=C[V];if(V>3){let tt=n[V];q+=L(S,O)&(1<<tt)-1,O+=tt}if(O>$t){H&&R(0);break}F&&K(z+131072);let st=z+Y;for(;z<st;z+=4)E[z]=E[z-q],E[z+1]=E[z+1-q],E[z+2]=E[z+2-q],E[z+3]=E[z+3-q];z=st}}v.l=G,v.p=et,v.b=z,v.f=N,G&&(N=1,v.m=Z,v.d=X,v.n=it)}while(!N);return z==E.length?E:j(E,0,z)};var W=new i(0);function gt(S,E){return rt(S,E)}var wt=typeof TextDecoder!="undefined"&&new TextDecoder,mt=0;try{wt.decode(W,{stream:!0}),mt=1}catch(S){}return{inflateSync:gt}}();class c{constructor(t,s,h,n,l){this.atlasName=t,this.frame=s,this.orig=h,this.trim=n,this.rotate=l}}class e{constructor(){this.$items=[],this.$atlasConfigs={}}static getById(t){return e.$packageInstById[t]}static getByName(t){return e.$packageInstByName[t]}static addPackage(t){let s=new e;return s.create(t),e.$packageInstById[s.id]=s,e.$packageInstByName[s.name]=s,s.customId=t,s}static removePackage(t){let s=e.$packageInstById[t];s.dispose(),delete e.$packageInstById[s.id],s.$customId!=null&&delete e.$packageInstById[s.$customId],delete e.$packageInstByName[s.name]}static createObject(t,s,h){let n=e.getByName(t);return n?n.createObject(s,h):null}static createObjectFromURL(t,s){let h=e.getItemByURL(t);return h?h.owner.internalCreateObject(h,s):null}static getItemURL(t,s){let h=e.getByName(t);if(!h)return null;let n=h.$itemsByName[s];return n?`ui://${h.id}${n.id}`:null}static getItemByURL(t){let s=t.indexOf("//");if(s==-1)return null;let h=t.indexOf("/",s+2),n;if(h==-1){if(t.length>13){let l=t.substr(5,8);if(n=e.getById(l),n!=null){let o=t.substr(13);return n.getItemById(o)}}}else{let l=t.substr(s+2,h-s-2);if(n=e.getByName(l),n!=null){let o=t.substr(h+1);return n.getItemByName(o)}}return null}static getBitmapFontByURL(t){return e.$bitmapFonts[t]}static setStringsSource(t){e.$stringsSource={},r.utils.XmlParser.tryParse(t).children.forEach(h=>{if(h.nodeName=="string"){let n=h.attributes.name,l=n.indexOf("-");if(l==-1)return;let o=h.text,$=n.substring(0,l),d=n.substring(l+1),p=e.$stringsSource[$];p||(p={},e.$stringsSource[$]=p),p[d]=o}})}static normalizeURL(t){if(t==null)return null;let s=t.indexOf("//");if(s==-1)return null;let h=t.indexOf("/",s+2);if(h==-1)return t;let n=t.substr(s+2,h-s-2),l=t.substr(h+1);return e.getItemURL(n,l)}create(t){this.$resKey=t;let s=r.utils.Assets.get(this.$resKey);if(s||(s=r.utils.Assets.get(`${this.$resKey}_fui`)),!s)throw new Error(`Resource '${this.$resKey}' not found, please make sure that you use "new fgui.utils.AssetLoader" to load resources instead of " PIXI.loaders.Loader".`);this.decompressPackage(s);let h=this.getResDescriptor("sprites.bytes");h&&h.split(e.sep1).forEach((o,$)=>{if($>=1&&o&&o.length){let d=o.split(e.sep2),p,w=d[0],C=parseInt(d[1]);if(C>=0)p=`atlas${C}`;else{let m=w.indexOf("_");m==-1?p=`atlas_${w}`:p=`atlas_${w.substr(0,m)}`}let I=new c(p);I.frame=new f.Rectangle(parseInt(d[2]),parseInt(d[3]),parseInt(d[4]),parseInt(d[5])),I.rotate=d[6]=="1"?6:0,I.orig=I.rotate!=0?new f.Rectangle(0,0,I.frame.height,I.frame.width):null,this.$atlasConfigs[w]=I}}),h=this.getResDescriptor("package.xml");let n=r.utils.XmlParser.tryParse(h);this.$id=n.attributes.id,this.$name=n.attributes.name;let l=n.children[0].children;this.$itemsById={},this.$itemsByName={},l.forEach(o=>{let $=new r.PackageItem;if($.type=r.ParsePackageItemType(o.nodeName),$.id=o.attributes.id,$.name=o.attributes.name,$.file=o.attributes.file,h=o.attributes.size,h){let d=h.split(e.sep0);$.width=parseInt(d[0]),$.height=parseInt(d[1])}switch($.type){case 0:{if(h=o.attributes.scale,h=="9grid"){if(h=o.attributes.scale9grid,h){let d=h.split(e.sep0),p=new f.Rectangle(parseInt(d[0]),parseInt(d[1]),parseInt(d[2]),parseInt(d[3]));$.scale9Grid=p,h=o.attributes.gridTile,h&&($.tiledSlices=parseInt(h))}}else h=="tile"&&($.scaleByTile=!0);break}}$.owner=this,this.$items.push($),this.$itemsById[$.id]=$,$.name!=null&&(this.$itemsByName[$.name]=$)},this),this.$items.forEach(o=>{o.type==6&&(this.loadFont(o),e.$bitmapFonts[o.bitmapFont.id]=o.bitmapFont)},this)}decompressPackage(t){this.$resData={};var s=a.inflateSync(new Uint8Array(t));let h=r.utils.RawByte.decodeUTF8(s),n=0,l,o;for(;;){let $=h.indexOf("|",n);if($==-1)break;l=h.substring(n,$),n=$+1,$=h.indexOf("|",n),o=parseInt(h.substring(n,$)),n=$+1,this.$resData[l]=h.substr(n,o),n+=o}}dispose(){this.$items.forEach(t=>{let s=t.texture;s!=null?(s.destroy(),f.Texture.removeFromCache(s)):t.frames!=null?t.frames.forEach(n=>{s=n.texture,s&&(s.destroy(),f.Texture.removeFromCache(s))}):t.bitmapFont!=null&&delete e.$bitmapFonts[t.bitmapFont.id];let h=this.$atlasConfigs[t.id];h&&r.utils.Assets.unload(`${this.$resKey}@${h.atlasName}`)},this),r.utils.Assets.unload(`${this.$resKey}`)}get id(){return this.$id}get name(){return this.$name}get customId(){return this.$customId}set customId(t){this.$customId!=null&&delete e.$packageInstById[this.$customId],this.$customId=t,this.$customId!=null&&(e.$packageInstById[this.$customId]=this)}createObject(t,s){let h=this.$itemsByName[t];return h?this.internalCreateObject(h,s):null}internalCreateObject(t,s=null){let h=t.type==4&&s!=null?new s:r.UIObjectFactory.newObject(t);return h==null?null:(e.$constructingObjects++,h.packageItem=t,h.constructFromResource(),e.$constructingObjects--,h)}getItemById(t){return this.$itemsById[t]}getItemByName(t){return this.$itemsByName[t]}getItemAssetByName(t){let s=this.$itemsByName[t];if(s==null)throw new Error(`Resource '${t}' not found`);return this.getItemAsset(s)}createSpriteTexture(t,s){let h=this.$itemsById[s.atlasName];if(h!=null){let n=this.getItemAsset(h);if(!n||!n.baseTexture)return null;s.texCacheID||(s.texCacheID=`${this.$resKey}@${s.atlasName}@${t}`);let l=f.utils.TextureCache[s.texCacheID];return l||(l=new f.Texture(n.baseTexture,s.frame,s.orig,s.trim,s.rotate),f.Texture.addToCache(l,s.texCacheID)),l}else return null}getItemAsset(t){switch(t.type){case 0:if(!t.decoded){t.decoded=!0;let s=this.$atlasConfigs[t.id];s!=null&&(t.texture=this.createSpriteTexture(t.id,s))}return t.texture;case 7:if(!t.decoded){t.decoded=!0;let s=t.file!=null&&t.file.length>0?t.file:`${t.id}.png`,h=`${this.$resKey}@${r.utils.StringUtil.getFileName(s)}`,n=r.utils.Assets.get(h);if(!n)throw new Error(`${h} not found in fgui.utils.AssetLoader.resourcesPool, please use new AssetLoader() to load assets instead of using new PIXI.loaders.Loader(). besides, AssetLoader is a sub-class from PIXI.loaders.Loader so they have the same usage.`);t.texture=n,t.texture||(n=r.utils.Assets.get(`${this.$resKey}@${s.replace(".","_")}`),t.texture=n)}return t.texture;case 3:return t.decoded=!1,null;case 6:return t.decoded||(t.decoded=!0,this.loadFont(t)),t.bitmapFont;case 2:return t.decoded||(t.decoded=!0,this.loadMovieClip(t)),t.frames;case 4:if(!t.decoded){t.decoded=!0;let s=this.getResDescriptor(`${t.id}.xml`),h=r.utils.XmlParser.tryParse(s);t.componentData=h,this.loadComponentChildren(t),this.loadComponentTranslation(t)}return t.componentData;default:return r.utils.Assets.get(`${this.$resKey}@${t.id}`)}}loadComponentChildren(t){let s=t.componentData.getChildNodes("displayList");s!=null&&s.length>0?(t.displayList=[],s[0].children.forEach(h=>{let n=h.nodeName,l,o=h.attributes.src;if(o){let $=h.attributes.pkg,d;$&&$!=t.owner.id?d=e.getById($):d=t.owner;let p=d!=null?d.getItemById(o):null;p!=null?l=new r.DisplayListItem(p,null):l=new r.DisplayListItem(null,n)}else n=="text"&&h.attributes.input=="true"?l=new r.DisplayListItem(null,"inputtext"):l=new r.DisplayListItem(null,n);l.desc=h,t.displayList.push(l)})):t.displayList=[]}getResDescriptor(t){return this.$resData[t]}loadComponentTranslation(t){if(e.$stringsSource==null)return;let s=e.$stringsSource[this.id+t.id];if(s==null)return;let h,n,l,o,$,d;t.displayList.forEach(p=>{n=p.desc,o=n.nodeName,$=n.attributes.id,d=n.attributes.tooltips,d&&(h=s[`${$}-tips`],h!=null&&(n.attributes.tooltips=h));let w=n.getChildNodes("gearText");if(l=w&&w[0],l&&(h=s[`${$}-texts`],h!=null&&(l.attributes.values=h),h=s[`${$}-texts_def`],h!=null&&(l.attributes.default=h)),o=="text"||o=="richtext")h=s[$],h!=null&&(n.attributes.text=h),h=s[`${$}-prompt`],h!=null&&(n.attributes.prompt=h);else if(o=="list")n.children.forEach((C,I)=>{C.nodeName=="item"&&(h=s[`${$}-${I}`],h!=null&&(C.attributes.title=h))});else if(o=="component"){if(w=n.getChildNodes("Button"),l=w&&w[0],l){h=s[$],h!=null&&(l.attributes.title=h),h=s[`${$}-0`],h!=null&&(l.attributes.selectedTitle=h);return}if(w=n.getChildNodes("Label"),l=w&&w[0],l){h=s[$],h!=null&&(l.attributes.title=h);return}if(w=n.getChildNodes("ComboBox"),l=w&&w[0],l){h=s[$],h!=null&&(l.attributes.title=h),l.children.forEach((C,I)=>{C.nodeName=="item"&&(h=s[`${$}-${I}`],h!=null&&(C.attributes.title=h))});return}}})}loadMovieClip(t){let s=r.utils.XmlParser.tryParse(this.getResDescriptor(`${t.id}.xml`)),h;h=s.attributes.interval,h!=null&&(t.interval=parseInt(h)),h=s.attributes.swing,h!=null&&(t.swing=h=="true"),h=s.attributes.repeatDelay,h!=null&&(t.repeatDelay=parseInt(h)),t.frames=[],s.children[0].children.forEach((l,o)=>{let $=new r.Frame;h=l.attributes.rect;let d=h.split(e.sep0),p=new f.Rectangle(parseInt(d[0]),parseInt(d[1]),parseInt(d[2]),parseInt(d[3]));if(h=l.attributes.addDelay,h&&($.addDelay=parseInt(h)),t.frames.push($),p.width<=0)return;h=l.attributes.sprite,h?h=`${t.id}_${h}`:h=`${t.id}_${o}`;let w=this.$atlasConfigs[h];w!=null&&(w.trim=p,$.texture=this.createSpriteTexture(h,w))})}loadFont(t){let s=new r.BitmapFont;s.id=`ui://${this.id}${t.id}`;let h=this.getResDescriptor(`${t.id}.fnt`),n=h.split(e.sep1),l={},o=!1,$=0,d=0,p=!1,w=!1,C=0,I=0,m,b,g=0,T=0;n.forEach(u=>{if(u&&u.length){h=r.utils.StringUtil.trim(u);let y=h.split(e.sep2);if(y.forEach(x=>{let P=x.split(e.sep3);l[P[0]]=P[1]}),h=y[0],h=="char"){let x=new r.BMGlyph;x.x=parseInt(l.x)||0,x.y=parseInt(l.y)||0,x.offsetX=parseInt(l.xoffset)||0,x.offsetY=parseInt(l.yoffset)||0,x.width=parseInt(l.width)||0,x.height=parseInt(l.height)||0,T=Math.max(x.height,T),x.advance=parseInt(l.xadvance)||0,l.chnl!=null&&(x.channel=parseInt(l.chnl),x.channel==15?x.channel=4:x.channel==1?x.channel=3:x.channel==2?x.channel=2:x.channel=1),o?b!=null&&(x.texture=new f.Texture(b.baseTexture,new f.Rectangle(x.x+C,x.y+I,x.width,x.height))):l.img&&(m=this.$itemsById[l.img],m!=null&&(m.load(),x.width=m.width,x.height=m.height,x.texture=m.texture)),o?x.lineHeight=g:(x.advance==0&&(d==0?x.advance=x.offsetX+x.width:x.advance=d),x.lineHeight=x.offsetY<0?x.height:x.offsetY+x.height,$>0&&x.lineHeight<$&&(x.lineHeight=$)),s.glyphs[String.fromCharCode(+l.id|0)]=x}else if(h=="info"){if(o=l.face!=null,l.size&&($=parseInt(l.size)),p=l.resizable=="true",w=l.colored=="true",o){let x=this.$atlasConfigs[t.id];if(x!=null){C=x.frame.x,I=x.frame.y;let P=this.$itemsById[x.atlasName];P!=null&&(b=this.getItemAsset(P))}}}else h=="common"&&(l.lineHeight&&(g=parseInt(l.lineHeight)),$==0?$=g:g==0&&(g=$),l.xadvance&&(d=parseInt(l.xadvance)))}}),$==0&&T>0&&($=T),s.ttf=o,s.size=$,s.resizable=p,s.colorable=w,t.bitmapFont=s}}e.$constructingObjects=0,e.$packageInstById={},e.$packageInstByName={},e.$bitmapFonts={},e.$stringsSource=null,e.sep0=",",e.sep1=`
`,e.sep2=" ",e.sep3="=",r.UIPackage=e})(fgui||(fgui={}));(function(r){var a;(function(c){c.Assets=f.Assets})(a=r.utils||(r.utils={}))})(fgui||(fgui={}));(function(r){var a;(function(c){class e{constructor(t=0,s=0,h=0,n=0){this._raw=[],this.h=0,this.s=0,this.c=0,this.b=0,this.setColor(t,s,h,n)}get hue(){return this.h}get brightness(){return this.b}get contrast(){return this.c}get saturation(){return this.s}setColor(t,s,h,n){return this.reset().adjustColor(t,s,h,n)}reset(){return this.copy(e.IDENTITY_MATRIX)}adjustColor(t,s,h,n){return this.adjustHue(n),this.adjustContrast(s),this.adjustBrightness(t),this.adjustSaturation(h)}adjustBrightness(t){return t==0||isNaN(t)?this:(this.b=t,t=this._cleanValue(t,255),this._multiplyMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0,0,0,0,0,1]),this)}adjustContrast(t){if(t==0||isNaN(t))return this;this.c=t,t=this._cleanValue(t,100);let s,h=1;return t<0?s=h+t/100*h:(s=t%1,s==0?s=e.DELTA_INDEX[t]:s=e.DELTA_INDEX[t<<0]*(1-s)+e.DELTA_INDEX[(t<<0)+1]*s,s=s*h+h),this._multiplyMatrix([s/h,0,0,0,.5*(h-s),0,s/h,0,0,.5*(h-s),0,0,s/h,0,.5*(h-s),0,0,0,1,0,0,0,0,0,1]),this}adjustSaturation(t){if(t==0||isNaN(t))return this;this.s=t,t=this._cleanValue(t,100);let s=1+(t>0?3*t/100:t/100),h=.3086,n=.6094,l=.082;return this._multiplyMatrix([h*(1-s)+s,n*(1-s),l*(1-s),0,0,h*(1-s),n*(1-s)+s,l*(1-s),0,0,h*(1-s),n*(1-s),l*(1-s)+s,0,0,0,0,0,1,0,0,0,0,0,1]),this}adjustHue(t){if(t==0||isNaN(t))return this;this.h=t,t=this._cleanValue(t,180)/180*Math.PI;let s=Math.cos(t),h=Math.sin(t),n=.213,l=.715,o=.072;return this._multiplyMatrix([n+s*(1-n)+h*-n,l+s*-l+h*-l,o+s*-o+h*(1-o),0,0,n+s*-n+h*.143,l+s*(1-l)+h*.14,o+s*-o+h*-.283,0,0,n+s*-n+h*-(1-n),l+s*-l+h*l,o+s*(1-o)+h*o,0,0,0,0,0,1,0,0,0,0,0,1]),this}concat(t){return t=this._fixMatrix(t),t.length!=e.LENGTH?this:(this._multiplyMatrix(t),this)}clone(){return new e().copy(this._raw)}toArray(){let t=[];for(let s=0,h=e.LENGTH;s<h;s++)t[s]=this._raw[s];return t}copy(t){let s=e.LENGTH;for(let h=0;h<s;h++)this._raw[h]=t[h];return this}_multiplyMatrix(t){let s,h,n,l=[];for(s=0;s<5;s++){for(h=0;h<5;h++)l[h]=this._raw[h+s*5];for(h=0;h<5;h++){let o=0;for(n=0;n<5;n++)o+=t[h+n*5]*l[n];this._raw[h+s*5]=o}}}_cleanValue(t,s){return Math.min(s,Math.max(-s,t))}_fixMatrix(t){return t instanceof e&&(t=t.toArray()),t.length<e.LENGTH?t=t.slice(0,t.length).concat(e.IDENTITY_MATRIX.slice(t.length,e.LENGTH)):t.length>e.LENGTH&&(t=t.slice(0,e.LENGTH)),t}}e.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],e.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],e.LENGTH=e.IDENTITY_MATRIX.length,c.ColorMatrix=e})(a=r.utils||(r.utils={}))})(fgui||(fgui={}));(function(r){var a;(function(c){class e{constructor(){this.$agent=new r.GLoader,this.$agent.draggable=!0,this.$agent.touchable=!1,this.$agent.setSize(100,100),this.$agent.setPivot(.5,.5,!0),this.$agent.align="center",this.$agent.verticalAlign=1,this.$agent.sortingOrder=1e6,this.$agent.on(r.DragEvent.END,this.$dragEnd,this)}get dragAgent(){return this.$agent}get isDragging(){return this.$agent.parent!=null}get sourceObject(){return this.$sourceObject}startDrag(t,s,h,n=-1){if(this.isDragging)return;this.$sourceObject=t,this.$sourceData=h,this.$agent.url=s,r.GRoot.inst.addChild(this.$agent);let l=r.GRoot.inst.globalToLocal(r.GRoot.globalMouseStatus.mouseX,r.GRoot.globalMouseStatus.mouseY);this.$agent.setXY(l.x,l.y),this.$agent.startDrag(n)}cancel(){this.$agent.parent!=null&&(this.$agent.stopDrag(),r.GRoot.inst.removeChild(this.$agent),this.$sourceData=null)}$dragEnd(t){if(!this.isDragging)return;r.GRoot.inst.removeChild(this.$agent);let s=this.$sourceData;this.$sourceData=null;let h=r.GRoot.inst.getObjectUnderPoint(t.data.global.x,t.data.global.y);for(;h!=null;){if(h.hasListener(r.DragEvent.DROP)){h.requestFocus(),t.currentTarget=h.displayObject,h.emit(r.DragEvent.DROP,t,s);return}h=h.parent}}}c.DragIndicator=e})(a=r.utils||(r.utils={}))})(fgui||(fgui={}));(function(r){var a;(function(c){class e{constructor(){this.left=0,this.right=0,this.top=0,this.bottom=0}parse(t){if(!t){this.left=this.right=this.top=this.bottom=0;return}let s=t.split(",");if(s.length==1){let h=parseInt(s[0]);this.left=this.right=this.top=this.bottom=h}else this.top=parseInt(s[0]),this.bottom=parseInt(s[1]),this.left=parseInt(s[2]),this.right=parseInt(s[3])}copy(t){this.top=t.top,this.bottom=t.bottom,this.left=t.left,this.right=t.right}}c.Margin=e})(a=r.utils||(r.utils={}))})(fgui||(fgui={}));(function(r){var a;(function(c){class e{static inRange(t,s,h){return s<=t&&t<=h}static decodeUTF8(t){let s=0,h="",n,l=0,o=0,$=0,d=0;for(;t.length>s;){let p=t[s++];if(p==-1)o!=0?n=65533:n=-1;else if(o==0)e.inRange(p,0,127)?n=p:(e.inRange(p,194,223)?(o=1,d=128,l=p-192):e.inRange(p,224,239)?(o=2,d=2048,l=p-224):e.inRange(p,240,244)&&(o=3,d=65536,l=p-240),l=l*Math.pow(64,o),n=null);else if(!e.inRange(p,128,191))l=0,o=0,$=0,d=0,s--,n=65533;else if($+=1,l=l+(p-128)*Math.pow(64,o-$),$!==o)n=null;else{let w=l,C=d;l=0,o=0,$=0,d=0,e.inRange(w,C,1114111)&&!this.inRange(w,55296,57343)?n=w:n=p}n!==null&&n!==-1&&(n<=65535?n>0&&(h+=String.fromCharCode(n)):(n-=65536,h+=String.fromCharCode(55296+(n>>10&1023)),h+=String.fromCharCode(56320+(n&1023))))}return h}}c.RawByte=e})(a=r.utils||(r.utils={}))})(fgui||(fgui={}));(function(r){var a;(function(c){class e{constructor(){this.$readPos=0,this.smallFontSize=12,this.normalFontSize=14,this.largeFontSize=16,this.defaultImgWidth=0,this.defaultImgHeight=0,this.$handlers={url:this.onTag_URL,img:this.onTag_IMG,b:this.onTag_Simple,i:this.onTag_Simple,u:this.onTag_Simple,sup:this.onTag_Simple,sub:this.onTag_Simple,color:this.onTag_COLOR,font:this.onTag_FONT,size:this.onTag_SIZE}}onTag_URL(t,s,h){return s?"</a>":h!=null?`<a href="${h}" target="_blank">`:`<a href="${this.getTagText()}" target="_blank">`}onTag_IMG(t,s,h){if(s)return null;{let n=this.getTagText(!0);return n?this.defaultImgWidth?`<img src="${n}" width="${this.defaultImgWidth}" height="${this.defaultImgHeight}"/>`:`<img src="${n}"/>`:null}}onTag_Simple(t,s,h){return s?`</${t}>`:`<${t}>`}onTag_COLOR(t,s,h){return s?"</font>":`<font color="${h}">`}onTag_FONT(t,s,h){return s?"</font>":`<font face="${h}">`}onTag_SIZE(t,s,h){return s?"</font>":(h=="normal"?h=`${this.normalFontSize}`:h=="small"?h=`${this.smallFontSize}`:h=="large"?h=`${this.largeFontSize}`:h.length&&h.charAt(0)=="+"?h=`${this.smallFontSize+parseInt(h.substr(1))}`:h.length&&h.charAt(0)=="-"&&(h=`${this.smallFontSize-parseInt(h.substr(1))}`),`<font size="${h}">`)}getTagText(t=!1){let s=this.$text.indexOf("[",this.$readPos);if(s==-1)return null;let h=this.$text.substring(this.$readPos,s);return t&&(this.$readPos=s),h}parseStyle(t){return[]}}e.inst=new e,c.UBBParser=e})(a=r.utils||(r.utils={}))})(fgui||(fgui={}))});Ct();})();
