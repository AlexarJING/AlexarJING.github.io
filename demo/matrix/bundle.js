(()=>{var _o=Object.create;var Xi=Object.defineProperty;var ko=Object.getOwnPropertyDescriptor;var Ro=Object.getOwnPropertyNames;var Mo=Object.getPrototypeOf,Uo=Object.prototype.hasOwnProperty;var Kt=(r,i)=>()=>(i||r((i={exports:{}}).exports,i),i.exports);var To=(r,i,t,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let o of Ro(i))!Uo.call(r,o)&&o!==t&&Xi(r,o,{get:()=>i[o],enumerable:!(e=ko(i,o))||e.enumerable});return r};var si=(r,i,t)=>(t=r!=null?_o(Mo(r)):{},To(i||!r||!r.__esModule?Xi(t,"default",{value:r,enumerable:!0}):t,r));var Yi=(r,i,t)=>{if(!i.has(r))throw TypeError("Cannot "+t)};var T=(r,i,t)=>(Yi(r,i,"read from private field"),t?t.call(r):i.get(r)),Zt=(r,i,t)=>{if(i.has(r))throw TypeError("Cannot add the same private member more than once");i instanceof WeakSet?i.add(r):i.set(r,t)},ce=(r,i,t,e)=>(Yi(r,i,"write to private field"),e?e.call(r,t):i.set(r,t),t);var m=(r,i,t)=>new Promise((e,o)=>{var s=n=>{try{h(t.next(n))}catch(c){o(c)}},l=n=>{try{h(t.throw(n))}catch(c){o(c)}},h=n=>n.done?e(n.value):Promise.resolve(n.value).then(s,l);h((t=t.apply(r,i)).next())});var ci=Kt((Gh,hi)=>{(function r(i,t,e){var o=function(n){return Object.prototype.toString.call(n)==="[object Array]"},s=function(n){return n!==e};function l(n,c){if(!(this instanceof l))return new l(n,c);o(n)?(c=n[1],n=n[0]):typeof n=="object"&&n&&(c=n.y,n=n.x),this.x=l.clean(n||0),this.y=l.clean(c||0)}l.prototype={change:function(n){if(typeof n=="function")this.observers?this.observers.push(n):this.observers=[n];else if(this.observers&&this.observers.length)for(var c=this.observers.length-1;c>=0;c--)this.observers[c](this,n);return this},ignore:function(n){if(this.observers)if(!n)this.observers=[];else for(var c=this.observers,d=c.length;d--;)c[d]===n&&c.splice(d,1);return this},set:function(n,c,d){if(typeof n!="number"&&(d=c,c=n.y,n=n.x),this.x===n&&this.y===c)return this;var g=null;if(d!==!1&&this.observers&&this.observers.length&&(g=this.clone()),this.x=l.clean(n),this.y=l.clean(c),d!==!1)return this.change(g)},zero:function(){return this.set(0,0)},clone:function(){return new this.constructor(this.x,this.y)},negate:function(n){return n?new this.constructor(-this.x,-this.y):this.set(-this.x,-this.y)},add:function(n,c,d){return typeof n!="number"&&(d=c,o(n)?(c=n[1],n=n[0]):(c=n.y,n=n.x)),n+=this.x,c+=this.y,d?new this.constructor(n,c):this.set(n,c)},subtract:function(n,c,d){return typeof n!="number"&&(d=c,o(n)?(c=n[1],n=n[0]):(c=n.y,n=n.x)),n=this.x-n,c=this.y-c,d?new this.constructor(n,c):this.set(n,c)},multiply:function(n,c,d){return typeof n!="number"?(d=c,o(n)?(c=n[1],n=n[0]):(c=n.y,n=n.x)):typeof c!="number"&&(d=c,c=n),n*=this.x,c*=this.y,d?new this.constructor(n,c):this.set(n,c)},rotate:function(n,c,d){var g=this.x,I=this.y,_=Math.cos(n),v=Math.sin(n),C,he;return c=c?-1:1,C=_*g-c*v*I,he=c*v*g+_*I,d?new this.constructor(C,he):this.set(C,he)},length:function(){var n=this.x,c=this.y;return Math.sqrt(n*n+c*c)},lengthSquared:function(){var n=this.x,c=this.y;return n*n+c*c},distance:function(n){var c=this.x-n.x,d=this.y-n.y;return Math.sqrt(c*c+d*d)},nearest:function(n){for(var c=Number.MAX_VALUE,d=null,g,I=n.length-1;I>=0;I--)g=this.distance(n[I]),g<=c&&(c=g,d=n[I]);return d},normalize:function(n){var c=this.length(),d=c<Number.MIN_VALUE?0:1/c;return n?new this.constructor(this.x*d,this.y*d):this.set(this.x*d,this.y*d)},equal:function(n,c){return typeof n!="number"&&(o(n)?(c=n[1],n=n[0]):(c=n.y,n=n.x)),l.clean(n)===this.x&&l.clean(c)===this.y},abs:function(n){var c=Math.abs(this.x),d=Math.abs(this.y);return n?new this.constructor(c,d):this.set(c,d)},min:function(n,c){var d=this.x,g=this.y,I=n.x,_=n.y,v=d<I?d:I,C=g<_?g:_;return c?new this.constructor(v,C):this.set(v,C)},max:function(n,c){var d=this.x,g=this.y,I=n.x,_=n.y,v=d>I?d:I,C=g>_?g:_;return c?new this.constructor(v,C):this.set(v,C)},clamp:function(n,c,d){var g=this.min(c,!0).max(n);return d?g:this.set(g.x,g.y)},lerp:function(n,c,d){return this.add(n.subtract(this,!0).multiply(c),d)},skew:function(n){return n?new this.constructor(-this.y,this.x):this.set(-this.y,this.x)},dot:function(n){return l.clean(this.x*n.x+n.y*this.y)},perpDot:function(n){return l.clean(this.x*n.y-this.y*n.x)},angleTo:function(n){return Math.atan2(this.perpDot(n),this.dot(n))},divide:function(n,c,d){if(typeof n!="number"?(d=c,o(n)?(c=n[1],n=n[0]):(c=n.y,n=n.x)):typeof c!="number"&&(d=c,c=n),n===0||c===0)throw new Error("division by zero");if(isNaN(n)||isNaN(c))throw new Error("NaN detected");return d?new this.constructor(this.x/n,this.y/c):this.set(this.x/n,this.y/c)},isPointOnLine:function(n,c){return(n.y-this.y)*(n.x-c.x)===(n.y-c.y)*(n.x-this.x)},toArray:function(){return[this.x,this.y]},fromArray:function(n){return this.set(n[0],n[1])},toJSON:function(){return{x:this.x,y:this.y}},toString:function(){return"("+this.x+", "+this.y+")"},constructor:l},l.fromArray=function(n,c){return new(c||l)(n[0],n[1])},l.precision=t||8;var h=Math.pow(10,l.precision);return l.clean=i||function(n){if(isNaN(n))throw new Error("NaN detected");if(!isFinite(n))throw new Error("Infinity detected");return Math.round(n)===n?n:Math.round(n*h)/h},l.inject=r,i||(l.fast=r(function(n){return n}),typeof hi!="undefined"&&typeof hi.exports=="object"?hi.exports=l:window.Vec2=window.Vec2||l),l})()});var Oi=Kt((ic,mo)=>{"use strict";var Di=class{constructor(){this._data=[]}get root(){return this._data[0]}get size(){return this._data.length}_compare(i,t){let[e,o]=[this._data[i],this._data[t]];return e.key>o.key?1:e.key<o.key?-1:0}_swap(i,t){[this._data[i],this._data[t]]=[this._data[t],this._data[i]]}children(i){let t={},e=this.childIndices(i);return Object.keys(e).forEach(o=>{t[o]=this.node(e[o])}),t}childIndices(i){let t={},e=this.leftIndex(i),o=this.rightIndex(i);return e<this.size&&(t.left=e),o<this.size&&(t.right=o),t}clear(){return this._data=[],this}degree(i){return Object.keys(this.children(i)).length}fullNodes(){let i=[];return this._data.forEach((t,e)=>{this.isFullNode(e)&&i.push(t)}),i}height(){return Math.ceil(Math.log2(this.size+1))-1}includes(i){for(let t of this._data)if(t.key===i)return!0;return!1}indexOf(i){let t=0;for(let e of this._data){if(e.key===i)return t;t+=1}return-1}internalNodes(){let i=[];return this._data.forEach((t,e)=>{this.isInternalNode(e)&&i.push(t)}),i}isEmpty(){return this._data.length===0}isFullNode(i){return this.left(i)!==void 0&&this.right(i)!==void 0}isInternalNode(i){return this.left(i)!==void 0||this.right(i)!==void 0}isLeafNode(i){return!this.left(i)&&!this.right(i)}isPartialNode(i){return this.degree(i)===1}keys(){let i=[];return this._data.forEach(t=>i.push(t.key)),i}leafNodes(){let i=[];return this._data.forEach((t,e)=>{this.isLeafNode(e)&&i.push(t)}),i}left(i){return this._data[this.leftIndex(i)]}leftIndex(i){return 2*i+1}levelOrder(i){return this._data.forEach(t=>i(t)),this}maxChild(i){return this._data[this.maxChildIndex(i)]}maxChildIndex(i){let{left:t,right:e}=this.childIndices(i);return t?e&&this._compare(e,t)>0?e:t:-1}minChild(i){return this._data[this.minChildIndex(i)]}minChildIndex(i){let{left:t,right:e}=this.childIndices(i);return t?e&&this._compare(t,e)>0?e:t:-1}node(i){return this._data[i]}parent(i){return this._data[this.parentIndex(i)]}parentIndex(i){return Math.floor((i-1)/2)}partialNodes(){let i=[];return this._data.forEach((t,e)=>{this.isPartialNode(e)&&i.push(t)}),i}right(i){return this._data[this.rightIndex(i)]}rightIndex(i){return 2*i+2}search(i){for(let t of this._data)if(t.key===i)return t}toArray(){let i=[];return this._data.forEach(t=>i.push(t)),i}toPairs(){let i=[];return this._data.forEach(t=>i.push(t.toPair())),i}update(i,t){let e=this.indexOf(i);return e>=0&&(this._data[e].value=t),this}values(){let i=[];return this._data.forEach(t=>i.push(t.value)),i}};mo.exports=Di});var pi=Kt((oc,uo)=>{"use strict";var Fi=class{constructor(i,t){this._key=i,this._value=t}get key(){return this._key}get value(){return this._value}set value(i){this._value=i}toPair(){return[this.key,this.value]}};uo.exports=Fi});var fo=Kt((sc,po)=>{"use strict";var Po=Oi(),No=pi(),zi=class extends Po{_isMaxOrdered(i){let t=this.childIndices(i);for(let e in t)if(this._compare(i,t[e])<0)return!1;return!0}extract(i){let t=this._data[i];return this.remove(i),t}extractMax(){return this.extract(0)}insert(i,t){let e=new No(i,t);this._data.push(e);let o=this.size-1,s=this.parentIndex(o);for(;s>=0&&this._compare(o,s)>0;)this._swap(o,s),o=s,s=this.parentIndex(o);return this}remove(i){if(i>=0&&i<this.size)if(i===this.size-1)this._data.pop();else{let t=i;for(this._data[t]=this._data.pop();!this._isMaxOrdered(t);){let e=this.maxChildIndex(t);this._swap(t,e),t=e}}return this}};po.exports=zi});var wo=Kt((rc,go)=>{"use strict";var Ao=Oi(),Bo=pi(),Wi=class extends Ao{_isMinOrdered(i){let t=this.childIndices(i);for(let e in t)if(this._compare(i,t[e])>0)return!1;return!0}extract(i){let t=this._data[i];return this.remove(i),t}extractMin(){return this.extract(0)}insert(i,t){let e=new Bo(i,t);this._data.push(e);let o=this.size-1,s=this.parentIndex(o);for(;s>=0&&this._compare(o,s)<0;)this._swap(o,s),o=s,s=this.parentIndex(o);return this}remove(i){if(i>=0&&i<this.size)if(i===this.size-1)this._data.pop();else{let t=i;for(this._data[t]=this._data.pop();!this._isMinOrdered(t);){let e=this.minChildIndex(t);this._swap(t,e),t=e}}return this}};go.exports=Wi});var bo=Kt((nc,vo)=>{"use strict";var Vo=fo(),jo=wo(),Do=pi();vo.exports=Object.assign({},{MaxHeap:Vo},{MinHeap:jo},{Node:Do})});function Ti(r,i){let t=r.indexOf(i);if(t!=-1)return r.splice(t,1),Ti(r,i)}var tt=class{constructor(i){this.all=new Map;this.sender=i}on(i,t){let e=this.all.get(i);return e&&e.push(t)||this.all.set(i,[t]),t}off(i,t){let e=this.all.get(i);e&&(t?e.splice(e.indexOf(t)>>>0,1):e.length=0)}emit(i,...t){(this.all.get(i)||[]).slice().map(e=>{e(...t)})}dispose(){this.all.clear()}};var qi=1,me=class{constructor(){this.ev=new tt(this);this.id=qi,qi+=1}get game(){return a.inst}},u=class extends me{constructor(){super(...arguments);this._updateHandler=null;this._delayAndIntervals=new Set;this.components=[];this.tags={};this.disposed=!1}enableUpdate(){this.game&&(this._updateHandler=this.update.bind(this),this.game.ev.on("update",this._updateHandler))}disableUpdate(){this.game&&this.game.ev.off("update",this._updateHandler)}init(){}dispose(){if(this.disposed){console.error("\u91CD\u590D\u5220\u9664\u4E00\u4E2A\u5BF9\u8C61");debugger;return}this.ev.emit("dispose"),this.disposed=!0,this._updateHandler&&this.game.ev.off("update",this._updateHandler);for(let t of this._delayAndIntervals)this.game.task.cancel(t);this.components.forEach(t=>{t.dispose()}),this.components=null,this.tags=null}$nextTick(t){this.game.$nextTick(t)}$delay(t,e=null){let o=this.game.task.delay(t,()=>{this._delayAndIntervals.delete(o),e&&e()});return this._delayAndIntervals.add(o),o}$interval(t=null,e=10){let o=this.game.task.interval(e,t);return this._delayAndIntervals.add(o),o}$wait(t,e,o=10,s=-1){return new Promise((l,h)=>{let n=()=>{t()&&(this.$stop(c),e&&e(),l())},c=this.game.task.interval(o,n);s>0&&this.game.task.delay(s,()=>{this.$stop(c),h("time out")})})}$until(t){return new Promise(e=>{let o=(...s)=>{e(s),this.ev.off(t,o)};this.ev.on(t,o)})}$stop(t){this.game.task.cancel(t)}update(t){for(let e of this.components)e.enabled&&e.update(t)}addComponentSync(t,e){return m(this,null,function*(){let o=new t;return e=e||o.tag,this.tags[e]&&console.warn("\u5C1D\u8BD5\u8986\u76D6\u4E00\u4E2A\u6807\u7B7E",e,o),o.tag=e,this.tags[e]=o,this.components.push(o),o.bind(this)})}addComponent(t,e){let o=new t;return e=e||o.tag,this.tags[e]&&console.warn("\u5C1D\u8BD5\u8986\u76D6\u4E00\u4E2A\u6807\u7B7E",e,o),o.tag=e,this.tags[e]=o,this.components.push(o),o.bind(this),o}removeComponent(t){Ti(this.components,t),delete this.tags[t.tag],t.enabled=!1,t.dispose()}};var w=class extends u{init(){}start(){}};var ri=class{};var et=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","DialogToast")}onConstruct(){this.m_frame=this.getChildAt(0),this.m_text=this.getChildAt(1)}};et.URL="ui://j8b2cwkbxatjb4";var M=class extends fgui.Window{constructor(t){super();this.ev=new tt(this);this.viewCls=t}get view(){return this.contentPane}onInit(){this.contentPane=this.viewCls.createInstance(),super.onInit(),this.ev.emit("init")}onShown(){super.center(),super.onShown(),this.ev.emit("show")}onHide(){var t;super.onHide(),this.ev.emit("hide"),this.waiter&&(this.waiter((t=this.extra)==null?void 0:t.resolve),this.waiter=null)}static _create(){let t=this.windowCache.get(this);return t||(t=new this,this.windowCache.set(this,t)),t}static hide(){this._create().hide()}static show(t={modal:!0,extra:{},title:null}){let e=this._create();e.modal=t.modal!==!1,e.extra=t.extra||{},e.style=t.style,e.show();let o=()=>{e.view||setTimeout(()=>{o()},100),t.title&&(e.view.m_frame.title=t.title,e.view.m_frame.width+=1),t.text&&e.view.getChild("text")&&(e.view.getChild("text").text=t.text)};return o(),e}setAsFullScreen(){this.width=fgui.GRoot.inst.width,this.height=fgui.GRoot.inst.height}static showAndWait(t={modal:!0,extra:null,title:null}){return new Promise(e=>{let o=this.show(t);o.waiter=e})}};M.windowCache=new Map;var K=class extends M{constructor(){super(et)}onShown(){super.onShown(),a.inst.task.$delay(this.extra.delay||2e3,()=>this.hide())}};var Gi=class extends u{constructor(){super(...arguments);this.state="init"}static createInstance(){this._inst=new Gi}static loadInst(){this._inst.ev.on("error",t=>{console.log("\u7531\u4E8E\u62A5\u9519\u91CD\u65B0\u5EFA\u7ACB\u5E7F\u544A\u5B9E\u4F8B",t),this._inst.dispose(),this._inst=null,this.reloadTry-=1}),this._inst.ev.on("finish",()=>{console.log("\u5E7F\u544A\u64AD\u653E\u5B8C\u6BD5"),this._inst.dispose(),this._inst=null,this.reloadTry=5});try{this._inst.load()}catch(t){console.error("\u521B\u5EFA\u5E7F\u544A\u5931\u8D25",t),this._inst.dispose(),this._inst=null}}static get inst(){if(!this._inst&&this.canReload&&this.reloadTry>0)try{this.createInstance(),this.loadInst(),this.canReload=!1,a.inst.task.delay(this.reloadCD,()=>this.canReload=!0),console.log("\u521B\u5EFA\u4E86\u5E7F\u544A\u5B9E\u4F8B",this._inst)}catch(t){this.canReload=!0,this.reloadTry-=1,console.log("\u521B\u5EFA\u5E7F\u544A\u5931\u8D25",t)}return this._inst}static show(){var t;return console.log("\u5C1D\u8BD5\u64AD\u653E\u5E7F\u544A"),(t=this.inst)==null?void 0:t.show()}static pay(){return m(this,null,function*(){var e;let t=yield(e=this.inst)==null?void 0:e.pay();return t==0&&K.show({text:"\u9700\u8981\u770B\u5B8C\u89C6\u9891\u624D\u80FD\u83B7\u5F97\u5956\u52B1\u54E6\uFF01"}),t})}static hide(){var t;return(t=this.inst)==null?void 0:t.hide()}static dispose(){var t;return(t=this.inst)==null?void 0:t.dispose()}load(){}show(){return m(this,null,function*(){})}hide(){return m(this,null,function*(){})}pay(){return m(this,null,function*(){})}dispose(){}},W=Gi;W.reloadCD=30,W.canReload=!0,W.reloadTry=5;var Jt=class extends W{constructor(){super(...arguments);this.type="banner";this.slotID="cd2ab7n6k7o8cjlli5";this.ctor=globalThis.dom.createBannerAd}static createInstance(){this._inst=new Jt}load(){this.native=this.ctor({adUnitId:this.slotID,adIntervals:120,style:{width:200}}),this.state="loading",this.native.onLoad(()=>{this.state="ready",console.log("\u5E7F\u544A\u52A0\u8F7D\u5B8C\u6BD5")}),this.native.onError(t=>{this.state="error",this.ev.emit("error",t),console.error("\u64AD\u653E\u5E95\u90E8\u5E7F\u544A\u9519\u8BEF",t)}),this.native.onResize(t=>{console.log("\u91CD\u65B0\u5B9A\u4F4D\u5E7F\u544A")})}show(){return m(this,null,function*(){this.state!="show"&&(yield this.$wait(()=>this.state=="ready"||this.state=="hide"),console.log("banner\u5E7F\u544A\u5DF2\u64AD\u653E"))})}hide(){return m(this,null,function*(){this.state!="hide"&&(yield this.$wait(()=>this.state=="show"),this.native.hide(),this.state="hide")})}dispose(){var t;this.state="destroyed",(t=this.native)==null||t.destroy(),super.dispose()}};var Qt=class extends W{constructor(){super(...arguments);this.type="interstitial";this.slotID="92c2hb281lf438h003";this.ctor=globalThis.dom.createInterstitialAd}static createInstance(){this._inst=new Qt}load(){this.native=this.ctor({adUnitId:this.slotID}),this.state="loading",this.native.onLoad(()=>{this.state="ready"}),this.native.onError(t=>{this.state="error",this.ev.emit("error",t)}),this.native.onClose(()=>{this.ev.emit("finish",1)})}show(){return m(this,null,function*(){this.state!="show"&&(yield this.$wait(()=>this.state=="ready"),yield this.native.show(),this.ev.emit("show"))})}dispose(){var t;this.state="destroyed",(t=this.native)==null||t.destroy(),super.dispose()}};var te=class extends W{constructor(){super(...arguments);this.type="video";this.slotID="9brmrdpntr4i7ajg5f";this.count=0;this.ctor=globalThis.dom.createRewardedVideoAd}static createInstance(){this._inst=new te}load(){this.native=this.ctor({adUnitId:this.slotID,multiton:this.count>0,multitonRewardTimes:this.count,multitonRewardMsg:["\u66F4\u591A\u5956\u52B1"]}),this.state="loading",this.native.onLoad(()=>{this.state="ready",console.log("\u89C6\u9891\u5E7F\u544A\u52A0\u8F7D\u5B8C\u6BD5")}),this.native.onError(t=>{this.state="error",this.ev.emit("error",t),console.log("\u89C6\u9891\u5E7F\u544A\u64AD\u653E\u5931\u8D25")}),this.native.onClose(t=>{!t.isEnded&&!t.count&&(t.count=0),this.ev.emit("finish",t.count)}),this.native.load()}show(){return m(this,null,function*(){this.state!="show"&&(yield this.$wait(()=>this.state=="ready"),yield this.native.show(),this.state="show",this.ev.emit("show"))})}pay(){return m(this,null,function*(){return this.show(),new Promise((t,e)=>{this.ev.on("finish",o=>{t(o)}),this.ev.on("error",o=>{console.log("\u652F\u4ED8\u89C6\u9891\u51FA\u9519"),t(0)})})})}dispose(){var t;this.state="destroyed",(t=this.native)==null||t.destroy(),super.dispose()}};var de=class extends w{constructor(){super(...arguments);this.banner=Jt;this.interstitial=Qt;this.video=te}};var ue=class extends w{init(){super.init()}start(){super.start()}loadSpine(){return m(this,null,function*(){})}getSpine(i){return PIXI.Assets.load(`assets/spine/${i}/skeleton.json`)}};var fe=class{constructor(i,t,e){this.ctor=i;this.dtor=t;this.size=e;this.stack=[]}fill(){for(let i=this.stack.length;i<this.size;i++)this.produce()}return(i){this.stack.includes(i)&&console.error("\u8BD5\u56FE\u5F52\u8FD8\u4E00\u4E2A\u5DF2\u5B58\u5728\u7684\u5BF9\u8C61",i),this.stack.length<this.size?this.stack.push(i):this.dtor(i)}produce(){let i=this.ctor();return this.stack.push(i),i}fetch(){return this.stack.length==0&&this.produce(),this.stack.pop()}remove(i){let t=this.stack.indexOf(i);t==-1||this.stack.splice(t,1)}clear(){this.stack.length=0}},pe=class extends u{static _createContext(){}static _createBuffer(){this._buffer||(this._buffer=new this.ItemBuffer(pe.createInstance,pe.destroy,pe.count))}static updateVolume(){this.actives.forEach(t=>t.context.volume=this.volume*a.inst.sound.volume[this.tag])}static play(){this._createBuffer();let t=this._buffer.fetch();return t.context.volume=this.volume*a.inst.sound.volume[this.tag],t.context.play(),this.actives.push(t),t}static pause(t){}static stop(t){}static destroy(t){}},Z=pe;Z.volume=1,Z.count=1,Z.autoplay=!0,Z.loop=!1,Z.isBGM=!1,Z.preload=!1,Z.ItemBuffer=fe,Z.actives=[];var z=class extends u{static _createContext(t){let e=new Audio(t);return document.getElementById("root").appendChild(e),e}static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(z.createInstance.bind(z),z.destroy.bind(z),z.count))}static _bindStopEvent(t){t.context.onended=()=>{this._buffer.return(t)}}static createInstance(){let t=new z,e=z._createContext();return t.context=e,e.src=z.path,e.autoplay=z.autoplay,e.loop=z.loop,e.volume=z.volume,this._bindStopEvent(t),t}static updateVolume(){!this.actives||this.actives.forEach(t=>t.context.volume=this.volume*a.inst.sound.volume[this.tag])}static play(){this._createBuffer();let t=this._buffer.fetch();return t.context.volume=this.volume*a.inst.sound.volume[this.tag],t.context.play(),this.actives.push(t),t}static pause(t){t?t.context.pause():this.actives.forEach(e=>e.context.pause())}static stop(t){t?this.actives=this.actives.filter(e=>t!=e):(t.context.pause(),this.actives.forEach(e=>e.context.pause()),this.actives=[])}static destroy(t){if(t){try{document.getElementById("root").removeChild(t.context)}catch(e){console.warn("\u91CD\u590D\u79FB\u9664\u4E00\u4E2A\u5BF9\u8C61",t)}this.actives=this.actives.filter(e=>t!=e),this._buffer.remove(t)}else{try{this.actives.forEach(e=>document.getElementById("root").removeChild(e.context))}catch(e){}this.actives=[],this._buffer.clear()}}},p=z;p.tag="fx",p.volume=1,p.count=1,p.autoplay=!0,p.loop=!1,p.isBGM=!1,p.preload=!1,p.ItemBuffer=fe;var G=class extends p{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(G.createInstance.bind(G),G.destroy.bind(G),G.count))}static createInstance(){let i=new G,t=G._createContext();return i.context=t,t.src=G.path,t.autoplay=G.autoplay,t.loop=G.loop,t.volume=G.volume,G._bindStopEvent(i),i}},Ut=G;Ut.path="assets/sound/Button.mp3",Ut.tag="fx",Ut.loop=!1;var E=class extends p{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(E.createInstance.bind(E),E.destroy.bind(E),E.count))}static createInstance(){let i=new E,t=E._createContext();return i.context=t,t.src=E.path,t.autoplay=E.autoplay,t.loop=E.loop,t.volume=E.volume,E._bindStopEvent(i),i}},Tt=E;Tt.path="assets/sound/Dead.mp3",Tt.tag="fx",Tt.loop=!1;var L=class extends p{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(L.createInstance.bind(L),L.destroy.bind(L),L.count))}static createInstance(){let i=new L,t=L._createContext();return i.context=t,t.src=L.path,t.autoplay=L.autoplay,t.loop=L.loop,t.volume=L.volume,L._bindStopEvent(i),i}},Gt=L;Gt.path="assets/sound/Hint.mp3",Gt.tag="fx",Gt.loop=!1;var S=class extends p{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(S.createInstance.bind(S),S.destroy.bind(S),S.count))}static createInstance(){let i=new S,t=S._createContext();return i.context=t,t.src=S.path,t.autoplay=S.autoplay,t.loop=S.loop,t.volume=S.volume,S._bindStopEvent(i),i}},it=S;it.path="assets/sound/Lose.mp3",it.tag="fx",it.loop=!1;var P=class extends p{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(P.createInstance.bind(P),P.destroy.bind(P),P.count))}static createInstance(){let i=new P,t=P._createContext();return i.context=t,t.src=P.path,t.autoplay=P.autoplay,t.loop=P.loop,t.volume=P.volume,P._bindStopEvent(i),i}},Et=P;Et.path="assets/sound/Moving.mp3",Et.tag="fx",Et.loop=!1;var N=class extends p{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(N.createInstance.bind(N),N.destroy.bind(N),N.count))}static createInstance(){let i=new N,t=N._createContext();return i.context=t,t.src=N.path,t.autoplay=N.autoplay,t.loop=N.loop,t.volume=N.volume,N._bindStopEvent(i),i}},H=N;H.path="assets/sound/Music1.mp3",H.tag="bgm",H.loop=!0;var A=class extends p{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(A.createInstance.bind(A),A.destroy.bind(A),A.count))}static createInstance(){let i=new A,t=A._createContext();return i.context=t,t.src=A.path,t.autoplay=A.autoplay,t.loop=A.loop,t.volume=A.volume,A._bindStopEvent(i),i}},$=A;$.path="assets/sound/Music2.mp3",$.tag="bgm",$.loop=!0;var B=class extends p{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(B.createInstance.bind(B),B.destroy.bind(B),B.count))}static createInstance(){let i=new B,t=B._createContext();return i.context=t,t.src=B.path,t.autoplay=B.autoplay,t.loop=B.loop,t.volume=B.volume,B._bindStopEvent(i),i}},X=B;X.path="assets/sound/PopPrize.mp3",X.tag="fx",X.loop=!1;var V=class extends p{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(V.createInstance.bind(V),V.destroy.bind(V),V.count))}static createInstance(){let i=new V,t=V._createContext();return i.context=t,t.src=V.path,t.autoplay=V.autoplay,t.loop=V.loop,t.volume=V.volume,V._bindStopEvent(i),i}},Lt=V;Lt.path="assets/sound/Star3.mp3",Lt.tag="fx",Lt.loop=!1;var j=class extends p{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(j.createInstance.bind(j),j.destroy.bind(j),j.count))}static createInstance(){let i=new j,t=j._createContext();return i.context=t,t.src=j.path,t.autoplay=j.autoplay,t.loop=j.loop,t.volume=j.volume,j._bindStopEvent(i),i}},St=j;St.path="assets/sound/Win.mp3",St.tag="fx",St.loop=!1;var ge=class extends p{static play(){console.log("\u9707\u52A8");let i=this.volume*a.inst.sound.volume[this.tag];return i==0||a.inst.ui.vibrate(20,1e3*i),null}};ge.tag="vibrate";var Go=ge,we={AudioPlayer_Button:Ut,AudioPlayer_Dead:Tt,AudioPlayer_Hint:Gt,AudioPlayer_Lose:it,AudioPlayer_Moving:Et,AudioPlayer_Music1:H,AudioPlayer_Music2:$,AudioPlayer_PopPrize:X,AudioPlayer_Star3:Lt,AudioPlayer_Win:St,vibrator:Go};var ni=class extends w{constructor(){super(...arguments);this.volume={bgm:1,fx:1,vibrate:1}}set bgm(t){this._bgm&&this._bgm.destroy(),t&&(this._bgm=t,console.log("\u64AD\u653E\u80CC\u666F\u97F3\u4E50",this._bgm.path),this._bgm.play())}start(){fgui.UIConfig.defaultButtonSound=we.AudioPlayer_Button,fgui.GButton.prototype.playSound=function(t){t.play()}}setupVolume(){let t=a.inst.profile.data;this.setVolume(t.bgm?1:0,"bgm",!0),this.setVolume(t.fx?1:0,"fx",!0),this.setVolume(t.vibrate?1:0,"vibrate",!0)}setVolume(t,e,o=!1){this.volume[e]==t&&!o||(this.volume[e]=t,Object.values(we).filter(s=>s.tag==e).forEach(s=>{s.updateVolume()}))}};var ee={width:900,height:1600},Ei="matrix world";function Li(r,i){let t=r.indexOf(i);return t==-1?null:r.splice(t,1)[0]}function ot(r){return r[Math.floor(Math.random()*r.length)]}function ie(r){let i=Math.floor(Math.random()*r.length);return r.substring(i,i+1)}function Pt(r,i){typeof i=="undefined"&&(i=r-1,r=0),r=Math.floor(r),i=Math.ceil(i);let t=[];for(let e=r;e<=i;e++)t.push(e);return t}function Ki(r,i){return ot(Pt(r,i))}function x(r){let i=Array.isArray(r)?[]:{};for(let t in r)typeof r[t]=="object"?i[t]=x(r[t]):i[t]=r[t];return i}function U(r){r=r.filter(e=>e.weight>0);let i=0;for(let e=0;e<r.length;++e)i+=r[e].weight;let t=Math.random()*i;i=0;for(let e=0;e<r.length-1;++e)if(i+=r[e].weight,i>=t)return r[e].value;return r[r.length-1].value}function ai(r,i,t){return r+(i-r)*t}function Si(r,i,t,e){return Math.sqrt(Math.pow(r-t,2)+Math.pow(i-e,2))}function ve(r,i,t,e){return Math.abs(r-t)+Math.abs(i-e)}function Zi(r,i="000"){let t=r.toFixed(0),e=i.substring(0,1),o=i.length;return e.repeat(o-t.length)+t}function Pi(){let r=new Object,i=location.search;return i.indexOf("?")!=-1&&i.substr(1).split("&").map(o=>{let s=o.split("=")[1];isFinite(Number(s))?s=Number(s):decodeURI&&(s=decodeURI(s)),r[o.split("=")[0]]=s}),r}var be=class extends u{constructor(t){super();this.config=t}};var st={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0},leftUp:{x:-1,y:-1},rightUp:{x:1,y:-1},leftDown:{x:-1,y:1},rightDown:{x:1,y:1}};var oe=(r,i)=>r.x==i.x&&r.y==i.y,y=class extends u{constructor(t){super();this.config=t;this.map={}}getNodeCount(){return Object.values(this.map).length}markDirty(t){this.ev.emit("needUpdate",t)}getPosID(t){return`${t.x}-${t.y}`}checkPosValid(t){return!(t.x<0||t.y<0||t.x>this.config.width-1||t.y>this.config.height-1||Math.floor(t.x)!=t.x||Math.floor(t.y)!=t.y)}getNode(t){return this.map[this.getPosID(t)]}setNode(t,e){let o=this.getPosID(t);return this.map[o]={pos:x(t),config:e,id:o,node:this.createNode(e)},this.ev.emit("newNode",this.map[o]),this.map[o]}removeNodeAt(t){let e=this.getPosID(t);delete this.map[e]}addNodeAt(t,e){if(this.getNode(t))throw new Error("\u4E0D\u80FD\u5728\u5DF2\u5360\u7528\u7684\u683C\u5B50\u4E2D\u6DFB\u52A0\u8282\u70B9");e.id=this.getPosID(t),e.pos=t,this.map[e.id]=e}createNode(t){return new be(t)}destroyNode(t){delete this.map[t.id],t.node.dispose()}destroyNodes(t){t=[...new Set(t)],t.forEach(e=>this.destroyNode(e))}traverse(t,e,o,s){s.length==0&&o(t)&&s.push(x(t)),e(t).forEach(h=>{!s.find(n=>oe(n,h))&&this.checkPosValid(h)&&o(h)&&(s.push(x(h)),this.traverse(h,e,o,s))})}forEach(t){Object.values(this.map).forEach(e=>{t(e)})}forEachSlot(t){for(let e=0;e<this.config.width;e++)for(let o=0;o<this.config.height;o++)t(e,o)}isRowFull(t){let e={x:0,y:t},o=[];return this.traverse(e,s=>[{x:s.x+1,y:s.y}],s=>!!this.getNode(s),o),o.length==this.config.width}destroyRow(t){this.getRow(t).forEach(e=>{this.destroyNode(e)})}isRowEmpty(t){let e={x:0,y:t},o=[];return this.traverse(e,s=>[{x:s.x+1,y:s.y}],s=>!this.getNode(s),o),o.length==this.config.width}clear(){for(let t in this.map)this.destroyNode(this.map[t])}getRow(t){return Object.values(this.map).filter(e=>e.pos.y==t)}moveRowUpperDown(){let t=!1;for(let e=this.config.height-1;e>0;e--)if(this.isRowEmpty(e)&&!this.isRowEmpty(e-1)){this.getRow(e-1).forEach(o=>{this.removeNodeAt(o.pos),this.addNodeAt({x:o.pos.x,y:o.pos.y+1},o),t=!0});break}if(t)return this.moveRowUpperDown();this.markDirty(2)}moveColUpperDown(t){let e=!1;for(let o=this.config.height-1;o>0;o--){let s=this.getNode({x:t,y:o}),l=this.getNode({x:t,y:o-1});if(!s&&!!l){this.removeNodeAt({x:t,y:o-1}),this.addNodeAt({x:t,y:o},l),e=!0;break}}if(e)return this.moveColUpperDown(t)}moveColAllUpperDown(){for(let t=0;t<this.config.width;t++)this.moveColUpperDown(t);this.ev.emit("needUpdate",2)}findNeighorsWithSameType(t){let e=[];return this.traverse(t.pos,o=>this.getAroundPoses(o),o=>{let s=this.getNode(o);return s?this.checkNodeSame(t,s):!1},e),this.getNodes(e)}findLineWithSameType(t,e){let o=[];return this.traverse(t.pos,s=>e?[{x:s.x-1,y:s.y},{x:s.x+1,y:s.y}]:[{x:s.x,y:s.y-1},{x:s.x,y:s.y+1}],s=>{let l=this.getNode(s);return l?this.checkNodeSame(t,l):!1},o),this.getNodes(o)}checkNodeSame(t,e){let o=!0;return t.config.text&&o&&(o=t.config.text==e.config.text),t.config.color&&o&&(o=t.config.color==e.config.color),t.config.tag&&o&&(o=t.config.tag==e.config.tag),t.config.image&&o&&(o=t.config.image==e.config.image),t.config.level&&o&&(o=t.config.level==e.config.level),o}checkConfigSame(t,e){let o=!0;return t.text&&o&&(o=t.text==e.text),t.color&&o&&(o=t.color==e.color),t.tag&&o&&(o=t.tag==e.tag),t.image&&o&&(o=t.image==e.image),t.level&&o&&(o=t.level==e.level),o}findConfigIndex(t,e){return e.findIndex(o=>this.checkConfigSame(o,t))}findLineDiagonalWithSameType(t,e){let o=[];return this.traverse(t.pos,s=>e?[{x:s.x-1,y:s.y-1},{x:s.x+1,y:s.y+1}]:[{x:s.x+1,y:s.y-1},{x:s.x-1,y:s.y+1}],s=>{let l=this.getNode(s);return l?this.checkNodeSame(t,l):!1},o),this.getNodes(o)}getAroundPoses(t){let e=[];return Object.values([st.up,st.down,st.left,st.right]).forEach(o=>{e.push({x:t.x+o.x,y:t.y+o.y})}),e}getNodes(t){let e=[];return t.forEach(o=>{let s=this.getNode(o);s&&!e.includes(s)&&e.push(s)}),e}canLink(t,e){if(t.x===e.x&&t.y===e.y)return!0;if(t.x===e.x){let o=Math.min(t.y,e.y),s=Math.max(t.y,e.y),l=t.x;for(let h=o+1;h<=s-1;h++)if(!this.isPosEmpty({x:l,y:h}))return!1;return!0}if(t.y===e.y){let o=Math.min(t.x,e.x),s=Math.max(t.x,e.x),l=t.y;for(let h=o+1;h<=s-1;h++)if(!this.isPosEmpty({x:h,y:l}))return!1;return!0}return!1}isPosEmpty(t){let e=this.getNode(t);return!e||e.config.hide}getShortPath(t,e){if(this.canLink(t,e))return[];let o={x:t.x,y:e.y};return this.isPosEmpty(o)&&this.canLink(t,o)&&this.canLink(o,e)?[o]:(o={x:e.x,y:t.y},this.isPosEmpty(o)&&this.canLink(t,o)&&this.canLink(o,e)?[o]:null)}findPath(t,e,o=3,s=[[]],l=0){let h=s.sort((g,I)=>I.length-g.length).pop();if(!h||s.length>1e3)return null;let n=h[h.length-1]||t,c=e,d=this.getShortPath(n,c);if(d&&h.length+d.length<=o)return[t,...h,...d,e];if(h.length<o){let g,I=[];for(let _=0;_<this.config.width;_++)for(let v=0;v<this.config.height;v++){if(g={x:_,y:v},!this.isPosEmpty(g)||oe(t,g)||oe(g,e)||h.find(he=>oe(he,g)))continue;let C=this.getShortPath(n,g);!C||I.push({point:g,path:C})}I.sort((_,v)=>ve(_.point.x,_.point.y,t.x,t.y)+ve(_.point.x,_.point.y,e.x,e.y)-(ve(v.point.x,v.point.y,t.x,t.y)+ve(v.point.x,v.point.y,e.x,e.y)));for(let _ of I)s.push([...h,..._.path,_.point])}return this.findPath(t,e,o,s,l+1)}moveItemDir(t,e){let o=this.getNode(t);if(!o)return!1;let s={x:t.x+e.x,y:t.y+e.y};return!this.checkPosValid(s)||this.getNode(s)?!1:(this.removeNodeAt(t),this.addNodeAt(s,o),this.moveItemDir(s,e),!0)}moveMapDir(t){let e=!0,o=0;for(;e;)o+=1,e=!1,this.forEach(s=>{e||(e=this.moveItemDir(s.pos,t))});console.log("\u79FB\u52A8\u5B8C\u6210\uFF0C\u79FB\u52A8\u4E86",o)}dispose(){this.clear(),super.dispose()}};var k=class extends u{constructor(t){super();this.config=t;this.ev.on("kill",this.getKillScore.bind(this)),this.ev.on("join",this.getJoinScore.bind(this))}getKillScore(t,e){console.log("\u51FB\u6740\u5F97\u5206",t,e),this.ev.emit("score",t*Math.pow(2,e))}getJoinScore(t,e){console.log("\u5408\u5E76\u5F97\u5206",t,e),this.ev.emit("score",t*Math.pow(2,e))}replaceConfig(){this.config.viewConfig.colCount=this.config.width,this.config.viewConfig.rowCount=this.config.height}};var rt=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","Arrow")}onConstruct(){this.m_bar=this.getChildAt(0),this.m_head=this.getChildAt(1),this.m_head2=this.getChildAt(2)}};rt.URL="ui://j8b2cwkbpxxpb9";var nt=class extends fgui.GLabel{static createInstance(){return fgui.UIPackage.createObject("main","BasicNode")}onConstruct(){this.m_bg=this.getChildAt(0),this.m_level=this.getChildAt(3)}};nt.URL="ui://j8b2cwkbvzofb7";var b=class extends u{constructor(t,e,o){super();this.grid=t;this.config=e;this.root=o;this.nodeViews={};this.tweenerMap={};let s=this.config.colCount*this.config.nodeSize+(this.config.colCount-1)*this.config.nodeSpacing,l=this.config.rowCount*this.config.nodeSize+(this.config.rowCount-1)*this.config.nodeSpacing;this.innerSize={x:s,y:l},this.anchor={x:.5*(this.config.viewWidth-s),y:.5*(this.config.viewHeight-l)},this.root.visible=!0,this.root.m_bg.setPosition(this.anchor.x,this.anchor.y),this.root.m_bg.setSize(s+4,l+4),this.root.m_bg.visible=this.config.withBG;let h=Math.min(this.root.width/this.root.m_bg.width,this.root.height/this.root.m_bg.height);this.root.setScale(h,h),this.grid.ev.on("needUpdate",n=>{this.updateView(n==4,200)}),this.grid.ev.on("newNode",n=>{this.getNodeView(n)})}dispose(){this.root.removeChildren(1,this.root.numChildren-1,!0)}updateView(t,e){this.grid.forEach(o=>{let s=this.getNodeView(o),l=this.getNodePos(o.pos);if(t&&!o.config.hide){this.tweenerMap[o.node.id]&&this.tweenerMap[o.node.id].stop();let h=e||Si(l.x,l.y,s.x,s.y);this.tweenerMap[o.node.id]=new TWEEN.Tween(s).to({x:l.x,y:l.y},h).onComplete(()=>{delete this.tweenerMap[o.node.id]}).start()}else s.setPosition(l.x,l.y)})}getNodePos(t){return{x:this.anchor.x+t.x*(this.config.nodeSize+this.config.nodeSpacing),y:this.anchor.y+t.y*(this.config.nodeSize+this.config.nodeSpacing)}}getNodeView(t){return this.nodeViews[t.node.id]||this.createNodeView(t),this.nodeViews[t.node.id]}createNodeView(t){let e=t.node,o=nt.createInstance();o.setSize(this.config.nodeSize,this.config.nodeSize),e.config.text&&(o.title=e.config.text),e.config.image&&(o.icon=e.config.image),e.config.color&&(o.m_bg.color=e.config.color),e.config.hide&&(o.alpha=.1),e.config.level&&(o.m_level.text=e.config.level+""),this.nodeViews[e.id]=o,o.on(fgui.InteractiveEvents.Click,()=>{e.ev.emit("touch")}),o.on(fgui.InteractiveEvents.Down,()=>{e.ev.emit("down")}),o.on(fgui.InteractiveEvents.Move,()=>{e.ev.emit("move")}),e.ev.on("dispose",()=>m(this,null,function*(){this.tweenerMap[e.id]&&this.tweenerMap[e.id].stop(),this.config.withAnim&&!t.config.hide&&(yield this.flyAway(t)),this.removeNodeView(e)})),this.root.addChild(o)}removeNodeView(t){try{this.nodeViews[t.id].dispose()}catch(e){}delete this.nodeViews[t.id]}flyAway(t){return m(this,null,function*(){this.tweenerMap[t.node.id]&&this.tweenerMap[t.node.id].stop();let e=this.getNodeView(t);e.parent.setChildIndex(e,e.parent.numChildren-1);let o=ai(-300,300,Math.random()),s=ai(-500,-1e3,Math.random()),l=ai(-300,300,Math.random()),h=this.$interval(()=>{if(this.disposed||!e||!e.parent)return;let n=this.game.delta;s+=1e3*n,e.x+=o*n,e.y+=s*n,e.rotation+=l*n,e.alpha-=n*.5},10);yield this.$delay(2e3),this.$stop(h)})}toLarge(t){this.tweenerMap[t.node.id]&&this.tweenerMap[t.node.id].stop();let e=this.getNodeView(t),o={scale:1};this.tweenerMap[t.node.id]=new TWEEN.Tween(o).to({scale:1.2},200).onUpdate(()=>{e.setScale(o.scale,o.scale)}).onComplete(()=>{delete this.tweenerMap[t.node.id]}).start()}toSmall(t,e=!1){this.tweenerMap[t.node.id]&&this.tweenerMap[t.node.id].stop();let o=this.getNodeView(t);if(e){o.setScale(1,1);return}let s={scale:1.2};this.tweenerMap[t.node.id]=new TWEEN.Tween(s).to({scale:1},200).onUpdate(()=>{o.setScale(s.scale,s.scale)}).onComplete(()=>{delete this.tweenerMap[t.node.id]}).start()}createArrow(t,e){let o=this.getNodePos(t),s=this.getNodePos(e),h=Math.atan2(s.y-o.y,s.x-o.x)/Math.PI*180,n=Si(o.x,o.y,s.x,s.y),c=rt.createInstance();return c.setPosition(o.x+this.config.nodeSize*.5,o.y+this.config.nodeSize*.5),c.rotation=h,c.width=n,this.root.addChild(c),c}};var D=class extends p{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(D.createInstance.bind(D),D.destroy.bind(D),D.count))}static createInstance(){let i=new D,t=D._createContext();return i.context=t,t.src=D.path,t.autoplay=D.autoplay,t.loop=D.loop,t.volume=D.volume,D._bindStopEvent(i),i}},R=D;R.path="assets/sound/move.mp3",R.tag="fx",R.loop=!1;var xe=class extends u{constructor(t){super();this.grid=t;this.bindKeyEvents(),this.bindTouchEvents()}bindKeyEvents(){let t=e=>{switch(e){case"a":this.ev.emit("move",{x:-1,y:0});break;case"d":this.ev.emit("move",{x:1,y:0});break;case"w":this.ev.emit("move",{x:0,y:-1});break;case"s":this.ev.emit("move",{x:0,y:1});break}R.play()};this.game.input.ev.on("key",t),this.ev.on("dispose",()=>{this.game.input.ev.off("key",t)})}bindTouchEvents(){let t=(e,o)=>{R.play(),this.ev.emit("move",{x:e,y:o})};this.game.input.ev.on("move",t),this.ev.on("dispose",()=>{this.game.input.ev.off("move",t)})}};var ye=class extends k{constructor(t){super(t);this.config=t;this.replaceConfig(),this.grid=new y({width:this.config.width,height:this.config.height}),this.view=new b(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.ctrl=new xe(this.grid),this.ctrl.ev.on("move",e=>{this.moveBroad(e)}),this.fillNumbers()}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),super.dispose()}moveBroad(t){console.log("\u79FB\u52A8\u5730\u56FE",t),this.grid.moveMapDir(t),this.grid.markDirty(4),this.$delay(200,()=>{this.checkCombine(t)?(this.grid.moveMapDir(t),this.grid.markDirty(4),this.$delay(200,()=>this.fillNumbers())):this.fillNumbers()})}checkCombine(t){let e=!1;return this.grid.forEach(o=>{if(this.grid.getNode(o.pos)!=o)return;let s=this.grid.getNode({x:o.pos.x+t.x,y:o.pos.y+t.y});if(s&&s.config.text==o.config.text){e=!0,this.grid.destroyNode(o);let l=this.grid.findConfigIndex(o.config,this.config.modulates)+1;this.ev.emit("join",l,0),this.changePosInto(s.pos,this.config.modulates[l])}}),e}fillNumbers(){let t=[];this.grid.forEachSlot((e,o)=>{this.grid.getNode({x:e,y:o})||t.push({x:e,y:o})}),t.sort(()=>Math.random()-.5);for(let e=0;e<this.config.roundGenCount;e++){let o=t.pop();if(!o){this.ev.emit("fail");break}this.changePosInto(o,this.config.modulates[0]),console.log("\u586B\u5145\u6570\u5B57")}this.grid.markDirty(0)}changePosInto(t,e){t=x(t);let o=this.grid.getNode(t);o&&this.grid.destroyNode(o),this.grid.setNode(t,e),this.grid.markDirty(3)}movePosition(t,e){t=x(t),e=x(e);let o=this.grid.getNode(t),s=this.grid.getNode(e);s&&this.grid.destroyNode(s),this.grid.removeNodeAt(t),this.grid.setNode(t,{hide:!0}),o&&this.grid.addNodeAt(e,o)}};var Ji={roundGenCount:4,width:6,height:6,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:6,colCount:6,withBG:!0,withAnim:!0},modulates:[{text:"\u5FAE"},{text:"\u6BEB"},{text:"\u5398"},{text:"\u5206"},{text:"\u4E00"},{text:"\u5341"},{text:"\u767E"},{text:"\u5343"},{text:"\u4E07"},{text:"\u4EBF"},{text:"\u5146"},{text:"\u4EAC"}]};var Ie=class extends u{constructor(t){super();this.grid=t;this.bindTouchEvent()}bindTouchEvent(){this.grid.ev.on("newNode",t=>{t.node.ev.on("down",()=>{R.play(),this.ev.emit("target",t)})})}};var Ce=class extends k{constructor(t){super(t);this.config=t;this.selectedNodes=[];this.replaceConfig(),this.grid=new y({width:this.config.width,height:this.config.height}),this.view=new b(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.previewGrid=new y({width:this.config.previewConfig.colCount,height:this.config.previewConfig.rowCount}),this.previewView=new b(this.previewGrid,this.config.previewConfig,this.game.gameplay.view.m_preview_zone),this.ctrl=new Ie(this.grid),this.ctrl.ev.on("target",e=>{this.onSelectTarget(e)}),this.fillMap(),this.genPreview()}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),this.previewGrid.dispose(),this.previewView.dispose(),super.dispose()}fillMap(){this.grid.forEachSlot((e,o)=>{this.grid.setNode({x:e,y:o},{hide:!0})});let t=[];this.grid.forEach(e=>{e.config.hide&&t.push(e)}),t.sort(()=>Math.random()-.5);for(let e=0;e<this.config.fillCount;e++){let o=t.pop(),s=U(this.config.modulates.drops);s.tag||this.changePosInto(o.pos,s)}this.grid.markDirty(0)}genPreview(){this.previewGrid.clear(),this.previewItem=U(this.config.modulates.drops),this.previewGrid.setNode({x:0,y:0},this.previewItem),this.previewGrid.markDirty(0)}onSelectTarget(t){switch(this.previewItem.tag){case"bomb":{if(this.grid.isPosEmpty(t.pos))return;console.log("booooom"),t.config.tag=="cat"?this.changePosInto(t.pos,this.config.modulates.god):this.changePosInto(t.pos,{hide:!0},!0);break}default:{if(!this.grid.isPosEmpty(t.pos))return;this.changePosInto(t.pos,this.previewItem)}}this.moveCats(),this.grid.markDirty(4),this.genPreview()}moveCats(){let t=[];this.grid.forEach(e=>{e.config.tag=="cat"&&t.push(e)}),t.forEach(e=>{let o=[];if([st.left,st.up,st.right,st.down].forEach(s=>{let l=this.grid.getNode({x:e.pos.x+s.x,y:e.pos.y+s.y});l&&l.config.hide&&o.push(l)}),o.length>0){let s=ot(o);this.movePosition(e.pos,s.pos)}else this.changePosInto(e.pos,this.config.modulates.god)})}changePosInto(t,e,o=!1){t=x(t);let s=this.grid.getNode(t);s&&this.grid.destroyNode(s),this.grid.setNode(t,e),this.grid.markDirty(3),o||this.checkCombine(t)}movePosition(t,e){t=x(t),e=x(e);let o=this.grid.getNode(t),s=this.grid.getNode(e);s&&this.grid.destroyNode(s),this.grid.removeNodeAt(t),this.grid.setNode(t,{hide:!0}),o&&this.grid.addNodeAt(e,o)}checkCombine(t){let e=this.grid.getNode(t);if(e.config.hide||e.config.tag=="cat")return;let o=this.grid.findNeighorsWithSameType(e);if(console.log(e,o),o.length>=this.config.minCombo){let s=e.config.level;this.ev.emit("join",(s+1)*o.length,0),o.forEach(l=>{if(oe(l.pos,t)){let h=x(e.config);h.level+=1,this.changePosInto(t,h),this.$delay(300,()=>{this.checkCombine(t)})}else this.changePosInto(l.pos,{hide:!0},!0)})}}};var Qi={minCombo:3,fillCount:20,modulates:{god:{text:"\u795E",level:1},drops:[{value:{text:"\u732B",tag:"cat"},weight:.2},{value:{text:"\u96F7",tag:"bomb"},weight:.1},{value:{text:"\u8349",level:1},weight:1},{value:{text:"\u77F3",level:1},weight:1},{value:{text:"\u6C34",level:1},weight:1},{value:{text:"\u623F",level:1},weight:1},{value:{text:"\u82B1",level:1},weight:1},{value:{text:"\u6811",level:1},weight:1}]},width:8,height:8,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:8,colCount:8,withBG:!0,withAnim:!0},previewConfig:{viewWidth:100,viewHeight:100,nodeSize:50,nodeSpacing:3,rowCount:1,colCount:1,withBG:!0}};var _e=class extends u{constructor(t){super();this.grid=t;this.bindTouchEvent()}bindTouchEvent(){this.grid.ev.on("newNode",e=>{e.node.ev.on("down",()=>{this.ev.emit("target",e)})});let t=(e,o)=>{this.ev.emit("move",{x:e,y:o})};this.game.input.ev.on("move",t),this.ev.on("dispose",()=>{this.game.input.ev.off("move",t)})}};var ke=class extends k{constructor(t){super(t);this.config=t;this.replaceConfig(),this.grid=new y({width:this.config.width,height:this.config.height}),this.view=new b(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.ctrl=new _e(this.grid),this.ctrl.ev.on("target",e=>{this.target&&e!=this.target&&this.releaseTarget(),this.setTarget(e)}),this.ctrl.ev.on("move",e=>{this.target&&(this.switcher=this.grid.getNode({x:this.target.pos.x+e.x,y:this.target.pos.y+e.y})),this.target&&this.switcher&&(this.switchTargets(this.target,this.switcher),this.target=null,this.switcher=null)}),this.fillMap()}replaceConfig(){this.config.viewConfig.colCount=this.config.width,this.config.viewConfig.rowCount=this.config.height,this.config.viewConfig.colCount=this.config.width,this.config.viewConfig.rowCount=this.config.height,this.config.modulates=[];for(let t=0;t<this.config.replaces.length;t++){let e=this.config.replaces[t];this.config.modulates.push({weight:1,value:{text:e}})}}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),super.dispose()}switchTargets(t,e){return m(this,null,function*(){this.view.toLarge(e),this.grid.removeNodeAt(t.pos),this.grid.removeNodeAt(e.pos);let o=x(e.pos),s=x(t.pos);if(this.grid.addNodeAt(o,t),this.grid.addNodeAt(s,e),this.grid.markDirty(4),yield this.$delay(500),this.checkMatch())this.fall();else{this.view.toSmall(e),this.view.toSmall(t),this.grid.removeNodeAt(t.pos),this.grid.removeNodeAt(e.pos);let l=x(e.pos),h=x(t.pos);this.grid.addNodeAt(l,t),this.grid.addNodeAt(h,e),this.grid.markDirty(4)}})}checkMatch(){let t=!1;return this.grid.forEach(e=>{let o=this.grid.findLineWithSameType(e,!0),s=this.grid.findLineWithSameType(e,!1),l=[];o.length>=this.config.minCombo&&(l=l.concat(o)),s.length>=this.config.minCombo&&(l=l.concat(s)),l.length>0&&(this.grid.destroyNodes(l),this.ev.emit("kill",l.length,0),t=!0)}),t}releaseTarget(){this.view.toSmall(this.target)}setTarget(t){this.target=t,this.view.toLarge(this.target)}fillMap(){this.grid.forEachSlot((t,e)=>{this.grid.setNode({x:t,y:e},U(this.config.modulates))}),this.grid.markDirty(0),this.checkMatch()&&this.fall()}shuffle(){this.grid.clear(),this.fillMap()}fall(){return m(this,null,function*(){this.grid.moveColAllUpperDown(),yield this.$delay(500),this.grid.forEachSlot((t,e)=>{this.grid.getNode({x:t,y:e})||this.grid.setNode({x:t,y:e},U(this.config.modulates))}),this.grid.markDirty(0),this.checkMatch()&&this.fall()})}};var to={minCombo:3,replaces:"\u6253\u5DE5\u4EBA\u5272\u97ED\u83DC",modulates:[{value:{text:"\u6253"},weight:1},{value:{text:"\u5DE5"},weight:1},{value:{text:"\u4EBA"},weight:1},{value:{text:"\u5272"},weight:1},{value:{text:"\u97ED"},weight:1},{value:{text:"\u83DC"},weight:1}],width:8,height:8,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:8,colCount:8,withBG:!0,withAnim:!0}};var Re=class extends u{constructor(t){super();this.grid=t;this.bindTouchEvent()}bindTouchEvent(){this.grid.ev.on("newNode",t=>{t.node.ev.on("touch",()=>{R.play(),this.ev.emit("target",t)})})}};var Me=class extends k{constructor(t){super(t);this.config=t;this.maxNumber=0;this.replaceConfig(),this.grid=new y({width:this.config.width,height:this.config.height}),this.view=new b(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.ctrl=new Re(this.grid),this.ctrl.ev.on("target",e=>{this.onSelectTarget(e)}),this.fillMap(),this.fillNumbers()}replaceConfig(){this.config.viewConfig.colCount=this.config.width,this.config.viewConfig.rowCount=this.config.height}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),super.dispose()}fillMap(){this.grid.forEachSlot((t,e)=>{this.grid.setNode({x:t,y:e},{hide:!0})}),this.grid.markDirty(0)}shuffle(){this.grid.clear(),this.fillMap()}fillNumbers(){let t=[];this.grid.forEach(e=>{e.config.hide&&t.push(e)}),t.sort(()=>Math.random()-.5);for(let e=0;e<this.config.roundGenCount;e++){let o=t.pop();if(!o){this.ev.emit("fail");break}this.grid.destroyNode(o),this.grid.setNode({x:o.pos.x,y:o.pos.y},this.config.modulates[Ki(0,this.maxNumber)])}this.grid.markDirty(0)}clear(){this.targetA&&this.view.toSmall(this.targetA),this.targetB&&this.view.toSmall(this.targetB),this.targetA=null,this.targetB=null}onSelectTarget(t){if(!this.targetA&&!t.config.hide?(this.targetA=t,this.view.toLarge(t)):t==this.targetA?this.clear():t&&t.config.hide&&(this.targetB=t),this.targetA&&this.targetB){let e=this.grid.findPath(this.targetA.pos,this.targetB.pos,this.config.minPathLength);if(e){let o=[];for(let s=0;s<e.length-1;s++){let l=e[s],h=e[s+1];o.push(this.view.createArrow(l,h))}this.$delay(300,()=>{this.grid.destroyNode(this.targetB),this.grid.removeNodeAt(this.targetA.pos),this.grid.setNode(this.targetA.pos,{hide:!0}),this.grid.addNodeAt(this.targetB.pos,this.targetA),this.view.toSmall(this.targetA,!0),this.grid.markDirty(4),o.forEach(s=>s.dispose()),this.checkCombine(this.targetA),this.targetA=null,this.targetB=null})}else this.clear()}}checkCombine(t,e=!0){let o=this.grid.findLineWithSameType(t,!0),s=this.grid.findLineWithSameType(t,!1),l=this.grid.findLineDiagonalWithSameType(t,!0),h=this.grid.findLineDiagonalWithSameType(t,!1),n=[];if(o.length>=this.config.combineCount&&(n=n.concat(o)),s.length>=this.config.combineCount&&(n=n.concat(s)),l.length>=this.config.combineCount&&(n=n.concat(l)),h.length>=this.config.combineCount&&(n=n.concat(h)),n.length>0){console.log("\u6D88\u9664\uFF01\uFF01"),this.grid.destroyNodes(n),n.forEach(d=>{d!=t&&this.grid.setNode(d.pos,{hide:!0})});let c=this.grid.findConfigIndex(t.config,this.config.modulates);this.ev.emit("join",n.length*(c+1),0),this.$delay(300,()=>{let d=this.grid.setNode(t.pos,this.config.modulates[c+1]);this.maxNumber=Math.max(this.maxNumber,c+1),this.grid.markDirty(0),this.checkCombine(d,!0)})}else e&&this.fillNumbers()}};var eo={minPathLength:12,roundGenCount:5,combineCount:5,width:12,height:12,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:12,colCount:12,withBG:!0,withAnim:!0},modulates:[{text:"\u5FAE"},{text:"\u6BEB"},{text:"\u5398"},{text:"\u5206"},{text:"\u4E00"},{text:"\u5341"},{text:"\u767E"},{text:"\u5343"},{text:"\u4E07"},{text:"\u4EBF"},{text:"\u5146"},{text:"\u4EAC"}]};var Ue=class extends u{constructor(t){super();this.grid=t;this.bindTouchEvent()}bindTouchEvent(){this.grid.ev.on("newNode",e=>{e.node.ev.on("down",()=>{R.play(),this.ev.emit("target",e)}),e.node.ev.on("move",()=>{this.ev.emit("hover",e)})});let t=(e,o)=>{R.play(),this.ev.emit("stop"),console.log("mouse up")};this.game.input.ev.on("up",t),this.ev.on("dispose",()=>{this.game.input.ev.off("up",t)})}};var Te=class extends k{constructor(t){super(t);this.config=t;this.selectedNodes=[];this.lineArrows=[];this.killCombo=0;this.maxCombo=0;this.replaceConfig(),this.grid=new y({width:this.config.width,height:this.config.height}),this.view=new b(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.ctrl=new Ue(this.grid),this.ctrl.ev.on("target",e=>{this.onSelectTarget(e)}),this.ctrl.ev.on("hover",e=>{this.onHoverTarget(e)}),this.ctrl.ev.on("stop",()=>{this.killTargets()}),this.fillMap()}replaceConfig(){this.config.viewConfig.colCount=this.config.width,this.config.viewConfig.rowCount=this.config.height,this.config.modulates=[];for(let t=0;t<this.config.replaces.length;t++){let e=this.config.replaces[t];this.config.modulates.push({weight:1,value:{text:e}})}}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),super.dispose()}fillMap(){this.grid.forEachSlot((t,e)=>{this.grid.setNode({x:t,y:e},U(this.config.modulates))}),this.grid.markDirty(0)}shuffle(){this.grid.clear(),this.fillMap()}clearPath(){this.lineArrows.forEach(t=>{t.dispose()}),this.lineArrows.length=0,this.selectedNodes.forEach(t=>{this.view.toSmall(t)}),this.selectedNodes.length=0}onSelectTarget(t){this.clearPath(),this.view.toLarge(t),this.selectedNodes.push(t),this.lastHover=t}onHoverTarget(t){if(t==this.lastHover)return;this.lastHover=t;let e=this.selectedNodes[this.selectedNodes.length-1];if(!!e)if(t==e)if(this.selectedNodes.length==1)this.clearPath();else{let o=this.selectedNodes.pop();this.view.toSmall(o),this.lineArrows.pop().dispose()}else{if(this.selectedNodes.includes(t))return;{let o=Math.abs(e.pos.x-t.pos.x)<=1&&Math.abs(e.pos.y-t.pos.y)<=1,s=this.grid.checkConfigSame(e.config,t.config);o&&s&&(this.view.toLarge(t),this.selectedNodes.push(t),this.lineArrows.push(this.view.createArrow(e.pos,t.pos)))}}}killTargets(){if(this.selectedNodes.length<this.config.minCombo){this.clearPath();return}this.selectedNodes.forEach(t=>{this.grid.destroyNode(t)}),this.killCombo+=1,this.ev.emit("kill",this.selectedNodes.length,this.killCombo),this.clearPath(),this.maxCombo=Math.max(this.maxCombo,this.killCombo),this.$delay(2e3,()=>{this.killCombo-=1,this.killCombo==0&&(console.log("\u6700\u5927\u8FDE\u51FB",this.maxCombo),this.maxCombo=0,this.fall())})}fall(){return m(this,null,function*(){this.grid.moveColAllUpperDown(),yield this.$delay(500),this.grid.forEachSlot((t,e)=>{this.grid.getNode({x:t,y:e})||this.grid.setNode({x:t,y:e},U(this.config.modulates))}),this.grid.markDirty(0)})}};var io={minCombo:4,replaces:"\u6253\u5DE5\u4EBA\u5272\u97ED\u83DC",modulates:[{value:{text:"\u6253"},weight:1},{value:{text:"\u5DE5"},weight:1},{value:{text:"\u4EBA"},weight:1},{value:{text:"\u5272"},weight:1},{value:{text:"\u97ED"},weight:1},{value:{text:"\u83DC"},weight:1}],width:10,height:15,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:15,colCount:10,withBG:!0,withAnim:!0}};var q=class extends u{constructor(t){super();this.grid=t;this.members=[]}createAt(t,e){this.members.length=0,e.forEach(o=>{this.members.push(this.grid.setNode({x:o.pos.x+t.x,y:o.pos.y+t.y},o.config))}),this.grid.markDirty(0)}addMembers(t){t.forEach(e=>this.members.push(e))}checkColl(t,e){let o=!1;return e.forEach(s=>{let l=this.grid.getNode({x:s.pos.x+t.x,y:s.pos.y+t.y});o||(o=!!l)}),o}transform(t,e=!1){let o=this.getRect(),s=[];this.members.forEach(h=>{let n=t(h.pos,o);s.push({pos:n,item:h}),this.grid.removeNodeAt(h.pos)});let l=!0;return s.forEach(h=>{!l||(this.grid.checkPosValid(h.pos)||(l=!1),this.grid.getNode(h.pos)&&(l=!1))}),l?(s.forEach(h=>{this.grid.addNodeAt(h.pos,h.item)}),this.grid.markDirty(e?2:1)):this.members.forEach(h=>{this.grid.addNodeAt(h.pos,h)}),l}rotate(t=!0){return this.transform((e,o)=>{let s=e.x-o.pos.x,l=e.y-o.pos.y,h=Math.floor((o.size.x-o.size.y)*.5);return h=h<0?h+1:h,t?{x:o.pos.x+l+h,y:o.pos.y+(o.size.x-s)}:{x:o.pos.x+(o.size.x-l)-h,y:o.pos.y+s}})}flip(t=!0){return this.transform((e,o)=>{let s=e.x-o.pos.x,l=e.y-o.pos.y;return t?{x:o.pos.x+(o.size.x-s),y:o.pos.y+l}:{x:o.pos.x+s,y:o.pos.y+(o.size.y-l)}})}move(t,e,o=!1){return this.transform((s,l)=>({x:s.x+t,y:s.y+e}),o)}getRect(){let t=1/0,e=1/0,o=-1/0,s=-1/0;this.members.forEach(n=>{t=Math.min(t,n.pos.x),o=Math.max(o,n.pos.x),e=Math.min(e,n.pos.y),s=Math.max(s,n.pos.y)});let l=o-t,h=s-e;return{pos:{x:t,y:e},size:{x:l,y:h}}}clear(){this.members.length=0}};var Ge=class extends u{constructor(t){super();this.grid=t;this.group=new q(this.grid),this.bindKeyEvents(),this.bindTouchEvents()}bindKeyEvents(){let t=this.group,e=o=>{switch(R.play(),o){case"q":t.rotate();break;case"e":t.rotate(!1);break;case"a":t.move(-1,0);break;case"d":t.move(1,0);break;case"w":t.rotate();break;case"s":t.move(0,1);break;case"r":t.flip(!0);break;case"f":t.flip(!1);break}};this.game.input.ev.on("key",e),this.ev.on("dispose",()=>{this.game.input.ev.off("key",e)})}bindTouchEvents(){let t=(o,s)=>{R.play(),s<0?this.group.rotate(!0):this.group.move(o,s)};this.game.input.ev.on("move",t),this.ev.on("dispose",()=>{this.game.input.ev.off("move",t)});let e=(o,s)=>{R.play(),s>.5?o<.1?this.group.rotate(!0):o>.9&&this.group.rotate(!1):o<.1?this.group.flip(!0):o>.9&&this.group.flip(!1)};this.game.input.ev.on("click",e),this.ev.on("dispose",()=>{this.game.input.ev.off("click",e)})}};var Ee=class extends k{constructor(t){super(t);this.config=t;this.dropGroup=()=>{this.ctrl.group.move(0,1),a.inst.gameplay.later(this.config.fallSpeed,()=>m(this,null,function*(){if(this.checkColl()){let t=[...this.ctrl.group.members];this.ctrl.group.clear(),this.checkScore(t),this.genCtrlGoup(),this.genPreview(),a.inst.gameplay.later(this.config.fallSpeed,()=>{this.dropGroup()})}else this.dropGroup()}))};this.droppingGroups=[];this.replaceConfig(),this.grid=new y({width:this.config.width,height:this.config.height}),this.ctrl=new Ge(this.grid),this.view=new b(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.previewGrid=new y({width:4,height:4}),this.previewView=new b(this.previewGrid,this.config.previewConfig,this.game.gameplay.view.m_preview_zone),this.init()}replaceConfig(){this.config.viewConfig.colCount=this.config.width,this.config.viewConfig.rowCount=this.config.height;for(let t=0;t<this.config.replaces.length;t++){let e=this.config.replaces[t];this.config.monsters[t]=x(this.config.monsters[t]),this.config.monsters[t].text=e}}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),this.previewGrid.dispose(),this.previewView.dispose(),super.dispose()}init(){this.genStartLevel(),this.genPreview(),this.genCtrlGoup(),this.genPreview(),a.inst.gameplay.later(this.config.fallSpeed,()=>{this.dropGroup()})}genStartLevel(){let t=this.config.monsters;for(let e=this.config.height-1;e>=this.config.height-this.config.baseLevel;e--){let o=Math.floor(this.config.width*this.config.levelFill),s=Pt(this.config.width-1).sort(()=>Math.random()-.5);s.length=o;for(let l of s){let h=ot(t);this.grid.setNode({x:l,y:e},h)}}}genPreview(){this.previewGrid.clear(),this.previewConfig=[{pos:{x:0,y:0},config:{text:ie(this.config.replaces)}},{pos:{x:1,y:0},config:{text:ie(this.config.replaces)}}],this.previewConfig.forEach(t=>{this.previewGrid.setNode({x:t.pos.x,y:t.pos.y},t.config)}),this.previewGrid.markDirty(0)}genCtrlGoup(){let t={x:Math.floor(this.config.width*.5-2),y:0};this.ctrl.group.checkColl(t,this.previewConfig)?this.ev.emit("fail"):this.ctrl.group.createAt(t,this.previewConfig)}checkColl(){let t=!1;return this.ctrl.group.members.forEach(e=>{if(t)return;if(e.pos.y==this.config.height-1){t=!0;return}let o=this.grid.getNode({x:e.pos.x,y:e.pos.y+1});if(o&&!this.ctrl.group.members.includes(o)){t=!0;return}}),t}checkScore(t){let e=!1;for(let o of t){let s=this.grid.findLineWithSameType(o,!0),l=this.grid.findLineWithSameType(o,!1),h=[];if(s.length>=this.config.minCombo&&(h=h.concat(s)),l.length>=this.config.minCombo&&(h=h.concat(l)),h.length>0){this.grid.destroyNodes(h);let n=h.filter(c=>c.config.tag=="monster").length;this.ev.emit("kill",h.length-n+n*5,0),e=!0}}e&&this.dropPills()}dropPills(){this.droppingGroups.forEach(l=>l.clear()),this.droppingGroups.length=0;let t=[];this.grid.forEach(l=>{l.config.image||t.push(l)});let e=[],o=[],s=t.pop();for(;s;){if(o.includes(s)){s=t.pop();continue}o.push(s);let l=[];this.grid.traverse(s.pos,n=>this.grid.getAroundPoses(n),n=>{let c=this.grid.getNode(n);return c?c.config.color==s.config.color&&!c.config.image:!1},l);let h=this.grid.getNodes(l);h.forEach(n=>o.push(n)),e.push(h)}e.forEach(l=>{let h=new q(this.grid);h.addMembers(l),this.tryMoveDownGroup(h),this.droppingGroups.push(h)})}tryMoveDownGroup(t){t.members.length>0&&t.move(0,1,!0)?this.$delay(100,()=>this.tryMoveDownGroup(t)):(this.checkScore([...t.members]),t.clear())}};var oo={fallSpeed:500,baseLevel:3,levelFill:.5,width:10,height:15,minCombo:4,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:15,colCount:10,withBG:!0,withAnim:!0},previewConfig:{viewWidth:100,viewHeight:100,nodeSize:50,nodeSpacing:3,rowCount:1,colCount:2,withBG:!0},replaces:"\u5927\u806A\u660E",monsters:[{text:"\u5927",color:11184810,tag:"monster"},{color:11184810,text:"\u806A",tag:"monster"},{color:11184810,text:"\u660E",tag:"monster"}],modulates:[{value:[{pos:{x:0,y:0},config:{text:"\u5927"}},{pos:{x:1,y:0},config:{text:"\u5927"}}],weight:1},{value:[{pos:{x:0,y:0},config:{text:"\u5927"}},{pos:{x:1,y:0},config:{text:"\u806A"}}],weight:1},{value:[{pos:{x:0,y:0},config:{text:"\u5927"}},{pos:{x:1,y:0},config:{text:"\u660E"}}],weight:1},{value:[{pos:{x:0,y:0},config:{text:"\u806A"}},{pos:{x:1,y:0},config:{text:"\u806A"}}],weight:1},{value:[{pos:{x:0,y:0},config:{text:"\u660E"}},{pos:{x:1,y:0},config:{text:"\u660E"}}],weight:1},{value:[{pos:{x:0,y:0},config:{text:"\u806A"}},{pos:{x:1,y:0},config:{text:"\u660E"}}],weight:1}]};var Le=class extends u{constructor(t){super();this.grid=t;this.bindTouchEvent()}bindTouchEvent(){this.grid.ev.on("newNode",t=>{t.node.ev.on("touch",()=>{R.play(),this.ev.emit("target",t)})})}};var Se=class extends k{constructor(t){super(t);this.config=t;this.replaceConfig(),this.grid=new y({width:this.config.width,height:this.config.height}),this.view=new b(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.ctrl=new Le(this.grid),this.ctrl.ev.on("target",e=>{this.onSelectTarget(e)}),this.fillMap()}replaceConfig(){this.config.viewConfig.colCount=this.config.width,this.config.viewConfig.rowCount=this.config.height,this.config.modulates=[];for(let t=0;t<this.config.replaces.length;t++){let e=this.config.replaces[t];this.config.modulates[t]={text:e}}}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),super.dispose()}fillMap(){let t=[],e=this.config.width*this.config.height,o=-1;for(;t.length<e;)o+=1,o>=this.config.modulates.length&&(o=0),t.push(x(this.config.modulates[o])),t.push(x(this.config.modulates[o]));t.sort(()=>Math.random()-.5);let s=-1;this.grid.forEachSlot((l,h)=>{s++;let n=t[s];this.grid.setNode({x:l,y:h},n)}),this.grid.markDirty(0)}shuffle(){this.grid.clear(),this.fillMap()}clear(){this.targetA&&this.view.toSmall(this.targetA),this.targetB&&this.view.toSmall(this.targetB),this.targetA=null,this.targetB=null}onSelectTarget(t){if(this.targetA?t==this.targetA?this.clear():(this.targetB=t,this.view.toLarge(t)):(this.targetA=t,this.view.toLarge(t)),this.targetA&&this.targetB)if(this.grid.checkNodeSame(this.targetA,this.targetB)){let e=this.grid.findPath(this.targetA.pos,this.targetB.pos,this.config.minPathLength);if(e){let o=[];for(let s=0;s<e.length-1;s++){let l=e[s],h=e[s+1];o.push(this.view.createArrow(l,h))}this.$delay(300,()=>{this.grid.destroyNodes([this.targetA,this.targetB]),this.ev.emit("kill",2,0),this.targetA=null,this.targetB=null,o.forEach(s=>s.dispose()),this.grid.getNodeCount()==0&&this.fillMap()})}else this.clear()}else this.clear()}checkPathLink(){return!0}};var so={minPathLength:2,replaces:"\u7F51\u7EDC\u70ED\u95E8\u751F\u7269\u89C6\u9891\u4E00\u952E\u4E09\u8FDE\u65E0\u7A77\u5C0F\u4EAE\u85CF\u72D0",modulates:[{text:"\u7F51"},{text:"\u7EDC"},{text:"\u70ED"},{text:"\u95E8"},{text:"\u751F"},{text:"\u7269"},{text:"\u89C6"},{text:"\u9891"},{text:"\u4E00"},{text:"\u952E"},{text:"\u4E09"},{text:"\u8FDE"},{text:"\u65E0"},{text:"\u7A77"},{text:"\u5C0F"},{text:"\u4EAE"},{text:"\u85CF"},{text:"\u72D0"}],width:12,height:12,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:12,colCount:12,withBG:!0,withAnim:!0}};var Pe=class extends u{constructor(t){super();this.grid=t;this.bindTouchEvent()}bindTouchEvent(){this.grid.ev.on("newNode",t=>{t.node.ev.on("touch",()=>{R.play(),this.ev.emit("target",t)})})}};var Ne=class extends k{constructor(t){super(t);this.config=t;this.selectedNodes=[];this.killCombo=0;this.maxCombo=0;this.replaceConfig(),this.grid=new y({width:this.config.width,height:this.config.height}),this.view=new b(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.ctrl=new Pe(this.grid),this.ctrl.ev.on("target",e=>{this.onSelectTarget(e)}),this.fillMap()}replaceConfig(){this.config.viewConfig.colCount=this.config.width,this.config.viewConfig.rowCount=this.config.height,this.config.modulates=[];for(let t=0;t<this.config.replaces.length;t++){let e=this.config.replaces[t];this.config.modulates.push({value:{text:e},weight:1})}}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),super.dispose()}fillMap(){this.grid.forEachSlot((t,e)=>{this.grid.setNode({x:t,y:e},U(this.config.modulates))}),this.grid.markDirty(0)}shuffle(){this.grid.clear(),this.fillMap()}onSelectTarget(t){if(this.selectedNodes.includes(t))this.selectedNodes.length>=this.config.minCombo?this.killTargets():(this.selectedNodes.forEach(e=>{this.view.toSmall(e)}),this.selectedNodes.length=0);else{this.selectedNodes.length>0&&this.selectedNodes.forEach(o=>{this.view.toSmall(o)});let e=this.grid.findNeighorsWithSameType(t);this.selectedNodes=e,e.forEach(o=>{this.view.toLarge(o)})}}killTargets(){this.selectedNodes.forEach(t=>{this.grid.destroyNode(t)}),this.killCombo+=1,this.ev.emit("kill",this.selectedNodes.length,this.killCombo),this.selectedNodes.length=0,this.maxCombo=Math.max(this.maxCombo,this.killCombo),this.$delay(2e3,()=>{this.killCombo-=1,this.killCombo==0&&(this.maxCombo=0,this.fall())})}fall(){return m(this,null,function*(){this.grid.moveColAllUpperDown(),yield this.$delay(500),this.grid.forEachSlot((t,e)=>{this.grid.getNode({x:t,y:e})||this.grid.setNode({x:t,y:e},U(this.config.modulates))}),this.grid.markDirty(0),this.findAnyCombo()||this.shuffle()})}findAnyCombo(t=!1){let e=!1;return this.grid.forEach(o=>{if(e)return;let s=this.grid.findNeighorsWithSameType(o);s.length>=this.config.minCombo&&(e=!0,t&&(this.selectedNodes=s,s.forEach(l=>{this.view.toLarge(l)})))}),e}};var ro={minCombo:4,replaces:"\u7EA2\u9EC4\u84DD",modulates:[{value:{text:"\u7EA2"},weight:1},{value:{text:"\u6A59"},weight:1},{value:{text:"\u9EC4"},weight:1},{value:{text:"\u7EFF"},weight:1},{value:{text:"\u9752"},weight:1},{value:{text:"\u84DD"},weight:1},{value:{text:"\u7D2B"},weight:1}],width:10,height:10,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:15,colCount:10,withBG:!0,withAnim:!0}};var Ae=class extends u{constructor(t){super();this.grid=t;this.group=new q(this.grid),this.bindKeyEvents(),this.bindTouchEvents()}bindKeyEvents(){let t=this.group,e=o=>{switch(o){case"q":t.rotate();break;case"e":t.rotate(!1);break;case"a":t.move(-1,0);break;case"d":t.move(1,0);break;case"w":t.rotate();break;case"s":t.move(0,1);break;case"r":t.flip(!0);break;case"f":t.flip(!1);break}};this.game.input.ev.on("key",e),this.ev.on("dispose",()=>{this.game.input.ev.off("key",e)})}bindTouchEvents(){let t=(o,s)=>{s<0?this.group.rotate(!0):this.group.move(o,s)};this.game.input.ev.on("move",t),this.ev.on("dispose",()=>{this.game.input.ev.off("move",t)});let e=(o,s)=>{s>.5?o<.1?this.group.rotate(!0):o>.9&&this.group.rotate(!1):o<.1?this.group.flip(!0):o>.9&&this.group.flip(!1)};this.game.input.ev.on("click",e),this.ev.on("dispose",()=>{this.game.input.ev.off("click",e)})}};var Be=class extends k{constructor(t){super(t);this.config=t;this.dropGroup=()=>{this.ctrl.group.move(0,1,!0),a.inst.gameplay.later(this.config.fallSpeed,()=>m(this,null,function*(){this.checkColl()?(this.ctrl.group.clear(),yield this.checkScore(),this.genCtrlGoup(),this.genPreview(),a.inst.gameplay.later(this.config.fallSpeed,()=>{this.dropGroup()})):this.dropGroup()}))};this.replaceConfig(),this.grid=new y({width:this.config.width,height:this.config.height}),this.ctrl=new Ae(this.grid),this.view=new b(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.previewGrid=new y({width:4,height:4}),this.previewView=new b(this.previewGrid,this.config.previewConfig,this.game.gameplay.view.m_preview_zone),this.init()}replaceConfig(){this.config.viewConfig.colCount=this.config.width,this.config.viewConfig.rowCount=this.config.height;let t=this.config.replaces.split(",");for(let e=0;e<t.length;e++){let o=t[e],s=this.config.modulates[e].value;for(let l=0;l<s.length;l++){let h=s[l];h.config={text:o[l]}}}}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),this.previewGrid.dispose(),this.previewView.dispose(),super.dispose()}init(){this.genStartLevel(),this.genPreview(),this.genCtrlGoup(),this.genPreview(),a.inst.gameplay.later(this.config.fallSpeed,()=>{this.dropGroup()})}genStartLevel(){for(let t=this.config.height-1;t>=this.config.height-this.config.baseLevel;t--){let e=Math.floor(this.config.width*this.config.levelFill),o=Pt(this.config.width-1).sort(()=>Math.random()-.5);o.length=e;for(let s of o)this.grid.setNode({x:s,y:t},{color:11184810})}}genPreview(){this.previewGrid.clear(),this.previewConfig=U(this.config.modulates),this.previewConfig.forEach(t=>{this.previewGrid.setNode({x:t.pos.x,y:t.pos.y},t.config)}),this.previewGrid.markDirty(0)}genCtrlGoup(){let t={x:Math.floor(this.config.width*.5-2),y:0};this.ctrl.group.checkColl(t,this.previewConfig)?this.ev.emit("fail"):this.ctrl.group.createAt(t,this.previewConfig)}checkColl(){let t=!1;return this.ctrl.group.members.forEach(e=>{if(t)return;if(e.pos.y==this.config.height-1){t=!0;return}let o=this.grid.getNode({x:e.pos.x,y:e.pos.y+1});if(o&&!this.ctrl.group.members.includes(o)){t=!0;return}}),t}checkScore(){return m(this,null,function*(){let t=0;for(let e=this.config.height-1;e>=0;e--)this.grid.isRowFull(e)&&(t+=1,this.grid.destroyRow(e));t>0&&(this.ev.emit("kill",this.config.width,t-1),yield this.$delay(300),this.grid.moveRowUpperDown())})}};var f={black:0,red:16711680,green:65280,blue:255,purple:16711935,yellow:16776960,azur:65535,white:16777215},no={fallSpeed:500,baseLevel:0,levelFill:.3,width:10,height:15,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:15,colCount:10,withBG:!0,withAnim:!0},previewConfig:{viewWidth:100,viewHeight:100,nodeSize:50,nodeSpacing:3,rowCount:4,colCount:4,withBG:!0},replaces:"\u9E21\u4F60\u592A\u7F8E,\u4EBA\u8270\u4E0D\u62C6,\u7D20\u8D28\u4E09\u8FDE,\u96E8\u5973\u65E0\u74DC,\u60CA\u4E0D\u60CA\u559C,\u610F\u4E0D\u610F\u5916,\u559C\u5927\u666E\u5954,\u6211\u592A\u96BE\u4E86",modulates:[{value:[{pos:{x:0,y:0},config:{color:f.red}},{pos:{x:1,y:0},config:{color:f.red}},{pos:{x:2,y:0},config:{color:f.red}},{pos:{x:2,y:1},config:{color:f.red}}],weight:1},{value:[{pos:{x:0,y:1},config:{color:f.green}},{pos:{x:1,y:1},config:{color:f.green}},{pos:{x:2,y:1},config:{color:f.green}},{pos:{x:2,y:0},config:{color:f.green}}],weight:1},{value:[{pos:{x:0,y:0},config:{color:f.blue}},{pos:{x:1,y:0},config:{color:f.blue}},{pos:{x:1,y:1},config:{color:f.blue}},{pos:{x:2,y:0},config:{color:f.blue}}],weight:1},{value:[{pos:{x:0,y:0},config:{color:f.blue}},{pos:{x:1,y:0},config:{color:f.blue}},{pos:{x:1,y:1},config:{color:f.blue}},{pos:{x:2,y:0},config:{color:f.blue}}],weight:1},{value:[{pos:{x:0,y:1},config:{color:f.purple}},{pos:{x:1,y:1},config:{color:f.purple}},{pos:{x:1,y:0},config:{color:f.purple}},{pos:{x:2,y:0},config:{color:f.purple}}],weight:1},{value:[{pos:{x:0,y:0},config:{color:f.azur}},{pos:{x:1,y:0},config:{color:f.azur}},{pos:{x:1,y:1},config:{color:f.azur}},{pos:{x:2,y:1},config:{color:f.azur}}],weight:1},{value:[{pos:{x:0,y:0},config:{color:f.black}},{pos:{x:0,y:1},config:{color:f.black}},{pos:{x:1,y:1},config:{color:f.black}},{pos:{x:1,y:0},config:{color:f.black}}],weight:1},{value:[{pos:{x:0,y:0},config:{color:f.white}},{pos:{x:1,y:0},config:{color:f.white}},{pos:{x:2,y:0},config:{color:f.white}},{pos:{x:3,y:0},config:{color:f.white}}],weight:1}]};var Ve=class extends u{constructor(t){super();this.grid=t;this.group=new q(this.grid),this.bindKeyEvents(),this.bindTouchEvents()}bindKeyEvents(){let t=this.group,e=o=>{switch(o){case"q":t.rotate();break;case"e":t.rotate(!1);break;case"a":t.move(-1,0);break;case"d":t.move(1,0);break;case"w":t.rotate();break;case"s":t.move(0,1);break;case"r":t.flip(!0);break;case"f":t.flip(!1);break}};this.game.input.ev.on("key",e),this.ev.on("dispose",()=>{this.game.input.ev.off("key",e)})}bindTouchEvents(){let t=(o,s)=>{s<0?this.group.rotate(!0):this.group.move(o,s)};this.game.input.ev.on("move",t),this.ev.on("dispose",()=>{this.game.input.ev.off("move",t)});let e=(o,s)=>{s>.5?o<.1?this.group.rotate(!0):o>.9&&this.group.rotate(!1):o<.1?this.group.flip(!0):o>.9&&this.group.flip(!1)};this.game.input.ev.on("click",e),this.ev.on("dispose",()=>{this.game.input.ev.off("click",e)})}};var je=class extends k{constructor(t){super(t);this.config=t;this.dropGroup=()=>{this.ctrl.group.move(0,1,!0),a.inst.gameplay.later(this.config.fallSpeed,()=>m(this,null,function*(){this.checkColl()?(yield this.checkCombo(),this.ctrl.group.clear(),yield this.checkScore(),this.genCtrlGoup(),this.genPreview(),a.inst.gameplay.later(this.config.fallSpeed,()=>{this.dropGroup()})):this.dropGroup()}))};this.replaceConfig(),this.grid=new y({width:this.config.width,height:this.config.height}),this.ctrl=new Ve(this.grid),this.view=new b(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.previewGrid=new y({width:4,height:4}),this.previewView=new b(this.previewGrid,this.config.previewConfig,this.game.gameplay.view.m_preview_zone),this.init()}replaceConfig(){this.config.viewConfig.colCount=this.config.width,this.config.viewConfig.rowCount=this.config.height}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),this.previewGrid.dispose(),this.previewView.dispose(),super.dispose()}init(){this.genStartLevel(),this.genPreview(),this.genCtrlGoup(),this.genPreview(),a.inst.gameplay.later(this.config.fallSpeed,()=>{this.dropGroup()})}genStartLevel(){for(let t=this.config.height-1;t>=this.config.height-this.config.baseLevel;t--){let e=Math.floor(this.config.width*this.config.levelFill),o=Pt(this.config.width-1).sort(()=>Math.random()-.5);o.length=e;for(let s of o)this.grid.setNode({x:s,y:t},{text:ie(this.config.replaces)})}}genPreview(){this.previewGrid.clear(),this.previewConfig=x(U(this.config.modulates)),this.previewConfig.forEach(t=>{t.config={text:ie(this.config.replaces)},this.previewGrid.setNode({x:t.pos.x,y:t.pos.y},t.config)}),this.previewGrid.markDirty(0)}genCtrlGoup(){let t={x:Math.floor(this.config.width*.5-2),y:0};this.ctrl.group.checkColl(t,this.previewConfig)?this.ev.emit("fail"):this.ctrl.group.createAt(t,this.previewConfig)}checkColl(){let t=!1;return this.ctrl.group.members.forEach(e=>{if(t)return;if(e.pos.y==this.config.height-1){t=!0;return}let o=this.grid.getNode({x:e.pos.x,y:e.pos.y+1});if(o&&!this.ctrl.group.members.includes(o)){t=!0;return}}),t}checkCombo(){return m(this,null,function*(){let t=0;this.ctrl.group.members.forEach(e=>{let o=this.grid.findNeighorsWithSameType(e);o.length>=this.config.minCombo&&(t+=o.length,this.grid.destroyNodes(o))}),t>0&&(this.ev.emit("kill",t,0),yield this.$delay(300),this.grid.moveRowUpperDown())})}checkScore(){return m(this,null,function*(){let t=0;for(let e=this.config.height-1;e>=0;e--)this.grid.isRowFull(e)&&(t+=1,this.grid.destroyRow(e));t>0&&(this.ev.emit("kill",this.config.width,t),yield this.$delay(300),this.grid.moveRowUpperDown())})}};var ao={fallSpeed:500,baseLevel:3,levelFill:.3,width:8,height:12,minCombo:4,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:12,colCount:8,withBG:!0,withAnim:!0},previewConfig:{viewWidth:200,viewHeight:200,nodeSize:50,nodeSpacing:3,rowCount:3,colCount:3,withBG:!0},replaces:"\u786E\u8BA4\u8FC7\u773C\u795E",modulates:[{value:[{pos:{x:0,y:0},config:{}},{pos:{x:1,y:0},config:{}}],weight:1},{value:[{pos:{x:0,y:0},config:{}},{pos:{x:1,y:1},config:{}}],weight:1},{value:[{pos:{x:0,y:1},config:{}},{pos:{x:1,y:0},config:{}}],weight:1},{value:[{pos:{x:0,y:0},config:{}},{pos:{x:1,y:0},config:{}},{pos:{x:1,y:1},config:{}}],weight:1},{value:[{pos:{x:0,y:0},config:{}},{pos:{x:0,y:1},config:{}},{pos:{x:1,y:1},config:{}}],weight:1},{value:[{pos:{x:0,y:0},config:{}},{pos:{x:1,y:0},config:{}},{pos:{x:2,y:0},config:{}}],weight:1}]};var lo={tetrix:[`\u4FC4\u7F57\u65AF\u65B9\u5757
\u6E38\u620F\u76EE\u6807
\u6BCF\u4E2A\u6A2A\u884C\u5168\u6EE1\u53EF\u4EE5\u6D88\u9664\u5F97\u5206\uFF01`,`\u64CD\u4F5C\u65B9\u6CD5\uFF1A
\u5411\u5DE6\u3001\u53F3\u3001\u4E0B\u6ED1\u52A8\u5C4F\u5E55\u79FB\u52A8
\u5411\u4E0A\u6ED1\u52A8\u5C4F\u5E55\u65CB\u8F6C`,"\u70B9\u51FB\u5DE6\u53F3\u4E24\u4FA7\u4E5F\u53EF\u4EE5\u65CB\u8F6C","\u5982\u679C\u5757\u5757\u5806\u5230\u9876\u4E86\u5219\u5931\u8D25"],star:[`\u6D88\u706D\u661F\u661F
\u6E38\u620F\u76EE\u6807
\u70B9\u51FB\u76F8\u4E92\u8FDE\u63A5\u7684\u76F8\u540C\u5757\u5757\u53EF\u4EE5\u6D88\u9664\u5F97\u5206\uFF01`,`\u64CD\u4F5C\u65B9\u6CD5\uFF1A
\u70B9\u51FB\u4E00\u6B21\u5757\u5757\u53EF\u4EE5\u67E5\u770B\u8FDE\u63A5\u7684\u6570\u91CF
\u518D\u6B21\u70B9\u51FB\u5373\u53EF\u6D88\u9664`,"\u5728\u5757\u5757\u8865\u5145\u524D\u5FEB\u901F\u70B9\u51FB\u53EF\u4EE5\u83B7\u5F97\u989D\u5916\u5206\u6570\uFF01"],mario:[`\u9A6C\u91CC\u5965\u533B\u751F
\u6E38\u620F\u76EE\u6807
\u540C\u8272\u6A2A\u884C\u6216\u7AD6\u884C\u76F8\u540C4\u4E2A\u4EE5\u4E0A\u53EF\u4EE5\u6D88\u9664\u5F97\u5206\uFF01`,`\u64CD\u4F5C\u65B9\u6CD5\uFF1A
\u5411\u5DE6\u3001\u53F3\u3001\u4E0B\u6ED1\u52A8\u5C4F\u5E55\u79FB\u52A8
\u5411\u4E0A\u6ED1\u52A8\u5C4F\u5E55\u65CB\u8F6C`,"\u70B9\u51FB\u5DE6\u53F3\u4E24\u4FA7\u4E5F\u53EF\u4EE5\u65CB\u8F6C","\u5982\u679C\u5757\u5757\u5806\u5230\u9876\u4E86\u5219\u5931\u8D25"],zuma:[`\u8499\u63D0\u7956\u739B
\u6E38\u620F\u76EE\u6807
\u4E0E\u76F8\u90BB\u7684\u5757\u5757\u4EA4\u6362\u4F4D\u7F6E\uFF0C\u6A2A\u884C\u6216\u7AD6\u884C\u76F8\u540C\u8FDE\u7EED3\u4E2A\u4EE5\u4E0A\u53EF\u4EE5\u6D88\u9664\u5F97\u5206\uFF01`,`\u64CD\u4F5C\u65B9\u6CD5\uFF1A
\u5411\u4E0A\u4E0B\u5DE6\u53F3\u65B9\u5411\u6ED1\u52A8\u4E00\u4E2A\u5757\u5757`,"\u8FDE\u7EED\u6D88\u9664\u5757\u5757\u53EF\u4EE5\u5F97\u5230\u66F4\u9AD8\u7684\u5206\u6570\u54E6"],line:[`\u8FDE\u7EBF\u6D88\u9664
\u6E38\u620F\u76EE\u6807
\u88AB\u8FDE\u63A5\u7684\u5757\u5757\u8D85\u8FC75\u4E2A\u5373\u53EF\u6D88\u9664\u5F97\u5206\uFF01`,`\u64CD\u4F5C\u65B9\u6CD5\uFF1A
\u6ED1\u52A8\u5C4F\u5E55\u901A\u8FC7\u540C\u4E00\u989C\u8272\u7684\u5757\u5757\u5373\u53EF
\u4E0D\u80FD\u7ECF\u8FC7\u5DF2\u7ECF\u8FDE\u63A5\u7684\u5757\u5757\u3002`,"\u8FDE\u7EBF\u8D8A\u957F\u3001\u5F97\u5206\u8D8A\u9AD8\u3002"],pair:[`\u8FDE\u8FDE\u770B
\u6E38\u620F\u76EE\u6807
\u70B9\u51FB\u8FDE\u7EBF\u76F8\u540C\u7684\u5757\u5757\u5373\u53EF\u6D88\u9664\uFF01`,`\u64CD\u4F5C\u65B9\u6CD5\uFF1A
\u5206\u522B\u70B9\u51FB\u4E24\u4E2A\u76F8\u540C\u7684\u5757\u5757\uFF0C\u5982\u679C\u6709\u8FDE\u7EBF\u8DEF\u5F84\uFF0C\u62D0\u5F2F2\u6B21\u4EE5\u5185\u5373\u53EF`],link:[`\u4E94\u5B50\u8FDE\u73E0
\u6E38\u620F\u76EE\u6807
\u79FB\u52A8\u68CB\u5B50,\u4F7F\u5F97\u6A2A\u3001\u7AD6\u6216\u659C\u884C\u76F8\u540C5\u5B50\u8FDE\u63A5\u5219\u53EF\u5408\u6210\u66F4\u9AD8\u7EA7\u7684\u5757\u5757`,`\u64CD\u4F5C\u65B9\u6CD5\uFF1A
\u70B9\u51FB\u4E00\u4E2A\u5757\u5757,\u518D\u70B9\u51FB\u4E00\u4E2A\u7A7A\u767D\u4F4D\u7F6E\uFF0C\u5982\u679C\u6709\u8DEF\u5F84\u5219\u53EF\u79FB\u52A8\u3002`,"\u5408\u6210\u7B49\u7EA7\u8D8A\u9AD8\u3001\u5206\u6570\u8D8A\u9AD8","\u6BCF\u8F6E\u751F\u62103\u4E2A\u5757\u5757\uFF0C\u5982\u679C\u65E0\u6CD5\u751F\u6210\u5219\u5931\u8D25\u3002"],m2048:[`2048
\u6E38\u620F\u76EE\u6807
\u8BA9\u76D2\u5B50\u91CC\u7684\u5757\u5757\u4E0A\u4E0B\u5DE6\u53F3\u79FB\u52A8\uFF0C\u5408\u6210\u66F4\u9AD8\u7EA7\u7684\u5757\u5757`,`\u64CD\u4F5C\u65B9\u6CD5:
\u4E0A\u3001\u4E0B\u3001\u5DE6\u3001\u53F3\u6ED1\u52A8\u5C4F\u5E55\u8BA9\u5757\u5757\u79FB\u52A8\u5E76\u5408\u6210`,"\u6BCF\u8F6E\u751F\u62103\u4E2A\u5757\u5757\uFF0C\u5982\u679C\u65E0\u6CD5\u751F\u6210\u5219\u5931\u8D25\u3002"],cat:[`\u8EB2\u732B\u732B
\u6E38\u620F\u76EE\u6807
\u901A\u8FC7\u653E\u7F6E\u5404\u79CD\u5757\u5757\uFF0C\u5408\u6210\u66F4\u9AD8\u7EA7\u7684\u5757\u5757\uFF01`,`\u64CD\u4F5C\u65B9\u6CD5\uFF1A
\u70B9\u51FB\u5C4F\u5E55\u7A7A\u767D\u4F4D\u7F6E\u5373\u53EF\u653E\u7F6E\u5757\u5757
\u6EE1\u7EC4\u76F8\u90BB\u540C\u82723\u4E2A\u4EE5\u4E0A\u5219\u53EF\u5408\u6210`,`\u9B3C\u6BCF\u8F6E\u90FD\u4F1A\u79FB\u52A8
\u9B3C\u65E0\u6CD5\u79FB\u52A8\u4F1A\u53D8\u6210\u795E\u50CF
\u795E\u50CF\u4E5F\u53EF\u5408\u6210`,"\u5F53\u6CA1\u6709\u7A7A\u95F4\u653E\u7F6E\u5219\u6E38\u620F\u5931\u8D25"],tiny:[`\u8FF7\u4F60\u4FC4\u7F57\u65AF
\u6E38\u620F\u76EE\u6807
\u6A2A\u884C\u5168\u6EE1\u6216\u8005\u540C\u8272\u8D85\u8FC74\u4E2A\u5747\u53EF\u6D88\u9664\u5F97\u5206\uFF01`,`\u64CD\u4F5C\u65B9\u6CD5\uFF1A
\u5411\u5DE6\u3001\u53F3\u3001\u4E0B\u6ED1\u52A8\u5C4F\u5E55\u79FB\u52A8
\u5411\u4E0A\u6ED1\u52A8\u5C4F\u5E55\u65CB\u8F6C`,"\u70B9\u51FB\u5DE6\u53F3\u4E24\u4FA7\u4E5F\u53EF\u4EE5\u65CB\u8F6C","\u5982\u679C\u5757\u5757\u5806\u5230\u9876\u4E86\u5219\u5931\u8D25"]},li={tetrix:"\u4FC4\u7F57\u65AF\u65B9\u5757",star:"\u6D88\u706D\u661F\u661F",mario:"\u9A6C\u91CC\u5965\u533B\u751F",zuma:"\u8499\u63D0\u7956\u739B",line:"\u8FDE\u7EBF\u6D88\u9664",pair:"\u8FDE\u8FDE\u770B",link:"\u4E94\u5B50\u8FDE\u73E0",m2048:"2048",cat:"\u8EB2\u732B\u732B",tiny:"\u8FF7\u4F60\u4FC4\u7F57\u65AF"};var J=class{};J.Rules={tetrix:Be,star:Ne,mario:Ee,zuma:ke,line:Te,pair:Se,link:Me,m2048:ye,cat:Ce,tiny:je},J.LevelTemplateConfigs={tetrix:no,star:ro,mario:oo,zuma:to,line:io,pair:so,link:eo,m2048:Ji,cat:Qi,tiny:ao};var at=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","Game")}onConstruct(){this.m_status=this.getControllerAt(0),this.m_bg=this.getChildAt(0),this.m_bg_image=this.getChildAt(1),this.m_title=this.getChildAt(2),this.m_game=this.getChildAt(3),this.m_win=this.getChildAt(4),this.m_lose=this.getChildAt(5),this.m_shop=this.getChildAt(6),this.m_select=this.getChildAt(7),this.m_mask=this.getChildAt(8)}};at.URL="ui://j8b2cwkbqrgtu";var se=class extends at{onConstruct(){super.onConstruct(),this.bindEvents(),this.changeStateTo("title")}bindEvents(){}changeStateTo(i,...t){let e=new TWEEN.Tween(this.m_mask).to({alpha:0},200);new TWEEN.Tween(this.m_mask).to({alpha:1},200).onComplete(()=>{this.m_status.selectedPage=i,a.inst.ui.ev.emit("stateChanged",i,...t),e.start()}).start()}};var De=class extends w{constructor(){super(...arguments);this._power=0;this._score=0;this._time=0;this.passed=!1;this._tasks=[];this._paused=!1;this.noTimeLimit=!1;this.noPowerFade=!1}set power(t){this._power=t,this.ev.emit("power",t)}get power(){return this._power}set score(t){this._score=t,this.ev.emit("score",t)}get score(){return this._score}set time(t){this._time=t,this.ev.emit("time",t)}get time(){return this._time}get view(){return this.game.ui.view.m_game}start(){return m(this,null,function*(){window.addEventListener("keypress",e=>{e.key==" "&&this.pause()}),this.$interval(()=>{this.rule&&this.onEverySecond()},1e3);let t=Date.now();this.$interval(()=>{let e=Date.now()-t;t=Date.now(),!this._paused&&(this._tasks.forEach(o=>{o.time-=e,o.time<=0&&o.task()}),this._tasks=this._tasks.filter(o=>o.time>0&&this.rule))})})}later(t,e){this._tasks.push({time:t,task:e})}pause(t=!this._paused){this._paused=t}onEverySecond(){this._paused||(this.noTimeLimit||(this.time=Math.max(0,this.time-1),this.levelConfig.time-this.time>10&&!this.screenshot&&this.takeScreenshot()),this.time==0&&this.gameOver(),this.noPowerFade||(this.power=Math.max(0,this.power-(this.levelConfig.powerFade||4))),this.game.profile.data.total.time+=1)}setInfinityPower(){this.power=100,this.noPowerFade=!0}setInfinityTime(){this.time=this.levelConfig.time,this.noTimeLimit=!0}gameOver(){this.leaveLevel()}startLevel(t=a.inst.profile.data.level){this.levelConfig=this.game.profile.getLevelConfig(t),console.log("\u5173\u5361\u4FE1\u606F",this.levelConfig),this.ev.emit("start"),this.time=this.levelConfig.time,this.score=0,this.power=0,this.passed=!1,this.noTimeLimit=!1,this.noPowerFade=!1,this.startRule(J.Rules[this.levelConfig.type],this.levelConfig.config),this.clearScreenshot(),this.game.sdk.startRecord()}startRule(t,e){this.rule=new t(e),this.rule.ev.on("score",o=>{this.getScore(o)}),this.rule.ev.on("fail",()=>{this.passed?(a.inst.gameplay.leaveLevel(),a.inst.ui.view.changeStateTo("win")):(this.leaveLevel(),a.inst.ui.view.changeStateTo("lose"))}),this.rule.ev.on("kill",o=>this.game.profile.data.total.kill+=o),this.rule.ev.on("join",o=>this.game.profile.data.total.combine+=o),this.rule.ev.on("score",o=>this.game.profile.data.total.score+=o),this.game.profile.data.total.level+=1,console.log("\u6E38\u620F\u5F00\u59CB",this.rule)}leaveLevel(){var t;this.ev.emit("end"),(t=this.rule)==null||t.dispose(),this.rule=null,this._tasks.length=0,this.game.sdk.stopRecord()}restartLevel(){this.leaveLevel(),this.startLevel(this.levelConfig.id)}getScore(t){this.score+=t*(this.power>80?2:1),this.power+=this.levelConfig.powerGen||20,this.score>this.levelConfig.score*.2&&(this.view.m_passed.selectedIndex=1,this.passed=!0)}getGameResultData(){let t=0;return this.score>=this.levelConfig.score?t=3:this.score>=this.levelConfig.score*.5?t=2:this.score>=this.levelConfig.score*.2&&(t=1),{star:t,time:this.levelConfig.time-this.time,score:this.score,played:1}}takeScreenshot(){return m(this,null,function*(){this.clearScreenshot(),this.screenshot=yield this.game.render2d.takeScreenshot(),console.log("\u83B7\u53D6\u622A\u56FE")})}clearScreenshot(){this.screenshot&&(this.screenshot.destroy({texture:!0}),this.screenshot=null)}};var Oe=class extends w{constructor(){super(...arguments);this.moveLimit=40}start(){this.bindKeyEvent(),this.bindTouchEvent()}bindKeyEvent(){window.addEventListener("keypress",t=>{this.ev.emit("key",t.key)})}bindTouchEvent(){let t=!1,e=0,o=0,s=0,l=0,h=0,n=0,c=0,d=null,g=500,I=!1,_=(v,C)=>Math.abs(v)>this.moveLimit&&Math.abs(C)<this.moveLimit?{x:Math.sign(v),y:0}:Math.abs(v)<this.moveLimit&&Math.abs(C)>this.moveLimit?{x:0,y:Math.sign(C)}:null;window.addEventListener("touchstart",v=>{t=!0,e=v.touches[0].clientX,o=v.touches[0].clientY,s=e,l=o,h=0,n=0,c=Date.now(),I=!1,this.ev.emit("down",s,l),d=this.$interval(()=>{if(Date.now()-c<g||!I)return;let C=_(h,n);C&&this.ev.emit("move",C.x,C.y,!0)},60)}),window.addEventListener("touchmove",v=>{if(!t)return;s=v.touches[0].clientX,l=v.touches[0].clientY,h=s-e,n=l-o;let C=_(h,n);C&&!I?(this.ev.emit("move",C.x,C.y,!1),I=!0,c=Date.now()):C||(I=!1)}),window.addEventListener("touchend",()=>{this.ev.emit("up",s,l),Math.abs(h)+Math.abs(n)<30&&this.ev.emit("click",s/window.innerWidth,l/window.innerHeight),t=!1,this.$stop(d)})}};var re=si(ci());var mi=new re.default(0,0);function di(r,i,t){return r+(i-r)*t}function Eo(r){if(r==null)return null;switch(typeof r){case"number":return r;case"object":return di(r[0],r[1],Math.random());case"function":return r(0)}}function ho(r,i){if(r==null)return null;switch(typeof r){case"number":return r;case"object":return di(r[0],r[1],i);case"function":return r(i)}}function Lo(r){return r==null?null:r instanceof re.default?r.clone():r instanceof Function?r(0):new re.default(di(r[0].x,r[1].x,Math.random()),di(r[0].y,r[1].y,Math.random()))}function ji(r){Object.getOwnPropertyNames(this).forEach(i=>{typeof this[i]=="number"?this[i]=Eo(r[i])||this[i]:this[i]instanceof re.default?this[i]=Lo(r[i])||this[i]:typeof this[i]=="string"&&(this[i]=r[i]||this[i])})}var Ni=class extends u{constructor(t){super();this.config=t;this.life=1;this._duration=1;this.vr=0;this.image="";this.scale=1;this.alpha=1;this.pos=mi;this.rot=0;this.vel=mi;ji.bind(this)(t),this._duration=this.life,this.enableUpdate(),this.sprite=new PIXI.Sprite,this.sprite.anchor.set(.5),PIXI.Assets.load(this.image).then(e=>{this.sprite.texture=e,this.update(0)})}update(t){if(this.life-=t,this.life<=0){this.dispose();return}let e=1-this.life/this._duration,o=ho(this.config.scale,e),s=ho(this.config.alpha,e);this.pos.add(this.vel.multiply(t,!0)),this.rot+=this.vr*t,this.sprite.position.set(this.pos.x,this.pos.y),this.sprite.rotation=this.rot,this.sprite.scale.set(o),this.sprite.alpha=s}dispose(){this.sprite.destroy(),super.dispose()}},Ai=class extends u{constructor(t){super();this.burstCount=1;this.freq=0;this.delay=0;this.wave=-1;this._canFire=!0;ji.bind(this)(t),this.delay?this.$delay(this.delay*1e3,()=>this.enableUpdate()):this.enableUpdate()}update(t){!this._canFire||(this.fire(),this._canFire=!1,this.$delay(this.freq*1e3,()=>this._canFire=!0),this.wave>0&&(this.wave-=1,this.wave<=0&&this.ev.emit("stop")))}fire(){for(let t=0;t<this.burstCount;t++)this.ev.emit("fire")}},Bi=class extends u{constructor(t){super();this.config=t;this.gravity=mi;this.holeHole=mi;this.dumpLinear=.995;this.dumpAngle=.995;this.particles=[];ji.bind(this)(t),this.enableUpdate()}update(t){this.particles.forEach(e=>{e.vel.add(this.gravity.multiply(t,!0))})}createItem(t){let e=new Ni(this.config);t.addChild(e.sprite),this.particles.push(e),e.ev.on("dispose",()=>{this.particles=this.particles.filter(o=>o!=e),this.particles.length==0&&this.ev.emit("empty")})}dispose(){[...this.particles].forEach(t=>t.dispose()),super.dispose()}},Vi=class extends u{constructor(t,e){super();this.emitter=new Ai(e),Object.getOwnPropertyNames(this.emitter).forEach(o=>{e[o]&&(this.emitter[o]=e[o])}),this.environement=new Bi(e),Object.getOwnPropertyNames(this.environement).forEach(o=>{e[o]&&(this.environement[o]=e[o])}),this.emitter.ev.on("fire",()=>this.environement.createItem(t)),this.emitter.ev.on("stop",()=>{this.emitter.dispose(),this.emitter=null}),this.environement.ev.on("empty",()=>this.dispose())}dispose(){var t;(t=this.emitter)==null||t.dispose(),this.environement.dispose(),super.dispose()}},Fe=class extends w{constructor(){super(...arguments);this.particles=[]}createParticle(t,e){let o=new Vi(t,e);return this.particles.push(o),o.ev.on("dispose",()=>Li(this.particles,o)),o}removeParticle(t){t.disposed||t.dispose(),Li(this.particles,t)}simpleParticle(t,e,o){this.game.particles.createParticle(this.game.ui.view.displayObject,{image:t,pos:e,vel:o,gravity:new re.default(0,2e3),scale:1,alpha:[1,0],vr:[-10,10],life:2,burstCount:12,freq:2,wave:1,delay:0})}};var Rt=[{type:"tetrix",config:{width:8,height:14,fallSpeed:500,baseLevel:3,levelFill:.5},score:100,time:300,name:"\u4FC4\u7F57\u65AF\u65B9\u5757"},{type:"pair",config:{replaces:"\u8FD9\u662F\u4E2A\u795E\u5947\u7684\u8FDE\u8FDE\u770B\u6E38\u620F"},score:30,time:300,name:"\u8FDE\u8FDE\u770B\u5165\u95E8"},{type:"cat",config:{},score:30,time:300},{type:"line",config:{},score:100,time:300},{type:"link",config:{},score:100,time:300},{type:"m2048",config:{},score:300,time:300},{type:"mario",config:{},score:100,time:300},{type:"star",config:{},score:100,time:300},{type:"tiny",config:{},score:100,time:300},{type:"zuma",config:{},score:100,time:300}];for(let r=0;r<100;r++)Rt.push({type:"tetrix",config:{},score:100,time:300});for(let r=0;r<Rt.length;r++)Rt[r].id=r;var co={theme_default:{id:"theme_default",path:"./assets/image/matrix.jpg"}};var ui=class extends w{constructor(){super(...arguments);this.genStarTime=300}start(){this.loadData(),this.applyData(),this.$interval(()=>{this.genStarTime-=1,this.ev.emit("genStarTime",this.genStarTime)},1e3)}applyData(){a.inst.sound.setupVolume()}loadData(){let t=localStorage.getItem(Ei);t?this.data=JSON.parse(t):(this.newData(),this.saveData());let e=Date.now()-this.data.lastTime}newData(){this.data=So}saveData(){this.data.lastTime=Date.now(),localStorage.setItem(Ei,JSON.stringify(this.data))}getLevelConfig(t){let e=Pi().id?Pi():Rt[t];e.config=e.config||{};let o={};for(let s in J.LevelTemplateConfigs[e.type])o[s]=e.config[s]||e[s]||J.LevelTemplateConfigs[e.type][s];return e.config=o,e}saveLevelData(t,e){let o=this.getLevelData(t);this.data.levelData[t]={star:Math.max(e.star,o.star),score:Math.max(e.score,o.score),time:o.time+e.time,played:o.played+e.played},console.log("\u66F4\u65B0\u5173\u5361\u4FE1\u606F",this.data.levelData[t]),this.saveData()}getLevelData(t){return this.data.levelData[t]||{star:0,score:0,time:0,played:0}}getPlayTimeStar(){this.getStar(),this.genStarTime=300,this.saveData()}getStar(t=1){this.data.star+=t,this.data.total.star+=t,this.saveData()}useStar(t=3){return this.data.star>=t?(this.data.star-=t,this.saveData(),!0):!1}unlockLevel(t=this.data.level+1){this.data.level=t,this.saveData()}getShopConfig(t){return co[t]}tryGetBonus(){return Date.now()-this.data.bonusTime>24*60*60*1e3?(this.getStar(3),!0):!1}};var So={bgm:!0,fx:!0,vibrate:!0,createTime:Date.now(),lastTime:Date.now(),level:1,star:0,bonusTime:0,levelData:{},unlocked:["theme_default","music_default","sound_default","block_default","color_default"],theme:"theme_default",music:"music_default",sound:"sound_default",block:"block_default",color:"color_default",total:{time:0,level:0,star:0,kill:0,combine:0,score:0}};var ze=class extends w{constructor(){super(...arguments);this.canvas=globalThis.screencanvas||document.getElementById("ui");this.ev=new tt(this);this.evInput=new tt(this);this.enabled=!0}init(){PIXI.settings.RENDER_OPTIONS.hello=!1;let t=new PIXI.Application({view:this.canvas,hello:!1,clearBeforeRender:!1,backgroundColor:16777215,backgroundAlpha:0,antialias:!1,autoStart:!1,resolution:1,width:window.innerWidth,height:window.innerHeight});this.app=t,this.renderer=this.app.renderer,this.scene=new PIXI.Container,this.app.stage.addChild(this.scene),this.game.ev.on("render",e=>{this.doRender(e)}),this.setupInputBoundary(),this.game.ev.on("resize",this.doResize.bind(this)),this.doResize()}setupInputBoundary(){this.boundary=new PIXI.EventBoundary(this.scene)}doRender(t){!this.enabled||(this.renderer.render(this.scene),this.ev.emit("render",this.renderer))}doResize(t=window.innerWidth,e=window.innerHeight){if(this.game.render2d.app.renderer.resize(t,e),this.scene){let o=t<e?t/ee.width:e/ee.height;this.scene.scale.set(o)}}takeScreenshot(){return m(this,null,function*(){return new Promise(t=>{let e=()=>{let o=this.app.renderer.extract.pixels(),s=PIXI.Texture.fromBuffer(o,window.innerWidth,window.innerHeight),l=new PIXI.Sprite(s);t(l),this.ev.off("render",e)};this.ev.on("render",e)})})}};var We=class extends w{constructor(){super(...arguments);this.native=window.tt||null}start(){}toast(t){var e;(e=this.native)==null||e.showToast({title:t})}showShare(){var t;(t=this.native)==null||t.showShareMenu()}startRecord(){var t,e,o;this.recorder||(this.recorder=(t=this.native)==null?void 0:t.getGameRecorderManager(),(e=this.recorder)==null||e.onStop(s=>{this.videoPath=s.videoPath,console.log("\u8BB0\u5F55\u89C6\u9891\u5206\u4EAB\u5730\u5740",this.videoPath)}));try{(o=this.recorder)==null||o.start({duration:300})}catch(s){this.recorder=null,console.error("\u5F00\u59CB\u5F55\u5C4F\u51FA\u9519")}this.videoPath=""}stopRecord(){var t;(t=this.recorder)==null||t.stop()}share(){return new Promise(t=>{var e;this.native||t(!1),this.videoPath||t(!1),(e=this.native)==null||e.shareAppMessage({title:"\u5206\u4EAB\u89C6\u9891\u5566",channel:"video",templateId:"89l1fmhfshk94k6bkp",extra:{videoTopics:["\u8FDE\u8FDE\u770B","\u6478\u9C7C","\u641E\u7B11"],videoPath:this.videoPath,withVideoId:!0},success(o){K.show({text:"\u5206\u4EAB\u6210\u529F\uFF01"}),t(!0)},fail(o){console.log("\u5931\u8D25",o),t(!1)}})})}bindInputEvents(){this.game.render2d.canvas.addEventListener("pointermove",t=>{fgui.GRoot.globalMouseStatus.mouseX=t.clientX,fgui.GRoot.globalMouseStatus.mouseY=t.clientY,console.log("move")}),this.game.render2d.canvas.addEventListener("pointerdown",t=>{fgui.GRoot.globalMouseStatus.touchDown=!0,console.log("down")}),this.game.render2d.canvas.addEventListener("pointerup",t=>{fgui.GRoot.globalMouseStatus.touchDown=!1,console.log("up")}),this.game.render2d.canvas.addEventListener("mouseout",t=>{fgui.GRoot.globalMouseStatus.touchDown=!1})}};var xo=si(bo()),fi=class{constructor(i){this.heap=new xo.MinHeap,this.getCurrentTime=i}callAfter(i,t){this.heap.insert(this.getCurrentTime()+i,t)}callAt(i,t){this.heap.insert(i,t)}update(i){let t=this.heap.root;for(;t&&this.getCurrentTime()>=t.key;){let e=t.value;if(!e.cancelled)try{e.execute()}catch(o){console.error(o)}this.heap.remove(0),t=this.heap.root}}};var He,gi=class{constructor(){Zt(this,He,-1);this.root=new At(-1,null),this.root.next=this.root,this.root.prev=this.root}get expiration(){return T(this,He)}set expiration(i){ce(this,He,i)}*[Symbol.iterator](){let i=this.root.next;for(;i!==this.root;){let t=i.next;i.cancelled||(yield i),i=t}}add(i){let t=!1;for(;!t;)if(i.remove(),i.list==null){let e=this.root.prev;i.next=this.root,i.prev=e,i.list=this,e.next=i,this.root.prev=i,t=!0}}remove(i){i.list===this&&(i.next.prev=i.prev,i.prev.next=i.next,i.next=null,i.prev=null,i.list=null)}flush(i){let t=this.root.next;for(;t!==this.root;){let e=t.next;if(this.remove(t),!t.cancelled&&!i.add(t)&&(t.execute&&t.execute(),i&&t.intervalDuration!==null)){let o=t;o.expirationMs+=o.intervalDuration,i.add(o)}t=e}this.expiration=-1}};He=new WeakMap;var At=class{constructor(i,t,e=null){this.list=null;this.next=null;this.prev=null;this.cancelled=!1;this.execute=t,this.expirationMs=i,this.intervalDuration=e}get key(){return this.expirationMs}remove(){let i=this.list;i!=null&&i.remove(this)}};var ne=class{constructor(i=10,t=20,e=0,o=null,s=null){this.overflowWheel=null;this.tickMs=i,this.wheelSize=t,this.interval=i*t,this.buckets=[...Array(t)].map(l=>new gi),this.currentTime=e-e%i,this.dq=o,this.root=s===null?this:s}addOverflowWheel(){this.overflowWheel||(this.overflowWheel=new ne(this.interval,this.wheelSize,this.currentTime,this.dq,this.root))}add(i){let t=i.expirationMs;if(i.cancelled)return!1;if(t<this.currentTime+this.tickMs)return!1;if(t<this.currentTime+this.interval){let e=Math.floor(t/this.tickMs),o=this.buckets[e%this.wheelSize];o.add(i);let s=e*this.tickMs;return o.expiration!==s&&(o.expiration=s,this.dq.callAt(o.expiration,{cancelled:!1,execute:()=>{this.root.advanceClock(o.expiration),o.flush(this.root)}})),!0}else return this.overflowWheel==null&&this.addOverflowWheel(),this.overflowWheel.add(i)}advanceClock(i){i>=this.currentTime+this.tickMs&&(this.currentTime=i-i%this.tickMs,this.overflowWheel!=null&&this.overflowWheel.advanceClock(this.currentTime))}};var Q,Bt,ae,wi=class extends w{constructor(){super();Zt(this,Q,void 0);Zt(this,Bt,void 0);Zt(this,ae,new Map)}getDelayQueue(){return T(this,Bt)}init(){ce(this,Bt,new fi(()=>this.game.time.logicTime)),ce(this,Q,new ne(10,20,this.game.time.logicTime,T(this,Bt)))}cancel(t){if(t instanceof At){if(!t.cancelled)return t.cancelled=!0,t.remove(),!0}else{let e=T(this,ae).get(t);if(e)return e.cancelled=!0,!0}return!1}interval(t,e=null){if(t<T(this,Q).tickMs)throw new Error(`\u95F4\u9694\u65F6\u95F4\u7C92\u5EA6 ${t} \u5C0F\u4E8E\u6700\u5C0F\u5141\u8BB8\u65F6\u95F4 ${T(this,Q).tickMs}`);let o=new At(this.game.time.logicTime+t,e,t);return T(this,Q).add(o),o}delay(t,e=null){if(t<T(this,Q).tickMs)throw new Error(`\u95F4\u9694\u65F6\u95F4\u7C92\u5EA6 ${t} \u5C0F\u4E8E\u6700\u5C0F\u5141\u8BB8\u65F6\u95F4 ${T(this,Q).tickMs}`);let o=new At(this.game.time.logicTime+t,null),s=new Promise((l,h)=>{let n=()=>{T(this,ae).delete(s),e&&e(),l(null)};o.execute=n,T(this,Q).add(o)});return T(this,ae).set(s,o),s}update(t){T(this,Bt).update(t)}};Q=new WeakMap,Bt=new WeakMap,ae=new WeakMap;var vi=class extends w{constructor(){super(...arguments);this.logicTime=0;this.startTime=0;this.realityTime=0}updateFixed(t){let e=t*1e3;this.startTime+=e,this.realityTime+=e}update(t){let e=t*1e3;this.logicTime+=e}};var $i=si(ci());var lt=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("loading","loading")}onConstruct(){this.m_state=this.getControllerAt(0),this.m_bg=this.getChildAt(0),this.m_loadingCircle=this.getChildAt(1),this.m_loadingBar=this.getChildAt(2),this.m_role_slot=this.getChildAt(3)}};lt.URL="ui://kq97nyc0kmld87";var $e=class{static bindAll(){fgui.UIObjectFactory.setPackageItemExtension(lt.URL,lt)}};var ht=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","DialogShare")}onConstruct(){this.m_frame=this.getChildAt(0),this.m_btnYes=this.getChildAt(1),this.m_slot=this.getChildAt(2),this.m_text=this.getChildAt(3)}};ht.URL="ui://j8b2cwkb7oxo5";var Vt=class extends fgui.GButton{static createInstance(){return fgui.UIPackage.createObject("main","_Frame")}onConstruct(){this.m_withClose=this.getControllerAt(0),this.m_withBG=this.getControllerAt(1),this.m_dragArea=this.getChildAt(1),this.m_contentArea=this.getChildAt(3),this.m_closeButton=this.getChildAt(4)}};Vt.URL="ui://j8b2cwkbcx8ui";var ct=class extends fgui.GButton{static createInstance(){return fgui.UIPackage.createObject("main","scaleBtn")}onConstruct(){this.m_with_ad=this.getControllerAt(1),this.m_with_lock=this.getControllerAt(2),this.m_adPos=this.getControllerAt(3),this.m_titleDown=this.getControllerAt(4),this.m_ad=this.getChildAt(1)}};ct.URL="ui://j8b2cwkbkmld83";var mt=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","DialogSetting")}onConstruct(){this.m_frame=this.getChildAt(0),this.m_btn_fx=this.getChildAt(7),this.m_btn_bgm=this.getChildAt(8),this.m_btn_vibrate=this.getChildAt(9),this.m_reset=this.getChildAt(10)}};mt.URL="ui://j8b2cwkbkmld86";var dt=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","stage")}onConstruct(){this.m_passed=this.getControllerAt(0),this.m_zone=this.getChildAt(0),this.m_level=this.getChildAt(1),this.m_btn_back=this.getChildAt(2),this.m_preview_zone=this.getChildAt(3),this.m_btn_help=this.getChildAt(4),this.m_btn_restart=this.getChildAt(6),this.m_btn_power=this.getChildAt(8),this.m_btn_time=this.getChildAt(10),this.m_score_bar=this.getChildAt(13),this.m_score_text=this.getChildAt(15),this.m_score=this.getChildAt(16),this.m_power_bar=this.getChildAt(17),this.m_power_text=this.getChildAt(19),this.m_power=this.getChildAt(20),this.m_time_bar=this.getChildAt(21),this.m_time_text=this.getChildAt(22),this.m_time=this.getChildAt(24),this.m_btn_pass=this.getChildAt(25)}};dt.URL="ui://j8b2cwkbkmld88";var jt=class extends fgui.GLabel{static createInstance(){return fgui.UIPackage.createObject("main","titleLabel")}onConstruct(){this.m_gray=this.getControllerAt(0)}};jt.URL="ui://j8b2cwkbkmld8a";var ut=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","win")}onConstruct(){this.m_star=this.getControllerAt(0),this.m_title=this.getChildAt(0),this.m_btn_retry=this.getChildAt(1),this.m_btn_skip=this.getChildAt(2),this.m_star_1_b=this.getChildAt(3),this.m_star_2_b=this.getChildAt(4),this.m_star_3_b=this.getChildAt(5),this.m_face=this.getChildAt(6),this.m_star_1=this.getChildAt(7),this.m_star_2=this.getChildAt(8),this.m_star_3=this.getChildAt(9)}};ut.URL="ui://j8b2cwkbkmld8e";var pt=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","lose")}onConstruct(){this.m_title=this.getChildAt(0),this.m_btn_retry=this.getChildAt(1),this.m_btn_skip=this.getChildAt(2),this.m_face=this.getChildAt(3),this.m_star_1_b=this.getChildAt(4),this.m_star_2_b=this.getChildAt(5),this.m_star_3_b=this.getChildAt(6)}};pt.URL="ui://j8b2cwkbkmld8g";var ft=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","shop")}onConstruct(){this.m_title=this.getChildAt(0),this.m_back=this.getChildAt(1),this.m_list=this.getChildAt(2)}};ft.URL="ui://j8b2cwkbkmld8h";var Dt=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","levelItem")}onConstruct(){this.m_state=this.getControllerAt(0),this.m_bg=this.getChildAt(0),this.m_select=this.getChildAt(1),this.m_icon=this.getChildAt(2),this.m_title=this.getChildAt(3),this.m_star_1=this.getChildAt(5),this.m_star_2=this.getChildAt(6),this.m_star_3=this.getChildAt(7),this.m_level=this.getChildAt(8)}};Dt.URL="ui://j8b2cwkbkmld8i";var gt=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","title")}onConstruct(){this.m_debug=this.getControllerAt(0),this.m_setting=this.getChildAt(0),this.m_achivement=this.getChildAt(1),this.m_shop=this.getChildAt(2),this.m_start=this.getChildAt(3),this.m_tetrix=this.getChildAt(5),this.m_star=this.getChildAt(6),this.m_mario=this.getChildAt(7),this.m_zuma=this.getChildAt(8),this.m_line=this.getChildAt(9),this.m_pair=this.getChildAt(10),this.m_link=this.getChildAt(11),this.m_m2048=this.getChildAt(12),this.m_cat=this.getChildAt(13),this.m_tiny=this.getChildAt(14),this.m_starPanel=this.getChildAt(16),this.m_t0=this.getTransitionAt(0)}};gt.URL="ui://j8b2cwkbkmld8j";var Ot=class extends fgui.GButton{static createInstance(){return fgui.UIPackage.createObject("main","MuteButton")}onConstruct(){this.m_state=this.getControllerAt(1)}};Ot.URL="ui://j8b2cwkbkywt2s";var Ft=class extends fgui.GProgressBar{static createInstance(){return fgui.UIPackage.createObject("main","loadingBar")}onConstruct(){this.m_color=this.getControllerAt(0),this.m_score=this.getControllerAt(1)}};Ft.URL="ui://j8b2cwkbpatr8k";var zt=class extends fgui.GButton{static createInstance(){return fgui.UIPackage.createObject("main","StoryChoicesItem")}onConstruct(){this.m_bg=this.getChildAt(0)}};zt.URL="ui://j8b2cwkbv44rp";var Wt=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","stageZone")}onConstruct(){this.m_hideBG=this.getControllerAt(0),this.m_bg=this.getChildAt(0)}};Wt.URL="ui://j8b2cwkbvzofb8";var wt=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","DialogConfirm")}onConstruct(){this.m_frame=this.getChildAt(0),this.m_btnYes=this.getChildAt(1),this.m_btnNo=this.getChildAt(2),this.m_text=this.getChildAt(3)}};wt.URL="ui://j8b2cwkbxatjb2";var vt=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","DialogAlert")}onConstruct(){this.m_frame=this.getChildAt(0),this.m_btnYes=this.getChildAt(1),this.m_text=this.getChildAt(2)}};vt.URL="ui://j8b2cwkbxatjb3";var Ht=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","DialogNewSkin")}onConstruct(){this.m_frame=this.getChildAt(0),this.m_btnYes=this.getChildAt(1),this.m_title=this.getChildAt(2)}};Ht.URL="ui://j8b2cwkbxatjb5";var bt=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","ADZone")}onConstruct(){this.m_bg=this.getChildAt(0),this.m_text=this.getChildAt(1)}};bt.URL="ui://j8b2cwkbxatjb6";var $t=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","shopItem")}onConstruct(){this.m_type=this.getControllerAt(0),this.m_state=this.getControllerAt(1),this.m_bg=this.getChildAt(0),this.m_select=this.getChildAt(1),this.m_icon=this.getChildAt(2),this.m_title=this.getChildAt(3)}};$t.URL="ui://j8b2cwkby7ddba";var Xt=class extends fgui.GButton{static createInstance(){return fgui.UIPackage.createObject("main","scaleToggleBtn")}onConstruct(){this.m_with_ad=this.getControllerAt(1),this.m_with_lock=this.getControllerAt(2),this.m_adPos=this.getControllerAt(3),this.m_ad=this.getChildAt(1)}};Xt.URL="ui://j8b2cwkby7ddbb";var xt=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","select")}onConstruct(){this.m_title=this.getChildAt(0),this.m_back=this.getChildAt(1),this.m_list=this.getChildAt(2)}};xt.URL="ui://j8b2cwkby7ddbc";var yt=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","DialogAchivement")}onConstruct(){this.m_frame=this.getChildAt(0),this.m_time=this.getChildAt(8),this.m_level=this.getChildAt(9),this.m_star=this.getChildAt(10),this.m_kill=this.getChildAt(11),this.m_combine=this.getChildAt(12),this.m_score=this.getChildAt(13),this.m_rank=this.getChildAt(14)}};yt.URL="ui://j8b2cwkby7ddbd";var It=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","starPanel")}onConstruct(){this.m_isReady=this.getControllerAt(0),this.m_count=this.getChildAt(2),this.m_tip=this.getChildAt(3),this.m_t0=this.getTransitionAt(0)}};It.URL="ui://j8b2cwkby7ddbe";var Ct=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","DialogUnlock")}onConstruct(){this.m_frame=this.getChildAt(0),this.m_userStar=this.getChildAt(1),this.m_watchAD=this.getChildAt(2),this.m_text=this.getChildAt(3),this.m_starCount=this.getChildAt(6)}};Ct.URL="ui://j8b2cwkby7ddbl";var _t=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","DialogTip")}onConstruct(){this.m_isEnd=this.getControllerAt(0),this.m_withPrev=this.getControllerAt(1),this.m_frame=this.getChildAt(0),this.m_text=this.getChildAt(1),this.m_prev=this.getChildAt(2),this.m_next=this.getChildAt(3)}};_t.URL="ui://j8b2cwkby7ddbm";var Xe=class{static bindAll(){fgui.UIObjectFactory.setPackageItemExtension(ht.URL,ht),fgui.UIObjectFactory.setPackageItemExtension(Vt.URL,Vt),fgui.UIObjectFactory.setPackageItemExtension(ct.URL,ct),fgui.UIObjectFactory.setPackageItemExtension(mt.URL,mt),fgui.UIObjectFactory.setPackageItemExtension(dt.URL,dt),fgui.UIObjectFactory.setPackageItemExtension(jt.URL,jt),fgui.UIObjectFactory.setPackageItemExtension(ut.URL,ut),fgui.UIObjectFactory.setPackageItemExtension(pt.URL,pt),fgui.UIObjectFactory.setPackageItemExtension(ft.URL,ft),fgui.UIObjectFactory.setPackageItemExtension(Dt.URL,Dt),fgui.UIObjectFactory.setPackageItemExtension(gt.URL,gt),fgui.UIObjectFactory.setPackageItemExtension(Ot.URL,Ot),fgui.UIObjectFactory.setPackageItemExtension(Ft.URL,Ft),fgui.UIObjectFactory.setPackageItemExtension(rt.URL,rt),fgui.UIObjectFactory.setPackageItemExtension(at.URL,at),fgui.UIObjectFactory.setPackageItemExtension(zt.URL,zt),fgui.UIObjectFactory.setPackageItemExtension(nt.URL,nt),fgui.UIObjectFactory.setPackageItemExtension(Wt.URL,Wt),fgui.UIObjectFactory.setPackageItemExtension(wt.URL,wt),fgui.UIObjectFactory.setPackageItemExtension(vt.URL,vt),fgui.UIObjectFactory.setPackageItemExtension(et.URL,et),fgui.UIObjectFactory.setPackageItemExtension(Ht.URL,Ht),fgui.UIObjectFactory.setPackageItemExtension(bt.URL,bt),fgui.UIObjectFactory.setPackageItemExtension($t.URL,$t),fgui.UIObjectFactory.setPackageItemExtension(Xt.URL,Xt),fgui.UIObjectFactory.setPackageItemExtension(xt.URL,xt),fgui.UIObjectFactory.setPackageItemExtension(yt.URL,yt),fgui.UIObjectFactory.setPackageItemExtension(It.URL,It),fgui.UIObjectFactory.setPackageItemExtension(Ct.URL,Ct),fgui.UIObjectFactory.setPackageItemExtension(_t.URL,_t)}};function Oo(r,i,t,e){PIXI.Assets?zo(r,i,t):Fo(r,i,t,e)}function Fo(r,i,t,e){let o={loadType:PIXI.LoaderResource.LOAD_TYPE.XHR,xhrType:PIXI.LoaderResource.XHR_RESPONSE_TYPE.BUFFER},s=new fgui.utils.AssetLoader;if(r.includes(",")){let l=r.split(","),h=i.split(",");for(let n=0;n<l.length;n++)s.add(l[n],h[n],h[n].endsWith(".txt")?o:null)}else s.add(r,i,i.endsWith(".txt")?o:null);return e&&s.onProgress.add((...l)=>{console.log("\u662F\u5426\u6709\u8FC7\u7A0B\u8FD4\u56DE",l),e(...l)}),t&&s.onComplete.add((l,h)=>{t(h),s.destroy()}),s.load(),s}function zo(r,i,t,e){let o=PIXI.Assets;if(r.includes(",")){let s=r.split(","),l=i.split(",");for(let h=0;h<s.length;h++)o.add(s[h],l[h]);o.load(s).then(h=>{t&&t(h)})}else o.add(r,i),o.load(r).then(s=>{console.log("load done",s),t&&t(s)})}function yo(r,i){return new Promise((t,e)=>{Oo(r,i,o=>{r.includes(",")?t(o):t(o[r]||o)})})}function Wo(r){fgui.UIObjectFactory.setPackageItemExtension(r.URL,r)}var bi=class extends w{constructor(){super(...arguments);this.binds=[];this.config={designWidth:900,designHeight:1600,orientation:"auto",packages:[]};this.domElements=[]}get view(){return fgui.GRoot.inst.numChildren>0&&fgui.GRoot.inst.getChildAt(0)}setupFgui(){fgui.UIConfig.modalLayerAlpha=.6,fgui.UIConfig.modalLayerColor=0,fgui.GRoot.inst.setSize(this.config.designWidth,this.config.designHeight),fgui.GRoot.inst.attachTo(this.game.render2d.app,{designWidth:this.config.designWidth,designHeight:this.config.designHeight,scaleMode:"exactFit",orientation:this.config.orientation,initliazeHTMLInput:!1,alignV:0,alignH:3}),this.game.render2d.canvas.addEventListener("touchdown",e=>{fgui.GRoot.globalMouseStatus.touchDown=!0}),console.log("\u7ED1\u5B9A\u4E8B\u4EF6\u4E86\u4E48"),document.addEventListener("touchmove",e=>{let o=e.touches[0];fgui.GRoot.globalMouseStatus.mouseX=o.clientX,fgui.GRoot.globalMouseStatus.mouseY=o.clientY}),document.addEventListener("touchdown",e=>{fgui.GRoot.globalMouseStatus.touchDown=!0}),document.addEventListener("touchup",e=>{fgui.GRoot.globalMouseStatus.touchDown=!1}),document.addEventListener("touchout",e=>{fgui.GRoot.globalMouseStatus.touchDown=!1}),this.game.render2d.canvas&&this.game.render2d.ev.on("render",e=>{e.render(fgui.GRoot.inst.$container)});let t=a.inst;this.ev.on("loaded",()=>this.doResize(window.innerWidth,window.innerHeight)),t.ev.on("resize",()=>this.doResize(window.innerWidth,window.innerHeight)),t.ev.on("render",()=>{for(let e of this.domElements){let o=e.obj.parent.parent,s=e.el;s.style.left=`${(o.x+e.obj.x)*fgui.GRoot.inst.scaleX}px`,s.style.top=`${(o.y+e.obj.y)*fgui.GRoot.inst.scaleY}px`}})}doResize(t=window.innerWidth,e=window.innerHeight){if(this.game.render2d.app.renderer.resize(t,e),this.view){let o=t<e?t/ee.width:e/ee.height;this.view.setSize(t/o,e/o),fgui.GRoot.inst.setSize(t/o,e/o),fgui.GRoot.inst.scaleX=o,fgui.GRoot.inst.scaleY=o}}loadPackages(t){return m(this,null,function*(){let e=[],o=[],s,l=[];for(let h of this.config.packages)if(h.mode==t){e.push(h.name),o.push(h.path),l.push(h.name),h.mode=="entry"&&(s=h.name);for(let n of h.res)o.push(n.path),e.push(n.name);h.binder.bindAll()}yield yo(e.join(","),o.join(","));for(let h of l)fgui.UIPackage.addPackage(h);this.bindExtension(),s&&this.setupCurrentView(s)})}setupCurrentView(t){let o=this.config.packages.find(s=>s.name==t).cls.createInstance();fgui.GRoot.inst.addChild(o),o.relations.add(fgui.GRoot.inst,24),this.doResize(window.innerWidth,window.innerHeight)}changePackageTo(t){this.view&&this.view.dispose(),this.setupCurrentView(t)}bindExtension(){for(let t of this.binds)Wo(t)}init(){return m(this,null,function*(){this.setupFgui(),yield this.loadPackages("entry"),this.ev.emit("loaded")})}};var Ye=class extends ct{onConstruct(){super.onConstruct(),a.inst.task.$nextTick(()=>{this.m_with_ad.selectedIndex==1&&(this.m_adPos.selectedPage=="mid"?(this.m_ad.x=16,this.m_ad.y=this.height*.5-this.m_ad.height*.5):this.m_adPos.selectedPage=="bot"&&(this.m_ad.y=this.height-this.m_ad.height))})}};var O=class extends p{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(O.createInstance.bind(O),O.destroy.bind(O),O.count))}static createInstance(){let i=new O,t=O._createContext();return i.context=t,t.src=O.path,t.autoplay=O.autoplay,t.loop=O.loop,t.volume=O.volume,O._bindStopEvent(i),i}},Yt=O;Yt.path="assets/sound/kill.mp3",Yt.tag="fx",Yt.loop=!1;var F=class extends p{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(F.createInstance.bind(F),F.destroy.bind(F),F.count))}static createInstance(){let i=new F,t=F._createContext();return i.context=t,t.src=F.path,t.autoplay=F.autoplay,t.loop=F.loop,t.volume=F.volume,F._bindStopEvent(i),i}},kt=F;kt.path="assets/sound/Music3.mp3",kt.tag="bgm",kt.loop=!0;var xi=class extends M{constructor(){super(_t)}onInit(){super.onInit(),this.view.m_next.onClick(()=>{this.view.m_isEnd.selectedIndex?this.hide():(this.index+=1,this.updateView())}),this.view.m_prev.onClick(()=>{this.index-=1})}onShown(){super.onShown(),this.tips=this.extra.tips,this.index=0,this.updateView()}updateView(){this.view.m_text.text=this.tips[this.index],this.view.m_withPrev.selectedIndex=this.index>0?1:0,this.view.m_isEnd.selectedIndex=this.index==this.tips.length-1?1:0}};var qe=class extends dt{constructor(){super(...arguments);this.items={power:0,time:0,score:0}}onConstruct(){super.onConstruct(),this.bindEvents(),this.bindGameEvents()}updateView(){a.inst.sound.bgm=ot([H,$,kt]);let t=a.inst.gameplay.levelConfig;this.m_level.title=t.name||`${li[t.type]}`,a.inst.ad.banner.hide()}bindEvents(){a.inst.ui.ev.on("stateChanged",t=>{t=="game"&&this.updateView()}),this.m_btn_back.onClick(()=>{a.inst.gameplay.leaveLevel(),a.inst.ui.view.changeStateTo("select"),a.inst.ad.interstitial.show()}),this.m_btn_restart.onClick(()=>{a.inst.gameplay.restartLevel()}),this.m_btn_power.onClick(()=>m(this,null,function*(){(yield a.inst.ad.video.pay())>0&&a.inst.gameplay.setInfinityPower()})),this.m_btn_time.onClick(()=>m(this,null,function*(){(yield a.inst.ad.video.pay())>0&&a.inst.gameplay.setInfinityTime()})),this.m_btn_help.onClick(()=>{a.inst.gameplay.pause(!0),xi.showAndWait({extra:{tips:lo[a.inst.gameplay.levelConfig.type]}}).then(()=>{a.inst.gameplay.pause(!1)})}),this.m_btn_pass.onClick(()=>{a.inst.gameplay.leaveLevel(),a.inst.ui.view.changeStateTo("win")})}bindGameEvents(){a.inst.gameplay.ev.on("start",()=>{console.log("\u91CD\u7F6E\u89C6\u56FE"),this.resetAll()}),a.inst.gameplay.ev.on("end",()=>{this.resetAll()}),a.inst.gameplay.ev.on("power",t=>{this._powerTween&&this._powerTween.stop(),this._powerTween=new TWEEN.Tween(this.items).onUpdate(()=>{this.m_power_bar.value=this.items.power,this.m_power_text.text=this.items.power.toFixed(0)}).to({power:t},300).start()}),a.inst.gameplay.ev.on("score",t=>{Yt.play(),this._scoreTween&&this._scoreTween.end(),this._scoreTween=new TWEEN.Tween(this.items).onUpdate(()=>{this.m_score_bar.value=100*this.items.score/a.inst.gameplay.levelConfig.score,this.m_score_text.text=this.items.score.toFixed(0)}).to({score:t},300).start()}),a.inst.gameplay.ev.on("time",t=>{this.m_time_bar.value=100*t/a.inst.gameplay.levelConfig.time,this.m_time_text.text=t+""})}resetAll(){this.m_power_bar.value=0,this.m_power_text.text="",this._powerTween&&(this._powerTween.stop(),this._powerTween=null),this.m_time_bar.value=0,this.m_time_text.text="0",this.m_score_bar.value=0,this.m_score_text.text="0",this._scoreTween&&(this._scoreTween.stop(),this._scoreTween=null),this.m_passed.selectedIndex=0}};var le=class extends lt{constructor(){super(...arguments);this.updateLoading=()=>{this.m_loadingCircle.rotation+=10,this.m_loadingBar.value+=1}}onConstruct(){super.onConstruct(),console.log("\u52A0\u8F7D\u8D44\u6E90\u4E2D\u3002\u3002\u3002"),this.loadAssets(),this.m_bg.onClick(()=>{console.log("\u70B9\u51FB\u4E86"),this.m_state.selectedPage=="ready"&&a.inst.ui.changePackageTo("main")})}loadAssets(){return m(this,null,function*(){this.m_loadingBar.value=0,a.inst.ev.on("update",this.updateLoading),yield a.inst.ui.loadPackages("dynamic"),yield a.inst.assets.loadSpine(),yield a.inst.ui.$wait(()=>this.m_loadingBar.value>=100),a.inst.ev.off("update",this.updateLoading),this.m_state.selectedPage="ready",a.inst.ui.changePackageTo("main")})}};var Mt=class extends M{constructor(){super(Ct)}onInit(){super.onInit(),this.view.m_userStar.onClick(()=>{a.inst.profile.useStar(3)?(this.extra.resolve=!0,this.hide()):K.show({text:"\u4F60\u7684\u661F\u661F\u4E0D\u591F\u54E6\uFF0C\u591A\u591A\u5C1D\u8BD5\u5427"})}),this.view.m_watchAD.onClick(()=>{a.inst.ad.video.pay().then(i=>{i>0&&(this.extra.resolve=!0,this.hide())})})}onShown(){super.onShown(),this.view.m_starCount.text=a.inst.profile.data.star+""}};var Ke=class extends pt{constructor(){super(...arguments);this.isNext=!1}onConstruct(){super.onConstruct(),this.m_btn_retry.onClick(()=>{a.inst.ui.view.changeStateTo("game"),a.inst.gameplay.restartLevel()}),this.m_btn_skip.onClick(()=>m(this,null,function*(){this.isNext?Mt.showAndWait().then(t=>{t?(a.inst.profile.unlockLevel(),a.inst.ui.view.changeStateTo("game"),a.inst.gameplay.startLevel()):a.inst.ui.view.changeStateTo("select")}):a.inst.ui.view.changeStateTo("select")})),a.inst.ui.ev.on("stateChanged",t=>{t=="lose"&&this.updateView()})}updateView(){a.inst.sound.bgm=null,it.play(),a.inst.gameplay.levelConfig.id==a.inst.profile.data.level?(this.m_btn_skip.title="\u8DF3\u5173",this.isNext=!0):(this.m_btn_skip.title="\u8FD4\u56DE",this.isNext=!1)}};var Ze=class extends xt{onConstruct(){super.onConstruct(),this.bindEvents(),this.setupView()}bindEvents(){this.m_back.onClick(()=>{a.inst.ui.view.changeStateTo("title")}),a.inst.ui.ev.on("stateChanged",i=>{i=="select"&&this.updateView()})}setupView(){this.m_list.itemRenderer=(i,t)=>{let e=Rt[i],o=a.inst.profile.getLevelData(i),s=a.inst.profile.data.level+1;i>s?t.m_state.selectedPage="hidden":i==s?t.m_state.selectedPage="lock":t.m_state.selectedPage=o.star==3?"perfect":"retry",t.m_title.text=e.name||`${li[e.type]}`,t.m_star_1.selected=o.star<1,t.m_star_2.selected=o.star<2,t.m_star_3.selected=o.star<3,t.m_level.text=`No.${Zi(e.id+1,"000")}`,t.userData=e},this.m_list.setVirtual(),this.m_list.numItems=0,this.m_list.on(fgui.ListEvent.ItemClick,(i,t)=>{let e=t.userData,o=a.inst.profile.data.level;e.id<=o?(a.inst.ui.view.changeStateTo("game"),a.inst.gameplay.startLevel(e.id)):e.id==o+1?(Mt.showAndWait().then(s=>{s&&(a.inst.profile.unlockLevel(e.id),a.inst.ui.view.changeStateTo("game"),a.inst.gameplay.startLevel(e.id))}),console.log("\u6253\u5F00\u89E3\u9501\u9875\u9762")):console.log("\u672A\u89E3\u9501")})}updateView(){this.m_list.numItems=Rt.length}};var Je=class extends ft{onConstruct(){super.onConstruct(),this.bindEvents(),this.setupView()}bindEvents(){this.m_back.onClick(()=>{a.inst.ui.view.changeStateTo("title")}),a.inst.ui.ev.on("stateChanged",i=>{i=="shop"?this.updateView():this.clearView()}),this.m_list.on(fgui.ListEvent.ItemClick,(i,t)=>m(this,null,function*(){}))}clearView(){}setupView(){}updateView(){}};var Qe=class extends It{onConstruct(){super.onConstruct(),a.inst.profile.ev.on("genStarTime",i=>{i>0?(this.m_isReady.selectedIndex=0,this.m_count.text=a.inst.profile.data.star+"",this.m_tip.text=`\u518D\u73A9${i}\u79D2\u83B7\u5F97\u4E00\u9897\u661F`):this.m_isReady.selectedIndex=1}),this.on(fgui.InteractiveEvents.Down,()=>{this.m_isReady.selectedIndex&&a.inst.profile.getPlayTimeStar()})}};var ti=class extends M{constructor(){super(mt);this._count=0}onInit(){super.onInit(),this.bindEvents()}onShown(){super.onShown(),this.updateView()}onConstruct(){super.onConstruct(),this.bindEvents()}bindEvents(){this.view.m_btn_bgm.onClick(()=>this.updateSetting()),this.view.m_btn_fx.onClick(()=>this.updateSetting()),this.view.m_btn_vibrate.onClick(()=>this.updateSetting()),this.view.m_reset.onClick(()=>{this._count+=1,this._count>3&&(a.inst.profile.newData(),a.inst.profile.saveData(),a.inst.ui.view.changeStateTo("title"),K.show({text:"\u5B58\u6863\u5DF2\u91CD\u7F6E"}))})}updateView(){let t=a.inst.profile.data;this.view.m_btn_bgm.selected=!t.bgm,this.view.m_btn_fx.selected=!t.fx,this.view.m_btn_vibrate.selected=!t.vibrate}updateSetting(){let t=a.inst.profile.data;t.bgm=!this.view.m_btn_bgm.selected,t.fx=!this.view.m_btn_fx.selected,t.vibrate=!this.view.m_btn_vibrate.selected,we.vibrator.play(),a.inst.profile.saveData(),a.inst.sound.setVolume(t.bgm?1:0,"bgm"),a.inst.sound.setVolume(t.fx?1:0,"fx"),a.inst.sound.setVolume(t.vibrate?1:0,"vibrate")}};var yi=class extends M{constructor(){super(yt)}onInit(){super.onInit()}onShown(){super.onShown();let i=a.inst.profile.data.total;this.view.m_combine.text=i.combine+"",this.view.m_kill.text=i.kill+"",this.view.m_level.text=i.level+"",this.view.m_rank.text="\u672A\u4E0A\u699C",this.view.m_score.text=i.score+"",this.view.m_star.text=i.star+"",this.view.m_time.text=i.time+""}};var ei=class extends gt{onConstruct(){super.onConstruct(),this.bindEvents()}bindEvents(){this.m_setting.onClick(()=>m(this,null,function*(){ti.show()})),this.m_shop.onClick(()=>{a.inst.ui.view.changeStateTo("shop")}),this.m_start.onClick(()=>{a.inst.ui.view.changeStateTo("select")}),a.inst.ui.ev.on("stateChanged",t=>{t=="title"&&this.updateView()}),this.m_achivement.onClick(()=>{yi.show()})}updateView(){a.inst.sound.bgm=ot([H,$,kt]),a.inst.ad.banner.show()}};var qt=si(ci());var Hi={gen:{"":"assets/gen/.gitkeep",ui:{loading:"assets/gen/ui/loading.txt","loading@atlas0":"assets/gen/ui/loading@atlas0.png",main:"assets/gen/ui/main.txt","main@atlas0":"assets/gen/ui/main@atlas0.png"}},image:{star:"assets/image/star.png",water_particle:"assets/image/water_particle.png"},libs:{fairyguiv7:"assets/libs/fairyguiv7.js",fguimin:"assets/libs/fgui.min.js",pixispine:"assets/libs/pixi-spine.js",pixi:"assets/libs/pixi.js",piximin:"assets/libs/pixi.min.js",tweenumdmin:"assets/libs/tween.umd.min.js"},sound:{Button:"assets/sound/Button.mp3",Dead:"assets/sound/Dead.mp3",Hint:"assets/sound/Hint.mp3",Lose:"assets/sound/Lose.mp3",Moving:"assets/sound/Moving.mp3",Music1:"assets/sound/Music1.mp3",Music2:"assets/sound/Music2.mp3",PopPrize:"assets/sound/PopPrize.mp3",Star3:"assets/sound/Star3.mp3",Win:"assets/sound/Win.mp3"}};var Ii=class extends M{constructor(){super(ht)}onInit(){super.onInit(),this.view.m_btnYes.onClick(()=>m(this,null,function*(){if(this.extra=this.extra||{},this.extra.resolve=!0,yield a.inst.sdk.share()){if(a.inst.profile.tryGetBonus()){this.hide(),X.play();return}}else console.log("\u5206\u4EAB\u51FA\u9519");this.hide()}))}onShown(){super.onShown(),this.showScreenShot()}showScreenShot(){let i=a.inst.gameplay.screenshot;i&&a.inst.ui.bindSpriteToCom(i,this.view.m_slot,!0)}};var ii=class extends ut{constructor(){super(...arguments);this.isNext=!1}onConstruct(){super.onConstruct(),this.m_btn_retry.onClick(()=>{a.inst.ui.view.changeStateTo("game"),a.inst.gameplay.restartLevel()}),this.m_btn_skip.onClick(()=>m(this,null,function*(){this.isNext?Mt.showAndWait().then(t=>{t?(a.inst.profile.unlockLevel(),a.inst.ui.view.changeStateTo("game"),a.inst.gameplay.startLevel()):a.inst.ui.view.changeStateTo("select")}):a.inst.ui.view.changeStateTo("select")})),a.inst.ui.ev.on("stateChanged",t=>{t=="win"&&this.updateView()})}updateView(){return m(this,null,function*(){a.inst.sound.bgm=null,X.play(),a.inst.gameplay.levelConfig.id==a.inst.profile.data.level?(this.m_btn_skip.title="\u4E0B\u4E00\u5173",this.isNext=!0):(this.m_btn_skip.title="\u8FD4\u56DE",this.isNext=!1);let t=a.inst.gameplay.getGameResultData(),e=t.star-a.inst.profile.getLevelData(a.inst.gameplay.levelConfig.id).star;e>0&&a.inst.profile.getStar(e),a.inst.profile.saveLevelData(a.inst.gameplay.levelConfig.id,t);for(let o=0;o<=t.star;o++)this.m_star.selectedIndex=o,(o==1||o==3)&&a.inst.particles.simpleParticle(Hi.image.smilingface,new qt.default(0,this.height*.6),[new qt.default(200,-1e3),new qt.default(500,-2e3)]),(o==2||o==3)&&a.inst.particles.simpleParticle(Hi.image.smilingface,new qt.default(this.width,this.height*.6),[new qt.default(-500,-1e3),new qt.default(-200,-2e3)]),yield a.inst.task.delay(200);a.inst.gameplay.screenshot&&Ii.show()})}};var oi=class extends bi{constructor(){super(...arguments);this.binds=[le,se,ei,Je,qe,ii,Ke,Ye,Qe,Ze];this.config={designWidth:900,designHeight:1600,orientation:"auto",packages:[{name:"loading",cls:le,binder:$e,path:"./assets/gen/ui/loading.txt",res:[{name:"loading@atlas0",path:"./assets/gen/ui/loading@atlas0.png"}],mode:"entry"},{name:"main",cls:se,binder:Xe,path:"./assets/gen/ui/main.txt",res:[{name:"main@atlas0",path:"./assets/gen/ui/main@atlas0.png"}],mode:"dynamic"}]};this.vibrating=!1}get view(){return fgui.GRoot.inst.numChildren>0&&fgui.GRoot.inst.getChildAt(0)}bindSpriteToCom(t,e,o=!1){t.position.set(e.x,o?e.y+e.height:e.y),t.scale.set(e.width/t.width,(o?-1:1)*e.height/t.height),e.displayObject.parent.addChildAt(t,e.displayObject.parent.getChildIndex(e.displayObject)),e.displayObject.alpha=0}bindSpineToCom(t,e,o=.5){return m(this,null,function*(){let s=yield a.inst.assets.getSpine(t),l=new PIXI.spine.Spine(s.spineData);l.skeleton.setToSetupPose(),l.update(0),l.autoUpdate=!0,l.position.set(e.x+e.width*.5,e.y+e.height*o);let h=l.skeleton.data.animations[0];h&&l.state.setAnimation(0,h.name,!0);let n=l.skeleton.data.skins[0];return n&&l.skeleton.setSkinByName(n.name),e.displayObject.parent.addChildAt(l,e.displayObject.parent.getChildIndex(e.displayObject)),e.displayObject.alpha=0,l})}vibrate(t,e=200){if(this.vibrating)return;let o={value:1};this.vibrating=!0;let s=new $i.default(this.view.x,this.view.y);new TWEEN.Tween(o).to({value:0},e).onUpdate(()=>{let l=new $i.default(t*o.value,0).rotate(Math.random()*Math.PI*2);this.view.setPosition(s.x+l.x,s.y+l.y)}).onComplete(()=>{this.view.setPosition(s.x,s.y),this.vibrating=!1}).start()}};var Io={time:new vi,task:new wi,profile:new ui,render2d:new ze,ui:new oi,gameplay:new De,assets:new ue,sound:new ni,particles:new Fe,ad:new de,sdk:new We,input:new Oe},Ci=class extends me{constructor(){super(...arguments);this.config=new ri;this.modules={};this._nextTicks=[];this.$tickCount=0;this.delta=0;this.frameTime=0;this.frameCount=0;this.everageFPS=60;this.enabled=!0;this.fpsLimit=60;this.timer=0}$nextTick(t){this._nextTicks.push({count:this.$tickCount+1,func:t})}quit(){}init(){console.log("\u6A21\u5757\u521D\u59CB\u5316\u5F00\u59CB");for(let e in Io)this.modules[e]=Io[e],this[e]=this.modules[e];let t=new Set;for(let e of Object.values(this.modules))!e||(e.init.bind(e)(),t.add(e));console.log("\u6A21\u5757\u521D\u59CB\u5316\u5B8C\u6210");for(let e of Object.values(this))e instanceof w&&e.start.bind(e)()}getModule(t){return this.modules[t]}updateFixed(t){this.modules.time.updateFixed(t),this.modules.task.update(t),this.ev.emit("updateFixed",t)}update(t){this.modules.time.update(t);let e=[];for(let o of this._nextTicks)o.count===this.$tickCount?o.func(t):o.count>this.$tickCount&&e.push(o);this._nextTicks=e,this.delta=t,this.ev.emit("update",t)}updatePrepare(t){this.ev.emit("updatePrepare",t)}updateLate(t){this.ev.emit("updateLate",t)}render(t){this.ev.emit("render",t)}tick(t){if(!this.enabled)return;let e=t/1e3;this.timer+=e,!(this.fpsLimit&&this.timer<1/this.fpsLimit)&&(e=this.timer,this.timer=0,this.$tickCount+=1,this.updateFixed(e),this.updatePrepare(e),this.update(e),this.updateLate(e),this.render(e))}calcEverage(){setTimeout(()=>{this.ev.on("update",t=>{t>.01&&t<.1&&(this.frameTime+=t,this.frameCount+=1,this.everageFPS=this.frameCount/this.frameTime)})},1e4)}};var a=class extends Ci{constructor(){super(),a._inst=this,globalThis.game=a.inst,this.start(),console.log("\u521B\u5EFA\u6E38\u620F\u5B9E\u4F8B\uFF1F\uFF1F")}start(){this.bindWindowEvents(),this.init()}static get inst(){return a._inst}init(){super.init(),console.log("\u542F\u52A8\u4E3B\u5FAA\u73AF"),this.bindLoop()}bindLoop(){if(this.modules.render3d)this.modules.render3d.engine.runRenderLoop(()=>{this.tick(this.modules.render3d.engine.getDeltaTime())});else{let i=Date.now();console.log("\u5E94\u8BE5\u7531\u81EA\u8EAB\u9A71\u52A8"),setInterval(()=>{let e=Date.now();this.tick(e-i),i=e},0)}this.calcEverage()}bindWindowEvents(){window.addEventListener("resize",()=>{this.ev.emit("resize",window.innerWidth,window.innerHeight,window.devicePixelRatio)},!1),window.addEventListener("blur",()=>{console.warn("\u5207\u5165\u540E\u53F0"),this.ev.emit("blur")}),window.addEventListener("focus",()=>{this.ev.emit("focus")}),window.windowHide=()=>{this.ev.emit("blur")},globalThis.windowHide=window.windowHide,window.windowShow=()=>{this.ev.emit("focus")},globalThis.windowShow=window.windowShow}};var _i=class extends M{constructor(){super(vt)}onInit(){super.onInit(),this.view.m_btnYes.onClick(()=>{this.extra.resolve=!0,this.hide()})}onShown(){super.onShown()}};var ki=class extends M{constructor(){super(wt)}onInit(){super.onInit(),this.view.m_btnYes.onClick(()=>{this.extra.resolve=!0,this.hide()}),this.view.m_btnNo.onClick(()=>{this.hide()})}};var Ri=class{constructor(i){this.callbacks={onLoad:[],onError:[],onResize:[]};let t=bt.createInstance();t.visible=!1;let e=a.inst.ui.view;t.width=e.width,t.x=0,t.y=e.height-t.height,e.addChild(t),this.view=t,this.callbacks.onLoad.forEach(o=>o())}show(){return m(this,null,function*(){this.view.visible=!0})}hide(){return m(this,null,function*(){this.view.visible=!1})}onLoad(i){this.callbacks.onLoad.push(i)}offLoad(i){this.callbacks.onLoad.splice(this.callbacks.onLoad.indexOf(i),1)}onError(i){this.callbacks.onError.push(i)}offError(i){this.callbacks.onError.splice(this.callbacks.onError.indexOf(i),1)}onResize(i){this.callbacks.onResize.push(i)}offResize(i){this.callbacks.onResize.splice(this.callbacks.onResize.indexOf(i),1)}destroy(){this.view.dispose(),this.callbacks={onLoad:[],onError:[],onResize:[]}}};function Ho(r){return new Ri(r)}var Mi=class{constructor(){this.callbacks={onLoad:[],onError:[],onClose:[]};this.show()}show(){return m(this,null,function*(){this.popup=_i.show({title:"\u63D2\u5C4F\u5E7F\u544A",text:"\u8FD9\u662F\u4E2A\u63D2\u5C4F\u5E7F\u544A"}),this.popup.ev.on("hide",()=>{this.hide()})})}hide(){return m(this,null,function*(){this.popup.hide(),this.callbacks.onClose.forEach(i=>i())})}load(){return m(this,null,function*(){this.callbacks.onLoad.forEach(i=>i())})}onLoad(i){this.callbacks.onLoad.push(i)}offLoad(i){this.callbacks.onLoad.splice(this.callbacks.onLoad.indexOf(i),1)}onError(i){this.callbacks.onError.push(i)}offError(i){this.callbacks.onError.splice(this.callbacks.onError.indexOf(i),1)}onClose(i){this.callbacks.onClose.push(i)}offClose(i){this.callbacks.onClose.splice(this.callbacks.onClose.indexOf(i),1)}destroy(){this.callbacks={onLoad:[],onError:[],onClose:[]}}};function $o(r){return new Mi}var Ui=class{constructor(){this.callbacks={onLoad:[],onError:[],onClose:[]};this.result={isEnded:!1,count:0}}show(){return m(this,null,function*(){this.popup=ki.show({title:"\u89C6\u9891\u5E7F\u544A",text:"\u662F\u5426\u5B8C\u6574\u89C2\u770B\u5E7F\u544A?"}),this.popup.ev.on("hide",()=>{var i;(i=this.popup.extra)!=null&&i.resolve?(this.result.isEnded=!0,this.result.count=1):(this.result.isEnded=!1,this.result.count=0),this.hide()})})}hide(){return m(this,null,function*(){this.popup.hide(),this.callbacks.onClose.forEach(i=>i(this.result))})}load(){return m(this,null,function*(){this.callbacks.onLoad.forEach(i=>i())})}onLoad(i){this.callbacks.onLoad.push(i)}offLoad(i){this.callbacks.onLoad.splice(this.callbacks.onLoad.indexOf(i),1)}onError(i){this.callbacks.onError.push(i)}offError(i){this.callbacks.onError.splice(this.callbacks.onError.indexOf(i),1)}onClose(i){this.callbacks.onClose.push(i)}offClose(i){this.callbacks.onClose.splice(this.callbacks.onClose.indexOf(i),1)}destroy(){this.callbacks={onLoad:[],onError:[],onClose:[]}}};function Xo(r){return new Ui}var Co={createBannerAd:Ho,BannerAd:Ri,InterstitialAd:Mi,createInterstitialAd:$o,createRewardedVideoAd:Xo,RewardedVideoAd:Ui};globalThis&&(globalThis.game=a.inst,globalThis._canvas=document.getElementById("root")||globalThis.screencanvas,globalThis.dom=Co);new a;})();
