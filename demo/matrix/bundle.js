(()=>{var xo=Object.create;var Li=Object.defineProperty;var vo=Object.getOwnPropertyDescriptor;var bo=Object.getOwnPropertyNames;var yo=Object.getPrototypeOf,Io=Object.prototype.hasOwnProperty;var Oe=(s,i)=>()=>(i||s((i={exports:{}}).exports,i),i.exports);var Co=(s,i,e,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let o of bo(i))!Io.call(s,o)&&o!==e&&Li(s,o,{get:()=>i[o],enumerable:!(t=vo(i,o))||t.enumerable});return s};var Ze=(s,i,e)=>(e=s!=null?xo(yo(s)):{},Co(i||!s||!s.__esModule?Li(e,"default",{value:s,enumerable:!0}):e,s));var Gi=(s,i,e)=>{if(!i.has(s))throw TypeError("Cannot "+e)};var S=(s,i,e)=>(Gi(s,i,"read from private field"),e?e.call(s):i.get(s)),Be=(s,i,e)=>{if(i.has(s))throw TypeError("Cannot add the same private member more than once");i instanceof WeakSet?i.add(s):i.set(s,e)},Ke=(s,i,e,t)=>(Gi(s,i,"write to private field"),t?t.call(s,e):i.set(s,e),e);var f=(s,i,e)=>new Promise((t,o)=>{var r=a=>{try{l(e.next(a))}catch(c){o(c)}},n=a=>{try{l(e.throw(a))}catch(c){o(c)}},l=a=>a.done?t(a.value):Promise.resolve(a.value).then(r,n);l((e=e.apply(s,i)).next())});var at=Oe((Ia,Xt)=>{(function s(i,e,t){var o=function(a){return Object.prototype.toString.call(a)==="[object Array]"},r=function(a){return a!==t};function n(a,c){if(!(this instanceof n))return new n(a,c);o(a)?(c=a[1],a=a[0]):typeof a=="object"&&a&&(c=a.y,a=a.x),this.x=n.clean(a||0),this.y=n.clean(c||0)}n.prototype={change:function(a){if(typeof a=="function")this.observers?this.observers.push(a):this.observers=[a];else if(this.observers&&this.observers.length)for(var c=this.observers.length-1;c>=0;c--)this.observers[c](this,a);return this},ignore:function(a){if(this.observers)if(!a)this.observers=[];else for(var c=this.observers,d=c.length;d--;)c[d]===a&&c.splice(d,1);return this},set:function(a,c,d){if(typeof a!="number"&&(d=c,c=a.y,a=a.x),this.x===a&&this.y===c)return this;var p=null;if(d!==!1&&this.observers&&this.observers.length&&(p=this.clone()),this.x=n.clean(a),this.y=n.clean(c),d!==!1)return this.change(p)},zero:function(){return this.set(0,0)},clone:function(){return new this.constructor(this.x,this.y)},negate:function(a){return a?new this.constructor(-this.x,-this.y):this.set(-this.x,-this.y)},add:function(a,c,d){return typeof a!="number"&&(d=c,o(a)?(c=a[1],a=a[0]):(c=a.y,a=a.x)),a+=this.x,c+=this.y,d?new this.constructor(a,c):this.set(a,c)},subtract:function(a,c,d){return typeof a!="number"&&(d=c,o(a)?(c=a[1],a=a[0]):(c=a.y,a=a.x)),a=this.x-a,c=this.y-c,d?new this.constructor(a,c):this.set(a,c)},multiply:function(a,c,d){return typeof a!="number"?(d=c,o(a)?(c=a[1],a=a[0]):(c=a.y,a=a.x)):typeof c!="number"&&(d=c,c=a),a*=this.x,c*=this.y,d?new this.constructor(a,c):this.set(a,c)},rotate:function(a,c,d){var p=this.x,x=this.y,g=Math.cos(a),b=Math.sin(a),I,Ye;return c=c?-1:1,I=g*p-c*b*x,Ye=c*b*p+g*x,d?new this.constructor(I,Ye):this.set(I,Ye)},length:function(){var a=this.x,c=this.y;return Math.sqrt(a*a+c*c)},lengthSquared:function(){var a=this.x,c=this.y;return a*a+c*c},distance:function(a){var c=this.x-a.x,d=this.y-a.y;return Math.sqrt(c*c+d*d)},nearest:function(a){for(var c=Number.MAX_VALUE,d=null,p,x=a.length-1;x>=0;x--)p=this.distance(a[x]),p<=c&&(c=p,d=a[x]);return d},normalize:function(a){var c=this.length(),d=c<Number.MIN_VALUE?0:1/c;return a?new this.constructor(this.x*d,this.y*d):this.set(this.x*d,this.y*d)},equal:function(a,c){return typeof a!="number"&&(o(a)?(c=a[1],a=a[0]):(c=a.y,a=a.x)),n.clean(a)===this.x&&n.clean(c)===this.y},abs:function(a){var c=Math.abs(this.x),d=Math.abs(this.y);return a?new this.constructor(c,d):this.set(c,d)},min:function(a,c){var d=this.x,p=this.y,x=a.x,g=a.y,b=d<x?d:x,I=p<g?p:g;return c?new this.constructor(b,I):this.set(b,I)},max:function(a,c){var d=this.x,p=this.y,x=a.x,g=a.y,b=d>x?d:x,I=p>g?p:g;return c?new this.constructor(b,I):this.set(b,I)},clamp:function(a,c,d){var p=this.min(c,!0).max(a);return d?p:this.set(p.x,p.y)},lerp:function(a,c,d){return this.add(a.subtract(this,!0).multiply(c),d)},skew:function(a){return a?new this.constructor(-this.y,this.x):this.set(-this.y,this.x)},dot:function(a){return n.clean(this.x*a.x+a.y*this.y)},perpDot:function(a){return n.clean(this.x*a.y-this.y*a.x)},angleTo:function(a){return Math.atan2(this.perpDot(a),this.dot(a))},divide:function(a,c,d){if(typeof a!="number"?(d=c,o(a)?(c=a[1],a=a[0]):(c=a.y,a=a.x)):typeof c!="number"&&(d=c,c=a),a===0||c===0)throw new Error("division by zero");if(isNaN(a)||isNaN(c))throw new Error("NaN detected");return d?new this.constructor(this.x/a,this.y/c):this.set(this.x/a,this.y/c)},isPointOnLine:function(a,c){return(a.y-this.y)*(a.x-c.x)===(a.y-c.y)*(a.x-this.x)},toArray:function(){return[this.x,this.y]},fromArray:function(a){return this.set(a[0],a[1])},toJSON:function(){return{x:this.x,y:this.y}},toString:function(){return"("+this.x+", "+this.y+")"},constructor:n},n.fromArray=function(a,c){return new(c||n)(a[0],a[1])},n.precision=e||8;var l=Math.pow(10,n.precision);return n.clean=i||function(a){if(isNaN(a))throw new Error("NaN detected");if(!isFinite(a))throw new Error("Infinity detected");return Math.round(a)===a?a:Math.round(a*l)/l},n.inject=s,i||(n.fast=s(function(a){return a}),typeof Xt!="undefined"&&typeof Xt.exports=="object"?Xt.exports=n:window.Vec2=window.Vec2||n),n})()});var Ri=Oe((Za,Yi)=>{"use strict";var Mi=class{constructor(){this._data=[]}get root(){return this._data[0]}get size(){return this._data.length}_compare(i,e){let[t,o]=[this._data[i],this._data[e]];return t.key>o.key?1:t.key<o.key?-1:0}_swap(i,e){[this._data[i],this._data[e]]=[this._data[e],this._data[i]]}children(i){let e={},t=this.childIndices(i);return Object.keys(t).forEach(o=>{e[o]=this.node(t[o])}),e}childIndices(i){let e={},t=this.leftIndex(i),o=this.rightIndex(i);return t<this.size&&(e.left=t),o<this.size&&(e.right=o),e}clear(){return this._data=[],this}degree(i){return Object.keys(this.children(i)).length}fullNodes(){let i=[];return this._data.forEach((e,t)=>{this.isFullNode(t)&&i.push(e)}),i}height(){return Math.ceil(Math.log2(this.size+1))-1}includes(i){for(let e of this._data)if(e.key===i)return!0;return!1}indexOf(i){let e=0;for(let t of this._data){if(t.key===i)return e;e+=1}return-1}internalNodes(){let i=[];return this._data.forEach((e,t)=>{this.isInternalNode(t)&&i.push(e)}),i}isEmpty(){return this._data.length===0}isFullNode(i){return this.left(i)!==void 0&&this.right(i)!==void 0}isInternalNode(i){return this.left(i)!==void 0||this.right(i)!==void 0}isLeafNode(i){return!this.left(i)&&!this.right(i)}isPartialNode(i){return this.degree(i)===1}keys(){let i=[];return this._data.forEach(e=>i.push(e.key)),i}leafNodes(){let i=[];return this._data.forEach((e,t)=>{this.isLeafNode(t)&&i.push(e)}),i}left(i){return this._data[this.leftIndex(i)]}leftIndex(i){return 2*i+1}levelOrder(i){return this._data.forEach(e=>i(e)),this}maxChild(i){return this._data[this.maxChildIndex(i)]}maxChildIndex(i){let{left:e,right:t}=this.childIndices(i);return e?t&&this._compare(t,e)>0?t:e:-1}minChild(i){return this._data[this.minChildIndex(i)]}minChildIndex(i){let{left:e,right:t}=this.childIndices(i);return e?t&&this._compare(e,t)>0?t:e:-1}node(i){return this._data[i]}parent(i){return this._data[this.parentIndex(i)]}parentIndex(i){return Math.floor((i-1)/2)}partialNodes(){let i=[];return this._data.forEach((e,t)=>{this.isPartialNode(t)&&i.push(e)}),i}right(i){return this._data[this.rightIndex(i)]}rightIndex(i){return 2*i+2}search(i){for(let e of this._data)if(e.key===i)return e}toArray(){let i=[];return this._data.forEach(e=>i.push(e)),i}toPairs(){let i=[];return this._data.forEach(e=>i.push(e.toPair())),i}update(i,e){let t=this.indexOf(i);return t>=0&&(this._data[t].value=e),this}values(){let i=[];return this._data.forEach(e=>i.push(e.value)),i}};Yi.exports=Mi});var ei=Oe((Ka,Zi)=>{"use strict";var Ei=class{constructor(i,e){this._key=i,this._value=e}get key(){return this._key}get value(){return this._value}set value(i){this._value=i}toPair(){return[this.key,this.value]}};Zi.exports=Ei});var Qi=Oe((Qa,Ki)=>{"use strict";var Jo=Ri(),es=ei(),Si=class extends Jo{_isMaxOrdered(i){let e=this.childIndices(i);for(let t in e)if(this._compare(i,e[t])<0)return!1;return!0}extract(i){let e=this._data[i];return this.remove(i),e}extractMax(){return this.extract(0)}insert(i,e){let t=new es(i,e);this._data.push(t);let o=this.size-1,r=this.parentIndex(o);for(;r>=0&&this._compare(o,r)>0;)this._swap(o,r),o=r,r=this.parentIndex(o);return this}remove(i){if(i>=0&&i<this.size)if(i===this.size-1)this._data.pop();else{let e=i;for(this._data[e]=this._data.pop();!this._isMaxOrdered(e);){let t=this.maxChildIndex(e);this._swap(e,t),e=t}}return this}};Ki.exports=Si});var eo=Oe((Ja,Ji)=>{"use strict";var ts=Ri(),is=ei(),Ui=class extends ts{_isMinOrdered(i){let e=this.childIndices(i);for(let t in e)if(this._compare(i,e[t])>0)return!1;return!0}extract(i){let e=this._data[i];return this.remove(i),e}extractMin(){return this.extract(0)}insert(i,e){let t=new is(i,e);this._data.push(t);let o=this.size-1,r=this.parentIndex(o);for(;r>=0&&this._compare(o,r)<0;)this._swap(o,r),o=r,r=this.parentIndex(o);return this}remove(i){if(i>=0&&i<this.size)if(i===this.size-1)this._data.pop();else{let e=i;for(this._data[e]=this._data.pop();!this._isMinOrdered(e);){let t=this.minChildIndex(e);this._swap(e,t),e=t}}return this}};Ji.exports=Ui});var io=Oe((en,to)=>{"use strict";var os=Qi(),ss=eo(),rs=ei();to.exports=Object.assign({},{MaxHeap:os},{MinHeap:ss},{Node:rs})});var ko=typeof global=="object"&&global&&global.Object===Object&&global,Pi=ko;var _o=typeof self=="object"&&self&&self.Object===Object&&self,Mo=Pi||_o||Function("return this")(),Ni=Mo;var Ro=Ni.Symbol,Ve=Ro;var Ai=Object.prototype,Eo=Ai.hasOwnProperty,So=Ai.toString,Qe=Ve?Ve.toStringTag:void 0;function Uo(s){var i=Eo.call(s,Qe),e=s[Qe];try{s[Qe]=void 0;var t=!0}catch(r){}var o=So.call(s);return t&&(i?s[Qe]=e:delete s[Qe]),o}var ji=Uo;var To=Object.prototype,Lo=To.toString;function Go(s){return Lo.call(s)}var Oi=Go;var Po="[object Null]",No="[object Undefined]",Bi=Ve?Ve.toStringTag:void 0;function Ao(s){return s==null?s===void 0?No:Po:Bi&&Bi in Object(s)?ji(s):Oi(s)}var Vi=Ao;function jo(s){return s!=null&&typeof s=="object"}var Di=jo;var Oo="[object Symbol]";function Bo(s){return typeof s=="symbol"||Di(s)&&Vi(s)==Oo}var zi=Bo;var Vo=/\s/;function Do(s){for(var i=s.length;i--&&Vo.test(s.charAt(i)););return i}var Fi=Do;var zo=/^\s+/;function Fo(s){return s&&s.slice(0,Fi(s)+1).replace(zo,"")}var Wi=Fo;function Wo(s){var i=typeof s;return s!=null&&(i=="object"||i=="function")}var mi=Wo;var Hi=0/0,Ho=/^[-+]0x[0-9a-f]+$/i,$o=/^0b[01]+$/i,Xo=/^0o[0-7]+$/i,qo=parseInt;function Yo(s){if(typeof s=="number")return s;if(zi(s))return Hi;if(mi(s)){var i=typeof s.valueOf=="function"?s.valueOf():s;s=mi(i)?i+"":i}if(typeof s!="string")return s===0?s:+s;s=Wi(s);var e=$o.test(s);return e||Xo.test(s)?qo(s.slice(2),e?2:8):Ho.test(s)?Hi:+s}var ui=Yo;function pi(s,i){let e=s.indexOf(i);if(e!=-1)return s.splice(e,1),pi(s,i)}var $=class{constructor(i){this.all=new Map;this.sender=i}on(i,e){let t=this.all.get(i);return t&&t.push(e)||this.all.set(i,[e]),e}off(i,e){let t=this.all.get(i);t&&(e?t.splice(t.indexOf(e)>>>0,1):t.length=0)}emit(i,...e){(this.all.get(i)||[]).slice().map(t=>{t(...e)})}dispose(){this.all.clear()}};var $i=1,Je=class{constructor(){this.ev=new $(this);this.id=$i,$i+=1}get game(){return h.inst}},u=class extends Je{constructor(){super(...arguments);this._updateHandler=null;this._delayAndIntervals=new Set;this.components=[];this.tags={};this.disposed=!1}enableUpdate(){this.game&&(this._updateHandler=this.update.bind(this),this.game.ev.on("update",this._updateHandler))}disableUpdate(){this.game&&this.game.ev.off("update",this._updateHandler)}init(){}dispose(){if(this.disposed){console.error("\u91CD\u590D\u5220\u9664\u4E00\u4E2A\u5BF9\u8C61");debugger;return}this.ev.emit("dispose"),this.disposed=!0,this._updateHandler&&this.game.ev.off("update",this._updateHandler);for(let e of this._delayAndIntervals)this.game.task.cancel(e);this.components.forEach(e=>{e.dispose()}),this.components=null,this.tags=null}$nextTick(e){this.game.$nextTick(e)}$delay(e,t=null){let o=this.game.task.delay(e,()=>{this._delayAndIntervals.delete(o),t&&t()});return this._delayAndIntervals.add(o),o}$interval(e=null,t=10){let o=this.game.task.interval(t,e);return this._delayAndIntervals.add(o),o}$wait(e,t,o=10,r=-1){return new Promise((n,l)=>{let a=()=>{e()&&(this.$stop(c),t&&t(),n())},c=this.game.task.interval(o,a);r>0&&this.game.task.delay(r,()=>{this.$stop(c),l("time out")})})}$until(e){return new Promise(t=>{let o=(...r)=>{t(r),this.ev.off(e,o)};this.ev.on(e,o)})}$stop(e){this.game.task.cancel(e)}update(e){for(let t of this.components)t.enabled&&t.update(e)}addComponentSync(e,t){return f(this,null,function*(){let o=new e;return t=t||o.tag,this.tags[t]&&console.warn("\u5C1D\u8BD5\u8986\u76D6\u4E00\u4E2A\u6807\u7B7E",t,o),o.tag=t,this.tags[t]=o,this.components.push(o),o.bind(this)})}addComponent(e,t){let o=new e;return t=t||o.tag,this.tags[t]&&console.warn("\u5C1D\u8BD5\u8986\u76D6\u4E00\u4E2A\u6807\u7B7E",t,o),o.tag=t,this.tags[t]=o,this.components.push(o),o.bind(this),o}removeComponent(e){pi(this.components,e),delete this.tags[e.tag],e.enabled=!1,e.dispose()}};var v=class extends u{init(){}start(){}};var Ht=class{};var X=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","DialogToast")}onConstruct(){this.m_frame=this.getChildAt(0),this.m_text=this.getChildAt(1)}};X.URL="ui://j8b2cwkbxatjb4";var U=class extends fgui.Window{constructor(e){super();this.ev=new $(this);this.viewCls=e}get view(){return this.contentPane}onInit(){this.contentPane=this.viewCls.createInstance(),super.onInit(),this.ev.emit("init")}onShown(){super.center(),super.onShown(),this.ev.emit("show")}onHide(){var e;super.onHide(),this.ev.emit("hide"),this.waiter&&(this.waiter((e=this.extra)==null?void 0:e.resolve),this.waiter=null)}static _create(){let e=this.windowCache.get(this);return e||(e=new this,this.windowCache.set(this,e)),e}static hide(){this._create().hide()}static show(e={modal:!0,extra:{},title:null}){let t=this._create();t.modal=e.modal!==!1,t.extra=e.extra||{},t.style=e.style,t.show();let o=()=>{t.view||setTimeout(()=>{o()},100),e.title&&(t.view.m_frame.title=e.title,t.view.m_frame.width+=1),e.text&&t.view.getChild("text")&&(t.view.getChild("text").text=e.text)};return o(),t}setAsFullScreen(){this.width=fgui.GRoot.inst.width,this.height=fgui.GRoot.inst.height}static showAndWait(e={modal:!0,extra:null,title:null}){return new Promise(t=>{let o=this.show(e);o.waiter=t})}};U.windowCache=new Map;var xe=class extends U{constructor(){super(X)}onShown(){super.onShown(),h.inst.task.$delay(this.extra.delay||2e3,()=>this.hide())}};var gi=class extends u{constructor(){super(...arguments);this.state="init"}static createInstance(){this._inst=new gi}static loadInst(){this._inst.ev.on("error",e=>{console.log("\u7531\u4E8E\u62A5\u9519\u91CD\u65B0\u5EFA\u7ACB\u5E7F\u544A\u5B9E\u4F8B",e),this._inst.dispose(),this._inst=null,this.reloadTry-=1}),this._inst.ev.on("finish",()=>{console.log("\u5E7F\u544A\u64AD\u653E\u5B8C\u6BD5"),this._inst.dispose(),this._inst=null,this.reloadTry=5});try{this._inst.load()}catch(e){console.error("\u521B\u5EFA\u5E7F\u544A\u5931\u8D25",e),this._inst.dispose(),this._inst=null}}static get inst(){if(!this._inst&&this.canReload&&this.reloadTry>0)try{this.createInstance(),this.loadInst(),this.canReload=!1,h.inst.task.delay(this.reloadCD,()=>this.canReload=!0),console.log("\u521B\u5EFA\u4E86\u5E7F\u544A\u5B9E\u4F8B",this._inst)}catch(e){this.canReload=!0,this.reloadTry-=1,console.log("\u521B\u5EFA\u5E7F\u544A\u5931\u8D25",e)}return this._inst}static show(){var e;return console.log("\u5C1D\u8BD5\u64AD\u653E\u5E7F\u544A"),(e=this.inst)==null?void 0:e.show()}static pay(){return f(this,null,function*(){var t;let e=yield(t=this.inst)==null?void 0:t.pay();return e==0&&xe.show({text:"\u9700\u8981\u770B\u5B8C\u89C6\u9891\u624D\u80FD\u83B7\u5F97\u5956\u52B1\u54E6\uFF01"}),e})}static hide(){var e;return(e=this.inst)==null?void 0:e.hide()}static dispose(){var e;return(e=this.inst)==null?void 0:e.dispose()}load(){}show(){return f(this,null,function*(){})}hide(){return f(this,null,function*(){})}pay(){return f(this,null,function*(){})}dispose(){}},z=gi;z.reloadCD=30,z.canReload=!0,z.reloadTry=5;var De=class extends z{constructor(){super(...arguments);this.type="banner";this.slotID="cd2ab7n6k7o8cjlli5";this.ctor=globalThis.dom.createBannerAd}static createInstance(){this._inst=new De}load(){this.native=this.ctor({adUnitId:this.slotID,adIntervals:120,style:{width:200}}),this.state="loading",this.native.onLoad(()=>{this.state="ready",console.log("\u5E7F\u544A\u52A0\u8F7D\u5B8C\u6BD5")}),this.native.onError(e=>{this.state="error",this.ev.emit("error",e),console.error("\u64AD\u653E\u5E95\u90E8\u5E7F\u544A\u9519\u8BEF",e)}),this.native.onResize(e=>{console.log("\u91CD\u65B0\u5B9A\u4F4D\u5E7F\u544A")})}show(){return f(this,null,function*(){this.state!="show"&&(yield this.$wait(()=>this.state=="ready"||this.state=="hide"),console.log("banner\u5E7F\u544A\u5DF2\u64AD\u653E"))})}hide(){return f(this,null,function*(){this.state!="hide"&&(yield this.$wait(()=>this.state=="show"),this.native.hide(),this.state="hide")})}dispose(){var e;this.state="destroyed",(e=this.native)==null||e.destroy(),super.dispose()}};var ze=class extends z{constructor(){super(...arguments);this.type="interstitial";this.slotID="92c2hb281lf438h003";this.ctor=globalThis.dom.createInterstitialAd}static createInstance(){this._inst=new ze}load(){this.native=this.ctor({adUnitId:this.slotID}),this.state="loading",this.native.onLoad(()=>{this.state="ready"}),this.native.onError(e=>{this.state="error",this.ev.emit("error",e)}),this.native.onClose(()=>{this.ev.emit("finish",1)})}show(){return f(this,null,function*(){this.state!="show"&&(yield this.$wait(()=>this.state=="ready"),yield this.native.show(),this.ev.emit("show"))})}dispose(){var e;this.state="destroyed",(e=this.native)==null||e.destroy(),super.dispose()}};var Fe=class extends z{constructor(){super(...arguments);this.type="video";this.slotID="9brmrdpntr4i7ajg5f";this.count=0;this.ctor=globalThis.dom.createRewardedVideoAd}static createInstance(){this._inst=new Fe}load(){this.native=this.ctor({adUnitId:this.slotID,multiton:this.count>0,multitonRewardTimes:this.count,multitonRewardMsg:["\u66F4\u591A\u5956\u52B1"]}),this.state="loading",this.native.onLoad(()=>{this.state="ready",console.log("\u89C6\u9891\u5E7F\u544A\u52A0\u8F7D\u5B8C\u6BD5")}),this.native.onError(e=>{this.state="error",this.ev.emit("error",e),console.log("\u89C6\u9891\u5E7F\u544A\u64AD\u653E\u5931\u8D25")}),this.native.onClose(e=>{!e.isEnded&&!e.count&&(e.count=0),this.ev.emit("finish",e.count)}),this.native.load()}show(){return f(this,null,function*(){this.state!="show"&&(yield this.$wait(()=>this.state=="ready"),yield this.native.show(),this.state="show",this.ev.emit("show"))})}pay(){return f(this,null,function*(){return this.show(),new Promise((e,t)=>{this.ev.on("finish",o=>{e(o)}),this.ev.on("error",o=>{console.log("\u652F\u4ED8\u89C6\u9891\u51FA\u9519"),e(0)})})})}dispose(){var e;this.state="destroyed",(e=this.native)==null||e.destroy(),super.dispose()}};var et=class extends v{constructor(){super(...arguments);this.banner=De;this.interstitial=ze;this.video=Fe}};var tt=class extends v{init(){super.init()}start(){super.start()}loadSpine(){return f(this,null,function*(){})}getSpine(i){return PIXI.Assets.load(`assets/spine/${i}/skeleton.json`)}};var ot=class{constructor(i,e,t){this.ctor=i;this.dtor=e;this.size=t;this.stack=[]}fill(){for(let i=this.stack.length;i<this.size;i++)this.produce()}return(i){this.stack.includes(i)&&console.error("\u8BD5\u56FE\u5F52\u8FD8\u4E00\u4E2A\u5DF2\u5B58\u5728\u7684\u5BF9\u8C61",i),this.stack.length<this.size?this.stack.push(i):this.dtor(i)}produce(){let i=this.ctor();return this.stack.push(i),i}fetch(){return this.stack.length==0&&this.produce(),this.stack.pop()}remove(i){let e=this.stack.indexOf(i);e==-1||this.stack.splice(e,1)}clear(){this.stack.length=0}},it=class extends u{static _createContext(){}static _createBuffer(){this._buffer||(this._buffer=new this.ItemBuffer(it.createInstance,it.destroy,it.count))}static updateVolume(){this.actives.forEach(e=>e.context.volume=this.volume*h.inst.sound.volume[this.tag])}static play(){this._createBuffer();let e=this._buffer.fetch();return e.context.volume=this.volume*h.inst.sound.volume[this.tag],e.context.play(),this.actives.push(e),e}static pause(e){}static stop(e){}static destroy(e){}},F=it;F.volume=1,F.count=1,F.autoplay=!0,F.loop=!1,F.isBGM=!1,F.preload=!1,F.ItemBuffer=ot,F.actives=[];var D=class extends u{static _createContext(e){let t=new Audio(e);return document.getElementById("root").appendChild(t),t}static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(D.createInstance.bind(D),D.destroy.bind(D),D.count))}static _bindStopEvent(e){e.context.onended=()=>{this._buffer.return(e)}}static createInstance(){let e=new D,t=D._createContext();return e.context=t,t.src=D.path,t.autoplay=D.autoplay,t.loop=D.loop,t.volume=D.volume,this._bindStopEvent(e),e}static updateVolume(){!this.actives||this.actives.forEach(e=>e.context.volume=this.volume*h.inst.sound.volume[this.tag])}static play(){this._createBuffer();let e=this._buffer.fetch();return e.context.volume=this.volume*h.inst.sound.volume[this.tag],e.context.play(),this.actives.push(e),e}static pause(e){e?e.context.pause():this.actives.forEach(t=>t.context.pause())}static stop(e){e?this.actives=this.actives.filter(t=>e!=t):(e.context.pause(),this.actives.forEach(t=>t.context.pause()),this.actives=[])}static destroy(e){if(e){try{document.getElementById("root").removeChild(e.context)}catch(t){console.warn("\u91CD\u590D\u79FB\u9664\u4E00\u4E2A\u5BF9\u8C61",e)}this.actives=this.actives.filter(t=>e!=t),this._buffer.remove(e)}else{try{this.actives.forEach(t=>document.getElementById("root").removeChild(t.context))}catch(t){}this.actives=[],this._buffer.clear()}}},w=D;w.tag="fx",w.volume=1,w.count=1,w.autoplay=!0,w.loop=!1,w.isBGM=!1,w.preload=!1,w.ItemBuffer=ot;var T=class extends w{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(T.createInstance.bind(T),T.destroy.bind(T),T.count))}static createInstance(){let i=new T,e=T._createContext();return i.context=e,e.src=T.path,e.autoplay=T.autoplay,e.loop=T.loop,e.volume=T.volume,T._bindStopEvent(i),i}},Ce=T;Ce.path="assets/sound/Button.mp3",Ce.tag="fx",Ce.loop=!1;var L=class extends w{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(L.createInstance.bind(L),L.destroy.bind(L),L.count))}static createInstance(){let i=new L,e=L._createContext();return i.context=e,e.src=L.path,e.autoplay=L.autoplay,e.loop=L.loop,e.volume=L.volume,L._bindStopEvent(i),i}},ke=L;ke.path="assets/sound/Dead.mp3",ke.tag="fx",ke.loop=!1;var G=class extends w{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(G.createInstance.bind(G),G.destroy.bind(G),G.count))}static createInstance(){let i=new G,e=G._createContext();return i.context=e,e.src=G.path,e.autoplay=G.autoplay,e.loop=G.loop,e.volume=G.volume,G._bindStopEvent(i),i}},q=G;q.path="assets/sound/Hint.mp3",q.tag="fx",q.loop=!1;var P=class extends w{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(P.createInstance.bind(P),P.destroy.bind(P),P.count))}static createInstance(){let i=new P,e=P._createContext();return i.context=e,e.src=P.path,e.autoplay=P.autoplay,e.loop=P.loop,e.volume=P.volume,P._bindStopEvent(i),i}},_e=P;_e.path="assets/sound/Lose.mp3",_e.tag="fx",_e.loop=!1;var N=class extends w{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(N.createInstance.bind(N),N.destroy.bind(N),N.count))}static createInstance(){let i=new N,e=N._createContext();return i.context=e,e.src=N.path,e.autoplay=N.autoplay,e.loop=N.loop,e.volume=N.volume,N._bindStopEvent(i),i}},Me=N;Me.path="assets/sound/Moving.mp3",Me.tag="fx",Me.loop=!1;var A=class extends w{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(A.createInstance.bind(A),A.destroy.bind(A),A.count))}static createInstance(){let i=new A,e=A._createContext();return i.context=e,e.src=A.path,e.autoplay=A.autoplay,e.loop=A.loop,e.volume=A.volume,A._bindStopEvent(i),i}},Y=A;Y.path="assets/sound/Music1.mp3",Y.tag="bgm",Y.loop=!0;var j=class extends w{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(j.createInstance.bind(j),j.destroy.bind(j),j.count))}static createInstance(){let i=new j,e=j._createContext();return i.context=e,e.src=j.path,e.autoplay=j.autoplay,e.loop=j.loop,e.volume=j.volume,j._bindStopEvent(i),i}},Z=j;Z.path="assets/sound/Music2.mp3",Z.tag="bgm",Z.loop=!0;var O=class extends w{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(O.createInstance.bind(O),O.destroy.bind(O),O.count))}static createInstance(){let i=new O,e=O._createContext();return i.context=e,e.src=O.path,e.autoplay=O.autoplay,e.loop=O.loop,e.volume=O.volume,O._bindStopEvent(i),i}},K=O;K.path="assets/sound/PopPrize.mp3",K.tag="fx",K.loop=!1;var B=class extends w{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(B.createInstance.bind(B),B.destroy.bind(B),B.count))}static createInstance(){let i=new B,e=B._createContext();return i.context=e,e.src=B.path,e.autoplay=B.autoplay,e.loop=B.loop,e.volume=B.volume,B._bindStopEvent(i),i}},Re=B;Re.path="assets/sound/Star3.mp3",Re.tag="fx",Re.loop=!1;var V=class extends w{static _createBuffer(){this.actives=[],this._buffer||(this._buffer=new this.ItemBuffer(V.createInstance.bind(V),V.destroy.bind(V),V.count))}static createInstance(){let i=new V,e=V._createContext();return i.context=e,e.src=V.path,e.autoplay=V.autoplay,e.loop=V.loop,e.volume=V.volume,V._bindStopEvent(i),i}},Ee=V;Ee.path="assets/sound/Win.mp3",Ee.tag="fx",Ee.loop=!1;var st=class extends w{static play(){console.log("\u9707\u52A8");let i=this.volume*h.inst.sound.volume[this.tag];return i==0||h.inst.ui.vibrate(20,1e3*i),null}};st.tag="vibrate";var Zo=st,rt={AudioPlayer_Button:Ce,AudioPlayer_Dead:ke,AudioPlayer_Hint:q,AudioPlayer_Lose:_e,AudioPlayer_Moving:Me,AudioPlayer_Music1:Y,AudioPlayer_Music2:Z,AudioPlayer_PopPrize:K,AudioPlayer_Star3:Re,AudioPlayer_Win:Ee,vibrator:Zo};var $t=class extends v{constructor(){super(...arguments);this.volume={bgm:1,fx:1,vibrate:1}}set bgm(e){this._bgm&&this._bgm.destroy(),e&&(this._bgm=e,this._bgm.play())}start(){fgui.UIConfig.defaultButtonSound=rt.AudioPlayer_Button,fgui.GButton.prototype.playSound=function(e){e.play()}}setupVolume(){let e=h.inst.profile.data;this.setVolume(e.bgm?1:0,"bgm",!0),this.setVolume(e.fx?1:0,"fx",!0),this.setVolume(e.vibrate?1:0,"vibrate",!0)}setVolume(e,t,o=!1){this.volume[t]==e&&!o||(this.volume[t]=e,Object.values(rt).filter(r=>r.tag==t).forEach(r=>{r.updateVolume()}))}};var Xi=Ze(at());var Q={gen:{"":"assets/gen/.gitkeep",ui:{loading:"assets/gen/ui/loading.txt","loading@atlas0":"assets/gen/ui/loading@atlas0.png",main:"assets/gen/ui/main.txt","main@atlas0":"assets/gen/ui/main@atlas0.png","main@atlas0_1":"assets/gen/ui/main@atlas0_1.png",spLevels:"assets/gen/ui/spLevels.txt","spLevels@atlas0":"assets/gen/ui/spLevels@atlas0.png"}},image:{angryfacewithhorns:"assets/image/angry-face-with-horns.png",angryface:"assets/image/angry-face.png",anguishedface:"assets/image/anguished-face.png",anxiousfacewithsweat:"assets/image/anxious-face-with-sweat.png",astonishedface:"assets/image/astonished-face.png",beamingfacewithsmilingeyes:"assets/image/beaming-face-with-smiling-eyes.png",clownface:"assets/image/clown-face.png",coldface:"assets/image/cold-face.png",confoundedface:"assets/image/confounded-face.png",confusedface:"assets/image/confused-face.png",cowboyhatface:"assets/image/cowboy-hat-face.png",cryingface:"assets/image/crying-face.png",disappointedface:"assets/image/disappointed-face.png",disguisedface:"assets/image/disguised-face.png",dizzyface:"assets/image/dizzy-face.png",dottedlineface:"assets/image/dotted-line-face.png",downcastfacewithsweat:"assets/image/downcast-face-with-sweat.png",droolingface:"assets/image/drooling-face.png",expressionlessface:"assets/image/expressionless-face.png",faceblowingakiss:"assets/image/face-blowing-a-kiss.png",faceexhaling:"assets/image/face-exhaling.png",faceholdingbacktears:"assets/image/face-holding-back-tears.png",facesavoringfood:"assets/image/face-savoring-food.png",facescreaminginfear:"assets/image/face-screaming-in-fear.png",facevomiting:"assets/image/face-vomiting.png",facewithdiagonalmouth:"assets/image/face-with-diagonal-mouth.png",facewithhandovermouth:"assets/image/face-with-hand-over-mouth.png",facewithheadbandage:"assets/image/face-with-head-bandage.png",facewithmedicalmask:"assets/image/face-with-medical-mask.png",facewithmonocle:"assets/image/face-with-monocle.png",facewithopeneyesandhandovermouth:"assets/image/face-with-open-eyes-and-hand-over-mouth.png",facewithopenmouth:"assets/image/face-with-open-mouth.png",facewithpeekingeye:"assets/image/face-with-peeking-eye.png",facewithraisedeyebrow:"assets/image/face-with-raised-eyebrow.png",facewithrollingeyes:"assets/image/face-with-rolling-eyes.png",facewithspiraleyes:"assets/image/face-with-spiral-eyes.png",facewithsteamfromnose:"assets/image/face-with-steam-from-nose.png",facewithsymbolsonmouth:"assets/image/face-with-symbols-on-mouth.png",facewithtearsofjoy:"assets/image/face-with-tears-of-joy.png",facewiththermometer:"assets/image/face-with-thermometer.png",facewithtongue:"assets/image/face-with-tongue.png",facewithoutmouth:"assets/image/face-without-mouth.png",fearfulface:"assets/image/fearful-face.png",flushedface:"assets/image/flushed-face.png",frowningfacewithopenmouth:"assets/image/frowning-face-with-open-mouth.png",frowningface:"assets/image/frowning-face.png",fullmoonface:"assets/image/full-moon-face.png",grimacingface:"assets/image/grimacing-face.png",grinningfacewithbigeyes:"assets/image/grinning-face-with-big-eyes.png",grinningfacewithsmilingeyes:"assets/image/grinning-face-with-smiling-eyes.png",grinningfacewithsweat:"assets/image/grinning-face-with-sweat.png",grinningface:"assets/image/grinning-face.png",grinningsquintingface:"assets/image/grinning-squinting-face.png",hotface:"assets/image/hot-face.png",huggingface:"assets/image/hugging-face.png",hushedface:"assets/image/hushed-face.png",kissingfacewithclosedeyes:"assets/image/kissing-face-with-closed-eyes.png",kissingfacewithsmilingeyes:"assets/image/kissing-face-with-smiling-eyes.png",kissingface:"assets/image/kissing-face.png",loudlycryingface:"assets/image/loudly-crying-face.png",lyingface:"assets/image/lying-face.png",meltingface:"assets/image/melting-face.png",moneymouthface:"assets/image/money-mouth-face.png",nauseatedface:"assets/image/nauseated-face.png",nerdface:"assets/image/nerd-face.png",neutralface:"assets/image/neutral-face.png",partyingface:"assets/image/partying-face.png",pensiveface:"assets/image/pensive-face.png",perseveringface:"assets/image/persevering-face.png",pleadingface:"assets/image/pleading-face.png",poutingface:"assets/image/pouting-face.png",relievedface:"assets/image/relieved-face.png",sadbutrelievedface:"assets/image/sad-but-relieved-face.png",salutingface:"assets/image/saluting-face.png",shushingface:"assets/image/shushing-face.png",sleepingface:"assets/image/sleeping-face.png",sleepyface:"assets/image/sleepy-face.png",slightlyfrowningface:"assets/image/slightly-frowning-face.png",slightlysmilingface:"assets/image/slightly-smiling-face.png",smilingfacewithhalo:"assets/image/smiling-face-with-halo.png",smilingfacewithhearteyes:"assets/image/smiling-face-with-heart-eyes.png",smilingfacewithhearts:"assets/image/smiling-face-with-hearts.png",smilingfacewithhorns:"assets/image/smiling-face-with-horns.png",smilingfacewithsmilingeyes:"assets/image/smiling-face-with-smiling-eyes.png",smilingfacewithsunglasses:"assets/image/smiling-face-with-sunglasses.png",smilingfacewithtear:"assets/image/smiling-face-with-tear.png",smilingface:"assets/image/smiling-face.png",smirkingface:"assets/image/smirking-face.png",sneezingface:"assets/image/sneezing-face.png",squintingfacewithtongue:"assets/image/squinting-face-with-tongue.png",thinkingface:"assets/image/thinking-face.png",tiredface:"assets/image/tired-face.png",unamusedface:"assets/image/unamused-face.png",upsidedownface:"assets/image/upside-down-face.png",wearyface:"assets/image/weary-face.png",winkingfacewithtongue:"assets/image/winking-face-with-tongue.png",winkingface:"assets/image/winking-face.png",woozyface:"assets/image/woozy-face.png",worriedface:"assets/image/worried-face.png",yawningface:"assets/image/yawning-face.png",zanyface:"assets/image/zany-face.png",zippermouthface:"assets/image/zipper-mouth-face.png"},libs:{fairyguiv7:"assets/libs/fairyguiv7.js",fguimin:"assets/libs/fgui.min.js",pixispine:"assets/libs/pixi-spine.js",pixi:"assets/libs/pixi.js",piximin:"assets/libs/pixi.min.js",tweenumdmin:"assets/libs/tween.umd.min.js"},sound:{Button:"assets/sound/Button.mp3",Dead:"assets/sound/Dead.mp3",Hint:"assets/sound/Hint.mp3",Lose:"assets/sound/Lose.mp3",Moving:"assets/sound/Moving.mp3",Music1:"assets/sound/Music1.mp3",Music2:"assets/sound/Music2.mp3",PopPrize:"assets/sound/PopPrize.mp3",Star3:"assets/sound/Star3.mp3",Win:"assets/sound/Win.mp3"}};var nt=class extends v{get view(){return this.game.ui.view.m_game}start(){return f(this,null,function*(){window.addEventListener("keypress",e=>{e.key==" "&&(h.inst.enabled=!h.inst.enabled)})})}startLevel(e,t){this.rule=new e(t),console.log("\u6E38\u620F\u5F00\u59CB",this.rule)}leaveLevel(){this.rule.dispose()}createParticle(e,t,o,r){this.game.particles.createParticle(e,{image:Q.image.smilingface,pos:t,vel:o,gravity:new Xi.default(0,2e3),scale:[.5*r,.1*r],alpha:[1,0],vr:[-10,10],life:2,burstCount:12,freq:2,wave:1,delay:0})}};var lt=class extends v{constructor(){super(...arguments);this.moveLimit=40}start(){this.bindKeyEvent(),this.bindTouchEvent()}bindKeyEvent(){window.addEventListener("keypress",e=>{this.ev.emit("key",e.key)})}bindTouchEvent(){let e=!1,t=0,o=0,r=0,n=0,l=0,a=0,c=0,d=null,p=500,x=!1,g=(b,I)=>Math.abs(b)>this.moveLimit&&Math.abs(I)<this.moveLimit?{x:Math.sign(b),y:0}:Math.abs(b)<this.moveLimit&&Math.abs(I)>this.moveLimit?{x:0,y:Math.sign(I)}:null;window.addEventListener("touchstart",b=>{e=!0,t=b.touches[0].clientX,o=b.touches[0].clientY,r=t,n=o,l=0,a=0,c=Date.now(),x=!1,this.ev.emit("down",r,n),d=this.$interval(()=>{if(Date.now()-c<p||!x)return;let I=g(l,a);I&&this.ev.emit("move",I.x,I.y,!0)},60)}),window.addEventListener("touchmove",b=>{if(!e)return;r=b.touches[0].clientX,n=b.touches[0].clientY,l=r-t,a=n-o;let I=g(l,a);I&&!x?(this.ev.emit("move",I.x,I.y,!1),x=!0,c=Date.now()):I||(x=!1)}),window.addEventListener("touchend",()=>{this.ev.emit("up",r,n),Math.abs(l)+Math.abs(a)<30&&this.ev.emit("click",r/window.innerWidth,n/window.innerHeight),e=!1,this.$stop(d)})}};var ht=Ze(at());var ve={width:900,height:1600},wi="draw_to_pee";function xi(s,i){let e=s.indexOf(i);return e==-1?null:s.splice(e,1)[0]}function be(s){return s[Math.floor(Math.random()*s.length)]}function qt(s,i){typeof i=="undefined"&&(i=s-1,s=0),s=Math.floor(s),i=Math.ceil(i);let e=[];for(let t=s;t<=i;t++)e.push(t);return e}function _(s){let i=Array.isArray(s)?[]:{};for(let e in s)typeof s[e]=="object"?i[e]=_(s[e]):i[e]=s[e];return i}function R(s){s=s.filter(t=>t.weight>0);let i=0;for(let t=0;t<s.length;++t)i+=s[t].weight;let e=Math.random()*i;i=0;for(let t=0;t<s.length-1;++t)if(i+=s[t].weight,i>=e)return s[t].value;return s[s.length-1].value}function Yt(s,i,e){return s+(i-s)*e}function vi(s,i,e,t){return Math.sqrt(Math.pow(s-e,2)+Math.pow(i-t,2))}function ct(s,i,e,t){return Math.abs(s-e)+Math.abs(i-t)}function y(s,i,e){s/=360;let t,o,r;if(i===0)t=o=r=e;else{let a=(p,x,g)=>(g<0&&(g+=1),g>1&&(g-=1),g<.16666666666666666?p+(x-p)*6*g:g<.5?x:g<.6666666666666666?p+(x-p)*(.6666666666666666-g)*6:p),c=e<.5?e*(1+i):e+i-e*i,d=2*e-c;t=a(d,c,s+1/3),o=a(d,c,s),r=a(d,c,s-1/3)}let n=a=>{let c=Math.round(a*255).toString(16);return c.length===1?"0"+c:c},l=`0x${n(t)}${n(o)}${n(r)}`;return ui(l)}var Zt=new ht.default(0,0);function Kt(s,i,e){return s+(i-s)*e}function Ko(s){if(s==null)return null;switch(typeof s){case"number":return s;case"object":return Kt(s[0],s[1],Math.random());case"function":return s(0)}}function qi(s,i){if(s==null)return null;switch(typeof s){case"number":return s;case"object":return Kt(s[0],s[1],i);case"function":return s(i)}}function Qo(s){return s==null?null:s instanceof ht.default?s.clone():s instanceof Function?s(0):new ht.default(Kt(s[0].x,s[1].x,Math.random()),Kt(s[0].y,s[1].y,Math.random()))}function ki(s){Object.getOwnPropertyNames(this).forEach(i=>{typeof this[i]=="number"?this[i]=Ko(s[i])||this[i]:this[i]instanceof ht.default?this[i]=Qo(s[i])||this[i]:typeof this[i]=="string"&&(this[i]=s[i]||this[i])})}var bi=class extends u{constructor(e){super();this.config=e;this.life=1;this._duration=1;this.vr=0;this.image="";this.scale=1;this.alpha=1;this.pos=Zt;this.rot=0;this.vel=Zt;ki.bind(this)(e),this._duration=this.life,this.enableUpdate(),this.sprite=new PIXI.Sprite,this.sprite.anchor.set(.5),PIXI.Assets.load(this.image).then(t=>{this.sprite.texture=t,this.update(0)})}update(e){if(this.life-=e,this.life<=0){this.dispose();return}let t=1-this.life/this._duration,o=qi(this.config.scale,t),r=qi(this.config.alpha,t);this.pos.add(this.vel.multiply(e,!0)),this.rot+=this.vr*e,this.sprite.position.set(this.pos.x,this.pos.y),this.sprite.rotation=this.rot,this.sprite.scale.set(o),this.sprite.alpha=r}dispose(){this.sprite.destroy(),super.dispose()}},yi=class extends u{constructor(e){super();this.burstCount=1;this.freq=0;this.delay=0;this.wave=-1;this._canFire=!0;ki.bind(this)(e),this.delay?this.$delay(this.delay*1e3,()=>this.enableUpdate()):this.enableUpdate()}update(e){!this._canFire||(this.fire(),this._canFire=!1,this.$delay(this.freq*1e3,()=>this._canFire=!0),this.wave>0&&(this.wave-=1,this.wave<=0&&this.ev.emit("stop")))}fire(){for(let e=0;e<this.burstCount;e++)this.ev.emit("fire")}},Ii=class extends u{constructor(e){super();this.config=e;this.gravity=Zt;this.holeHole=Zt;this.dumpLinear=.995;this.dumpAngle=.995;this.particles=[];ki.bind(this)(e),this.enableUpdate()}update(e){this.particles.forEach(t=>{t.vel.add(this.gravity.multiply(e,!0))})}createItem(e){let t=new bi(this.config);e.addChild(t.sprite),this.particles.push(t),t.ev.on("dispose",()=>{this.particles=this.particles.filter(o=>o!=t),this.particles.length==0&&this.ev.emit("empty")})}dispose(){[...this.particles].forEach(e=>e.dispose()),super.dispose()}},Ci=class extends u{constructor(e,t){super();this.emitter=new yi(t),Object.getOwnPropertyNames(this.emitter).forEach(o=>{t[o]&&(this.emitter[o]=t[o])}),this.environement=new Ii(t),Object.getOwnPropertyNames(this.environement).forEach(o=>{t[o]&&(this.environement[o]=t[o])}),this.emitter.ev.on("fire",()=>this.environement.createItem(e)),this.emitter.ev.on("stop",()=>{this.emitter.dispose(),this.emitter=null}),this.environement.ev.on("empty",()=>this.dispose())}dispose(){var e;(e=this.emitter)==null||e.dispose(),this.environement.dispose(),super.dispose()}},ft=class extends v{constructor(){super(...arguments);this.particles=[]}createParticle(e,t){let o=new Ci(e,t);return this.particles.push(o),o.ev.on("dispose",()=>xi(this.particles,o)),o}removeParticle(e){e.disposed||e.dispose(),xi(this.particles,e)}};var Jt=class extends v{constructor(){super(...arguments);this.mode="rush"}start(){this.loadData(),this.applyData()}applyData(){h.inst.sound.setupVolume()}loadData(){let e=localStorage.getItem(wi);e?this.data=JSON.parse(e):(this.newData(),this.saveData());let t=Date.now()-this.data.lastTime}newData(){this.data={bgm:!0,fx:!0,vibrate:!0,createTime:Date.now(),lastTime:Date.now(),level:0,level_unlock:null,level_unlock_progress:0,skinUnlocked:["male1","female1"],skin_male:"male1",skin_female:"female1",skin_toilet:null,sp_level:0,getBonusTime:null}}saveData(){this.data.lastTime=Date.now(),localStorage.setItem(wi,JSON.stringify(this.data))}getSkinConfig(e){switch(e){case"male":return ye[this.data.skin_male];case"female":return ye[this.data.skin_female];case"toilet":return ye[this.data.skin_toilet]}}getSkinConfigByID(e){return ye[e]}setSkin(e){switch(e.type){case"male":this.data.skin_male=e.id;break;case"female":this.data.skin_female=e.id;break;case"toilet":this.data.skin_toilet=e.id;break}this.data.skinUnlocked.includes(e.id)||this.data.skinUnlocked.push(e.id),this.saveData()}clearSkinUnlock(){this.data.level_unlock=null,this.data.level_unlock_progress=0,this.saveData()}getSkinUnlock(){if(!this.data.level_unlock){let e=Object.keys(ye);for(let t=0;t<e.length;t++){let o=e[t];if(!this.data.skinUnlocked.includes(o)){this.data.level_unlock=o,this.data.level_unlock_progress=0,this.saveData();break}}}return{skin:this.data.level_unlock,progress:this.data.level_unlock_progress}}getRandomSkinToUnlock(){let e=[],t=Object.keys(ye);for(let o=0;o<t.length;o++){let r=t[o];!this.data.skinUnlocked.includes(r)&&r!=this.data.level_unlock&&e.push(this.getSkinConfigByID(r))}return be(e)}skinUnlockTo(e=.05){this.data.level_unlock_progress+=e,this.saveData()}nextLevel(){this.mode=="link"?this.data.sp_level+=1:this.data.level+=1,this.saveData()}getLevel(){return Qt[this.data.level]?Qt[this.data.level].level:be(Qt).level}getSPLevel(){return _i[this.data.sp_level]?_i[this.data.sp_level].level:be(_i).level}tryGetBonus(){return this.data.getBonusTime?Date.now()-this.data.getBonusTime>24*60*60*1e3?(this.data.getBonusTime=Date.now(),this.saveData(),!0):!1:(this.data.getBonusTime=Date.now(),!0)}},Qt=[];for(let s=1;s<51;s++)Qt.push({level:s<10?"level_0"+s:"level_"+s});var _i=[{level:"link_01"},{level:"link_02"}],ye={male1:{id:"male1",type:"male",skin:"char1",skin_win:"char_win1",order:1},male4:{id:"male4",type:"male",skin:"char4",skin_win:"char_win4",order:4},male5:{id:"male5",type:"male",skin:"char5",skin_win:"char_win5",order:5},male6:{id:"male6",type:"male",skin:"char6",skin_win:"char_win6",order:6},male7:{id:"male7",type:"male",skin:"char7",skin_win:"char_win7",order:7},male8:{id:"male8",type:"male",skin:"char8",skin_win:"char_win8",order:8},male9:{id:"male9",type:"male",skin:"char9",skin_win:"char_win9",order:9},male10:{id:"male10",type:"male",skin:"char10",skin_win:"char_win10",order:10},male11:{id:"male11",type:"male",skin:"char11",skin_win:"char_win11",order:11},female1:{id:"female1",type:"female",skin:"lady1",skin_win:"lady_win1",order:1.5},female2:{id:"female2",type:"female",skin:"lady2",skin_win:"lady_win2",order:2.5},female3:{id:"female3",type:"female",skin:"lady3",skin_win:"lady_win3",order:3.5},female4:{id:"female4",type:"female",skin:"lady4",skin_win:"lady_win4",order:4.5},female5:{id:"female5",type:"female",skin:"lady5",skin_win:"lady_win5",order:5.5},female6:{id:"female6",type:"female",skin:"lady6",skin_win:"lady_win6",order:6.5},female7:{id:"female7",type:"female",skin:"lady7",skin_win:"lady_win7",order:7.5},female8:{id:"female8",type:"female",skin:"lady8",skin_win:"lady_win8",order:8.5},toilet0:{id:"toilet0",type:"toilet",skin:"skin1",order:.7},toilet1:{id:"toilet1",type:"toilet",skin:"skin2",order:1.7},toilet2:{id:"toilet2",type:"toilet",skin:"skin3",order:2.7},toilet3:{id:"toilet3",type:"toilet",skin:"skin4",order:3.7},toilet4:{id:"toilet4",type:"toilet",skin:"skin5",order:4.7},toilet5:{id:"toilet5",type:"toilet",skin:"skin6",order:5.7},toilet6:{id:"toilet6",type:"toilet",skin:"skin7",order:6.7}};var dt=class extends v{constructor(){super(...arguments);this.canvas=globalThis.screencanvas||document.getElementById("ui");this.ev=new $(this);this.evInput=new $(this);this.enabled=!0}init(){PIXI.settings.RENDER_OPTIONS.hello=!1;let e=new PIXI.Application({view:this.canvas,hello:!1,clearBeforeRender:!1,backgroundColor:16777215,backgroundAlpha:0,antialias:!1,autoStart:!1,resolution:1,width:window.innerWidth,height:window.innerHeight});this.app=e,this.renderer=this.app.renderer,this.scene=new PIXI.Container,this.app.stage.addChild(this.scene),this.game.ev.on("render",t=>{this.doRender(t)}),this.setupInputBoundary(),this.game.ev.on("resize",this.doResize.bind(this)),this.doResize()}setupInputBoundary(){this.boundary=new PIXI.EventBoundary(this.scene)}doRender(e){!this.enabled||(this.renderer.render(this.scene),this.ev.emit("render",this.renderer))}doResize(e=window.innerWidth,t=window.innerHeight){if(this.game.render2d.app.renderer.resize(e,t),this.scene){let o=e<t?e/ve.width:t/ve.height;this.scene.scale.set(o)}}takeScreenshot(){return f(this,null,function*(){return new Promise(e=>{let t=()=>{let o=this.app.renderer.extract.pixels(),r=PIXI.Texture.fromBuffer(o,window.innerWidth,window.innerHeight),n=new PIXI.Sprite(r);e(n),this.ev.off("render",t)};this.ev.on("render",t)})})}};var mt=class extends v{constructor(){super(...arguments);this.native=window.tt||null}start(){}toast(e){var t;(t=this.native)==null||t.showToast({title:e})}showShare(){var e;(e=this.native)==null||e.showShareMenu()}startRecord(){var e,t,o;this.recorder||(this.recorder=(e=this.native)==null?void 0:e.getGameRecorderManager(),(t=this.recorder)==null||t.onStop(r=>{this.videoPath=r.videoPath,console.log("\u8BB0\u5F55\u89C6\u9891\u5206\u4EAB\u5730\u5740",this.videoPath)}));try{(o=this.recorder)==null||o.start({duration:300})}catch(r){this.recorder=null,console.error("\u5F00\u59CB\u5F55\u5C4F\u51FA\u9519")}this.videoPath=""}stopRecord(){var e;(e=this.recorder)==null||e.stop()}share(){return new Promise(e=>{var t;this.native||e(!1),this.videoPath||e(!1),(t=this.native)==null||t.shareAppMessage({title:"\u5206\u4EAB\u89C6\u9891\u5566",channel:"video",templateId:"89l1fmhfshk94k6bkp",extra:{videoTopics:["\u8FDE\u8FDE\u770B","\u6478\u9C7C","\u641E\u7B11"],videoPath:this.videoPath,withVideoId:!0},success(o){xe.show({text:"\u5206\u4EAB\u6210\u529F\uFF01"}),e(!0)},fail(o){console.log("\u5931\u8D25",o),e(!1)}})})}bindInputEvents(){this.game.render2d.canvas.addEventListener("pointermove",e=>{fgui.GRoot.globalMouseStatus.mouseX=e.clientX,fgui.GRoot.globalMouseStatus.mouseY=e.clientY,console.log("move")}),this.game.render2d.canvas.addEventListener("pointerdown",e=>{fgui.GRoot.globalMouseStatus.touchDown=!0,console.log("down")}),this.game.render2d.canvas.addEventListener("pointerup",e=>{fgui.GRoot.globalMouseStatus.touchDown=!1,console.log("up")}),this.game.render2d.canvas.addEventListener("mouseout",e=>{fgui.GRoot.globalMouseStatus.touchDown=!1})}};var oo=Ze(io()),ti=class{constructor(i){this.heap=new oo.MinHeap,this.getCurrentTime=i}callAfter(i,e){this.heap.insert(this.getCurrentTime()+i,e)}callAt(i,e){this.heap.insert(i,e)}update(i){let e=this.heap.root;for(;e&&this.getCurrentTime()>=e.key;){let t=e.value;if(!t.cancelled)try{t.execute()}catch(o){console.error(o)}this.heap.remove(0),e=this.heap.root}}};var ut,ii=class{constructor(){Be(this,ut,-1);this.root=new Se(-1,null),this.root.next=this.root,this.root.prev=this.root}get expiration(){return S(this,ut)}set expiration(i){Ke(this,ut,i)}*[Symbol.iterator](){let i=this.root.next;for(;i!==this.root;){let e=i.next;i.cancelled||(yield i),i=e}}add(i){let e=!1;for(;!e;)if(i.remove(),i.list==null){let t=this.root.prev;i.next=this.root,i.prev=t,i.list=this,t.next=i,this.root.prev=i,e=!0}}remove(i){i.list===this&&(i.next.prev=i.prev,i.prev.next=i.next,i.next=null,i.prev=null,i.list=null)}flush(i){let e=this.root.next;for(;e!==this.root;){let t=e.next;if(this.remove(e),!e.cancelled&&!i.add(e)&&(e.execute&&e.execute(),i&&e.intervalDuration!==null)){let o=e;o.expirationMs+=o.intervalDuration,i.add(o)}e=t}this.expiration=-1}};ut=new WeakMap;var Se=class{constructor(i,e,t=null){this.list=null;this.next=null;this.prev=null;this.cancelled=!1;this.execute=e,this.expirationMs=i,this.intervalDuration=t}get key(){return this.expirationMs}remove(){let i=this.list;i!=null&&i.remove(this)}};var We=class{constructor(i=10,e=20,t=0,o=null,r=null){this.overflowWheel=null;this.tickMs=i,this.wheelSize=e,this.interval=i*e,this.buckets=[...Array(e)].map(n=>new ii),this.currentTime=t-t%i,this.dq=o,this.root=r===null?this:r}addOverflowWheel(){this.overflowWheel||(this.overflowWheel=new We(this.interval,this.wheelSize,this.currentTime,this.dq,this.root))}add(i){let e=i.expirationMs;if(i.cancelled)return!1;if(e<this.currentTime+this.tickMs)return!1;if(e<this.currentTime+this.interval){let t=Math.floor(e/this.tickMs),o=this.buckets[t%this.wheelSize];o.add(i);let r=t*this.tickMs;return o.expiration!==r&&(o.expiration=r,this.dq.callAt(o.expiration,{cancelled:!1,execute:()=>{this.root.advanceClock(o.expiration),o.flush(this.root)}})),!0}else return this.overflowWheel==null&&this.addOverflowWheel(),this.overflowWheel.add(i)}advanceClock(i){i>=this.currentTime+this.tickMs&&(this.currentTime=i-i%this.tickMs,this.overflowWheel!=null&&this.overflowWheel.advanceClock(this.currentTime))}};var W,Ue,He,oi=class extends v{constructor(){super();Be(this,W,void 0);Be(this,Ue,void 0);Be(this,He,new Map)}getDelayQueue(){return S(this,Ue)}init(){Ke(this,Ue,new ti(()=>this.game.time.logicTime)),Ke(this,W,new We(10,20,this.game.time.logicTime,S(this,Ue)))}cancel(e){if(e instanceof Se){if(!e.cancelled)return e.cancelled=!0,e.remove(),!0}else{let t=S(this,He).get(e);if(t)return t.cancelled=!0,!0}return!1}interval(e,t=null){if(e<S(this,W).tickMs)throw new Error(`\u95F4\u9694\u65F6\u95F4\u7C92\u5EA6 ${e} \u5C0F\u4E8E\u6700\u5C0F\u5141\u8BB8\u65F6\u95F4 ${S(this,W).tickMs}`);let o=new Se(this.game.time.logicTime+e,t,e);return S(this,W).add(o),o}delay(e,t=null){if(e<S(this,W).tickMs)throw new Error(`\u95F4\u9694\u65F6\u95F4\u7C92\u5EA6 ${e} \u5C0F\u4E8E\u6700\u5C0F\u5141\u8BB8\u65F6\u95F4 ${S(this,W).tickMs}`);let o=new Se(this.game.time.logicTime+e,null),r=new Promise((n,l)=>{let a=()=>{S(this,He).delete(r),t&&t(),n(null)};o.execute=a,S(this,W).add(o)});return S(this,He).set(r,o),r}update(e){S(this,Ue).update(e)}};W=new WeakMap,Ue=new WeakMap,He=new WeakMap;var si=class extends v{constructor(){super(...arguments);this.logicTime=0;this.startTime=0;this.realityTime=0}updateFixed(e){let t=e*1e3;this.startTime+=t,this.realityTime+=t}update(e){let t=e*1e3;this.logicTime+=t}};var Ti=Ze(at());var J=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("loading","loading")}onConstruct(){this.m_state=this.getControllerAt(0),this.m_bg=this.getChildAt(0),this.m_loadingCircle=this.getChildAt(1),this.m_loadingBar=this.getChildAt(2),this.m_role_slot=this.getChildAt(3)}};J.URL="ui://kq97nyc0kmld87";var pt=class{static bindAll(){fgui.UIObjectFactory.setPackageItemExtension(J.URL,J)}};var ee=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","DialogShare")}onConstruct(){this.m_frame=this.getChildAt(0),this.m_btnYes=this.getChildAt(1),this.m_slot=this.getChildAt(2),this.m_text=this.getChildAt(3)}};ee.URL="ui://j8b2cwkb7oxo5";var Te=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","clipItem")}onConstruct(){this.m_bg=this.getChildAt(0)}};Te.URL="ui://j8b2cwkbbwrs8s";var Le=class extends fgui.GButton{static createInstance(){return fgui.UIPackage.createObject("main","_Frame")}onConstruct(){this.m_withClose=this.getControllerAt(0),this.m_withBG=this.getControllerAt(1),this.m_dragArea=this.getChildAt(1),this.m_contentArea=this.getChildAt(3),this.m_closeButton=this.getChildAt(4)}};Le.URL="ui://j8b2cwkbcx8ui";var te=class extends fgui.GButton{static createInstance(){return fgui.UIPackage.createObject("main","scaleBtn")}onConstruct(){this.m_with_ad=this.getControllerAt(1),this.m_with_lock=this.getControllerAt(2),this.m_adPos=this.getControllerAt(3),this.m_ad=this.getChildAt(1)}};te.URL="ui://j8b2cwkbkmld83";var ie=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","DialogSetting")}onConstruct(){this.m_frame=this.getChildAt(0),this.m_btn_fx=this.getChildAt(7),this.m_btn_bgm=this.getChildAt(8),this.m_btn_vibrate=this.getChildAt(9),this.m_reset=this.getChildAt(10)}};ie.URL="ui://j8b2cwkbkmld86";var oe=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","stage")}onConstruct(){this.m_stage=this.getChildAt(0),this.m_zone=this.getChildAt(1),this.m_preview_zone=this.getChildAt(2),this.m_level=this.getChildAt(3),this.m_btn_back=this.getChildAt(4),this.m_btn_restart=this.getChildAt(5),this.m_btn_tip=this.getChildAt(6),this.m_btn_skip=this.getChildAt(7)}};oe.URL="ui://j8b2cwkbkmld88";var Ge=class extends fgui.GLabel{static createInstance(){return fgui.UIPackage.createObject("main","titleLabel")}onConstruct(){this.m_gray=this.getControllerAt(0)}};Ge.URL="ui://j8b2cwkbkmld8a";var se=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","win")}onConstruct(){this.m_type=this.getControllerAt(0),this.m_title=this.getChildAt(0),this.m_unlock_progress=this.getChildAt(1),this.m_btn_retry=this.getChildAt(2),this.m_btn_skip=this.getChildAt(3)}};se.URL="ui://j8b2cwkbkmld8e";var re=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","lose")}onConstruct(){this.m_type=this.getControllerAt(0),this.m_title=this.getChildAt(0),this.m_btn_retry=this.getChildAt(1),this.m_btn_skip=this.getChildAt(2)}};re.URL="ui://j8b2cwkbkmld8g";var ae=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","shop")}onConstruct(){this.m_title=this.getChildAt(0),this.m_back=this.getChildAt(1),this.m_list=this.getChildAt(2)}};ae.URL="ui://j8b2cwkbkmld8h";var ne=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","shopItem")}onConstruct(){this.m_color=this.getControllerAt(0),this.m_bg=this.getChildAt(0),this.m_icon=this.getChildAt(1),this.m_select=this.getChildAt(2)}};ne.URL="ui://j8b2cwkbkmld8i";var le=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","title")}onConstruct(){this.m_setting=this.getChildAt(0),this.m_level=this.getChildAt(1),this.m_skin=this.getChildAt(2),this.m_tetrix=this.getChildAt(3),this.m_star=this.getChildAt(4),this.m_mario=this.getChildAt(5),this.m_zuma=this.getChildAt(6),this.m_line=this.getChildAt(7),this.m_pair=this.getChildAt(8),this.m_link=this.getChildAt(9),this.m_m2048=this.getChildAt(10),this.m_cat=this.getChildAt(11),this.m_t0=this.getTransitionAt(0),this.m_t1=this.getTransitionAt(1)}};le.URL="ui://j8b2cwkbkmld8j";var Pe=class extends fgui.GButton{static createInstance(){return fgui.UIPackage.createObject("main","MuteButton")}onConstruct(){this.m_state=this.getControllerAt(1)}};Pe.URL="ui://j8b2cwkbkywt2s";var ce=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","Arrow")}onConstruct(){this.m_bar=this.getChildAt(0),this.m_head=this.getChildAt(1),this.m_head2=this.getChildAt(2)}};ce.URL="ui://j8b2cwkbpxxpb9";var he=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","Game")}onConstruct(){this.m_status=this.getControllerAt(0),this.m_bg=this.getChildAt(0),this.m_title=this.getChildAt(1),this.m_game=this.getChildAt(2),this.m_win=this.getChildAt(3),this.m_lose=this.getChildAt(4),this.m_shop=this.getChildAt(5),this.m_mask=this.getChildAt(6)}};he.URL="ui://j8b2cwkbqrgtu";var Ne=class extends fgui.GButton{static createInstance(){return fgui.UIPackage.createObject("main","StoryChoicesItem")}onConstruct(){this.m_bg=this.getChildAt(0)}};Ne.URL="ui://j8b2cwkbv44rp";var fe=class extends fgui.GLabel{static createInstance(){return fgui.UIPackage.createObject("main","BasicNode")}onConstruct(){this.m_bg=this.getChildAt(0)}};fe.URL="ui://j8b2cwkbvzofb7";var Ae=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","stageZone")}onConstruct(){this.m_bg=this.getChildAt(0)}};Ae.URL="ui://j8b2cwkbvzofb8";var de=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","DialogConfirm")}onConstruct(){this.m_frame=this.getChildAt(0),this.m_btnYes=this.getChildAt(1),this.m_btnNo=this.getChildAt(2),this.m_text=this.getChildAt(3)}};de.URL="ui://j8b2cwkbxatjb2";var me=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","DialogAlert")}onConstruct(){this.m_frame=this.getChildAt(0),this.m_btnYes=this.getChildAt(1),this.m_text=this.getChildAt(2)}};me.URL="ui://j8b2cwkbxatjb3";var ue=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","DialogNewSkin")}onConstruct(){this.m_frame=this.getChildAt(0),this.m_btnYes=this.getChildAt(1),this.m_title=this.getChildAt(2),this.m_bg=this.getChildAt(3),this.m_icon=this.getChildAt(4)}};ue.URL="ui://j8b2cwkbxatjb5";var pe=class extends fgui.GComponent{static createInstance(){return fgui.UIPackage.createObject("main","ADZone")}onConstruct(){this.m_bg=this.getChildAt(0),this.m_text=this.getChildAt(1)}};pe.URL="ui://j8b2cwkbxatjb6";var gt=class{static bindAll(){fgui.UIObjectFactory.setPackageItemExtension(ee.URL,ee),fgui.UIObjectFactory.setPackageItemExtension(Te.URL,Te),fgui.UIObjectFactory.setPackageItemExtension(Le.URL,Le),fgui.UIObjectFactory.setPackageItemExtension(te.URL,te),fgui.UIObjectFactory.setPackageItemExtension(ie.URL,ie),fgui.UIObjectFactory.setPackageItemExtension(oe.URL,oe),fgui.UIObjectFactory.setPackageItemExtension(Ge.URL,Ge),fgui.UIObjectFactory.setPackageItemExtension(se.URL,se),fgui.UIObjectFactory.setPackageItemExtension(re.URL,re),fgui.UIObjectFactory.setPackageItemExtension(ae.URL,ae),fgui.UIObjectFactory.setPackageItemExtension(ne.URL,ne),fgui.UIObjectFactory.setPackageItemExtension(le.URL,le),fgui.UIObjectFactory.setPackageItemExtension(Pe.URL,Pe),fgui.UIObjectFactory.setPackageItemExtension(ce.URL,ce),fgui.UIObjectFactory.setPackageItemExtension(he.URL,he),fgui.UIObjectFactory.setPackageItemExtension(Ne.URL,Ne),fgui.UIObjectFactory.setPackageItemExtension(fe.URL,fe),fgui.UIObjectFactory.setPackageItemExtension(Ae.URL,Ae),fgui.UIObjectFactory.setPackageItemExtension(de.URL,de),fgui.UIObjectFactory.setPackageItemExtension(me.URL,me),fgui.UIObjectFactory.setPackageItemExtension(X.URL,X),fgui.UIObjectFactory.setPackageItemExtension(ue.URL,ue),fgui.UIObjectFactory.setPackageItemExtension(pe.URL,pe)}};function as(s,i,e,t){PIXI.Assets?ls(s,i,e):ns(s,i,e,t)}function ns(s,i,e,t){let o={loadType:PIXI.LoaderResource.LOAD_TYPE.XHR,xhrType:PIXI.LoaderResource.XHR_RESPONSE_TYPE.BUFFER},r=new fgui.utils.AssetLoader;if(s.includes(",")){let n=s.split(","),l=i.split(",");for(let a=0;a<n.length;a++)r.add(n[a],l[a],l[a].endsWith(".txt")?o:null)}else r.add(s,i,i.endsWith(".txt")?o:null);return t&&r.onProgress.add((...n)=>{console.log("\u662F\u5426\u6709\u8FC7\u7A0B\u8FD4\u56DE",n),t(...n)}),e&&r.onComplete.add((n,l)=>{e(l),r.destroy()}),r.load(),r}function ls(s,i,e,t){let o=PIXI.Assets;if(s.includes(",")){let r=s.split(","),n=i.split(",");for(let l=0;l<r.length;l++)o.add(r[l],n[l]);o.load(r).then(l=>{e&&e(l)})}else o.add(s,i),o.load(s).then(r=>{console.log("load done",r),e&&e(r)})}function so(s,i){return new Promise((e,t)=>{as(s,i,o=>{s.includes(",")?e(o):e(o[s]||o)})})}function cs(s){fgui.UIObjectFactory.setPackageItemExtension(s.URL,s)}var ri=class extends v{constructor(){super(...arguments);this.binds=[];this.config={designWidth:900,designHeight:1600,orientation:"auto",packages:[]};this.domElements=[]}get view(){return fgui.GRoot.inst.numChildren>0&&fgui.GRoot.inst.getChildAt(0)}setupFgui(){fgui.UIConfig.modalLayerAlpha=.6,fgui.UIConfig.modalLayerColor=0,fgui.GRoot.inst.setSize(this.config.designWidth,this.config.designHeight),fgui.GRoot.inst.attachTo(this.game.render2d.app,{designWidth:this.config.designWidth,designHeight:this.config.designHeight,scaleMode:"exactFit",orientation:this.config.orientation,initliazeHTMLInput:!1,alignV:0,alignH:3}),this.game.render2d.canvas.addEventListener("touchdown",t=>{fgui.GRoot.globalMouseStatus.touchDown=!0}),console.log("\u7ED1\u5B9A\u4E8B\u4EF6\u4E86\u4E48"),document.addEventListener("touchmove",t=>{let o=t.touches[0];fgui.GRoot.globalMouseStatus.mouseX=o.clientX,fgui.GRoot.globalMouseStatus.mouseY=o.clientY}),document.addEventListener("touchdown",t=>{fgui.GRoot.globalMouseStatus.touchDown=!0}),document.addEventListener("touchup",t=>{fgui.GRoot.globalMouseStatus.touchDown=!1}),document.addEventListener("touchout",t=>{fgui.GRoot.globalMouseStatus.touchDown=!1}),this.game.render2d.canvas&&this.game.render2d.ev.on("render",t=>{t.render(fgui.GRoot.inst.$container)});let e=h.inst;this.ev.on("loaded",()=>this.doResize(window.innerWidth,window.innerHeight)),e.ev.on("resize",()=>this.doResize(window.innerWidth,window.innerHeight)),e.ev.on("render",()=>{for(let t of this.domElements){let o=t.obj.parent.parent,r=t.el;r.style.left=`${(o.x+t.obj.x)*fgui.GRoot.inst.scaleX}px`,r.style.top=`${(o.y+t.obj.y)*fgui.GRoot.inst.scaleY}px`}})}doResize(e=window.innerWidth,t=window.innerHeight){if(this.game.render2d.app.renderer.resize(e,t),this.view){let o=e<t?e/ve.width:t/ve.height;this.view.setSize(e/o,t/o),fgui.GRoot.inst.setSize(e/o,t/o),fgui.GRoot.inst.scaleX=o,fgui.GRoot.inst.scaleY=o}}loadPackages(e){return f(this,null,function*(){let t=[],o=[],r,n=[];for(let l of this.config.packages)if(l.mode==e){t.push(l.name),o.push(l.path),n.push(l.name),l.mode=="entry"&&(r=l.name);for(let a of l.res)o.push(a.path),t.push(a.name);l.binder.bindAll()}yield so(t.join(","),o.join(","));for(let l of n)fgui.UIPackage.addPackage(l);this.bindExtension(),r&&this.setupCurrentView(r)})}setupCurrentView(e){let o=this.config.packages.find(r=>r.name==e).cls.createInstance();fgui.GRoot.inst.addChild(o),o.relations.add(fgui.GRoot.inst,24),this.doResize(window.innerWidth,window.innerHeight)}changePackageTo(e){this.view&&this.view.dispose(),this.setupCurrentView(e)}bindExtension(){for(let e of this.binds)cs(e)}init(){return f(this,null,function*(){this.setupFgui(),yield this.loadPackages("entry"),this.ev.emit("loaded")})}};function ro(){let s=window.innerWidth,i=window.innerHeight;return s<i?s/ve.width:i/ve.height}var wt=class extends te{onConstruct(){super.onConstruct(),h.inst.task.$nextTick(()=>{this.m_with_ad.selectedIndex==1&&(this.m_adPos.selectedPage=="mid"?(this.m_ad.x=16,this.m_ad.y=this.height*.5-this.m_ad.height*.5):this.m_adPos.selectedPage=="bot"&&(this.m_ad.y=this.height-this.m_ad.height))})}};var $e=class extends he{onConstruct(){super.onConstruct(),this.bindEvents(),this.changeStateTo("title")}bindEvents(){}changeStateTo(i,...e){let t=new TWEEN.Tween(this.m_mask).to({alpha:0},200);new TWEEN.Tween(this.m_mask).to({alpha:1},200).onComplete(()=>{this.m_status.selectedPage=i,h.inst.ui.ev.emit("stateChanged",i,...e),t.start()}).start()}};var xt=class extends oe{onConstruct(){super.onConstruct(),this.bindEvents()}updateView(){h.inst.sound.bgm=Z,h.inst.profile.mode=="rush"&&(this.m_level.title=`\u7B2C${h.inst.profile.data.level+1}\u5173`),h.inst.ad.banner.hide()}bindEvents(){h.inst.ui.ev.on("stateChanged",i=>{i=="game"&&this.updateView()}),this.m_btn_back.onClick(()=>{h.inst.gameplay.leaveLevel(),h.inst.ui.view.changeStateTo("title"),h.inst.ad.interstitial.show()}),this.m_btn_restart.onClick(()=>{}),this.m_btn_skip.onClick(()=>f(this,null,function*(){(yield h.inst.ad.video.pay())>0&&h.inst.profile.nextLevel()})),this.m_btn_tip.onClick(()=>f(this,null,function*(){(yield h.inst.ad.video.pay())>0&&h.inst.profile.mode=="link"})),this.bindInputCtrl()}bindInputCtrl(){let i=!1,e=0,t=0,o=ro();this.on(fgui.InteractiveEvents.Move,r=>{if(i){let n=r.clientX/o,l=r.clientY/o,a=n-r.clientX,c=l-r.clientY;e=n,t=l}}),this.on(fgui.InteractiveEvents.Down,r=>{i=!0,e=r.clientX/o,t=r.clientY/o}),this.on(fgui.InteractiveEvents.Up,r=>{i=!1,e=r.clientX/o,t=r.clientY/o})}};var Xe=class extends J{constructor(){super(...arguments);this.updateLoading=()=>{this.m_loadingCircle.rotation+=10,this.m_loadingBar.value+=1}}onConstruct(){super.onConstruct(),console.log("\u52A0\u8F7D\u8D44\u6E90\u4E2D\u3002\u3002\u3002"),this.loadAssets(),this.m_bg.onClick(()=>{console.log("\u70B9\u51FB\u4E86"),this.m_state.selectedPage=="ready"&&h.inst.ui.changePackageTo("main")})}loadAssets(){return f(this,null,function*(){this.m_loadingBar.value=0,h.inst.ev.on("update",this.updateLoading),yield h.inst.ui.loadPackages("dynamic"),yield h.inst.assets.loadSpine(),yield h.inst.ui.$wait(()=>this.m_loadingBar.value>=100),h.inst.ev.off("update",this.updateLoading),this.m_state.selectedPage="ready",h.inst.ui.changePackageTo("main")})}};var bt=class extends re{onConstruct(){super.onConstruct(),this.m_btn_retry.onClick(()=>{h.inst.ui.view.changeStateTo("game"),h.inst.ad.interstitial.show()}),this.m_btn_skip.onClick(()=>f(this,null,function*(){(yield h.inst.ad.video.pay())>0&&(h.inst.profile.nextLevel(),h.inst.ui.view.changeStateTo("game"))})),h.inst.ui.ev.on("stateChanged",i=>{i=="lose"&&this.updateView()})}updateView(){}};var Ie=class extends U{constructor(){super(ue)}onInit(){super.onInit(),this.view.m_btnYes.onClick(()=>{let i=h.inst.profile;this.hide()})}onShown(){super.onShown(),this.updateView()}updateView(){return f(this,null,function*(){})}};var yt=class extends ae{onConstruct(){super.onConstruct(),this.bindEvents()}bindEvents(){this.m_back.onClick(()=>{h.inst.ui.view.changeStateTo("title")}),h.inst.ui.ev.on("stateChanged",i=>{i=="shop"?(console.log("\u521B\u5EFA\u5217\u8868"),this.setupView(),this.updateView()):this.clearView()}),this.m_list.on(fgui.ListEvent.ItemClick,(i,e)=>f(this,null,function*(){let t=h.inst.profile.data,o=e.userData;o.id==t.skin_male||o.id==t.skin_female||(t.skinUnlocked.includes(o.id)?h.inst.profile.setSkin(o):(yield h.inst.ad.video.pay())>0&&(yield Ie.showAndWait({extra:{skin:o}}))),this.updateView()}))}clearView(){this.m_list.removeChildren(0,this.m_list.numChildren-1,!0)}setupView(){Object.values(ye).sort((e,t)=>e.order-t.order).forEach(e=>f(this,null,function*(){let t=ne.createInstance();t.userData=e,this.m_list.addChild(t);let o=yield h.inst.ui.bindSpineToCom(e.type,t.m_icon.m_bg,.8);t.spine=o,o.state.setAnimation(0,"idle",!0),o.state.timeScale=0,o.skeleton.setSkinByName(e.skin),o.scale.set(.6)}))}updateView(){let i=h.inst.profile.data;for(let e=0;e<this.m_list.numChildren;e++){let t=this.m_list.getChildAt(e),o=t.userData;o.id==i.skin_male||o.id==i.skin_female?(t.m_color.selectedPage="yellow",t.m_select.title="\u5DF2\u9009\u4E2D",t.m_select.m_with_ad.selectedIndex=0):i.skinUnlocked.includes(o.id)?(t.m_color.selectedPage="blue",t.m_select.title="\u5DF2\u89E3\u9501",t.m_select.m_with_ad.selectedIndex=0):(t.m_color.selectedPage="green",t.m_select.title="\u672A\u89E3\u9501",t.m_select.m_with_ad.selectedIndex=1)}}};var It=class extends u{constructor(e){super();this.config=e}};var ge={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0},leftUp:{x:-1,y:-1},rightUp:{x:1,y:-1},leftDown:{x:-1,y:1},rightDown:{x:1,y:1}};var qe=(s,i)=>s.x==i.x&&s.y==i.y,k=class extends u{constructor(e){super();this.config=e;this.map={}}getNodeCount(){return Object.values(this.map).length}markDirty(e){this.ev.emit("needUpdate",e)}getPosID(e){return`${e.x}-${e.y}`}checkPosValid(e){return!(e.x<0||e.y<0||e.x>this.config.width-1||e.y>this.config.height-1||Math.floor(e.x)!=e.x||Math.floor(e.y)!=e.y)}getNode(e){return this.map[this.getPosID(e)]}setNode(e,t){let o=this.getPosID(e);return this.map[o]={pos:_(e),config:t,id:o,node:this.createNode(t)},this.ev.emit("newNode",this.map[o]),this.map[o]}removeNodeAt(e){let t=this.getPosID(e);delete this.map[t]}addNodeAt(e,t){if(this.getNode(e))throw new Error("\u4E0D\u80FD\u5728\u5DF2\u5360\u7528\u7684\u683C\u5B50\u4E2D\u6DFB\u52A0\u8282\u70B9");t.id=this.getPosID(e),t.pos=e,this.map[t.id]=t}createNode(e){return new It(e)}destroyNode(e){delete this.map[e.id],e.node.dispose()}destroyNodes(e){e=[...new Set(e)],e.forEach(t=>this.destroyNode(t))}traverse(e,t,o,r){r.length==0&&o(e)&&r.push(_(e)),t(e).forEach(l=>{!r.find(a=>qe(a,l))&&this.checkPosValid(l)&&o(l)&&(r.push(_(l)),this.traverse(l,t,o,r))})}forEach(e){Object.values(this.map).forEach(t=>{e(t)})}forEachSlot(e){for(let t=0;t<this.config.width;t++)for(let o=0;o<this.config.height;o++)e(t,o)}isRowFull(e){let t={x:0,y:e},o=[];return this.traverse(t,r=>[{x:r.x+1,y:r.y}],r=>!!this.getNode(r),o),o.length==this.config.width}destroyRow(e){this.getRow(e).forEach(t=>{this.destroyNode(t)})}isRowEmpty(e){let t={x:0,y:e},o=[];return this.traverse(t,r=>[{x:r.x+1,y:r.y}],r=>!this.getNode(r),o),o.length==this.config.width}clear(){for(let e in this.map)this.destroyNode(this.map[e])}getRow(e){return Object.values(this.map).filter(t=>t.pos.y==e)}moveRowUpperDown(){let e=!1;for(let t=this.config.height-1;t>0;t--)if(this.isRowEmpty(t)&&!this.isRowEmpty(t-1)){this.getRow(t-1).forEach(o=>{this.removeNodeAt(o.pos),this.addNodeAt({x:o.pos.x,y:o.pos.y+1},o),e=!0});break}if(e)return this.moveRowUpperDown();this.markDirty(2)}moveColUpperDown(e){let t=!1;for(let o=this.config.height-1;o>0;o--){let r=this.getNode({x:e,y:o}),n=this.getNode({x:e,y:o-1});if(!r&&!!n){this.removeNodeAt({x:e,y:o-1}),this.addNodeAt({x:e,y:o},n),t=!0;break}}if(t)return this.moveColUpperDown(e)}moveColAllUpperDown(){for(let e=0;e<this.config.width;e++)this.moveColUpperDown(e);this.ev.emit("needUpdate",2)}findNeighorsWithSameColor(e,t,o){let r=[];return this.traverse(e,n=>this.getAroundPoses(n),n=>{let l=this.getNode(n);return l?l.config.color==t&&(!o||l.config.text==o):!1},r),this.getNodes(r)}findLineWithSameColor(e,t,o){let r=[];return this.traverse(e,n=>o?[{x:n.x-1,y:n.y},{x:n.x+1,y:n.y}]:[{x:n.x,y:n.y-1},{x:n.x,y:n.y+1}],n=>{let l=this.getNode(n);return l?l.config.color==t:!1},r),this.getNodes(r)}findLineDiagonalWithSameColor(e,t,o){let r=[];return this.traverse(e,n=>o?[{x:n.x-1,y:n.y-1},{x:n.x+1,y:n.y+1}]:[{x:n.x+1,y:n.y-1},{x:n.x-1,y:n.y+1}],n=>{let l=this.getNode(n);return l?l.config.color==t:!1},r),this.getNodes(r)}getAroundPoses(e){let t=[];return Object.values([ge.up,ge.down,ge.left,ge.right]).forEach(o=>{t.push({x:e.x+o.x,y:e.y+o.y})}),t}getNodes(e){let t=[];return e.forEach(o=>{let r=this.getNode(o);r&&!t.includes(r)&&t.push(r)}),t}canLink(e,t){if(e.x===t.x&&e.y===t.y)return!0;if(e.x===t.x){let o=Math.min(e.y,t.y),r=Math.max(e.y,t.y),n=e.x;for(let l=o+1;l<=r-1;l++)if(!this.isPosEmpty({x:n,y:l}))return!1;return!0}if(e.y===t.y){let o=Math.min(e.x,t.x),r=Math.max(e.x,t.x),n=e.y;for(let l=o+1;l<=r-1;l++)if(!this.isPosEmpty({x:l,y:n}))return!1;return!0}return!1}isPosEmpty(e){let t=this.getNode(e);return!t||t.config.hide}getShortPath(e,t){if(this.canLink(e,t))return[];let o={x:e.x,y:t.y};return this.isPosEmpty(o)&&this.canLink(e,o)&&this.canLink(o,t)?[o]:(o={x:t.x,y:e.y},this.isPosEmpty(o)&&this.canLink(e,o)&&this.canLink(o,t)?[o]:null)}findPath(e,t,o=3,r=[[]],n=0){let l=r.sort((p,x)=>x.length-p.length).pop();if(!l)return null;let a=l[l.length-1]||e,c=t,d=this.getShortPath(a,c);if(d&&l.length+d.length<=o)return[e,...l,...d,t];if(l.length<o){let p,x=[];for(let g=0;g<this.config.width;g++)for(let b=0;b<this.config.height;b++){if(p={x:g,y:b},!this.isPosEmpty(p)||qe(e,p)||qe(p,t)||l.find(Ye=>qe(Ye,p)))continue;let I=this.getShortPath(a,p);!I||x.push({point:p,path:I})}x.sort((g,b)=>ct(g.point.x,g.point.y,e.x,e.y)+ct(g.point.x,g.point.y,t.x,t.y)-(ct(b.point.x,b.point.y,e.x,e.y)+ct(b.point.x,b.point.y,t.x,t.y)));for(let g of x)r.push([...l,...g.path,g.point])}return this.findPath(e,t,o,r,n+1)}moveItemDir(e,t){let o=this.getNode(e);if(!o)return!1;let r={x:e.x+t.x,y:e.y+t.y};return!this.checkPosValid(r)||this.getNode(r)?!1:(this.removeNodeAt(e),this.addNodeAt(r,o),this.moveItemDir(r,t),!0)}moveMapDir(e){let t=!0,o=0;for(;t;)o+=1,t=!1,this.forEach(r=>{t||(t=this.moveItemDir(r.pos,e))});console.log("\u79FB\u52A8\u5B8C\u6210\uFF0C\u79FB\u52A8\u4E86",o)}dispose(){this.clear(),super.dispose()}};var M=class extends u{constructor(e){super();this.config=e}};var C=class extends u{constructor(e,t,o){super();this.grid=e;this.config=t;this.root=o;this.nodeViews={};this.tweenerMap={};let r=this.config.colCount*this.config.nodeSize+(this.config.colCount-1)*this.config.nodeSpacing,n=this.config.rowCount*this.config.nodeSize+(this.config.rowCount-1)*this.config.nodeSpacing;this.innerSize={x:r,y:n},this.anchor={x:.5*(this.config.viewWidth-r),y:.5*(this.config.viewHeight-n)},this.root.visible=!0,this.root.m_bg.setPosition(this.anchor.x,this.anchor.y),this.root.m_bg.setSize(r,n),this.root.m_bg.visible=this.config.withBG;let l=Math.min(this.root.width/this.root.m_bg.width,this.root.height/this.root.m_bg.height);this.root.setScale(l,l),this.grid.ev.on("needUpdate",a=>{this.updateView(a==4,200)}),this.grid.ev.on("newNode",a=>{this.getNodeView(a)})}dispose(){this.root.removeChildren(1,this.root.numChildren-1,!0)}updateView(e,t){this.grid.forEach(o=>{let r=this.getNodeView(o),n=this.getNodePos(o.pos);if(e&&!o.config.hide){this.tweenerMap[o.node.id]&&this.tweenerMap[o.node.id].stop();let l=t||vi(n.x,n.y,r.x,r.y);this.tweenerMap[o.node.id]=new TWEEN.Tween(r).to({x:n.x,y:n.y},l).onComplete(()=>{delete this.tweenerMap[o.node.id]}).start()}else r.setPosition(n.x,n.y)})}getNodePos(e){return{x:this.anchor.x+e.x*(this.config.nodeSize+this.config.nodeSpacing),y:this.anchor.y+e.y*(this.config.nodeSize+this.config.nodeSpacing)}}getNodeView(e){return this.nodeViews[e.node.id]||this.createNodeView(e),this.nodeViews[e.node.id]}createNodeView(e){let t=e.node,o=fe.createInstance();o.setSize(this.config.nodeSize,this.config.nodeSize),t.config.text,o.title=t.config.text,t.config.image&&(o.icon=t.config.image),t.config.color&&(o.m_bg.color=t.config.color),t.config.hide&&(o.alpha=.2),this.nodeViews[t.id]=o,o.on(fgui.InteractiveEvents.Click,()=>{t.ev.emit("touch")}),o.on(fgui.InteractiveEvents.Down,()=>{t.ev.emit("down")}),o.on(fgui.InteractiveEvents.Move,()=>{t.ev.emit("move")}),t.ev.on("dispose",()=>f(this,null,function*(){this.tweenerMap[t.id]&&this.tweenerMap[t.id].stop(),this.config.withAnim&&!e.config.hide&&(yield this.flyAway(e)),this.removeNodeView(t)})),this.root.addChild(o)}removeNodeView(e){try{this.nodeViews[e.id].dispose()}catch(t){}delete this.nodeViews[e.id]}flyAway(e){return f(this,null,function*(){this.tweenerMap[e.node.id]&&this.tweenerMap[e.node.id].stop();let t=this.getNodeView(e);t.parent.setChildIndex(t,t.parent.numChildren-1);let o=Yt(-300,300,Math.random()),r=Yt(-500,-1e3,Math.random()),n=Yt(-300,300,Math.random()),l=this.$interval(()=>{if(this.disposed||!t||!t.parent)return;let a=this.game.delta;r+=1e3*a,t.x+=o*a,t.y+=r*a,t.rotation+=n*a,t.alpha-=a*.5},10);yield this.$delay(2e3),this.$stop(l)})}toLarge(e){this.tweenerMap[e.node.id]&&this.tweenerMap[e.node.id].stop();let t=this.getNodeView(e),o={scale:1};this.tweenerMap[e.node.id]=new TWEEN.Tween(o).to({scale:1.2},200).onUpdate(()=>{t.setScale(o.scale,o.scale)}).onComplete(()=>{delete this.tweenerMap[e.node.id]}).start()}toSmall(e,t=!1){this.tweenerMap[e.node.id]&&this.tweenerMap[e.node.id].stop();let o=this.getNodeView(e);if(t){o.setScale(1,1);return}let r={scale:1.2};this.tweenerMap[e.node.id]=new TWEEN.Tween(r).to({scale:1},200).onUpdate(()=>{o.setScale(r.scale,r.scale)}).onComplete(()=>{delete this.tweenerMap[e.node.id]}).start()}createArrow(e,t){let o=this.getNodePos(e),r=this.getNodePos(t),l=Math.atan2(r.y-o.y,r.x-o.x)/Math.PI*180,a=vi(o.x,o.y,r.x,r.y),c=ce.createInstance();return c.setPosition(o.x+this.config.nodeSize*.5,o.y+this.config.nodeSize*.5),c.rotation=l,c.width=a,this.root.addChild(c),c}};var Ct=class extends u{constructor(e){super();this.grid=e;this.bindKeyEvents(),this.bindTouchEvents()}bindKeyEvents(){let e=t=>{switch(t){case"a":this.ev.emit("move",{x:-1,y:0});break;case"d":this.ev.emit("move",{x:1,y:0});break;case"w":this.ev.emit("move",{x:0,y:-1});break;case"s":this.ev.emit("move",{x:0,y:1});break}};this.game.input.ev.on("key",e),this.ev.on("dispose",()=>{this.game.input.ev.off("key",e)})}bindTouchEvents(){let e=(t,o)=>{this.ev.emit("move",{x:t,y:o})};this.game.input.ev.on("move",e),this.ev.on("dispose",()=>{this.game.input.ev.off("move",e)})}};var kt=class extends M{constructor(e){super(e);this.config=e;this.grid=new k({width:this.config.width,height:this.config.height}),this.view=new C(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.ctrl=new Ct(this.grid),this.ctrl.ev.on("move",t=>{this.moveBroad(t)}),this.fillNumbers()}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),super.dispose()}moveBroad(e){console.log("\u79FB\u52A8\u5730\u56FE",e),this.grid.moveMapDir(e),this.grid.markDirty(4),this.$delay(200,()=>{this.checkCombine(e)?(this.grid.moveMapDir(e),this.grid.markDirty(4),this.$delay(200,()=>this.fillNumbers())):this.fillNumbers()})}checkCombine(e){let t=!1;return this.grid.forEach(o=>{if(this.grid.getNode(o.pos)!=o)return;let r=this.grid.getNode({x:o.pos.x+e.x,y:o.pos.y+e.y});if(r&&r.config.text==o.config.text){t=!0,this.grid.destroyNode(o);let n=Number(r.config.text);this.changePosInto(r.pos,this.config.modulates[n])}}),t}fillNumbers(){let e=[];this.grid.forEachSlot((t,o)=>{this.grid.getNode({x:t,y:o})||e.push({x:t,y:o})}),e.sort(()=>Math.random()-.5);for(let t=0;t<this.config.roundGenCount;t++){let o=e.pop();if(!o){this.ev.emit("gameOver");break}this.changePosInto(o,this.config.modulates[0]),console.log("\u586B\u5145\u6570\u5B57")}this.grid.markDirty(0)}changePosInto(e,t){e=_(e);let o=this.grid.getNode(e);o&&this.grid.destroyNode(o),this.grid.setNode(e,t),this.grid.markDirty(3)}movePosition(e,t){e=_(e),t=_(t);let o=this.grid.getNode(e),r=this.grid.getNode(t);r&&this.grid.destroyNode(r),this.grid.removeNodeAt(e),this.grid.setNode(e,{hide:!0}),o&&this.grid.addNodeAt(t,o)}};var ao={roundGenCount:4,width:6,height:6,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:6,colCount:6,withBG:!0,withAnim:!0},modulates:[{text:"1",color:y(0,1,.5)},{text:"2",color:y(30,1,.5)},{text:"3",color:y(60,1,.5)},{text:"4",color:y(90,1,.5)},{text:"5",color:y(120,1,.5)},{text:"6",color:y(150,1,.5)},{text:"7",color:y(180,1,.5)},{text:"8",color:y(210,1,.5)},{text:"9",color:y(240,1,.5)},{text:"A",color:y(270,1,.5)},{text:"B",color:y(300,1,.5)},{text:"C",color:y(330,1,.5)}]};var _t=class extends u{constructor(e){super();this.grid=e;this.bindTouchEvent()}bindTouchEvent(){this.grid.ev.on("newNode",e=>{e.node.ev.on("down",()=>{this.ev.emit("target",e)})})}};var Mt=class extends M{constructor(e){super(e);this.config=e;this.selectedNodes=[];this.grid=new k({width:this.config.width,height:this.config.height}),this.view=new C(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.previewGrid=new k({width:this.config.previewConfig.colCount,height:this.config.previewConfig.rowCount}),this.previewView=new C(this.previewGrid,this.config.previewConfig,this.game.gameplay.view.m_preview_zone),this.ctrl=new _t(this.grid),this.ctrl.ev.on("target",t=>{this.onSelectTarget(t)}),this.fillMap(),this.genPreview()}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),this.previewGrid.dispose(),this.previewView.dispose(),super.dispose()}fillMap(){this.grid.forEachSlot((t,o)=>{this.grid.setNode({x:t,y:o},{hide:!0})});let e=[];this.grid.forEach(t=>{t.config.hide&&e.push(t)}),e.sort(()=>Math.random()-.5);for(let t=0;t<this.config.fillCount;t++){let o=e.pop(),r=R(this.config.modulates.drops);r.tag||this.changePosInto(o.pos,r)}this.grid.markDirty(0)}genPreview(){this.previewGrid.clear(),this.previewItem=R(this.config.modulates.drops),this.previewGrid.setNode({x:0,y:0},this.previewItem),this.previewGrid.markDirty(0)}onSelectTarget(e){switch(this.previewItem.tag){case"bomb":{if(this.grid.isPosEmpty(e.pos))return;console.log("booooom"),e.config.tag=="cat"?this.changePosInto(e.pos,this.config.modulates.god):this.changePosInto(e.pos,{hide:!0});break}default:{if(!this.grid.isPosEmpty(e.pos))return;this.changePosInto(e.pos,this.previewItem)}}this.moveCats(),this.grid.markDirty(4),this.genPreview()}moveCats(){let e=[];this.grid.forEach(t=>{t.config.tag=="cat"&&e.push(t)}),e.forEach(t=>{let o=[];if([ge.left,ge.up,ge.right,ge.down].forEach(r=>{let n=this.grid.getNode({x:t.pos.x+r.x,y:t.pos.y+r.y});n&&n.config.hide&&o.push(n)}),o.length>0){let r=be(o);this.movePosition(t.pos,r.pos)}else this.changePosInto(t.pos,this.config.modulates.god)})}changePosInto(e,t){e=_(e);let o=this.grid.getNode(e);o&&this.grid.destroyNode(o),this.grid.setNode(e,t),this.grid.markDirty(3),this.checkCombine(e)}movePosition(e,t){e=_(e),t=_(t);let o=this.grid.getNode(e),r=this.grid.getNode(t);r&&this.grid.destroyNode(r),this.grid.removeNodeAt(e),this.grid.setNode(e,{hide:!0}),o&&this.grid.addNodeAt(t,o)}checkCombine(e){let t=this.grid.getNode(e);if(t.config.hide||t.config.tag=="cat")return;let o=this.grid.findNeighorsWithSameColor(e,t.config.color,t.config.text);if(o.length>=this.config.minCombo){let r=Number(t.config.text);o.forEach(n=>{if(qe(n.pos,e)){let l=_(t.config);l.text=r+1+"",this.changePosInto(e,l),this.$delay(300,()=>{this.checkCombine(e)})}else this.changePosInto(n.pos,{hide:!0})})}}};var m={black:0,red:16711680,green:65280,blue:255,purple:16711935,yellow:16776960,azur:65535,white:16777215},no={fallSpeed:500,baseLevel:3,levelFill:.3,width:10,height:15,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:15,colCount:10,withBG:!0,withAnim:!0},previewConfig:{viewWidth:200,viewHeight:200,nodeSize:50,nodeSpacing:3,rowCount:4,colCount:4,withBG:!0},modulates:[{value:[{pos:{x:0,y:0},config:{color:m.red}},{pos:{x:1,y:0},config:{color:m.red}},{pos:{x:2,y:0},config:{color:m.red}},{pos:{x:2,y:1},config:{color:m.red}}],weight:1},{value:[{pos:{x:0,y:1},config:{color:m.green}},{pos:{x:1,y:1},config:{color:m.green}},{pos:{x:2,y:1},config:{color:m.green}},{pos:{x:2,y:0},config:{color:m.green}}],weight:1},{value:[{pos:{x:0,y:0},config:{color:m.blue}},{pos:{x:1,y:0},config:{color:m.blue}},{pos:{x:1,y:1},config:{color:m.blue}},{pos:{x:2,y:0},config:{color:m.blue}}],weight:2},{value:[{pos:{x:0,y:1},config:{color:m.purple}},{pos:{x:1,y:1},config:{color:m.purple}},{pos:{x:1,y:0},config:{color:m.purple}},{pos:{x:2,y:0},config:{color:m.purple}}],weight:1},{value:[{pos:{x:0,y:0},config:{color:m.azur}},{pos:{x:1,y:0},config:{color:m.azur}},{pos:{x:1,y:1},config:{color:m.azur}},{pos:{x:2,y:1},config:{color:m.azur}}],weight:1},{value:[{pos:{x:0,y:0},config:{color:m.black}},{pos:{x:0,y:1},config:{color:m.black}},{pos:{x:1,y:1},config:{color:m.black}},{pos:{x:1,y:0},config:{color:m.black}}],weight:1},{value:[{pos:{x:0,y:0},config:{color:m.white}},{pos:{x:1,y:0},config:{color:m.white}},{pos:{x:2,y:0},config:{color:m.white}},{pos:{x:3,y:0},config:{color:m.white}}],weight:1}]};var lo={minCombo:3,fillCount:20,modulates:{god:{color:m.white,tag:"god",text:"1"},drops:[{value:{color:m.yellow,image:Q.image.smilingfacewithhearts,tag:"cat"},weight:.2},{value:{color:m.black,image:Q.image.smilingfacewithhorns,tag:"bomb"},weight:.1},{value:{color:m.red,text:"1"},weight:1},{value:{color:m.green,text:"1"},weight:3},{value:{color:m.blue,text:"1"},weight:2}]},width:8,height:8,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:8,colCount:8,withBG:!0,withAnim:!0},previewConfig:{viewWidth:200,viewHeight:200,nodeSize:50,nodeSpacing:3,rowCount:1,colCount:1,withBG:!0}};var Rt=class extends u{constructor(e){super();this.grid=e;this.bindTouchEvent()}bindTouchEvent(){this.grid.ev.on("newNode",t=>{t.node.ev.on("down",()=>{this.ev.emit("target",t)})});let e=(t,o)=>{this.ev.emit("move",{x:t,y:o})};this.game.input.ev.on("move",e),this.ev.on("dispose",()=>{this.game.input.ev.off("move",e)})}};var Et=class extends M{constructor(e){super(e);this.config=e;this.grid=new k({width:this.config.width,height:this.config.height}),this.view=new C(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.ctrl=new Rt(this.grid),this.ctrl.ev.on("target",t=>{this.target&&t!=this.target&&this.releaseTarget(),this.setTarget(t)}),this.ctrl.ev.on("move",t=>{this.target&&(this.switcher=this.grid.getNode({x:this.target.pos.x+t.x,y:this.target.pos.y+t.y})),this.target&&this.switcher&&(this.switchTargets(this.target,this.switcher),this.target=null,this.switcher=null)}),this.fillMap()}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),super.dispose()}switchTargets(e,t){return f(this,null,function*(){this.view.toLarge(t),this.grid.removeNodeAt(e.pos),this.grid.removeNodeAt(t.pos);let o=_(t.pos),r=_(e.pos);if(this.grid.addNodeAt(o,e),this.grid.addNodeAt(r,t),this.grid.markDirty(4),yield this.$delay(500),this.checkMatch())this.fall();else{this.view.toSmall(t),this.view.toSmall(e),this.grid.removeNodeAt(e.pos),this.grid.removeNodeAt(t.pos);let n=_(t.pos),l=_(e.pos);this.grid.addNodeAt(n,e),this.grid.addNodeAt(l,t),this.grid.markDirty(4)}})}checkMatch(){let e=!1;return this.grid.forEach(t=>{let o=this.grid.findLineWithSameColor(t.pos,t.config.color,!0),r=this.grid.findLineWithSameColor(t.pos,t.config.color,!1),n=[];o.length>=this.config.minCombo&&(n=n.concat(o)),r.length>=this.config.minCombo&&(n=n.concat(r)),n.length>0&&(this.grid.destroyNodes(n),this.ev.emit("score",100*n.length),e=!0)}),e}releaseTarget(){this.view.toSmall(this.target)}setTarget(e){this.target=e,this.view.toLarge(this.target)}fillMap(){this.grid.forEachSlot((e,t)=>{this.grid.setNode({x:e,y:t},R(this.config.modulates))}),this.grid.markDirty(0),this.checkMatch()&&this.fall()}shuffle(){this.grid.clear(),this.fillMap()}fall(){return f(this,null,function*(){this.grid.moveColAllUpperDown(),yield this.$delay(500),this.grid.forEachSlot((e,t)=>{this.grid.getNode({x:e,y:t})||this.grid.setNode({x:e,y:t},R(this.config.modulates))}),this.grid.markDirty(0),this.checkMatch()&&this.fall()})}};var co={minCombo:3,modulates:[{value:{color:m.red},weight:1},{value:{color:m.green},weight:1},{value:{color:m.blue},weight:1},{value:{color:m.purple},weight:1},{value:{color:m.yellow},weight:1},{value:{color:m.azur},weight:1}],width:8,height:8,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:8,colCount:8,withBG:!0,withAnim:!0}};var St=class extends u{constructor(e){super();this.grid=e;this.bindTouchEvent()}bindTouchEvent(){this.grid.ev.on("newNode",e=>{e.node.ev.on("touch",()=>{this.ev.emit("target",e)})})}};var Ut=class extends M{constructor(e){super(e);this.config=e;this.grid=new k({width:this.config.width,height:this.config.height}),this.view=new C(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.ctrl=new St(this.grid),this.ctrl.ev.on("target",t=>{this.onSelectTarget(t)}),this.fillMap(),this.fillNumbers()}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),super.dispose()}fillMap(){this.grid.forEachSlot((e,t)=>{this.grid.setNode({x:e,y:t},{hide:!0})}),this.grid.markDirty(0)}shuffle(){this.grid.clear(),this.fillMap()}fillNumbers(){let e=[];this.grid.forEach(t=>{t.config.hide&&e.push(t)}),e.sort(()=>Math.random()-.5),console.log("\u586B\u5145\u6570\u5B57");for(let t=0;t<this.config.roundGenCount;t++){let o=e.pop();if(!o){this.ev.emit("gameOver");break}this.grid.destroyNode(o);let r=this.grid.setNode({x:o.pos.x,y:o.pos.y},this.config.modulates[0]);console.log(r,{x:o.pos.x,y:o.pos.y},this.config.modulates[0])}this.grid.markDirty(0)}clear(){this.targetA&&this.view.toSmall(this.targetA),this.targetB&&this.view.toSmall(this.targetB),this.targetA=null,this.targetB=null}onSelectTarget(e){if(!this.targetA&&!e.config.hide?(this.targetA=e,this.view.toLarge(e)):e==this.targetA?this.clear():e&&e.config.hide&&(this.targetB=e),this.targetA&&this.targetB){let t=this.grid.findPath(this.targetA.pos,this.targetB.pos,this.config.minPathLength);if(console.log("\u662F\u5426\u6709\u8DEF\u5F84",t),t){let o=[];for(let r=0;r<t.length-1;r++){let n=t[r],l=t[r+1];o.push(this.view.createArrow(n,l))}this.$delay(300,()=>{this.grid.destroyNode(this.targetB),this.grid.removeNodeAt(this.targetA.pos),this.grid.setNode(this.targetA.pos,{hide:!0}),this.grid.addNodeAt(this.targetB.pos,this.targetA),this.view.toSmall(this.targetA,!0),this.grid.markDirty(4),o.forEach(r=>r.dispose()),this.checkCombine(this.targetA),this.targetA=null,this.targetB=null})}else this.clear()}}checkCombine(e,t=!0){let o=this.grid.findLineWithSameColor(e.pos,e.config.color,!0),r=this.grid.findLineWithSameColor(e.pos,e.config.color,!1),n=this.grid.findLineDiagonalWithSameColor(e.pos,e.config.color,!0),l=this.grid.findLineDiagonalWithSameColor(e.pos,e.config.color,!1),a=[];o.length>=this.config.combineCount&&(a=a.concat(o)),r.length>=this.config.combineCount&&(a=a.concat(r)),n.length>=this.config.combineCount&&(a=a.concat(n)),l.length>=this.config.combineCount&&(a=a.concat(l)),a.length>0?(console.log("\u6D88\u9664\uFF01\uFF01"),this.grid.destroyNodes(a),a.forEach(c=>{c!=e&&this.grid.setNode(c.pos,{hide:!0})}),this.ev.emit("score",100*a.length*Number(e.config.text)),this.$delay(300,()=>{let c=Number(e.config.text),d=this.grid.setNode(e.pos,this.config.modulates[c]);console.log(this.config.modulates[c]),this.grid.markDirty(0),this.checkCombine(d,!0)})):t&&this.fillNumbers()}};var ho={minPathLength:12,roundGenCount:5,combineCount:5,width:12,height:12,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:12,colCount:12,withBG:!0,withAnim:!0},modulates:[{text:"1",color:y(0,1,.5)},{text:"2",color:y(30,1,.5)},{text:"3",color:y(60,1,.5)},{text:"4",color:y(90,1,.5)},{text:"5",color:y(120,1,.5)},{text:"6",color:y(150,1,.5)},{text:"7",color:y(180,1,.5)},{text:"8",color:y(210,1,.5)},{text:"9",color:y(240,1,.5)},{text:"A",color:y(270,1,.5)},{text:"B",color:y(300,1,.5)},{text:"C",color:y(330,1,.5)}]};var Tt=class extends u{constructor(e){super();this.grid=e;this.bindTouchEvent()}bindTouchEvent(){this.grid.ev.on("newNode",t=>{t.node.ev.on("down",()=>{this.ev.emit("target",t)}),t.node.ev.on("move",()=>{this.ev.emit("hover",t)})});let e=(t,o)=>{this.ev.emit("stop"),console.log("mouse up")};this.game.input.ev.on("up",e),this.ev.on("dispose",()=>{this.game.input.ev.off("up",e)})}};var Lt=class extends M{constructor(e){super(e);this.config=e;this.selectedNodes=[];this.lineArrows=[];this.killCombo=0;this.maxCombo=0;this.grid=new k({width:this.config.width,height:this.config.height}),this.view=new C(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.ctrl=new Tt(this.grid),this.ctrl.ev.on("target",t=>{this.onSelectTarget(t)}),this.ctrl.ev.on("hover",t=>{this.onHoverTarget(t)}),this.ctrl.ev.on("stop",()=>{this.killTargets()}),this.fillMap()}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),super.dispose()}fillMap(){this.grid.forEachSlot((e,t)=>{this.grid.setNode({x:e,y:t},R(this.config.modulates))}),this.grid.markDirty(0)}shuffle(){this.grid.clear(),this.fillMap()}clearPath(){this.lineArrows.forEach(e=>{e.dispose()}),this.lineArrows.length=0,this.selectedNodes.forEach(e=>{this.view.toSmall(e)}),this.selectedNodes.length=0}onSelectTarget(e){this.clearPath(),this.view.toLarge(e),this.selectedNodes.push(e),this.lastHover=e}onHoverTarget(e){if(e==this.lastHover)return;this.lastHover=e;let t=this.selectedNodes[this.selectedNodes.length-1];if(!!t)if(e==t)if(this.selectedNodes.length==1)this.clearPath();else{let o=this.selectedNodes.pop();this.view.toSmall(o),this.lineArrows.pop().dispose()}else{if(this.selectedNodes.includes(e))return;{let o=Math.abs(t.pos.x-e.pos.x)<=1&&Math.abs(t.pos.y-e.pos.y)<=1,r=e.config.color==t.config.color;o&&r&&(this.view.toLarge(e),this.selectedNodes.push(e),this.lineArrows.push(this.view.createArrow(t.pos,e.pos)))}}}killTargets(){if(this.selectedNodes.length<this.config.minCombo){this.clearPath();return}this.selectedNodes.forEach(e=>{this.grid.destroyNode(e)}),this.clearPath(),this.killCombo+=1,this.maxCombo=Math.max(this.maxCombo,this.killCombo),this.$delay(2e3,()=>{this.killCombo-=1,this.killCombo==0&&(console.log("\u6700\u5927\u8FDE\u51FB",this.maxCombo),this.maxCombo=0,this.fall())})}fall(){return f(this,null,function*(){this.grid.moveColAllUpperDown(),yield this.$delay(500),this.grid.forEachSlot((e,t)=>{this.grid.getNode({x:e,y:t})||this.grid.setNode({x:e,y:t},R(this.config.modulates))}),this.grid.markDirty(0)})}};var fo={minCombo:4,modulates:[{value:{color:m.red},weight:1},{value:{color:m.green},weight:1},{value:{color:m.blue},weight:1},{value:{color:m.purple},weight:1},{value:{color:m.yellow},weight:1},{value:{color:m.azur},weight:1}],width:10,height:15,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:15,colCount:10,withBG:!0,withAnim:!0}};var we=class extends u{constructor(e){super();this.grid=e;this.members=[]}createAt(e,t){this.members.length=0,t.forEach(o=>{this.members.push(this.grid.setNode({x:o.pos.x+e.x,y:o.pos.y+e.y},o.config))}),this.grid.markDirty(0)}addMembers(e){e.forEach(t=>this.members.push(t))}checkColl(e,t){let o=!1;return t.forEach(r=>{let n=this.grid.getNode({x:r.pos.x+e.x,y:r.pos.y+e.y});o||(o=!!n)}),o}transform(e,t=!1){let o=this.getRect(),r=[];this.members.forEach(l=>{let a=e(l.pos,o);r.push({pos:a,item:l}),this.grid.removeNodeAt(l.pos)});let n=!0;return r.forEach(l=>{!n||(this.grid.checkPosValid(l.pos)||(n=!1),this.grid.getNode(l.pos)&&(n=!1))}),n?(r.forEach(l=>{this.grid.addNodeAt(l.pos,l.item)}),this.grid.markDirty(t?2:1)):this.members.forEach(l=>{this.grid.addNodeAt(l.pos,l)}),n}rotate(e=!0){return this.transform((t,o)=>{let r=t.x-o.pos.x,n=t.y-o.pos.y,l=Math.floor((o.size.x-o.size.y)*.5);return l=l<0?l+1:l,e?{x:o.pos.x+n+l,y:o.pos.y+(o.size.x-r)}:{x:o.pos.x+(o.size.x-n)-l,y:o.pos.y+r}})}flip(e=!0){return this.transform((t,o)=>{let r=t.x-o.pos.x,n=t.y-o.pos.y;return e?{x:o.pos.x+(o.size.x-r),y:o.pos.y+n}:{x:o.pos.x+r,y:o.pos.y+(o.size.y-n)}})}move(e,t,o=!1){return this.transform((r,n)=>({x:r.x+e,y:r.y+t}),o)}getRect(){let e=1/0,t=1/0,o=-1/0,r=-1/0;this.members.forEach(a=>{e=Math.min(e,a.pos.x),o=Math.max(o,a.pos.x),t=Math.min(t,a.pos.y),r=Math.max(r,a.pos.y)});let n=o-e,l=r-t;return{pos:{x:e,y:t},size:{x:n,y:l}}}clear(){this.members.length=0}};var Gt=class extends u{constructor(e){super();this.grid=e;this.group=new we(this.grid),this.bindKeyEvents(),this.bindTouchEvents()}bindKeyEvents(){let e=this.group,t=o=>{switch(o){case"q":e.rotate();break;case"e":e.rotate(!1);break;case"a":e.move(-1,0);break;case"d":e.move(1,0);break;case"w":e.rotate();break;case"s":e.move(0,1);break;case"r":e.flip(!0);break;case"f":e.flip(!1);break}};this.game.input.ev.on("key",t),this.ev.on("dispose",()=>{this.game.input.ev.off("key",t)})}bindTouchEvents(){let e=(o,r)=>{this.group.move(o,r)};this.game.input.ev.on("move",e),this.ev.on("dispose",()=>{this.game.input.ev.off("move",e)});let t=(o,r)=>{r>.5?o<.1?this.group.rotate(!0):o>.9&&this.group.rotate(!1):o<.1?this.group.flip(!0):o>.9&&this.group.flip(!1)};this.game.input.ev.on("click",t),this.ev.on("dispose",()=>{this.game.input.ev.off("click",t)})}};var E={black:0,red:16711680,green:65280,blue:255,purple:16711935,yellow:16776960,azur:65535,white:16777215},mo={fallSpeed:500,baseLevel:3,levelFill:.5,width:10,height:15,minCombo:4,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:15,colCount:10,withBG:!0,withAnim:!0},previewConfig:{viewWidth:200,viewHeight:200,nodeSize:50,nodeSpacing:3,rowCount:1,colCount:2,withBG:!0},modulates:[{value:[{pos:{x:0,y:0},config:{color:E.red}},{pos:{x:1,y:0},config:{color:E.red}}],weight:1},{value:[{pos:{x:0,y:0},config:{color:E.red}},{pos:{x:1,y:0},config:{color:E.green}}],weight:1},{value:[{pos:{x:0,y:0},config:{color:E.red}},{pos:{x:1,y:0},config:{color:E.blue}}],weight:1},{value:[{pos:{x:0,y:0},config:{color:E.green}},{pos:{x:1,y:0},config:{color:E.green}}],weight:1},{value:[{pos:{x:0,y:0},config:{color:E.green}},{pos:{x:1,y:0},config:{color:E.blue}}],weight:1},{value:[{pos:{x:0,y:0},config:{color:E.blue}},{pos:{x:1,y:0},config:{color:E.blue}}],weight:1}]};var Pt=class extends M{constructor(e){super(e);this.config=e;this.dropGroup=()=>{this.ctrl.group.move(0,1),this.$delay(this.config.fallSpeed,()=>f(this,null,function*(){if(this.checkColl()){let e=[...this.ctrl.group.members];this.ctrl.group.clear(),this.checkScore(e),this.genCtrlGoup(),this.genPreview(),this.dropGroup()}else this.dropGroup()}))};this.droppingGroups=[];this.grid=new k({width:this.config.width,height:this.config.height}),this.ctrl=new Gt(this.grid),this.view=new C(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.previewGrid=new k({width:4,height:4}),this.previewView=new C(this.previewGrid,this.config.previewConfig,this.game.gameplay.view.m_preview_zone),this.init()}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),this.previewGrid.dispose(),this.previewView.dispose(),super.dispose()}init(){this.genStartLevel(),this.genPreview(),this.genCtrlGoup(),this.genPreview(),this.$delay(this.config.fallSpeed,()=>{this.dropGroup()})}genStartLevel(){let e=[{color:E.red,image:Q.image.angryface},{color:E.green,image:Q.image.smilingface},{color:E.blue,image:Q.image.coldface}];for(let t=this.config.height-1;t>=this.config.height-this.config.baseLevel;t--){let o=Math.floor(this.config.width*this.config.levelFill),r=qt(this.config.width-1).sort(()=>Math.random()-.5);r.length=o;for(let n of r){let l=be(e);this.grid.setNode({x:n,y:t},l)}}}genPreview(){this.previewGrid.clear(),this.previewConfig=R(this.config.modulates),this.previewConfig.forEach(e=>{this.previewGrid.setNode({x:e.pos.x,y:e.pos.y},e.config)}),this.previewGrid.markDirty(0)}genCtrlGoup(){let e={x:Math.floor(this.config.width*.5-2),y:0};this.ctrl.group.checkColl(e,this.previewConfig)?this.ev.emit("gameOver"):this.ctrl.group.createAt(e,this.previewConfig)}checkColl(){let e=!1;return this.ctrl.group.members.forEach(t=>{if(e)return;if(t.pos.y==this.config.height-1){e=!0;return}let o=this.grid.getNode({x:t.pos.x,y:t.pos.y+1});if(o&&!this.ctrl.group.members.includes(o)){e=!0;return}}),e}checkScore(e){let t=!1;for(let o of e){let r=this.grid.findLineWithSameColor(o.pos,o.config.color,!0),n=this.grid.findLineWithSameColor(o.pos,o.config.color,!1),l=[];r.length>=this.config.minCombo&&(l=l.concat(r)),n.length>=this.config.minCombo&&(l=l.concat(n)),l.length>0&&(this.grid.destroyNodes(l),this.ev.emit("score",100*l.length),t=!0)}t&&this.dropPills()}dropPills(){this.droppingGroups.forEach(n=>n.clear()),this.droppingGroups.length=0;let e=[];this.grid.forEach(n=>{n.config.image||e.push(n)});let t=[],o=[],r=e.pop();for(;r;){if(o.includes(r)){r=e.pop();continue}o.push(r);let n=[];this.grid.traverse(r.pos,a=>this.grid.getAroundPoses(a),a=>{let c=this.grid.getNode(a);return c?c.config.color==r.config.color&&!c.config.image:!1},n);let l=this.grid.getNodes(n);l.forEach(a=>o.push(a)),t.push(l)}t.forEach(n=>{let l=new we(this.grid);l.addMembers(n),this.tryMoveDownGroup(l),this.droppingGroups.push(l)})}tryMoveDownGroup(e){e.members.length>0&&e.move(0,1,!0)?this.$delay(100,()=>this.tryMoveDownGroup(e)):(this.checkScore([...e.members]),e.clear())}};var Nt=class extends u{constructor(e){super();this.grid=e;this.bindTouchEvent()}bindTouchEvent(){this.grid.ev.on("newNode",e=>{e.node.ev.on("touch",()=>{this.ev.emit("target",e)})})}};var At=class extends M{constructor(e){super(e);this.config=e;this.grid=new k({width:this.config.width,height:this.config.height}),this.view=new C(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.ctrl=new Nt(this.grid),this.ctrl.ev.on("target",t=>{this.onSelectTarget(t)}),this.fillMap()}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),super.dispose()}fillMap(){let e=[],t=this.config.width*this.config.height,o=-1;for(;e.length<t;)o+=1,o>=this.config.modulates.length&&(o=0),e.push(_(this.config.modulates[o])),e.push(_(this.config.modulates[o]));e.sort(()=>Math.random()-.5);let r=-1;this.grid.forEachSlot((n,l)=>{r++;let a=e[r];this.grid.setNode({x:n,y:l},a)}),this.grid.markDirty(0)}shuffle(){this.grid.clear(),this.fillMap()}clear(){this.targetA&&this.view.toSmall(this.targetA),this.targetB&&this.view.toSmall(this.targetB),this.targetA=null,this.targetB=null}onSelectTarget(e){if(this.targetA?e==this.targetA?this.clear():(this.targetB=e,this.view.toLarge(e)):(this.targetA=e,this.view.toLarge(e)),this.targetA&&this.targetB)if(this.targetA.config.text==this.targetB.config.text){let t=this.grid.findPath(this.targetA.pos,this.targetB.pos,this.config.minPathLength);if(t){let o=[];for(let r=0;r<t.length-1;r++){let n=t[r],l=t[r+1];o.push(this.view.createArrow(n,l))}this.$delay(300,()=>{this.grid.destroyNodes([this.targetA,this.targetB]),this.targetA=null,this.targetB=null,o.forEach(r=>r.dispose()),this.grid.getNodeCount()==0&&this.fillMap()})}else this.clear()}else this.clear()}checkPathLink(){return!0}};var uo={minPathLength:2,modulates:[{text:"\u9504"},{text:"\u79BE"},{text:"\u65E5"},{text:"\u5F53"},{text:"\u5348"},{text:"\u6C57"},{text:"\u6EF4"},{text:"\u4E0B"},{text:"\u571F"},{text:"\u8C01"},{text:"\u77E5"},{text:"\u76D8"},{text:"\u4E2D"},{text:"\u9910"},{text:"\u7C92"},{text:"\u7686"},{text:"\u8F9B"},{text:"\u82E6"}],width:12,height:12,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:12,colCount:12,withBG:!0,withAnim:!0}};var jt=class extends u{constructor(e){super();this.grid=e;this.bindTouchEvent()}bindTouchEvent(){this.grid.ev.on("newNode",e=>{e.node.ev.on("touch",()=>{this.ev.emit("target",e)})})}};var Ot=class extends M{constructor(e){super(e);this.config=e;this.selectedNodes=[];this.killCombo=0;this.maxCombo=0;this.grid=new k({width:this.config.width,height:this.config.height}),this.view=new C(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.ctrl=new jt(this.grid),this.ctrl.ev.on("target",t=>{this.onSelectTarget(t)}),this.fillMap()}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),super.dispose()}fillMap(){this.grid.forEachSlot((e,t)=>{this.grid.setNode({x:e,y:t},R(this.config.modulates))}),this.grid.markDirty(0)}shuffle(){this.grid.clear(),this.fillMap()}onSelectTarget(e){if(this.selectedNodes.includes(e))this.selectedNodes.length>=this.config.minCombo?this.killTargets():(this.selectedNodes.forEach(t=>{this.view.toSmall(t)}),this.selectedNodes.length=0);else{this.selectedNodes.length>0&&this.selectedNodes.forEach(o=>{this.view.toSmall(o)});let t=this.grid.findNeighorsWithSameColor(e.pos,e.config.color);this.selectedNodes=t,t.forEach(o=>{this.view.toLarge(o)})}}killTargets(){this.selectedNodes.forEach(e=>{this.grid.destroyNode(e)}),this.selectedNodes.length=0,this.killCombo+=1,this.maxCombo=Math.max(this.maxCombo,this.killCombo),this.$delay(2e3,()=>{this.killCombo-=1,this.killCombo==0&&(console.log("\u6700\u5927\u8FDE\u51FB",this.maxCombo),this.maxCombo=0,this.fall())})}fall(){return f(this,null,function*(){this.grid.moveColAllUpperDown(),yield this.$delay(500),this.grid.forEachSlot((e,t)=>{this.grid.getNode({x:e,y:t})||this.grid.setNode({x:e,y:t},R(this.config.modulates))}),this.grid.markDirty(0),this.findAnyCombo()||this.shuffle()})}findAnyCombo(e=!1){let t=!1;return this.grid.forEach(o=>{if(t)return;let r=this.grid.findNeighorsWithSameColor(o.pos,o.config.color);r.length>=this.config.minCombo&&(t=!0,e&&(this.selectedNodes=r,r.forEach(n=>{this.view.toLarge(n)})))}),t}};var po={minCombo:4,modulates:[{value:{color:m.red},weight:1},{value:{color:m.green},weight:1},{value:{color:m.blue},weight:1},{value:{color:m.purple},weight:1},{value:{color:m.yellow},weight:1},{value:{color:m.azur},weight:1}],width:10,height:15,viewConfig:{viewWidth:900,viewHeight:900,nodeSize:50,nodeSpacing:3,rowCount:15,colCount:10,withBG:!0,withAnim:!0}};var Bt=class extends u{constructor(e){super();this.grid=e;this.group=new we(this.grid),this.bindKeyEvents(),this.bindTouchEvents()}bindKeyEvents(){let e=this.group,t=o=>{switch(o){case"q":e.rotate();break;case"e":e.rotate(!1);break;case"a":e.move(-1,0);break;case"d":e.move(1,0);break;case"w":e.rotate();break;case"s":e.move(0,1);break;case"r":e.flip(!0);break;case"f":e.flip(!1);break}};this.game.input.ev.on("key",t),this.ev.on("dispose",()=>{this.game.input.ev.off("key",t)})}bindTouchEvents(){let e=(o,r)=>{this.group.move(o,r)};this.game.input.ev.on("move",e),this.ev.on("dispose",()=>{this.game.input.ev.off("move",e)});let t=(o,r)=>{r>.5?o<.1?this.group.rotate(!0):o>.9&&this.group.rotate(!1):o<.1?this.group.flip(!0):o>.9&&this.group.flip(!1)};this.game.input.ev.on("click",t),this.ev.on("dispose",()=>{this.game.input.ev.off("click",t)})}};var Vt=class extends M{constructor(e){super(e);this.config=e;this.dropGroup=()=>{this.ctrl.group.move(0,1,!0),this.$delay(this.config.fallSpeed,()=>f(this,null,function*(){this.checkColl()?(this.ctrl.group.clear(),yield this.checkScore(),this.genCtrlGoup(),this.genPreview(),this.dropGroup()):this.dropGroup()}))};this.grid=new k({width:this.config.width,height:this.config.height}),this.ctrl=new Bt(this.grid),this.view=new C(this.grid,this.config.viewConfig,this.game.gameplay.view.m_zone),this.previewGrid=new k({width:4,height:4}),this.previewView=new C(this.previewGrid,this.config.previewConfig,this.game.gameplay.view.m_preview_zone),this.init()}dispose(){this.grid.dispose(),this.ctrl.dispose(),this.view.dispose(),this.previewGrid.dispose(),this.previewView.dispose(),super.dispose()}init(){this.genStartLevel(),this.genPreview(),this.genCtrlGoup(),this.genPreview(),this.$delay(this.config.fallSpeed,()=>{this.dropGroup()})}genStartLevel(){for(let e=this.config.height-1;e>=this.config.height-this.config.baseLevel;e--){let t=Math.floor(this.config.width*this.config.levelFill),o=qt(this.config.width-1).sort(()=>Math.random()-.5);o.length=t;for(let r of o)this.grid.setNode({x:r,y:e},{color:11184810})}}genPreview(){this.previewGrid.clear(),this.previewConfig=R(this.config.modulates),this.previewConfig.forEach(e=>{this.previewGrid.setNode({x:e.pos.x,y:e.pos.y},e.config)}),this.previewGrid.markDirty(0)}genCtrlGoup(){let e={x:Math.floor(this.config.width*.5-2),y:0};this.ctrl.group.checkColl(e,this.previewConfig)?this.ev.emit("gameOver"):this.ctrl.group.createAt(e,this.previewConfig)}checkColl(){let e=!1;return this.ctrl.group.members.forEach(t=>{if(e)return;if(t.pos.y==this.config.height-1){e=!0;return}let o=this.grid.getNode({x:t.pos.x,y:t.pos.y+1});if(o&&!this.ctrl.group.members.includes(o)){e=!0;return}}),e}checkScore(){return f(this,null,function*(){let e=0;for(let t=this.config.height-1;t>=0;t--)this.grid.isRowFull(t)&&(e+=1,this.grid.destroyRow(t));this.ev.emit("score",100*Math.pow(2,e)),yield this.$delay(300),e>0&&this.grid.moveRowUpperDown()})}};var Dt=class extends U{constructor(){super(ie);this._count=0}onInit(){super.onInit(),this.bindEvents()}onShown(){super.onShown(),this.updateView()}onConstruct(){super.onConstruct(),this.bindEvents()}bindEvents(){this.view.m_btn_bgm.onClick(()=>this.updateSetting()),this.view.m_btn_fx.onClick(()=>this.updateSetting()),this.view.m_btn_vibrate.onClick(()=>this.updateSetting()),this.view.m_reset.onClick(()=>{this._count+=1,this._count>3&&(h.inst.profile.newData(),h.inst.profile.saveData(),h.inst.ui.view.changeStateTo("title"),xe.show({text:"\u5B58\u6863\u5DF2\u91CD\u7F6E"}))})}updateView(){let e=h.inst.profile.data;this.view.m_btn_bgm.selected=!e.bgm,this.view.m_btn_fx.selected=!e.fx,this.view.m_btn_vibrate.selected=!e.vibrate}updateSetting(){let e=h.inst.profile.data;e.bgm=!this.view.m_btn_bgm.selected,e.fx=!this.view.m_btn_fx.selected,e.vibrate=!this.view.m_btn_vibrate.selected,rt.vibrator.play(),h.inst.profile.saveData(),h.inst.sound.setVolume(e.bgm?1:0,"bgm"),h.inst.sound.setVolume(e.fx?1:0,"fx"),h.inst.sound.setVolume(e.vibrate?1:0,"vibrate")}};var zt=class extends le{onConstruct(){super.onConstruct(),this.bindEvents()}bindEvents(){this.m_setting.onClick(()=>f(this,null,function*(){Dt.show()})),this.m_skin.onClick(()=>{h.inst.ui.view.changeStateTo("shop")}),this.m_tetrix.onClick(()=>{h.inst.ui.view.changeStateTo("game"),h.inst.gameplay.startLevel(Vt,no)}),this.m_star.onClick(()=>{h.inst.ui.view.changeStateTo("game"),h.inst.gameplay.startLevel(Ot,po)}),this.m_mario.onClick(()=>{h.inst.ui.view.changeStateTo("game"),h.inst.gameplay.startLevel(Pt,mo)}),this.m_zuma.onClick(()=>{h.inst.ui.view.changeStateTo("game"),h.inst.gameplay.startLevel(Et,co)}),this.m_line.onClick(()=>{h.inst.ui.view.changeStateTo("game"),h.inst.gameplay.startLevel(Lt,fo)}),this.m_pair.onClick(()=>{h.inst.ui.view.changeStateTo("game"),h.inst.gameplay.startLevel(At,uo)}),this.m_link.onClick(()=>{h.inst.ui.view.changeStateTo("game"),h.inst.gameplay.startLevel(Ut,ho)}),this.m_cat.onClick(()=>{h.inst.ui.view.changeStateTo("game"),h.inst.gameplay.startLevel(Mt,lo)}),this.m_m2048.onClick(()=>{h.inst.ui.view.changeStateTo("game"),h.inst.gameplay.startLevel(kt,ao)}),h.inst.ui.ev.on("stateChanged",e=>{e=="title"&&this.updateView()})}updateView(){h.inst.sound.bgm=Y,this.m_level.title=`\u5173\u5361 ${h.inst.profile.data.level+1}/50`,h.inst.ad.banner.show()}};var je=Ze(at());var ai=class extends U{constructor(){super(ee)}onInit(){super.onInit(),this.view.m_btnYes.onClick(()=>f(this,null,function*(){if(this.extra=this.extra||{},this.extra.resolve=!0,yield h.inst.sdk.share()){if(h.inst.profile.tryGetBonus()){this.hide(),Ie.show({extra:{skin:h.inst.profile.getRandomSkinToUnlock()}});return}}else console.log("\u5206\u4EAB\u51FA\u9519");this.hide()}))}onShown(){super.onShown(),this.showScreenShot()}showScreenShot(){let i=h.inst.gameplay.screenshot;i&&h.inst.ui.bindSpriteToCom(i,this.view.m_slot)}};var Ft=class extends se{onConstruct(){super.onConstruct(),this.m_btn_retry.onClick(()=>{h.inst.ui.view.changeStateTo("game"),h.inst.ad.interstitial.show()}),this.m_btn_skip.onClick(()=>f(this,null,function*(){h.inst.ad.interstitial.show(),h.inst.profile.nextLevel(),h.inst.ui.view.changeStateTo("game")})),h.inst.ui.ev.on("stateChanged",i=>{i=="win"&&this.updateView()})}updateView(){this.m_type.selectedPage="both";let i=h.inst.profile,e=i.getSkinUnlock(),t=i.getSkinConfigByID(e.skin);i.skinUnlockTo(.1),K.play(),this.m_unlock_progress.value=100*e.progress;let o=this.m_unlock_progress.value+20,r=new TWEEN.Tween(this.m_unlock_progress).to({value:o},1e3).onComplete(()=>{o>=100?(i.clearSkinUnlock(),q.play(),Ie.show({extra:{skin:t}})):h.inst.sdk.videoPath&&ai.show()}).start();h.inst.gameplay.createParticle(this.displayObject,new je.default(0,this.height*.6),[new je.default(200,-1e3),new je.default(500,-2e3)],2),h.inst.gameplay.createParticle(this.displayObject,new je.default(this.width,this.height*.6),[new je.default(-500,-1e3),new je.default(-200,-2e3)],2)}};var Wt=class extends ri{constructor(){super(...arguments);this.binds=[Xe,$e,zt,yt,xt,Ft,bt,wt];this.config={designWidth:900,designHeight:1600,orientation:"auto",packages:[{name:"loading",cls:Xe,binder:pt,path:"./assets/gen/ui/loading.txt",res:[{name:"loading@atlas0",path:"./assets/gen/ui/loading@atlas0.png"}],mode:"entry"},{name:"main",cls:$e,binder:gt,path:"./assets/gen/ui/main.txt",res:[{name:"main@atlas0",path:"./assets/gen/ui/main@atlas0.png"}],mode:"dynamic"}]};this.vibrating=!1}get view(){return fgui.GRoot.inst.numChildren>0&&fgui.GRoot.inst.getChildAt(0)}bindSpriteToCom(e,t,o=!1){e.position.set(t.x,o?t.y+t.height:t.y),e.scale.set(t.width/e.width,(o?-1:1)*t.height/e.height),t.displayObject.parent.addChildAt(e,t.displayObject.parent.getChildIndex(t.displayObject)),t.displayObject.alpha=0}bindSpineToCom(e,t,o=.5){return f(this,null,function*(){let r=yield h.inst.assets.getSpine(e),n=new PIXI.spine.Spine(r.spineData);n.skeleton.setToSetupPose(),n.update(0),n.autoUpdate=!0,n.position.set(t.x+t.width*.5,t.y+t.height*o);let l=n.skeleton.data.animations[0];l&&n.state.setAnimation(0,l.name,!0);let a=n.skeleton.data.skins[0];return a&&n.skeleton.setSkinByName(a.name),t.displayObject.parent.addChildAt(n,t.displayObject.parent.getChildIndex(t.displayObject)),t.displayObject.alpha=0,n})}vibrate(e,t=200){if(this.vibrating)return;let o={value:1};this.vibrating=!0;let r=new Ti.default(this.view.x,this.view.y);new TWEEN.Tween(o).to({value:0},t).onUpdate(()=>{let n=new Ti.default(e*o.value,0).rotate(Math.random()*Math.PI*2);this.view.setPosition(r.x+n.x,r.y+n.y)}).onComplete(()=>{this.view.setPosition(r.x,r.y),this.vibrating=!1}).start()}};var go={time:new si,task:new oi,profile:new Jt,render2d:new dt,ui:new Wt,gameplay:new nt,assets:new tt,sound:new $t,particles:new ft,ad:new et,sdk:new mt,input:new lt},ni=class extends Je{constructor(){super(...arguments);this.config=new Ht;this.modules={};this._nextTicks=[];this.$tickCount=0;this.delta=0;this.frameTime=0;this.frameCount=0;this.everageFPS=60;this.enabled=!0;this.fpsLimit=60;this.timer=0}$nextTick(e){this._nextTicks.push({count:this.$tickCount+1,func:e})}quit(){}init(){console.log("\u6A21\u5757\u521D\u59CB\u5316\u5F00\u59CB");for(let t in go)this.modules[t]=go[t],this[t]=this.modules[t];let e=new Set;for(let t of Object.values(this.modules))!t||(t.init.bind(t)(),e.add(t));console.log("\u6A21\u5757\u521D\u59CB\u5316\u5B8C\u6210");for(let t of Object.values(this))t instanceof v&&t.start.bind(t)()}getModule(e){return this.modules[e]}updateFixed(e){this.modules.time.updateFixed(e),this.modules.task.update(e),this.ev.emit("updateFixed",e)}update(e){this.modules.time.update(e);let t=[];for(let o of this._nextTicks)o.count===this.$tickCount?o.func(e):o.count>this.$tickCount&&t.push(o);this._nextTicks=t,this.delta=e,this.ev.emit("update",e)}updatePrepare(e){this.ev.emit("updatePrepare",e)}updateLate(e){this.ev.emit("updateLate",e)}render(e){this.ev.emit("render",e)}tick(e){if(!this.enabled)return;let t=e/1e3;this.timer+=t,!(this.fpsLimit&&this.timer<1/this.fpsLimit)&&(t=this.timer,this.timer=0,this.$tickCount+=1,this.updateFixed(t),this.updatePrepare(t),this.update(t),this.updateLate(t),this.render(t))}calcEverage(){setTimeout(()=>{this.ev.on("update",e=>{e>.01&&e<.1&&(this.frameTime+=e,this.frameCount+=1,this.everageFPS=this.frameCount/this.frameTime)})},1e4)}};var h=class extends ni{constructor(){super(),h._inst=this,globalThis.game=h.inst,this.start(),console.log("\u521B\u5EFA\u6E38\u620F\u5B9E\u4F8B\uFF1F\uFF1F")}start(){this.bindWindowEvents(),this.init()}static get inst(){return h._inst}init(){super.init(),console.log("\u542F\u52A8\u4E3B\u5FAA\u73AF"),this.bindLoop()}bindLoop(){if(this.modules.render3d)this.modules.render3d.engine.runRenderLoop(()=>{this.tick(this.modules.render3d.engine.getDeltaTime())});else{let i=Date.now();console.log("\u5E94\u8BE5\u7531\u81EA\u8EAB\u9A71\u52A8"),setInterval(()=>{let t=Date.now();this.tick(t-i),i=t},0)}this.calcEverage()}bindWindowEvents(){window.addEventListener("resize",()=>{this.ev.emit("resize",window.innerWidth,window.innerHeight,window.devicePixelRatio)},!1),window.addEventListener("blur",()=>{console.warn("\u5207\u5165\u540E\u53F0"),this.ev.emit("blur")}),window.addEventListener("focus",()=>{this.ev.emit("focus")}),window.windowHide=()=>{this.ev.emit("blur")},globalThis.windowHide=window.windowHide,window.windowShow=()=>{this.ev.emit("focus")},globalThis.windowShow=window.windowShow}};var li=class extends U{constructor(){super(me)}onInit(){super.onInit(),this.view.m_btnYes.onClick(()=>{this.extra.resolve=!0,this.hide()})}onShown(){super.onShown()}};var ci=class extends U{constructor(){super(de)}onInit(){super.onInit(),this.view.m_btnYes.onClick(()=>{this.extra.resolve=!0,this.hide()}),this.view.m_btnNo.onClick(()=>{this.hide()})}};var hi=class{constructor(i){this.callbacks={onLoad:[],onError:[],onResize:[]};let e=pe.createInstance();e.visible=!1;let t=h.inst.ui.view;e.width=t.width,e.x=0,e.y=t.height-e.height,t.addChild(e),this.view=e,this.callbacks.onLoad.forEach(o=>o())}show(){return f(this,null,function*(){this.view.visible=!0})}hide(){return f(this,null,function*(){this.view.visible=!1})}onLoad(i){this.callbacks.onLoad.push(i)}offLoad(i){this.callbacks.onLoad.splice(this.callbacks.onLoad.indexOf(i),1)}onError(i){this.callbacks.onError.push(i)}offError(i){this.callbacks.onError.splice(this.callbacks.onError.indexOf(i),1)}onResize(i){this.callbacks.onResize.push(i)}offResize(i){this.callbacks.onResize.splice(this.callbacks.onResize.indexOf(i),1)}destroy(){this.view.dispose(),this.callbacks={onLoad:[],onError:[],onResize:[]}}};function hs(s){return new hi(s)}var fi=class{constructor(){this.callbacks={onLoad:[],onError:[],onClose:[]};this.show()}show(){return f(this,null,function*(){this.popup=li.show({title:"\u63D2\u5C4F\u5E7F\u544A",text:"\u8FD9\u662F\u4E2A\u63D2\u5C4F\u5E7F\u544A"}),this.popup.ev.on("hide",()=>{this.hide()})})}hide(){return f(this,null,function*(){this.popup.hide(),this.callbacks.onClose.forEach(i=>i())})}load(){return f(this,null,function*(){this.callbacks.onLoad.forEach(i=>i())})}onLoad(i){this.callbacks.onLoad.push(i)}offLoad(i){this.callbacks.onLoad.splice(this.callbacks.onLoad.indexOf(i),1)}onError(i){this.callbacks.onError.push(i)}offError(i){this.callbacks.onError.splice(this.callbacks.onError.indexOf(i),1)}onClose(i){this.callbacks.onClose.push(i)}offClose(i){this.callbacks.onClose.splice(this.callbacks.onClose.indexOf(i),1)}destroy(){this.callbacks={onLoad:[],onError:[],onClose:[]}}};function fs(s){return new fi}var di=class{constructor(){this.callbacks={onLoad:[],onError:[],onClose:[]};this.result={isEnded:!1,count:0}}show(){return f(this,null,function*(){this.popup=ci.show({title:"\u89C6\u9891\u5E7F\u544A",text:"\u662F\u5426\u5B8C\u6574\u89C2\u770B\u5E7F\u544A?"}),this.popup.ev.on("hide",()=>{var i;(i=this.popup.extra)!=null&&i.resolve?(this.result.isEnded=!0,this.result.count=1):(this.result.isEnded=!1,this.result.count=0),this.hide()})})}hide(){return f(this,null,function*(){this.popup.hide(),this.callbacks.onClose.forEach(i=>i(this.result))})}load(){return f(this,null,function*(){this.callbacks.onLoad.forEach(i=>i())})}onLoad(i){this.callbacks.onLoad.push(i)}offLoad(i){this.callbacks.onLoad.splice(this.callbacks.onLoad.indexOf(i),1)}onError(i){this.callbacks.onError.push(i)}offError(i){this.callbacks.onError.splice(this.callbacks.onError.indexOf(i),1)}onClose(i){this.callbacks.onClose.push(i)}offClose(i){this.callbacks.onClose.splice(this.callbacks.onClose.indexOf(i),1)}destroy(){this.callbacks={onLoad:[],onError:[],onClose:[]}}};function ds(s){return new di}var wo={createBannerAd:hs,BannerAd:hi,InterstitialAd:fi,createInterstitialAd:fs,createRewardedVideoAd:ds,RewardedVideoAd:di};globalThis&&(globalThis.game=h.inst,globalThis._canvas=document.getElementById("root")||globalThis.screencanvas,globalThis.dom=wo);new h;})();
/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
