window.fgui={},window.fairygui=window.fgui,fgui={},PIXI=PIXI||globalThis.PIXI;var PIXI,__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(h,n){function r(t){try{a(s.next(t))}catch(t){n(t)}}function l(t){try{a(s.throw(t))}catch(t){n(t)}}function a(t){t.done?h(t.value):new i(function(e){e(t.value)}).then(r,l)}a((s=s.apply(t,e||[])).next())})};!function(t){let e=window,i=!(!e.PointerEvent&&!e.MSPointerEvent),s="ontouchstart"in window&&PIXI.utils.isMobile.any;class h{}h.Down=i?"pointerdown":s?"touchstart":"mousedown",h.Cancel=i?"pointercancel":s?"touchcancel":"mousecancel",h.Up=i?"pointerup":s?"touchend":"mouseup",h.Click=i?"pointertap":s?"tap":"click",h.UpOutside=i?"pointerupoutside":s?"touchendoutside":"mouseupoutside",h.Move=i?"pointermove":s?"touchmove":"mousemove",h.Over=i?"pointerover":s?null:"mouseover",h.Out=i?"pointerout":s?null:"mouseout",h.RightDown="rightdown",h.RightUp="rightup",h.RightClick="rightclick",h.RightUpOutside="rightupoutside",t.InteractiveEvents=h,t.GearXMLNodeNameMap={gearDisplay:0,gearXY:1,gearSize:2,gearLook:3,gearColor:4,gearAni:5,gearText:6,gearIcon:7},t.BlendModeMap=["Normal","Add","Multiply","Screen","Overlay","Darken","Lighten","ColorDodge","ColorBurn","HardLight","SoftLight","Difference","Exclusion","Hue","Saturation","Color","Luminosity","NormalNPM","AddNPM","ScreenNPM"],t.ParseOverflowType=function(t){switch(t){case"visible":return 0;case"hidden":return 1;case"scroll":return 2;case"scale":return 3;case"scaleFree":return 4;default:return 0}},t.ParseScrollType=function(t){switch(t){case"horizontal":return 0;case"vertical":return 1;case"both":return 2;default:return 1}},t.ParseLoaderFillType=function(t){switch(t){case"none":return 0;case"scale":return 1;case"scaleMatchHeight":return 2;case"scaleMatchWidth":return 3;case"scaleFree":return 4;case"scaleNoBorder":return 5;default:return 0}},t.ParseListLayoutType=function(t){switch(t){case"column":return 0;case"row":return 1;case"flow_hz":return 2;case"flow_vt":return 3;case"pagination":return 4;default:return 0}},t.ParseListSelectionMode=function(t){switch(t){case"single":return 0;case"multiple":return 1;case"multipleSingleClick":return 2;case"none":return 3;default:return 0}},t.ParsePackageItemType=function(t){switch(t){case"image":return 0;case"movieclip":return 2;case"sound":return 3;case"component":return 4;case"swf":return 1;case"font":return 6;case"atlas":return 7;default:return 5}},t.ParseProgressTitleType=function(t){switch(t){case"percent":return 0;case"valueAndmax":return 1;case"value":return 2;case"max":return 3;default:return 0}},t.ParseScrollBarDisplayType=function(t){switch(t){case"default":return 0;case"visible":return 1;case"auto":return 2;case"hidden":return 3;default:return 0}},t.ParseFlipType=function(t){switch(t){case"hz":return 1;case"vt":return 2;case"both":return 3;default:return 0}},t.ParseButtonMode=function(t){switch(t){case"Common":return 0;case"Check":return 1;case"Radio":return 2;default:return 0}},t.ParseAutoSizeType=function(t){switch(t){case"none":return 0;case"both":return 1;case"height":return 2;case"shrink":return 3;default:return 0}},t.ParseAlignType=function(t){switch(t){case"left":return"left";case"center":return"center";case"right":return"right";default:return"left"}},t.ParseVertAlignType=function(t){switch(t){case"top":return 0;case"middle":return 1;case"bottom":return 2;default:return 0}},t.ParseListChildrenRenderOrder=function(t){switch(t){case"ascent":return 0;case"descent":return 1;case"arch":return 2;default:return 0}};let n={Linear:TWEEN.Easing.Linear.None,"Elastic.In":TWEEN.Easing.Elastic.In,"Elastic.Out":TWEEN.Easing.Elastic.Out,"Elastic.InOut":TWEEN.Easing.Elastic.InOut,"Quad.In":TWEEN.Easing.Quadratic.In,"Quad.Out":TWEEN.Easing.Quadratic.Out,"Quad.InOut":TWEEN.Easing.Quadratic.InOut,"Cube.In":TWEEN.Easing.Cubic.In,"Cube.Out":TWEEN.Easing.Cubic.Out,"Cube.InOut":TWEEN.Easing.Cubic.InOut,"Quart.In":TWEEN.Easing.Quartic.In,"Quart.Out":TWEEN.Easing.Quartic.Out,"Quart.InOut":TWEEN.Easing.Quartic.InOut,"Quint.In":TWEEN.Easing.Quintic.In,"Quint.Out":TWEEN.Easing.Quintic.Out,"Quint.InOut":TWEEN.Easing.Quintic.InOut,"Sine.In":TWEEN.Easing.Sinusoidal.In,"Sine.Out":TWEEN.Easing.Sinusoidal.Out,"Sine.InOut":TWEEN.Easing.Sinusoidal.InOut,"Bounce.In":TWEEN.Easing.Bounce.In,"Bounce.Out":TWEEN.Easing.Bounce.Out,"Bounce.InOut":TWEEN.Easing.Bounce.InOut,"Circ.In":TWEEN.Easing.Circular.In,"Circ.Out":TWEEN.Easing.Circular.Out,"Circ.InOut":TWEEN.Easing.Circular.InOut,"Expo.In":TWEEN.Easing.Exponential.In,"Expo.Out":TWEEN.Easing.Exponential.Out,"Expo.InOut":TWEEN.Easing.Exponential.InOut,"Back.In":TWEEN.Easing.Back.In,"Back.Out":TWEEN.Easing.Back.Out,"Back.InOut":TWEEN.Easing.Back.InOut};t.ParseEaseType=function(t){return n[t]||n.Linear}}(fgui||(fgui={})),function(t){class e{constructor(){this.$x=0,this.$y=0,this.$width=0,this.$height=0,this.$alpha=1,this.$rotation=0,this.$visible=!0,this.$touchable=!0,this.$grayed=!1,this.$draggable=!1,this.$scaleX=1,this.$scaleY=1,this.$skewX=0,this.$skewY=0,this.$pivot=new PIXI.Point,this.$pivotAsAnchor=!1,this.$pivotOffset=new PIXI.Point,this.$sortingOrder=0,this.$internalVisible=!0,this.$focusable=!1,this.$pixelSnapping=!1,this.$handlingController=!1,this.$lastColorComponents=null,this.$rawWidth=0,this.$rawHeight=0,this.$initWidth=0,this.$initHeight=0,this.$sourceWidth=0,this.$sourceHeight=0,this.$id=`${e.gInstanceCounter++}`,this.$name="",this.createDisplayObject(),this.$relations=new t.Relations(this),this.$gears=[]}get id(){return this.$id}get name(){return this.$name}set name(t){this.$name=t}get x(){return this.$x}set x(t){this.setXY(t,this.$y)}get y(){return this.$y}set y(t){this.setXY(this.$x,t)}setXY(i,s){this.$x==i&&this.$y==s||(this.$x=i,this.$y=s,this.handleXYChanged(),this.updateGear(1),this.$parent&&(this.$parent.setBoundsChangedFlag(),this.$displayObject.emit(t.DisplayObjectEvent.XY_CHANGED,this)),e.draggingObject!=this||e.sUpdatingWhileDragging||this.localToGlobalRect(0,0,this.width,this.height,e.sGlobalRect))}get pixelSnapping(){return this.$pixelSnapping}set pixelSnapping(t){this.$pixelSnapping!=t&&(this.$pixelSnapping=t,this.handleXYChanged())}center(t=!1){let e;e=null!=this.$parent?this.parent:this.root,this.setXY((e.width-this.width)/2,(e.height-this.height)/2),t&&(this.addRelation(e,3),this.addRelation(e,10))}get width(){return this.ensureSizeCorrect(),this.$relations.sizeDirty&&this.$relations.ensureRelationsSizeCorrect(),this.$width}set width(t){this.setSize(t,this.$rawHeight)}get height(){return this.ensureSizeCorrect(),this.$relations.sizeDirty&&this.$relations.ensureRelationsSizeCorrect(),this.$height}set height(t){this.setSize(this.$rawWidth,t)}setSize(e,i,s=!1){if(this.$rawWidth!=e||this.$rawHeight!=i){this.$rawWidth=e,this.$rawHeight=i,e=Math.max(0,e),i=Math.max(0,i);let h=e-this.mapPivotWidth(1),n=i-this.mapPivotHeight(1);this.$width=e,this.$height=i,this.handleSizeChanged(),0==this.$pivot.x&&0==this.$pivot.y||(this.$pivotAsAnchor?this.applyPivot():(s||this.setXY(this.x-this.$pivot.x*h,this.y-this.$pivot.y*n),this.updatePivotOffset())),this.updateGear(2),this.$parent&&(this.$relations.onOwnerSizeChanged(h,n),this.$parent.setBoundsChangedFlag()),this.$displayObject.emit(t.DisplayObjectEvent.SIZE_CHANGED,this)}}ensureSizeCorrect(){}get sourceHeight(){return this.$sourceHeight}get sourceWidth(){return this.$sourceWidth}get initHeight(){return this.$initHeight}get initWidth(){return this.$initWidth}get actualWidth(){return this.width*Math.abs(this.$scaleX)}get actualHeight(){return this.height*Math.abs(this.$scaleY)}get scaleX(){return this.$scaleX}set scaleX(t){this.setScale(t,this.$scaleY)}get scaleY(){return this.$scaleY}set scaleY(t){this.setScale(this.$scaleX,t)}setScale(t,e){this.$scaleX==t&&this.$scaleY==e||(this.$scaleX=t,this.$scaleY=e,this.handleScaleChanged(),this.applyPivot(),this.updateGear(2))}get skewX(){return this.$skewX}set skewX(t){this.setSkew(t,this.$skewY)}get skewY(){return this.$skewY}set skewY(t){this.setSkew(this.$skewX,t)}setSkew(e,i){this.$skewX==e&&this.$skewY==i||(this.$skewX=e,this.$skewY=i,this.$displayObject.skew.set(e*-t.utils.NumberUtil.RADIAN,i*t.utils.NumberUtil.RADIAN),this.applyPivot())}mapPivotWidth(t){return t*this.$width}mapPivotHeight(t){return t*this.$height}get pivotX(){return this.$pivot.x}get pivotY(){return this.$pivot.y}set pivotX(t){this.setPivot(t,this.pivotY)}set pivotY(t){this.setPivot(this.pivotX,t)}setPivot(t,e,i=!1){this.$pivot.x==t&&this.$pivot.y==e&&this.$pivotAsAnchor==i||(this.$pivot.set(t,e),this.$pivotAsAnchor=i,this.updatePivotOffset(),this.handleXYChanged())}internalSetPivot(t,e,i){this.$pivot.set(t,e),this.$pivotAsAnchor=i,i&&this.handleXYChanged()}updatePivotOffset(){if(0!=this.$pivot.x||0!=this.$pivot.y&&this.$displayObject.transform){let t=this.mapPivotWidth(this.$pivot.x),i=this.mapPivotHeight(this.$pivot.y);e.sHelperPoint.set(t,i),this.$displayObject.transform.updateLocalTransform();let s=this.$displayObject.localTransform,h=s.apply(e.sHelperPoint,e.sHelperPoint);h.x-=s.tx,h.y-=s.ty,this.$pivotOffset.set(this.$pivot.x*this.$width-h.x,this.$pivot.y*this.$height-h.y)}else this.$pivotOffset.set(0,0)}applyPivot(){0==this.$pivot.x&&0==this.$pivot.y||(this.updatePivotOffset(),this.handleXYChanged())}get touchable(){return this.$touchable}set touchable(t){this.$touchable=t,this.$displayObject.interactive=this.$touchable}get grayed(){return this.$grayed}set grayed(t){this.$grayed!=t&&(this.$grayed=t,this.handleGrayedChanged(),this.updateGear(3))}get enabled(){return!this.$grayed&&this.$touchable}set enabled(t){this.grayed=!t,this.touchable=t}get rotation(){return this.$rotation}set rotation(e){this.$rotation!=e&&(this.$rotation=e,this.$displayObject&&(this.$displayObject.rotation=t.utils.NumberUtil.angleToRadian(this.normalizeRotation)),this.applyPivot(),this.updateGear(3))}get normalizeRotation(){let t=this.$rotation%360;return t>180?t-=360:t<-180&&(t+=360),t}get alpha(){return this.$alpha}set alpha(t){this.$alpha!=t&&(this.$alpha=t,this.updateAlpha())}updateAlpha(){this.$displayObject&&(this.$displayObject.alpha=this.$alpha),this.updateGear(3)}get visible(){return this.$visible}set visible(e){this.$visible!=e&&(this.$visible=e,this.$displayObject&&(this.$displayObject.visible=this.$visible),this.$parent&&(this.$parent.childStateChanged(this),this.$parent.setBoundsChangedFlag()),this.emit(t.DisplayObjectEvent.VISIBLE_CHANGED,this.$visible,this))}set internalVisible(t){t!=this.$internalVisible&&(this.$internalVisible=t,this.$parent&&this.$parent.childStateChanged(this))}get internalVisible(){return this.$internalVisible}get finalVisible(){return this.$visible&&this.$internalVisible&&(!this.$group||this.$group.finalVisible)}get sortingOrder(){return this.$sortingOrder}set sortingOrder(t){if(t<0&&(t=0),this.$sortingOrder!=t){let e=this.$sortingOrder;this.$sortingOrder=t,null!=this.$parent&&this.$parent.childSortingOrderChanged(this,e,this.$sortingOrder)}}get focusable(){return this.$focusable}set focusable(t){this.$focusable=t}get focused(){return this.root.focus==this}requestFocus(){let t=this;for(;t&&!t.$focusable;)t=t.parent;null!=t&&(this.root.focus=t)}get tooltips(){return this.$tooltips}set tooltips(t){this.$tooltips=t}get blendMode(){return this.$displayObject&&this.$displayObject instanceof PIXI.Sprite?t.BlendModeMap[this.$displayObject.blendMode]||"None":t.BlendModeMap[0]}set blendMode(e){if(e&&e.length&&this.$displayObject&&this.$displayObject instanceof PIXI.Sprite)for(let i=0;i<t.BlendModeMap.length;i++)if(t.BlendModeMap[i].toLowerCase()===e.toLowerCase())return void(this.$displayObject.blendMode=i)}get filters(){return this.$displayObject.filters}set filters(t){this.$displayObject.filters=t}get inContainer(){return null!=this.$displayObject.parent}static isDisplayObjectOnStage(e){if(!e||!e.parent)return!1;let i=e;for(;null!=i;){if(i==t.GRoot.inst.nativeStage)return!0;i=i.parent}return!1}get onStage(){return e.isDisplayObjectOnStage(this.$displayObject)}get resourceURL(){return null!=this.packageItem?`ui://${this.packageItem.owner.id}${this.packageItem.id}`:null}set group(t){this.$group=t}get group(){return this.$group}getGear(e){let i=this.$gears[e];if(null==i){switch(e){case 0:i=new t.GearDisplay(this);break;case 1:i=new t.GearXY(this);break;case 2:i=new t.GearSize(this);break;case 3:i=new t.GearLook(this);break;case 4:if(!t.isColorGear(this))throw new Error(`Invalid component type to add GearColor feature, please check the component named ${this.$name} in the Editor.`);i=new t.GearColor(this);break;case 5:if(!t.isAnimationGear(this))throw new Error(`Invalid component type to add GearAnimation feature, please check the component named ${this.$name} in the Editor.`);i=new t.GearAnimation(this);break;case 6:i=new t.GearText(this);break;case 7:i=new t.GearIcon(this);break;default:throw new Error("FGUI: invalid gear type")}this.$gears[e]=i}return i}updateGear(t){null!=this.$gears[t]&&this.$gears[t].updateState()}updateGearFromRelations(t,e,i){null!=this.$gears[t]&&this.$gears[t].updateFromRelations(e,i)}hasGearController(t,e){return this.$gears[t]&&this.$gears[t].controller==e}lockGearDisplay(){let t=this.$gears[0];if(t&&t.controller){let e=t.lock();return this.checkGearVisible(),e}return 0}releaseGearDisplay(t){let e=this.$gears[0];e&&e.controller&&(e.release(t),this.checkGearVisible())}checkGearVisible(){if(this.$handlingController)return;let t=this.$gears[0],e=!t||t.connected;e!=this.$internalVisible&&(this.$internalVisible=e,this.$parent&&this.$parent.childStateChanged(this))}get gearXY(){return this.getGear(1)}get gearSize(){return this.getGear(2)}get gearLook(){return this.getGear(3)}get relations(){return this.$relations}addRelation(t,e,i=!1){this.$relations.add(t,e,i)}removeRelation(t,e=0){this.$relations.remove(t,e)}get displayObject(){return this.$displayObject}createDisplayObject(){}setDisplayObject(t){this.$displayObject=t}get parent(){return this.$parent}set parent(t){this.$parent=t}removeFromParent(){this.$parent&&this.$parent.removeChild(this)}get root(){if(this instanceof t.GRoot)return this;let e=this.$parent;for(;e;){if(e instanceof t.GRoot)return e;e=e.parent}return t.GRoot.inst}get text(){return null}set text(t){}get icon(){return null}set icon(t){}dispose(){this.removeFromParent(),this.$relations.dispose(),this.removeAllListeners(),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Move,this.$moving,this),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Up,this.$end,this),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Move,this.$moving2,this),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Up,this.$end2,this),this.$displayObject.destroy()}click(e,i){return this.on(t.InteractiveEvents.Click,e,i)}onClick(e,i){return this.on(t.InteractiveEvents.Click,e,i)}setPosition(t,e){this.setXY(t,e)}onConstruct(){}removeClick(e,i){return this.off(t.InteractiveEvents.Click,e,i)}hasClick(e){return this.hasListener(t.InteractiveEvents.Click,e)}on(t,e,i){return null==t?this:(this.$displayObject.on(t,e,i),this)}off(t,e,i){return null==t?this:(this.$displayObject.listeners(t)&&this.$displayObject.off(t,e,i),this)}once(t,e,i){return null==t?this:(this.$displayObject.once(t,e,i),this)}hasListener(t,e){return e?this.$displayObject.listeners(t).indexOf(e)>=0:this.$displayObject.listenerCount(t)>0}emit(t,...e){return!e||e.length<=0?e=[t]:e.unshift(t),this.$displayObject.emit.apply(this.$displayObject,e)}removeAllListeners(t){this.$displayObject.removeAllListeners(t)}get draggable(){return this.$draggable}set draggable(t){this.$draggable!=t&&(this.$draggable=t,this.initDrag())}get dragBounds(){return this.$dragBounds}set dragBounds(t){this.$dragBounds=t}startDrag(t=-1){this.onStage&&this.dragBegin()}stopDrag(){this.dragEnd()}get dragging(){return e.draggingObject==this}localToGlobal(t=0,i=0,s){return this.$pivotAsAnchor&&(t+=this.$pivot.x*this.$width,i+=this.$pivot.y*this.$height),s||(s=e.sHelperPoint),s.x=t,s.y=i,this.$displayObject.toGlobal(s,s)}globalToLocal(i=0,s=0,h){return h||(h=e.sHelperPoint),h.set(i,s),h=this.$displayObject.toLocal(h,t.GRoot.inst.nativeStage),this.$pivotAsAnchor&&(h.x-=this.$pivot.x*this.$width,h.y-=this.$pivot.y*this.$height),h}localToRoot(e=0,i=0,s){let h=this.localToGlobal(e,i,s);return h.x/=t.GRoot.inst.contentScaleFactor,h.y/=t.GRoot.inst.contentScaleFactor,h}rootToLocal(e=0,i=0,s){return e*=t.GRoot.inst.contentScaleFactor,i*=t.GRoot.inst.contentScaleFactor,this.globalToLocal(e,i,s)}localToGlobalRect(t=0,i=0,s=0,h=0,n){null==n&&(n=e.sDragHelperRect);let r=this.localToGlobal(t,i);return n.x=r.x,n.y=r.y,n.width=s,n.height=h,n}globalToLocalRect(t=0,i=0,s=0,h=0,n){null==n&&(n=e.sDragHelperRect);let r=this.globalToLocal(t,i);return n.x=r.x,n.y=r.y,n.width=s,n.height=h,n}handleControllerChanged(t){this.$handlingController=!0;for(let e=0;e<8;e++){let i=this.$gears[e];null!=i&&i.controller==t&&i.apply()}this.$handlingController=!1,this.checkGearVisible()}switchDisplayObject(t){if(t==this.$displayObject)return;let e=this.$displayObject;if(this.inContainer){let e=this.$displayObject.parent.getChildIndex(this.$displayObject);this.$displayObject.parent.addChildAt(t,e),this.$displayObject.parent.removeChild(this.$displayObject)}this.$displayObject=t,this.$displayObject.x=e.x,this.$displayObject.y=e.y,this.$displayObject.rotation=e.rotation,this.$displayObject.alpha=e.alpha,this.$displayObject.visible=e.visible,this.$displayObject.scale.x=e.scale.x,this.$displayObject.scale.y=e.scale.y,this.$displayObject.interactive=e.interactive,this.$displayObject instanceof PIXI.Container&&e instanceof PIXI.Container&&(this.$displayObject.interactiveChildren=e.interactiveChildren)}handleXYChanged(){if(this.$displayObject){let t=this.$x,e=this.$y;this.$pivotAsAnchor&&(t-=this.$pivot.x*this.$width,e-=this.$pivot.y*this.$height),this.$pixelSnapping&&(t=Math.round(t),e=Math.round(e)),this.$displayObject.position.set(t+this.$pivotOffset.x,e+this.$pivotOffset.y)}}handleSizeChanged(){}handleScaleChanged(){this.$displayObject&&this.$displayObject.scale.set(this.$scaleX,this.$scaleY)}get colorFilter(){if(this.$colorFilter)return this.$colorFilter;if(this.$colorFilter=new PIXI.filters.ColorMatrixFilter,this.$displayObject){let t=this.$displayObject.filters||[];t.push(this.$colorFilter),this.$displayObject.filters=t}return this.$colorFilter}updateColorComponents(i,s,h,n){e.$colorHelper||(e.$colorHelper=new t.utils.ColorMatrix);let r=e.$colorHelper;r.setColor(i,100*s,100*h,180*n);let l=this.colorFilter;l.enabled=!0,l.reset(),l.matrix=r.toArray(),this.$lastColorComponents||(this.$lastColorComponents=[]),this.$lastColorComponents.length=0,this.$lastColorComponents.push(r.brightness,r.contrast,r.saturation,r.hue)}handleGrayedChanged(){if(this.$displayObject){let t=this.colorFilter;t.enabled=!0,this.$grayed?t.blackAndWhite(!0):this.$lastColorComponents&&this.$lastColorComponents.length>=4?this.updateColorComponents(this.$lastColorComponents[0],this.$lastColorComponents[1],this.$lastColorComponents[2],this.$lastColorComponents[3]):t.enabled=!1}}constructFromResource(){}setupBeforeAdd(t){let e,i;if(this.$id=t.attributes.id,this.$name=t.attributes.name,i=(e=t.attributes.xy).split(","),this.setXY(parseInt(i[0]),parseInt(i[1])),(e=t.attributes.size)&&(i=e.split(","),this.$initWidth=parseInt(i[0]),this.$initHeight=parseInt(i[1]),this.setSize(this.$initWidth,this.$initHeight,!0)),(e=t.attributes.scale)&&(i=e.split(","),this.setScale(parseFloat(i[0]),parseFloat(i[1]))),(e=t.attributes.rotation)&&(this.rotation=parseInt(e)),(e=t.attributes.skew)&&(i=e.split(","),this.setSkew(parseFloat(i[0]),parseFloat(i[1]))),e=t.attributes.pivot){i=e.split(",");let s=parseFloat(i[0]),h=parseFloat(i[1]);e=t.attributes.anchor,this.setPivot(s,h,"true"==e)}if((e=t.attributes.alpha)&&(this.alpha=parseFloat(e)),"false"==t.attributes.touchable&&(this.touchable=!1),"false"==t.attributes.visible&&(this.visible=!1),"true"==t.attributes.grayed&&(this.grayed=!0),this.tooltips=t.attributes.tooltips,this.customData=t.attributes.customData,t.children){t.children.filter(t=>"property"==t.nodeName).forEach(t=>{this[t.attributes.target].text=t.attributes.value})}if((e=t.attributes.blend)&&(this.blendMode=e),e=t.attributes.filter)switch(e){case"color":i=(e=t.attributes.filterData).split(","),this.updateColorComponents(parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3]))}}setupAfterAdd(e){let i=e.attributes.group;i&&(this.$group=this.$parent.getChildById(i)),e.children.forEach(e=>{let i=t.GearXMLNodeNameMap[e.nodeName];null!=i&&this.getGear(i).setup(e)},this)}static castFromNativeObject(e){return t.isUIObject(e)?e.UIOwner:null}initDrag(){this.$draggable?this.on(t.InteractiveEvents.Down,this.$touchBegin,this):this.off(t.InteractiveEvents.Down,this.$touchBegin,this)}dragBegin(){null!=e.draggingObject&&e.draggingObject.stopDrag(),e.sGlobalDragStart.x=t.GRoot.globalMouseStatus.mouseX,e.sGlobalDragStart.y=t.GRoot.globalMouseStatus.mouseY,this.localToGlobalRect(0,0,this.width,this.height,e.sGlobalRect),e.draggingObject=this,t.GRoot.inst.nativeStage.on(t.InteractiveEvents.Move,this.$moving2,this),t.GRoot.inst.nativeStage.on(t.InteractiveEvents.Up,this.$end2,this)}dragEnd(){e.draggingObject==this&&(t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Move,this.$moving2,this),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Up,this.$end2,this),e.draggingObject=null),e.$dragBeginCancelled=!0}reset(){t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Move,this.$moving,this),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Up,this.$end,this)}$touchBegin(e){null==this.$touchDownPoint&&(this.$touchDownPoint=new PIXI.Point),this.$touchDownPoint.x=e.data.global.x,this.$touchDownPoint.y=e.data.global.y,t.GRoot.inst.nativeStage.on(t.InteractiveEvents.Move,this.$moving,this),t.GRoot.inst.nativeStage.on(t.InteractiveEvents.Up,this.$end,this)}$end(t){this.reset()}$moving(i){let s=t.UIConfig.touchDragSensitivity;null!=this.$touchDownPoint&&Math.abs(this.$touchDownPoint.x-i.data.global.x)<s&&Math.abs(this.$touchDownPoint.y-i.data.global.y)<s||(this.reset(),e.$dragBeginCancelled=!1,i.currentTarget=this.$displayObject,this.$displayObject.emit(t.DragEvent.START,i,this),e.$dragBeginCancelled||this.dragBegin())}$moving2(i){let s=i.data.global.x-e.sGlobalDragStart.x+e.sGlobalRect.x,h=i.data.global.y-e.sGlobalDragStart.y+e.sGlobalRect.y;if(null!=this.$dragBounds){let i=t.GRoot.inst.localToGlobalRect(this.$dragBounds.x,this.$dragBounds.y,this.$dragBounds.width,this.$dragBounds.height,e.sDragHelperRect);s<i.x?s=i.x:s+e.sGlobalRect.width>i.right&&(s=i.right-e.sGlobalRect.width)<i.x&&(s=i.x),h<i.y?h=i.y:h+e.sGlobalRect.height>i.bottom&&(h=i.bottom-e.sGlobalRect.height)<i.y&&(h=i.y)}e.sUpdatingWhileDragging=!0,e.sHelperPoint.x=s,e.sHelperPoint.y=h;let n=this.parent.globalToLocal(s,h,e.sHelperPoint);this.setXY(Math.round(n.x),Math.round(n.y)),e.sUpdatingWhileDragging=!1,i.currentTarget=this.$displayObject,this.$displayObject.emit(t.DragEvent.MOVING,i,this)}$end2(i){e.draggingObject==this&&(this.stopDrag(),i.currentTarget=this.$displayObject,this.$displayObject.emit(t.DragEvent.END,i,this))}}e.gInstanceCounter=0,e.sGlobalDragStart=new PIXI.Point,e.sGlobalRect=new PIXI.Rectangle,e.sHelperPoint=new PIXI.Point,e.sDragHelperRect=new PIXI.Rectangle,t.GObject=e}(fgui||(fgui={})),function(t){t.GComponent=class extends t.GObject{constructor(){super(),this.$sortingChildCount=0,this.$children=[],this.$controllers=[],this.$transitions=[],this.$margin=new t.utils.Margin,this.$alignOffset=new PIXI.Point}createDisplayObject(){this.$rootContainer=new t.UIContainer(this),this.setDisplayObject(this.$rootContainer),this.$container=this.$rootContainer}dispose(){t.GTimer.inst.remove(this.$validate,this),this.off("added",this.$added,this),this.off("removed",this.$removed,this),this.$transitions.forEach(t=>{t.dispose()});for(let t=this.$children.length-1;t>=0;--t){let e=this.$children[t];e.parent=null,e.dispose()}this.$boundsChanged=!1,this.$scrollPane&&this.$scrollPane.dispose(),super.dispose()}get displayListContainer(){return this.$container}addChild(t){return this.addChildAt(t,this.$children.length),t}addChildAt(t,e=0){if(!t)throw new Error("Invalid child");let i=this.$children.length;if(e>=0&&e<=i){if(t.parent==this)this.setChildIndex(t,e);else{t.removeFromParent(),t.parent=this;let i=this.$children.length;0!=t.sortingOrder?(this.$sortingChildCount++,e=this.getInsertPosForSortingChild(t)):this.$sortingChildCount>0&&e>i-this.$sortingChildCount&&(e=i-this.$sortingChildCount),e==i?this.$children.push(t):this.$children.splice(e,0,t),this.childStateChanged(t),this.setBoundsChangedFlag()}return t}throw new Error("Invalid child index")}getInsertPosForSortingChild(t){let e=this.$children.length,i=0;for(i=0;i<e;i++){let e=this.$children[i];if(e!=t&&t.sortingOrder<e.sortingOrder)break}return i}removeChild(t,e=!1){let i=this.$children.indexOf(t);return-1!=i&&this.removeChildAt(i,e),t}removeChildAt(t,e=!1){if(t>=0&&t<this.numChildren){let i=this.$children[t];return i.parent=null,0!=i.sortingOrder&&this.$sortingChildCount--,this.$children.splice(t,1),i.inContainer&&this.$container.removeChild(i.displayObject),!0===e&&i.dispose(),this.setBoundsChangedFlag(),i}throw new Error("Invalid child index")}removeChildren(t=0,e=-1,i=!1){(e<0||e>=this.numChildren)&&(e=this.numChildren-1);for(let s=t;s<=e;++s)this.removeChildAt(t,i)}getChildAt(t=0){if(t>=0&&t<this.numChildren)return this.$children[t];throw new Error("Invalid child index")}getChild(t){let e=this.$children.length;for(let i=0;i<e;++i)if(this.$children[i].name==t)return this.$children[i];return null}getChildInGroup(t,e){let i=this.$children.length;for(let s=0;s<i;++s){let i=this.$children[s];if(i.group==e&&i.name==t)return i}return null}getChildById(t){let e=this.$children.length;for(let i=0;i<e;++i)if(this.$children[i].id==t)return this.$children[i];return null}getChildIndex(t){return this.$children.indexOf(t)}setChildIndex(t,e=0){let i=this.$children.indexOf(t);if(-1==i)throw new Error("no such child found");if(0!=t.sortingOrder)return;let s=this.$children.length;this.$sortingChildCount>0&&e>s-this.$sortingChildCount-1&&(e=s-this.$sortingChildCount-1),this.$setChildIndex(t,i,e)}setChildIndexBefore(t,e){let i=this.$children.indexOf(t);if(-1==i)throw new Error("no such child found");if(0!=t.sortingOrder)return i;let s=this.$children.length;return this.$sortingChildCount>0&&e>s-this.$sortingChildCount-1&&(e=s-this.$sortingChildCount-1),i<e?this.$setChildIndex(t,i,e-1):this.$setChildIndex(t,i,e)}$setChildIndex(t,e,i=0){let s=this.$children.length;if(i>s&&(i=s),e==i)return e;if(this.$children.splice(e,1),this.$children.splice(i,0,t),t.inContainer){let e=0,s=this.$container.children.length;for(let t=0;t<i;t++)this.$children[t].inContainer&&e++;e==s&&e--,this.$container.setChildIndex(t.displayObject,e),this.setBoundsChangedFlag()}return i}swapChildren(t,e){let i=this.$children.indexOf(t),s=this.$children.indexOf(e);if(-1==i||-1==s)throw new Error("no such child found");this.swapChildrenAt(i,s)}swapChildrenAt(t,e=0){let i=this.$children[t],s=this.$children[e];this.setChildIndex(i,e),this.setChildIndex(s,t)}get numChildren(){return this.$children.length}isAncestorOf(t){if(null==t)return!1;let e=t.parent;for(;e;){if(e==this)return!0;e=e.parent}return!1}addController(t){this.$controllers.push(t),t.$parent=this,this.applyController(t)}getControllerAt(t){return this.$controllers[t]}getController(t){let e=this.$controllers.length;for(let i=0;i<e;++i){let e=this.$controllers[i];if(e.name==t)return e}return null}removeController(t){let e=this.$controllers.indexOf(t);if(-1==e)throw new Error("controller not exists");t.$parent=null,this.$controllers.splice(e,1),this.$children.forEach(e=>{e.handleControllerChanged(t)})}get controllers(){return this.$controllers}childStateChanged(e){if(!this.$buildingDisplayList)if(e instanceof t.GGroup)this.$children.forEach(t=>{t.group==e&&this.childStateChanged(t)},this);else if(e.displayObject)if(e.finalVisible){if(!e.displayObject.parent){let t=0,i=this.$children.length;for(let s=0;s<i;s++){let i=this.$children[s];if(i==e)break;i.displayObject&&i.displayObject.parent&&t++}this.$container.addChildAt(e.displayObject,t)}}else e.displayObject.parent&&this.$container.removeChild(e.displayObject)}applyController(t){this.$applyingController=t,this.$children.forEach(e=>{e.handleControllerChanged(t)}),this.$applyingController=null,t.executeActions()}applyAllControllers(){this.$controllers.forEach(t=>{this.applyController(t)},this)}adjustRadioGroupDepth(e,i){let s=-1,h=-1;this.$children.forEach((n,r)=>{n==e?s=r:n instanceof t.GButton&&n.relatedController==i&&r>h&&(h=r)}),s<h&&(null!=this.$applyingController&&this.$children[h].handleControllerChanged(this.$applyingController),this.swapChildrenAt(s,h))}getTransitionAt(t){return this.$transitions[t]}getTransition(t){let e=this.$transitions.length;for(let i=0;i<e;++i){let e=this.$transitions[i];if(e.name==t)return e}return null}isChildInView(t){return null!=this.$rootContainer.scrollRect?t.x+t.width>=0&&t.x<=this.width&&t.y+t.height>=0&&t.y<=this.height:null==this.$scrollPane||this.$scrollPane.isChildInView(t)}getFirstChildInView(){let t=this.$children.length;for(let e=0;e<t;++e){let t=this.$children[e];if(this.isChildInView(t))return e}return-1}get scrollPane(){return this.$scrollPane}get opaque(){return this.$opaque}set opaque(t){this.$opaque!=t&&(this.$opaque=t,this.$opaque?this.updateOpaque():this.$rootContainer.hitArea&&this.$rootContainer.hitArea instanceof PIXI.Rectangle&&(this.$rootContainer.hitArea.width=this.$rootContainer.hitArea.height=0))}get margin(){return this.$margin}set margin(t){this.$margin.copy(t),null!=this.$rootContainer.scrollRect&&(this.$container.x=this.$margin.left+this.$alignOffset.x,this.$container.y=this.$margin.top+this.$alignOffset.y),this.handleSizeChanged()}get mask(){return this.$rootContainer.mask}set mask(t){t&&(t instanceof PIXI.Container&&(t.interactive=!1),t instanceof PIXI.Graphics&&(t.isMask=!0),this.$rootContainer.mask=t)}updateOpaque(){this.$rootContainer.hitArea||(this.$rootContainer.hitArea=new PIXI.Rectangle);let t=this.$rootContainer.hitArea;t.x=t.y=0,t.width=this.width,t.height=this.height}updateScrollRect(){let t=this.$rootContainer.scrollRect;null==t&&(t=new PIXI.Rectangle);let e=this.width-this.$margin.right,i=this.height-this.$margin.bottom;t.x=t.y=0,t.width=e,t.height=i,this.$rootContainer.scrollRect=t}setupScroll(e,i,s,h,n,r,l,a){this.$rootContainer==this.$container&&(this.$container=new PIXI.Container,this.$rootContainer.addChild(this.$container)),this.$scrollPane=new t.ScrollPane(this,i,e,s,h,n,r,l,a)}setupOverflow(t){1==t?(this.$rootContainer==this.$container&&(this.$container=new PIXI.Container,this.$rootContainer.addChild(this.$container)),this.updateScrollRect(),this.$container.x=this.$margin.left,this.$container.y=this.$margin.top):0==this.$margin.left&&0==this.$margin.top||(this.$rootContainer==this.$container&&(this.$container=new PIXI.Container,this.$rootContainer.addChild(this.$container)),this.$container.x=this.$margin.left,this.$container.y=this.$margin.top),this.setBoundsChangedFlag()}handleSizeChanged(){this.$scrollPane?this.$scrollPane.onOwnerSizeChanged():null!=this.$rootContainer.scrollRect&&this.updateScrollRect(),this.$opaque&&this.updateOpaque()}handleGrayedChanged(){let t=this.getController("grayed");null!=t?t.selectedIndex=this.grayed?1:0:super.handleGrayedChanged()}setBoundsChangedFlag(){(this.$scrollPane||this.$trackBounds)&&(this.$boundsChanged||(this.$boundsChanged=!0,t.GTimer.inst.callLater(this.$validate,this)))}$validate(t){this.$boundsChanged&&this.updateBounds()}ensureBoundsCorrect(){this.$boundsChanged&&this.updateBounds()}updateBounds(){let t=0,e=0,i=0,s=0;if(this.$children.length>0){t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY;let h=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=0;this.$children.forEach(i=>{i.ensureSizeCorrect(),(r=i.x)<t&&(t=r),(r=i.y)<e&&(e=r),(r=i.x+i.actualWidth)>h&&(h=r),(r=i.y+i.actualHeight)>n&&(n=r)}),i=h-t,s=n-e}this.setBounds(t,e,i,s)}setBounds(t,e,i,s=0){this.$boundsChanged=!1,this.$scrollPane&&this.$scrollPane.setContentSize(Math.round(t+i),Math.round(e+s))}get viewWidth(){return null!=this.$scrollPane?this.$scrollPane.viewWidth:this.width-this.$margin.left-this.$margin.right}set viewWidth(t){null!=this.$scrollPane?this.$scrollPane.viewWidth=t:this.width=t+this.$margin.left+this.$margin.right}get viewHeight(){return null!=this.$scrollPane?this.$scrollPane.viewHeight:this.height-this.$margin.top-this.$margin.bottom}set viewHeight(t){null!=this.$scrollPane?this.$scrollPane.viewHeight=t:this.height=t+this.$margin.top+this.$margin.bottom}getSnappingPosition(t,e,i){i||(i=new PIXI.Point);let s=this.$children.length;if(s<=0)return i.x=0,i.y=0,i;this.ensureBoundsCorrect();let h=null,n=null,r=0;if(0!=e){for(;r<s;r++)if(e<(h=this.$children[r]).y){if(0==r){e=0;break}e=e<(n=this.$children[r-1]).y+n.actualHeight/2?n.y:h.y;break}r==s&&(e=h.y)}if(0!=t){for(r>0&&r--;r<s;r++)if(t<(h=this.$children[r]).x){if(0==r){t=0;break}t=t<(n=this.$children[r-1]).x+n.actualWidth/2?n.x:h.x;break}r==s&&(t=h.x)}return i.x=t,i.y=e,i}childSortingOrderChanged(t,e,i=0){if(0==i)this.$sortingChildCount--,this.setChildIndex(t,this.$children.length);else{0==e&&this.$sortingChildCount++;let i=this.$children.indexOf(t),s=this.getInsertPosForSortingChild(t);i<s?this.$setChildIndex(t,i,s-1):this.$setChildIndex(t,i,s)}}constructFromResource(){this.constructInternal(null,0)}constructInternal(e,i){let s,h,n,r=this.packageItem.owner.getItemAsset(this.packageItem);if(this.$inProgressBuilding=!0,h=(s=r.attributes.size).split(","),this.$sourceWidth=parseInt(h[0]),this.$sourceHeight=parseInt(h[1]),this.$initWidth=this.$sourceWidth,this.$initHeight=this.$sourceHeight,this.setSize(this.$sourceWidth,this.$sourceHeight),(s=r.attributes.pivot)&&(h=s.split(","),s=r.attributes.anchor,this.internalSetPivot(parseFloat(h[0]),parseFloat(h[1]),"true"==s)),s=r.attributes.opaque,this.opaque="false"!=s,n=(s=r.attributes.overflow)?t.ParseOverflowType(s):0,(s=r.attributes.margin)&&this.$margin.parse(s),2==n){let e,i,n;e=(s=r.attributes.scroll)?t.ParseScrollType(s):1,i=(s=r.attributes.scrollBar)?t.ParseScrollBarDisplayType(s):0,n=(s=r.attributes.scrollBarFlags)?parseInt(s):0;let l,a,o,$,c=new t.utils.Margin;(s=r.attributes.scrollBarMargin)&&c.parse(s),(s=r.attributes.scrollBarRes)&&(l=(h=s.split(","))[0],a=h[1]),(s=r.attributes.ptrRes)&&(o=(h=s.split(","))[0],$=h[1]),this.setupScroll(c,e,i,n,l,a,o,$)}else this.setupOverflow(n);this.$buildingDisplayList=!0;let l=r.children;l.forEach(e=>{if("controller"==e.nodeName){let i=new t.Controller;this.$controllers.push(i),i.$parent=this,i.setup(e)}});let a=this.packageItem.displayList;if(a.forEach((s,h)=>{let n;null!=e?n=e[i+h]:s.packageItem?((n=t.UIObjectFactory.newObject(s.packageItem)).packageItem=s.packageItem,n.constructFromResource()):n=t.UIObjectFactory.newObjectDirectly(s.type),n.$inProgressBuilding=!0,n.setupBeforeAdd(s.desc),n.parent=this,this.$children.push(n)},this),this.relations.setup(r),this.$children.forEach((t,e)=>{t.relations.setup(a[e].desc),t.setupAfterAdd(a[e].desc),t.$inProgressBuilding=!1}),s=r.attributes.mask){let t=this.getChildById(s).displayObject;if(!(t instanceof PIXI.Graphics||t instanceof PIXI.Sprite))throw new Error("only PIXI.Sprite or PIXI.Graphics can be applied as mask object");this.mask=t}l.forEach(e=>{if("transition"==e.nodeName){let i=new t.Transition(this);this.$transitions.push(i),i.setup(e)}},this),this.$transitions.length>0&&(this.on("added",this.$added,this),this.on("removed",this.$removed,this)),this.applyAllControllers(),this.$buildingDisplayList=!1,this.$inProgressBuilding=!1,this.appendChildrenList(),this.setBoundsChangedFlag(),this.constructFromXML(r),this.onConstruct()}appendChildrenList(){this.$children.forEach(t=>{null!=t.displayObject&&t.finalVisible&&this.$container.addChild(t.displayObject)},this)}constructFromXML(t){}$added(t){this.$transitions.forEach(t=>{t.autoPlay&&t.play({times:t.autoPlayRepeat,delay:t.autoPlayDelay})})}$removed(t){this.$transitions.forEach(t=>{t.stop(!1,!1)})}}}(fgui||(fgui={})),function(t){class e extends t.GComponent{constructor(){super(),this.$mode=0,this.$title="",this.$icon="",this.$pageOption=new t.PageOption,this.$changeStateOnClick=!0,this.$downEffect=0,this.$downEffectValue=.8}setDisplayObject(t){super.setDisplayObject(t),this.$displayObject.buttonMode=!0}get icon(){return this.$icon}set icon(t){this.$icon=t,t=this.$selected&&this.$selectedIcon?this.$selectedIcon:this.$icon,null!=this.$iconObject&&(this.$iconObject.icon=t),this.updateGear(7)}get selectedIcon(){return this.$selectedIcon}set selectedIcon(t){this.$selectedIcon=t,t=this.$selected&&this.$selectedIcon?this.$selectedIcon:this.$icon,null!=this.$iconObject&&(this.$iconObject.icon=t)}get title(){return this.$title}set title(t){this.$title=t,this.$titleObject&&(this.$titleObject.text=this.$selected&&this.$selectedTitle?this.$selectedTitle:this.$title),this.updateGear(6)}get text(){return this.title}set text(t){this.title=t}get selectedTitle(){return this.$selectedTitle}set selectedTitle(t){this.$selectedTitle=t,this.$titleObject&&(this.$titleObject.text=this.$selected&&this.$selectedTitle?this.$selectedTitle:this.$title)}get titleColor(){return t.isColorableTitle(this.$titleObject)?this.$titleObject.titleColor:0}set titleColor(e){t.isColorableTitle(this.$titleObject)&&(this.$titleObject.titleColor=e)}get fontSize(){return t.isColorableTitle(this.$titleObject)?this.$titleObject.fontSize:0}set fontSize(e){t.isColorableTitle(this.$titleObject)&&(this.$titleObject.fontSize=e)}set selected(t){if(0!=this.$mode&&this.$selected!=t){if(this.$selected=t,this.grayed&&this.$buttonController&&this.$buttonController.hasPage(e.DISABLED)?this.$selected?this.setState(e.SELECTED_DISABLED):this.setState(e.DISABLED):this.$selected?this.setState(this.$over?e.SELECTED_OVER:e.DOWN):this.setState(this.$over?e.OVER:e.UP),this.$selectedTitle&&this.$titleObject&&(this.$titleObject.text=this.$selected?this.$selectedTitle:this.$title),this.$selectedIcon){let t=this.$selected?this.$selectedIcon:this.$icon;null!=this.$iconObject&&(this.$iconObject.icon=t)}this.$relatedController&&this.$parent&&!this.$parent.$buildingDisplayList&&(this.$selected?(this.$relatedController.selectedPageId=this.$pageOption.id,this.$relatedController.$autoRadioGroupDepth&&this.$parent.adjustRadioGroupDepth(this,this.$relatedController)):1==this.$mode&&this.$relatedController.selectedPageId==this.$pageOption.id&&(this.$relatedController.oppositePageId=this.$pageOption.id))}}get selected(){return this.$selected}get mode(){return this.$mode}set mode(t){this.$mode!=t&&(0==t&&(this.selected=!1),this.$mode=t)}get relatedController(){return this.$relatedController}set relatedController(t){t!=this.$relatedController&&(this.$relatedController=t,this.$pageOption.controller=t,this.$pageOption.clear())}get pageOption(){return this.$pageOption}get changeStateOnClick(){return this.$changeStateOnClick}set changeStateOnClick(t){this.$changeStateOnClick=t}get linkedPopup(){return this.$linkedPopup}set linkedPopup(t){this.$linkedPopup=t}addStateListener(e,i){this.on(t.StateChangeEvent.CHANGED,e,i)}removeStateListener(e,i){this.off(t.StateChangeEvent.CHANGED,e,i)}fireClick(i=!0){i&&0==this.$mode&&(this.setState(e.OVER),t.GTimer.inst.add(100,1,this.setState,this,e.DOWN),t.GTimer.inst.add(200,1,this.setState,this,e.UP)),this.$click(null)}setState(i){if(this.$buttonController&&(this.$buttonController.selectedPage=i),1==this.$downEffect)if(i==e.DOWN||i==e.SELECTED_OVER||i==e.SELECTED_DISABLED){let e=255*this.$downEffectValue,i=(e<<16)+(e<<8)+e;this.$children.forEach(e=>{t.isColorGear(e)&&(e.color=i)})}else this.$children.forEach(e=>{t.isColorGear(e)&&(e.color=16777215)});else 2==this.$downEffect&&(i==e.DOWN||i==e.SELECTED_OVER||i==e.SELECTED_DISABLED?this.setScale(this.$downEffectValue,this.$downEffectValue):this.setScale(1,1))}handleControllerChanged(t){super.handleControllerChanged(t),this.$relatedController==t&&(this.selected=this.$pageOption.id==t.selectedPageId)}handleGrayedChanged(){this.$buttonController&&this.$buttonController.hasPage(e.DISABLED)?this.grayed?this.$selected&&this.$buttonController.hasPage(e.SELECTED_DISABLED)?this.setState(e.SELECTED_DISABLED):this.setState(e.DISABLED):this.$selected?this.setState(e.DOWN):this.setState(e.UP):super.handleGrayedChanged()}constructFromXML(i){let s;super.constructFromXML(i),(s=(i=i.getChildNodes("Button")[0]).attributes.mode)&&(this.$mode=t.ParseButtonMode(s)),(s=i.attributes.downEffect)&&(this.$downEffect="dark"==s?1:"scale"==s?2:0,s=i.attributes.downEffectValue,this.$downEffectValue=parseFloat(s),2==this.$downEffect&&this.setPivot(.5,.5)),this.$buttonController=this.getController("button"),this.$titleObject=this.getChild("title"),this.$iconObject=this.getChild("icon"),null!=this.$titleObject&&(this.$title=this.$titleObject.text),null!=this.$iconObject&&(this.$icon=this.$iconObject.icon),0==this.$mode&&this.setState(e.UP),this.on(t.InteractiveEvents.Over,this.$rollover,this),this.on(t.InteractiveEvents.Out,this.$rollout,this),this.on(t.InteractiveEvents.Down,this.$mousedown,this),this.on(t.InteractiveEvents.Click,this.$click,this)}setupAfterAdd(e){if(super.setupAfterAdd(e),e=e.getChildNodes("Button")[0]){let i;(i=e.attributes.title)&&(this.title=i),(i=e.attributes.icon)&&(this.icon=i),(i=e.attributes.selectedTitle)&&(this.selectedTitle=i),(i=e.attributes.selectedIcon)&&(this.selectedIcon=i),(i=e.attributes.titleColor)&&(this.titleColor=t.utils.StringUtil.convertFromHtmlColor(i)),(i=e.attributes.titleFontSize)&&(this.fontSize=parseInt(i)),i=e.attributes.controller,this.$relatedController=i?this.$parent.getController(i):null,i=e.attributes.sound,this.$clicksound=i||null,this.$pageOption.id=e.attributes.page,this.selected="true"==e.attributes.checked}}$rollover(t){this.$buttonController&&this.$buttonController.hasPage(e.OVER)&&(this.$over=!0,this.$down||this.setState(this.$selected?e.SELECTED_OVER:e.OVER))}$rollout(t){this.$buttonController&&this.$buttonController.hasPage(e.OVER)&&(this.$over=!1,this.$down||this.setState(this.$selected?e.DOWN:e.UP))}$mousedown(i){this.$down=!0,t.GRoot.inst.on(t.InteractiveEvents.Up,this.$mouseup,this),0==this.$mode&&(this.grayed&&this.$buttonController&&this.$buttonController.hasPage(e.DISABLED)?this.setState(e.SELECTED_DISABLED):this.setState(e.DOWN)),null!=this.$linkedPopup&&(this.$linkedPopup instanceof t.Window?this.$linkedPopup.toggleVisible():this.root.togglePopup(this.$linkedPopup,this))}$mouseup(i){this.$down&&(t.GRoot.inst.off(t.InteractiveEvents.Up,this.$mouseup,this),this.$down=!1,0==this.$mode&&(this.grayed&&this.$buttonController&&this.$buttonController.hasPage(e.DISABLED)?this.setState(e.DISABLED):this.$over?this.setState(e.OVER):this.setState(e.UP)))}$click(e){if(this.$changeStateOnClick&&(1==this.$mode?(this.selected=!this.$selected,this.emit(t.StateChangeEvent.CHANGED,this)):2==this.$mode&&(this.$selected||(this.selected=!0,this.emit(t.StateChangeEvent.CHANGED,this))),this.$clicksound)){var i=this.packageItem.owner.name,s=t.UIPackage.getItemByURL(this.$clicksound);if(s){var h=t.utils.AssetLoader.resourcesPool[`${i}@${s.id}`];this.playSound(h)}}}playSound(t){return __awaiter(this,void 0,void 0,function*(){if(PIXI.sound){let e=PIXI.sound.Sound;if(t.sound)t.sound.play();else{e.from(t.data).play(t=>t.destroy())}}})}dispose(){t.GTimer.inst.remove(this.setState,this),t.GTimer.inst.remove(this.setState,this),t.GRoot.inst.off(t.InteractiveEvents.Up,this.$mouseup,this),super.dispose()}}e.UP="up",e.DOWN="down",e.OVER="over",e.SELECTED_OVER="selectedOver",e.DISABLED="disabled",e.SELECTED_DISABLED="selectedDisabled",t.GButton=e}(fgui||(fgui={})),function(t){t.GComboBox=class extends t.GComponent{constructor(){super(),this.$visibleItemCount=0,this.$selectedIndex=0,this.$popupDir=1,this.$visibleItemCount=t.UIConfig.defaultComboBoxVisibleItemCount,this.$itemsUpdated=!0,this.$selectedIndex=-1,this.$items=[],this.$values=[]}get text(){return this.$titleObject?this.$titleObject.text:null}set text(t){this.$titleObject&&(this.$titleObject.text=t),this.updateGear(6)}get icon(){return this.$iconObject?this.$iconObject.icon:null}set icon(t){this.$iconObject&&(this.$iconObject.icon=t),this.updateGear(7)}get titleColor(){return t.isColorableTitle(this.$titleObject)?this.$titleObject.titleColor:0}set titleColor(e){t.isColorableTitle(this.$titleObject)&&(this.$titleObject.titleColor=e)}get visibleItemCount(){return this.$visibleItemCount}set visibleItemCount(t){this.$visibleItemCount=t}get popupDirection(){return this.$popupDir}set popupDirection(t){this.$popupDir=t}get items(){return this.$items}set items(t){t?this.$items=t.concat():this.$items.length=0,this.$items.length>0?(this.$selectedIndex>=this.$items.length?this.$selectedIndex=this.$items.length-1:-1==this.$selectedIndex&&(this.$selectedIndex=0),this.text=this.$items[this.$selectedIndex],null!=this.$icons&&this.$selectedIndex<this.$icons.length&&(this.icon=this.$icons[this.$selectedIndex])):(this.text="",null!=this.$icons&&(this.icon=null),this.$selectedIndex=-1),this.$itemsUpdated=!0}get icons(){return this.$icons}set icons(t){this.$icons=t,null!=this.$icons&&-1!=this.$selectedIndex&&this.$selectedIndex<this.$icons.length&&(this.icon=this.$icons[this.$selectedIndex])}get values(){return this.$values}set values(t){t?this.$values=t.concat():this.$values.length=0}get selectedIndex(){return this.$selectedIndex}set selectedIndex(t){this.$selectedIndex!=t&&(this.$selectedIndex=t,this.selectedIndex>=0&&this.selectedIndex<this.$items.length?(this.text=this.$items[this.$selectedIndex],null!=this.$icons&&this.$selectedIndex<this.$icons.length&&(this.icon=this.$icons[this.$selectedIndex])):(this.text="",null!=this.$icons&&(this.icon=null)))}get value(){return this.$values[this.$selectedIndex]}set value(t){this.selectedIndex=this.$values.indexOf(t)}setState(t){this.$buttonController&&(this.$buttonController.selectedPage=t)}constructFromXML(e){let i;if(super.constructFromXML(e),e=e.getChildNodes("ComboBox")[0],this.$buttonController=this.getController("button"),this.$titleObject=this.getChild("title"),this.$iconObject=this.getChild("icon"),i=e.attributes.dropdown){if(this.$dropdown=t.UIPackage.createObjectFromURL(i),!this.$dropdown)throw new Error("the 'dropdown' is not specified, it must be a component definied in the package pool");if(this.$dropdown.name="this.dropdown",this.$list=this.$dropdown.getChild("list"),null==this.$list)throw new Error(`${this.resourceURL}: the dropdown component must have a GList child and named 'list'.`);this.$list.on(t.ListEvent.ItemClick,this.$clickItem,this),this.$list.addRelation(this.$dropdown,14),this.$list.removeRelation(this.$dropdown,15),this.$dropdown.addRelation(this.$list,15),this.$dropdown.removeRelation(this.$list,14),this.$dropdown.on("removed",this.$popupWinClosed,this)}PIXI.utils.isMobile.any||(this.on(t.InteractiveEvents.Over,this.$rollover,this),this.on(t.InteractiveEvents.Out,this.$rollout,this)),this.on(t.InteractiveEvents.Down,this.$mousedown,this)}dispose(){t.GTimer.inst.remove(this.delayedClickItem,this),this.$list.off(t.ListEvent.ItemClick,this.$clickItem,this),this.$dropdown.off("removed",this.$popupWinClosed,this),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Up,this.$mouseup,this),this.$popupWinClosed(null),this.$dropdown&&(this.$dropdown.dispose(),this.$dropdown=null),super.dispose()}setupAfterAdd(e){if(super.setupAfterAdd(e),e=e.getChildNodes("ComboBox")[0]){let i;(i=e.attributes.titleColor)&&(this.titleColor=t.utils.StringUtil.convertFromHtmlColor(i)),(i=e.attributes.visibleItemCount)&&(this.$visibleItemCount=parseInt(i));let s=e.children;s&&s.forEach((t,e)=>{"item"==t.nodeName&&(this.$items.push(t.attributes.title),this.$values.push(t.attributes.value),(i=t.attributes.icon)&&(this.$icons||(this.$icons=new Array(length)),this.$icons[e]=i))}),(i=e.attributes.title)?(this.text=i,this.$selectedIndex=this.$items.indexOf(i)):this.$items.length>0?(this.$selectedIndex=0,this.text=this.$items[0]):this.$selectedIndex=-1,(i=e.attributes.icon)&&(this.icon=i),(i=e.attributes.direction)&&("up"==i?this.$popupDir=2:"auto"==i&&(this.$popupDir=0))}}showDropdown(){this.$itemsUpdated&&(this.$itemsUpdated=!1,this.$list.removeChildrenToPool(),this.$items.forEach((t,e)=>{let i=this.$list.addItemFromPool();i.name=e<this.$values.length?this.$values[e]:"",i.text=this.$items[e],i.icon=null!=this.$icons&&e<this.$icons.length?this.$icons[e]:null},this),this.$list.resizeToFit(this.$visibleItemCount)),this.$list.selectedIndex=-1,this.$dropdown.width=this.width,this.root.togglePopup(this.$dropdown,this,this.$popupDir),this.$dropdown.parent&&this.setState(t.GButton.DOWN)}$popupWinClosed(e){this.$over?this.setState(t.GButton.OVER):this.setState(t.GButton.UP)}$clickItem(e,i){t.GTimer.inst.add(100,1,this.delayedClickItem,this,this.$list.getChildIndex(i))}delayedClickItem(e){this.$dropdown.parent instanceof t.GRoot&&this.$dropdown.parent.hidePopup(),this.$selectedIndex=e,this.$selectedIndex>=0?this.text=this.$items[this.$selectedIndex]:this.text="",this.emit(t.StateChangeEvent.CHANGED,this)}$rollover(e){this.$over=!0,this.$down||this.$dropdown&&this.$dropdown.parent||this.setState(t.GButton.OVER)}$rollout(e){this.$over=!1,this.$down||this.$dropdown&&this.$dropdown.parent||this.setState(t.GButton.UP)}$mousedown(e){e.stopPropagation(),t.GRoot.inst.checkPopups(e.target),this.$down=!0,t.GRoot.inst.nativeStage.on(t.InteractiveEvents.Up,this.$mouseup,this),this.$dropdown&&this.showDropdown()}$mouseup(e){this.$down&&(this.$down=!1,t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Up,this.$mouseup,this),this.$dropdown&&!this.$dropdown.parent&&(this.$over?this.setState(t.GButton.OVER):this.setState(t.GButton.UP)))}}}(fgui||(fgui={})),function(t){t.GGraph=class extends t.GObject{constructor(){super(),this.$type=0,this.$lineSize=0,this.$lineColor=0,this.$fillColor=0,this.$lineSize=1,this.$lineAlpha=1,this.$fillAlpha=1,this.$fillColor=16777215}drawRect(t,e,i,s,h,n=null){this.$type=1,this.$lineSize=t,this.$lineColor=e,this.$lineAlpha=i,this.$fillColor=s,this.$fillAlpha=h,this.$corner=n,this.drawGraph()}drawEllipse(t,e,i,s,h){this.$type=2,this.$lineSize=t,this.$lineColor=e,this.$lineAlpha=i,this.$fillColor=s,this.$fillAlpha=h,this.$corner=null,this.drawGraph()}get color(){return this.$fillColor}set color(t){this.$fillColor=t,0!=this.$type&&this.drawGraph()}drawGraph(){let t=this.$displayObject;t.interactive=this.touchable,t.clear();let e=this.width,i=this.height;if(0!=e&&0!=i){if(0==this.$lineSize?t.lineStyle(0,0,0):t.lineStyle(this.$lineSize,this.$lineColor,this.$lineAlpha),t.beginFill(this.$fillColor,this.$fillAlpha),1==this.$type)this.$corner&&this.$corner.length>=1?t.drawRoundedRect(0,0,e,i,this.$corner[0]):t.drawRect(0,0,e,i);else{let s=.5*e,h=.5*i;e==i?t.drawCircle(s,s,s):t.drawEllipse(s,h,s,h)}t.endFill()}}replaceMe(t){if(!this.$parent)throw new Error("parent not set");t.name=this.name,t.alpha=this.alpha,t.rotation=this.rotation,t.visible=this.visible,t.touchable=this.touchable,t.grayed=this.grayed,t.setXY(this.x,this.y),t.setSize(this.width,this.height);let e=this.$parent.getChildIndex(this);this.$parent.addChildAt(t,e),t.relations.copyFrom(this.relations),this.$parent.removeChild(this,!0)}addBeforeMe(t){if(null==this.$parent)throw new Error("parent not set");let e=this.$parent.getChildIndex(this);this.$parent.addChildAt(t,e)}addAfterMe(t){if(null==this.$parent)throw new Error("parent not set");let e=this.$parent.getChildIndex(this);e++,this.$parent.addChildAt(t,e)}setNativeObject(t){this.$type=0;let e=this.$displayObject;e.interactive=this.touchable,e.clear(),e.removeChildren(),e.addChild(t)}createDisplayObject(){this.$displayObject=new t.UISprite(this)}handleSizeChanged(){0!=this.$type&&this.drawGraph()}setupBeforeAdd(e){super.setupBeforeAdd(e);let i=e.attributes.type;if(i&&"empty"!=i){let s,h,n;(s=e.attributes.lineSize)&&(this.$lineSize=parseInt(s)),(s=e.attributes.lineColor)&&(h=t.utils.StringUtil.convertFromHtmlColor(s,!0),this.$lineColor=16777215&h,this.$lineAlpha=(h>>24&255)/255),(s=e.attributes.fillColor)&&(h=t.utils.StringUtil.convertFromHtmlColor(s,!0),this.$fillColor=16777215&h,this.$fillAlpha=(h>>24&255)/255),(s=e.attributes.corner)&&((n=s.split(",")).length>1?this.$corner=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])]:this.$corner=[parseInt(n[0])]),this.$type="rect"==i?1:2,this.drawGraph()}}}}(fgui||(fgui={})),function(t){t.GGroup=class extends t.GObject{createDisplayObject(){let e=new t.UIContainer(this);e.interactive=!1,this.setDisplayObject(e)}updateBounds(){if(this.$updating||!this.parent)return;let t,e=this.$parent.numChildren,i=0,s=Number.POSITIVE_INFINITY,h=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;this.$empty=!0;let l=0;for(i=0;i<e;i++)(t=this.$parent.getChildAt(i)).group==this&&((l=t.x)<s&&(s=l),(l=t.y)<h&&(h=l),(l=t.x+t.width)>n&&(n=l),(l=t.y+t.height)>r&&(r=l),this.$empty=!1);this.$updating=!0,this.$empty?this.setSize(0,0):(this.setXY(s,h),this.setSize(n-s,r-h)),this.$updating=!1}setXY(t,e){if(this.$x!=t||this.$y!=e){let i=t-this.$x,s=e-this.$y;super.setXY(t,e),this.moveChildren(i,s)}}moveChildren(t,e){if(this.$updating||!this.$parent)return;this.$updating=!0;let i,s=this.$parent.numChildren,h=0;for(h=0;h<s;h++)(i=this.$parent.getChildAt(h)).group==this&&i.setXY(i.x+t,i.y+e);this.$updating=!1}updateAlpha(){if(super.updateAlpha(),this.$inProgressBuilding)return;let t,e,i=this.$parent.numChildren;for(t=0;t<i;t++)(e=this.$parent.getChildAt(t)).group==this&&(e.alpha=this.alpha)}}}(fgui||(fgui={})),function(t){t.GImage=class extends t.GObject{constructor(){super()}get touchable(){return!1}set touchable(t){this.$touchable=!1}get color(){return this.$content.tint}set color(t){this.color!=t&&(this.updateGear(4),this.$content.tint=t)}get flip(){return this.$flip}set flip(t){if(this.$flip!=t){this.$flip=t;let e=!1,i=!1;1!=this.$flip&&3!=this.$flip||(e=!0),2!=this.$flip&&3!=this.$flip||(i=!0),this.$content.flipX=e,this.$content.flipY=i}}get texture(){return this.$content.texture}set texture(t){null!=t?(this.$sourceWidth=t.orig.width,this.$sourceHeight=t.orig.height):this.$sourceWidth=this.$sourceHeight=0,this.$initWidth=this.$sourceWidth,this.$initHeight=this.$sourceHeight,this.$content.texture=t}createDisplayObject(){this.$content=new t.UIImage(this),this.setDisplayObject(this.$content)}dispose(){this.$content.destroy(),super.dispose()}constructFromResource(){this.$sourceWidth=this.packageItem.width,this.$sourceHeight=this.packageItem.height,this.$initWidth=this.$sourceWidth,this.$initHeight=this.$sourceHeight,this.$content.$initDisp(this.packageItem),this.setSize(this.$sourceWidth,this.$sourceHeight)}handleXYChanged(){super.handleXYChanged(),0!=this.$flip&&(-1==this.$content.scale.x&&(this.$content.x+=this.width),-1==this.$content.scale.y&&(this.$content.y+=this.height))}handleSizeChanged(){this.$content.width=this.width,this.$content.height=this.height}setupBeforeAdd(e){let i;super.setupBeforeAdd(e),(i=e.attributes.color)&&(this.color=t.utils.StringUtil.convertFromHtmlColor(i)),(i=e.attributes.flip)&&(this.flip=t.ParseFlipType(i))}}}(fgui||(fgui={})),function(t){t.GLabel=class extends t.GComponent{constructor(){super()}get icon(){return null!=this.$iconObject?this.$iconObject.icon:null}set icon(t){null!=this.$iconObject&&(this.$iconObject.icon=t),this.updateGear(7)}get title(){return this.$titleObject?this.$titleObject.text:null}set title(t){this.$titleObject&&(this.$titleObject.text=t),this.updateGear(6)}get text(){return this.title}set text(t){this.title=t}get titleColor(){return t.isColorableTitle(this.$titleObject)?this.$titleObject.titleColor:0}set titleColor(e){t.isColorableTitle(this.$titleObject)&&(this.$titleObject.titleColor=e)}get fontSize(){return t.isColorableTitle(this.$titleObject)?this.$titleObject.fontSize:0}set fontSize(e){t.isColorableTitle(this.$titleObject)&&(this.$titleObject.fontSize=e)}set editable(t){this.$titleObject&&(this.$titleObject.editable=t)}get editable(){return!!(this.$titleObject&&this.$titleObject instanceof t.GTextInput)&&this.$titleObject.editable}constructFromXML(t){super.constructFromXML(t),this.$titleObject=this.getChild("title"),this.$iconObject=this.getChild("icon")}setupAfterAdd(e){super.setupAfterAdd(e);let i=e.getChildNodes("Label");if(i&&i.length>0){let s;if((s=(e=i[0]).attributes.title)&&(this.text=s),(s=e.attributes.icon)&&(this.icon=s),(s=e.attributes.titleColor)&&(this.titleColor=t.utils.StringUtil.convertFromHtmlColor(s)),this.$titleObject instanceof t.GTextInput){s=e.attributes.prompt;let t=this.$titleObject;s&&(t.promptText=s),(s=e.attributes.maxLength)&&(t.maxLength=parseInt(s)),(s=e.attributes.restrict)&&(t.restrict=s),(s=e.attributes.password)&&(t.password="true"==s)}}}}}(fgui||(fgui={})),function(t){class e{constructor(){this.width=0,this.height=0,this.updateFlag=0,this.selected=!1}}class i extends t.GComponent{constructor(){super(),this.$lineCount=0,this.$columnCount=0,this.$lineGap=0,this.$columnGap=0,this.$lastSelectedIndex=0,this.$numItems=0,this.$firstIndex=0,this.$curLineItemCount=0,this.$virtualListChanged=0,this.$apexIndex=0,this.$childrenRenderOrder=0,this.$itemInfoVer=0,this.$enterCounter=0,this.$trackBounds=!0,this.$pool=new t.utils.GObjectRecycler,this.$layout=0,this.$autoResizeItem=!0,this.$lastSelectedIndex=-1,this.$selectionMode=0,this.opaque=!0,this.scrollItemToViewOnClick=!0,this.$align="left",this.$verticalAlign=0,this.$container=new PIXI.Container,this.$rootContainer.addChild(this.$container)}get childrenRenderOrder(){return this.$childrenRenderOrder}set childrenRenderOrder(t){this.$childrenRenderOrder!=t&&(this.$childrenRenderOrder=t,this.appendChildrenList())}get apexIndex(){return this.$apexIndex}set apexIndex(t){this.$apexIndex!=t&&(this.$apexIndex=t,2==this.$childrenRenderOrder&&this.appendChildrenList())}appendChildrenList(){const t=this.$children.length;if(0==t)return;let e,i;switch(this.$childrenRenderOrder){case 0:for(e=0;e<t;e++)null!=(i=this.$children[e]).displayObject&&i.finalVisible&&this.$container.addChild(i.displayObject);break;case 1:for(e=t-1;e>=0;e--)null!=(i=this.$children[e]).displayObject&&i.finalVisible&&this.$container.addChild(i.displayObject);break;case 2:for(e=0;e<this.$apexIndex;e++)null!=(i=this.$children[e]).displayObject&&i.finalVisible&&this.$container.addChild(i.displayObject);for(e=t-1;e>=this.$apexIndex;e--)null!=(i=this.$children[e]).displayObject&&i.finalVisible&&this.$container.addChild(i.displayObject)}}setXY(e,i){this.$x==e&&this.$y==i||(this.$x=e,this.$y=i,this.handleXYChanged(),this.updateGear(1),t.GObject.draggingObject!=this||t.GObject.sUpdatingWhileDragging||this.localToGlobalRect(0,0,this.width,this.height,t.GObject.sGlobalRect))}$setChildIndex(e,i,s=0){let h=this.$children.length;if(s>h&&(s=h),i==s)return i;if(this.$children.splice(i,1),this.$children.splice(s,0,e),e.inContainer){let i,n,r=0;if(0==this.$childrenRenderOrder){for(n=0;n<s;n++)(i=this.$children[n]).inContainer&&r++;r==this.$container.children.length&&r--,this.$container.setChildIndex(e.displayObject,r)}else if(1==this.$childrenRenderOrder){for(n=h-1;n>s;n--)(i=this.$children[n]).inContainer&&r++;r==this.$container.children.length&&r--,this.$container.setChildIndex(e.displayObject,r)}else t.GTimer.inst.callLater(this.appendChildrenList,this);this.setBoundsChangedFlag()}return s}childStateChanged(e){if(!this.$buildingDisplayList)if(e instanceof t.GGroup)this.$children.forEach(t=>{t.group==e&&this.childStateChanged(t)},this);else if(e.displayObject)if(e.finalVisible){let i,s,h=this.$children.length;if(!e.displayObject.parent){let n=0;if(0==this.$childrenRenderOrder){for(let t=0;t<h&&(s=this.$children[t])!=e;t++)null!=s.displayObject&&null!=s.displayObject.parent&&n++;this.$container.addChildAt(e.displayObject,n)}else if(1==this.$childrenRenderOrder){for(i=h-1;i>=0&&(s=this.$children[i])!=e;i--)null!=s.displayObject&&null!=s.displayObject.parent&&n++;this.$container.addChildAt(e.displayObject,n)}else this.$container.addChild(e.displayObject),t.GTimer.inst.callLater(this.appendChildrenList,this)}}else e.displayObject.parent&&this.$container.removeChild(e.displayObject)}dispose(){t.GTimer.inst.remove(this.$refreshVirtualList,this),this.$pool.clear(),this.$scrollPane&&this.$scrollPane.off(t.ScrollEvent.SCROLL,this.$scrolled,this),super.dispose()}get layout(){return this.$layout}set layout(t){this.$layout!=t&&(this.$layout=t,this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0))}get lineCount(){return this.$lineCount}set lineCount(t){this.$lineCount!=t&&(this.$lineCount=t,3!=this.$layout&&4!=this.$layout||(this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0)))}get columnCount(){return this.$columnCount}set columnCount(t){this.$columnCount!=t&&(this.$columnCount=t,2!=this.$layout&&4!=this.$layout||(this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0)))}get lineGap(){return this.$lineGap}set lineGap(t){this.$lineGap!=t&&(this.$lineGap=t,this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0))}get columnGap(){return this.$columnGap}set columnGap(t){this.$columnGap!=t&&(this.$columnGap=t,this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0))}get align(){return this.$align}set align(t){this.$align!=t&&(this.$align=t,this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0))}get verticalAlign(){return this.$verticalAlign}set verticalAlign(t){this.$verticalAlign!=t&&(this.$verticalAlign=t,this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0))}get virtualItemSize(){return this.$itemSize}set virtualItemSize(t){this.$virtual&&(null==this.$itemSize&&(this.$itemSize=new PIXI.Point),this.$itemSize.copyFrom(t),this.setVirtualListChangedFlag(!0))}get defaultItem(){return this.$defaultItem}set defaultItem(t){this.$defaultItem=t}get autoResizeItem(){return this.$autoResizeItem}set autoResizeItem(t){this.$autoResizeItem!=t&&(this.$autoResizeItem=t,this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0))}get selectionMode(){return this.$selectionMode}set selectionMode(t){this.$selectionMode=t}get selectionController(){return this.$selectionController}set selectionController(t){this.$selectionController=t}get itemPool(){return this.$pool}getFromPool(t=null){t||(t=this.$defaultItem);let e=this.$pool.get(t);return null!=e&&(e.visible=!0),e}returnToPool(t){this.$pool.recycle(t.resourceURL,t)}addChildAt(e,i=0){return super.addChildAt(e,i),e instanceof t.GButton&&(e.selected=!1,e.changeStateOnClick=!1),e.click(this.$clickItem,this),e}addItem(e=null){return e||(e=this.$defaultItem),this.addChild(t.UIPackage.createObjectFromURL(e))}addItemFromPool(t=null){return this.addChild(this.getFromPool(t))}removeChildAt(e,i=!1){if(e>=0&&e<this.numChildren){let s=this.$children[e];return s.parent=null,0!=s.sortingOrder&&this.$sortingChildCount--,this.$children.splice(e,1),s.inContainer&&(this.$container.removeChild(s.displayObject),2==this.$childrenRenderOrder&&t.GTimer.inst.callLater(this.appendChildrenList,this)),!0===i&&s.dispose(),this.setBoundsChangedFlag(),s.removeClick(this.$clickItem,this),s}throw new Error("Invalid child index")}removeChildToPoolAt(t){let e=this.removeChildAt(t);this.returnToPool(e)}removeChildToPool(t){super.removeChild(t),this.returnToPool(t)}removeChildrenToPool(t=0,e=-1){(e<0||e>=this.$children.length)&&(e=this.$children.length-1);for(let i=t;i<=e;++i)this.removeChildToPoolAt(t)}get selectedIndex(){let e;if(this.$virtual)for(e=0;e<this.$realNumItems;e++){const i=this.$virtualItems[e];if(i.obj instanceof t.GButton&&i.obj.selected||null==i.obj&&i.selected)return this.$loop?e%this.$numItems:e}else{const t=this.$children.length;for(e=0;e<t;e++){const t=this.$children[e];if(null!=t&&t.selected)return e}}return-1}set selectedIndex(t){t>=0&&t<this.numItems?(0!=this.selectionMode&&this.clearSelection(),this.addSelection(t)):this.clearSelection()}getSelection(){let e,i=[];if(this.$virtual)for(e=0;e<this.$realNumItems;e++){const s=this.$virtualItems[e];if(s.obj instanceof t.GButton&&s.obj.selected||null==s.obj&&s.selected){let t=e;if(this.$loop&&(t=e%this.$numItems,-1!=i.indexOf(t)))continue;i.push(t)}}else{const t=this.$children.length;for(e=0;e<t;e++){const t=this.$children[e];null!=t&&t.selected&&i.push(e)}}return i}addSelection(t,e=!1){if(3==this.$selectionMode)return;this.checkVirtualList(),0==this.$selectionMode&&this.clearSelection(),e&&this.scrollToView(t),this.$lastSelectedIndex=t;let i=null;if(this.$virtual){const e=this.$virtualItems[t];null!=e.obj&&(i=e.obj),e.selected=!0}else i=this.getChildAt(t);null==i||i.selected||(i.selected=!0,this.updateSelectionController(t))}removeSelection(t){if(3==this.$selectionMode)return;let e=null;if(this.$virtual){const i=this.$virtualItems[t];null!=i.obj&&(e=i.obj),i.selected=!1}else e=this.getChildAt(t);null!=e&&(e.selected=!1)}clearSelection(){let e;if(this.$virtual)for(e=0;e<this.$realNumItems;e++){const i=this.$virtualItems[e];i.obj instanceof t.GButton&&(i.obj.selected=!1),i.selected=!1}else{const t=this.$children.length;for(e=0;e<t;e++){const t=this.$children[e];null!=t&&(t.selected=!1)}}}clearSelectionExcept(e){let i;if(this.$virtual)for(i=0;i<this.$realNumItems;i++){const s=this.$virtualItems[i];s.obj!=e&&(s.obj instanceof t.GButton&&(s.obj.selected=!1),s.selected=!1)}else{const t=this.$children.length;for(i=0;i<t;i++){const t=this.$children[i];null!=t&&t!=e&&(t.selected=!1)}}}selectAll(){this.checkVirtualList();let e,i=-1;if(this.$virtual)for(e=0;e<this.$realNumItems;e++){const s=this.$virtualItems[e];s.obj instanceof t.GButton&&!s.obj.selected&&(s.obj.selected=!0,i=e),s.selected=!0}else{const t=this.$children.length;for(e=0;e<t;e++){const t=this.$children[e];null==t||t.selected||(t.selected=!0,i=e)}}-1!=i&&this.updateSelectionController(i)}selectNone(){this.clearSelection()}selectReverse(){this.checkVirtualList();let e,i=-1;if(this.$virtual)for(e=0;e<this.$realNumItems;e++){const s=this.$virtualItems[e];s.obj instanceof t.GButton&&(s.obj.selected=!s.obj.selected,s.obj.selected&&(i=e)),s.selected=!s.selected}else{const t=this.$children.length;for(e=0;e<t;e++){const t=this.$children[e];null!=t&&(t.selected=!t.selected,t.selected&&(i=e))}}-1!=i&&this.updateSelectionController(i)}handleArrowKey(t){let e,i,s,h,n=this.selectedIndex;if(-1!=n)switch(t){case 38:if(0==this.$layout||3==this.$layout)--n>=0&&(this.clearSelection(),this.addSelection(n,!0));else if(2==this.$layout||4==this.$layout){for(e=this.$children[n],i=0,s=n-1;s>=0;s--){if((h=this.$children[s]).y!=e.y){e=h;break}i++}for(;s>=0;s--)if((h=this.$children[s]).y!=e.y){this.clearSelection(),this.addSelection(s+i+1,!0);break}}break;case 39:if(1==this.$layout||2==this.$layout||4==this.$layout)++n<this.$children.length&&(this.clearSelection(),this.addSelection(n,!0));else if(3==this.$layout){e=this.$children[n],i=0;const t=this.$children.length;for(s=n+1;s<t;s++){if((h=this.$children[s]).x!=e.x){e=h;break}i++}for(;s<t;s++)if((h=this.$children[s]).x!=e.x){this.clearSelection(),this.addSelection(s-i-1,!0);break}}break;case 40:if(0==this.$layout||3==this.$layout)++n<this.$children.length&&(this.clearSelection(),this.addSelection(n,!0));else if(2==this.$layout||4==this.$layout){e=this.$children[n],i=0;const t=this.$children.length;for(s=n+1;s<t;s++){if((h=this.$children[s]).y!=e.y){e=h;break}i++}for(;s<t;s++)if((h=this.$children[s]).y!=e.y){this.clearSelection(),this.addSelection(s-i-1,!0);break}}break;case 37:if(1==this.$layout||2==this.$layout||4==this.$layout)--n>=0&&(this.clearSelection(),this.addSelection(n,!0));else if(3==this.$layout){for(e=this.$children[n],i=0,s=n-1;s>=0;s--){if((h=this.$children[s]).x!=e.x){e=h;break}i++}for(;s>=0;s--)if((h=this.$children[s]).x!=e.x){this.clearSelection(),this.addSelection(s+i+1,!0);break}}}}$clickItem(e){if(null!=this.$scrollPane&&this.$scrollPane.isDragging)return;const i=t.GObject.castFromNativeObject(e.currentTarget);i&&(this.setSelectionOnEvent(i),this.$scrollPane&&this.scrollItemToViewOnClick&&this.$scrollPane.scrollToView(i,!0),this.emit(t.ListEvent.ItemClick,e,i))}setSelectionOnEvent(e){if(!(e instanceof t.GButton)||3==this.$selectionMode)return;let i=!1,s=this.childIndexToItemIndex(this.getChildIndex(e));if(0==this.$selectionMode)e.selected||(this.clearSelectionExcept(e),e.selected=!0);else if(t.utils.DOMEventManager.inst.isKeyPressed(16)){if(!e.selected)if(-1!=this.$lastSelectedIndex){const e=Math.min(this.$lastSelectedIndex,s),h=Math.min(Math.max(this.$lastSelectedIndex,s),this.numItems-1);let n;if(this.$virtual)for(n=e;n<=h;n++){const e=this.$virtualItems[n];e.obj instanceof t.GButton&&(e.obj.selected=!0),e.selected=!0}else for(n=e;n<=h;n++){const t=this.getChildAt(n);null!=t&&(t.selected=!0)}i=!0}else e.selected=!0}else t.utils.DOMEventManager.inst.isKeyPressed(17)||2==this.$selectionMode?e.selected=!e.selected:e.selected?this.clearSelectionExcept(e):(this.clearSelectionExcept(e),e.selected=!0);i||(this.$lastSelectedIndex=s),e.selected&&this.updateSelectionController(s)}resizeToFit(t=1e6,e=0){this.ensureBoundsCorrect();const i=this.numItems;if(t>i&&(t=i),this.$virtual){const e=Math.ceil(t/this.$curLineItemCount);0==this.$layout||2==this.$layout?this.viewHeight=e*this.$itemSize.y+Math.max(0,e-1)*this.$lineGap:this.viewWidth=e*this.$itemSize.x+Math.max(0,e-1)*this.$columnGap}else if(0==t)0==this.$layout||2==this.$layout?this.viewHeight=e:this.viewWidth=e;else{let i,s=t-1;for(;s>=0&&(i=this.getChildAt(s),this.foldInvisibleItems&&!i.visible);)s--;if(s<0)0==this.$layout||2==this.$layout?this.viewHeight=e:this.viewWidth=e;else{let t=0;0==this.$layout||2==this.$layout?((t=i.y+i.height)<e&&(t=e),this.viewHeight=t):((t=i.x+i.width)<e&&(t=e),this.viewWidth=t)}}}getMaxItemWidth(){const t=this.$children.length;let e=0;for(let i=0;i<t;i++){const t=this.getChildAt(i);t.width>e&&(e=t.width)}return e}handleSizeChanged(){super.handleSizeChanged(),this.setBoundsChangedFlag(),this.$virtual&&this.setVirtualListChangedFlag(!0)}handleControllerChanged(t){super.handleControllerChanged(t),this.$selectionController==t&&(this.selectedIndex=t.selectedIndex)}updateSelectionController(t){if(null!=this.$selectionController&&!this.$selectionController.$updating&&t<this.$selectionController.pageCount){const e=this.$selectionController;this.$selectionController=null,e.selectedIndex=t,this.$selectionController=e}}getSnappingPosition(t,e,s=null){if(this.$virtual){let h,n;return s||(s=new PIXI.Point),0==this.$layout||2==this.$layout?(h=e,i.$lastPosHelper=e,n=this.getIndexOnPos1(!1),e=i.$lastPosHelper,n<this.$virtualItems.length&&h-e>this.$virtualItems[n].height/2&&n<this.$realNumItems&&(e+=this.$virtualItems[n].height+this.$lineGap)):1==this.$layout||3==this.$layout?(h=t,i.$lastPosHelper=t,n=this.getIndexOnPos2(!1),t=i.$lastPosHelper,n<this.$virtualItems.length&&h-t>this.$virtualItems[n].width/2&&n<this.$realNumItems&&(t+=this.$virtualItems[n].width+this.$columnGap)):(h=t,i.$lastPosHelper=t,n=this.getIndexOnPos3(!1),t=i.$lastPosHelper,n<this.$virtualItems.length&&h-t>this.$virtualItems[n].width/2&&n<this.$realNumItems&&(t+=this.$virtualItems[n].width+this.$columnGap)),s.x=t,s.y=e,s}return super.getSnappingPosition(t,e,s)}scrollToView(t,e=!1,i=!1){if(this.$virtual){if(0==this.$numItems)return;if(this.checkVirtualList(),t>=this.$virtualItems.length)throw new Error(`Invalid child index: ${t} is larger than max length: ${this.$virtualItems.length}`);let s;this.$loop&&(t=Math.floor(this.$firstIndex/this.$numItems)*this.$numItems+t);const h=this.$virtualItems[t];let n,r=0;if(0==this.$layout||2==this.$layout){for(n=0;n<t;n+=this.$curLineItemCount)r+=this.$virtualItems[n].height+this.$lineGap;s=new PIXI.Rectangle(0,r,this.$itemSize.x,h.height)}else if(1==this.$layout||3==this.$layout){for(n=0;n<t;n+=this.$curLineItemCount)r+=this.$virtualItems[n].width+this.$columnGap;s=new PIXI.Rectangle(r,0,h.width,this.$itemSize.y)}else{const e=t/(this.$curLineItemCount*this.$curLineItemCount2);s=new PIXI.Rectangle(e*this.viewWidth+t%this.$curLineItemCount*(h.width+this.$columnGap),t/this.$curLineItemCount%this.$curLineItemCount2*(h.height+this.$lineGap),h.width,h.height)}i=!0,null!=this.$scrollPane&&this.$scrollPane.scrollToView(s,e,i)}else{const s=this.getChildAt(t);null!=this.$scrollPane?this.$scrollPane.scrollToView(s,e,i):null!=this.parent&&null!=this.parent.scrollPane&&this.parent.scrollPane.scrollToView(s,e,i)}}getFirstChildInView(){return this.childIndexToItemIndex(super.getFirstChildInView())}childIndexToItemIndex(t){if(!this.$virtual)return t;if(4==this.$layout){for(let e=this.$firstIndex;e<this.$realNumItems;e++)if(null!=this.$virtualItems[e].obj&&--t<0)return e;return t}return t+=this.$firstIndex,this.$loop&&this.$numItems>0&&(t%=this.$numItems),t}itemIndexToChildIndex(t){if(!this.$virtual)return t;if(4==this.$layout)return this.getChildIndex(this.$virtualItems[t].obj);if(this.$loop&&this.$numItems>0){const e=this.$firstIndex%this.$numItems;t=t>=e?this.$firstIndex+(t-e):this.$firstIndex+this.$numItems+(e-t)}else t-=this.$firstIndex;return t}setVirtual(){this.$setVirtual(!1)}setVirtualAndLoop(){this.$setVirtual(!0)}$setVirtual(e){if(!this.$virtual){if(null==this.$scrollPane)throw new Error("Virtual list must be scrollable");if(e){if(2==this.$layout||3==this.$layout)throw new Error("Virtual list with loop mode is not supported for both FlowHorizontal and FlowVertical layout");this.$scrollPane.bouncebackEffect=!1}if(this.$virtual=!0,this.$loop=e,this.$virtualItems=[],this.removeChildrenToPool(),null==this.$itemSize){this.$itemSize=new PIXI.Point;const t=this.getFromPool(null);if(null==t)throw new Error("Virtual list must have a default list item resource specified through list.defaultItem = resUrl.");this.$itemSize.x=t.width,this.$itemSize.y=t.height,this.returnToPool(t)}0==this.$layout||2==this.$layout?(this.$scrollPane.scrollSpeed=this.$itemSize.y,this.$loop&&(this.$scrollPane.$loop=2)):(this.$scrollPane.scrollSpeed=this.$itemSize.x,this.$loop&&(this.$scrollPane.$loop=1)),this.$scrollPane.on(t.ScrollEvent.SCROLL,this.$scrolled,this),this.setVirtualListChangedFlag(!0)}}get numItems(){return this.$virtual?this.$numItems:this.$children.length}set numItems(i){let s;if(this.$virtual){if(null==this.itemRenderer)throw new Error("list.itemRenderer is required");this.$numItems=i,this.$loop?this.$realNumItems=6*this.$numItems:this.$realNumItems=this.$numItems;const h=this.$virtualItems.length;if(this.$realNumItems>h)for(s=h;s<this.$realNumItems;s++){let t=new e;t.width=this.$itemSize.x,t.height=this.$itemSize.y,this.$virtualItems.push(t)}else for(s=this.$realNumItems;s<h;s++)this.$virtualItems[s].selected=!1;0!=this.$virtualListChanged&&t.GTimer.inst.remove(this.$refreshVirtualList,this),this.$refreshVirtualList()}else{const t=this.$children.length;if(i>t)for(s=t;s<i;s++)null==this.itemProvider?this.addItemFromPool():this.addItemFromPool(this.itemProvider(s));else this.removeChildrenToPool(i,t);if(null!=this.itemRenderer)for(s=0;s<i;s++)this.itemRenderer(s,this.getChildAt(s))}}refreshVirtualList(){this.setVirtualListChangedFlag(!1)}checkVirtualList(){0!=this.$virtualListChanged&&(this.$refreshVirtualList(),t.GTimer.inst.remove(this.$refreshVirtualList,this))}setVirtualListChangedFlag(e=!1){e?this.$virtualListChanged=2:0==this.$virtualListChanged&&(this.$virtualListChanged=1),t.GTimer.inst.callLater(this.$refreshVirtualList,this)}$refreshVirtualList(){const t=2==this.$virtualListChanged;this.$virtualListChanged=0,this.$eventLocked=!0,t&&(0==this.$layout||1==this.$layout?this.$curLineItemCount=1:2==this.$layout?this.$columnCount>0?this.$curLineItemCount=this.$columnCount:(this.$curLineItemCount=Math.floor((this.$scrollPane.viewWidth+this.$columnGap)/(this.$itemSize.x+this.$columnGap)),this.$curLineItemCount<=0&&(this.$curLineItemCount=1)):3==this.$layout?this.$lineCount>0?this.$curLineItemCount=this.$lineCount:(this.$curLineItemCount=Math.floor((this.$scrollPane.viewHeight+this.$lineGap)/(this.$itemSize.y+this.$lineGap)),this.$curLineItemCount<=0&&(this.$curLineItemCount=1)):(this.$columnCount>0?this.$curLineItemCount=this.$columnCount:(this.$curLineItemCount=Math.floor((this.$scrollPane.viewWidth+this.$columnGap)/(this.$itemSize.x+this.$columnGap)),this.$curLineItemCount<=0&&(this.$curLineItemCount=1)),this.$lineCount>0?this.$curLineItemCount2=this.$lineCount:(this.$curLineItemCount2=Math.floor((this.$scrollPane.viewHeight+this.$lineGap)/(this.$itemSize.y+this.$lineGap)),this.$curLineItemCount2<=0&&(this.$curLineItemCount2=1))));let e=0,i=0;if(this.$realNumItems>0){let t,s=Math.ceil(this.$realNumItems/this.$curLineItemCount)*this.$curLineItemCount,h=Math.min(this.$curLineItemCount,this.$realNumItems);if(0==this.$layout||2==this.$layout){for(t=0;t<s;t+=this.$curLineItemCount)e+=this.$virtualItems[t].height+this.$lineGap;if(e>0&&(e-=this.$lineGap),this.$autoResizeItem)i=this.$scrollPane.viewWidth;else{for(t=0;t<h;t++)i+=this.$virtualItems[t].width+this.$columnGap;i>0&&(i-=this.$columnGap)}}else if(1==this.$layout||3==this.$layout){for(t=0;t<s;t+=this.$curLineItemCount)i+=this.$virtualItems[t].width+this.$columnGap;if(i>0&&(i-=this.$columnGap),this.$autoResizeItem)e=this.$scrollPane.viewHeight;else{for(t=0;t<h;t++)e+=this.$virtualItems[t].height+this.$lineGap;e>0&&(e-=this.$lineGap)}}else{i=Math.ceil(s/(this.$curLineItemCount*this.$curLineItemCount2))*this.viewWidth,e=this.viewHeight}}this.handleAlign(i,e),this.$scrollPane.setContentSize(i,e),this.$eventLocked=!1,this.handleScroll(!0)}$scrolled(){this.handleScroll(!1)}getIndexOnPos1(t){if(this.$realNumItems<this.$curLineItemCount)return i.$lastPosHelper=0,0;let e,s,h;if(this.numChildren>0&&!t){if((s=this.getChildAt(0).y)>i.$lastPosHelper){for(e=this.$firstIndex-this.$curLineItemCount;e>=0;e-=this.$curLineItemCount)if((s-=this.$virtualItems[e].height+this.$lineGap)<=i.$lastPosHelper)return i.$lastPosHelper=s,e;return i.$lastPosHelper=0,0}for(e=this.$firstIndex;e<this.$realNumItems;e+=this.$curLineItemCount){if((h=s+this.$virtualItems[e].height+this.$lineGap)>i.$lastPosHelper)return i.$lastPosHelper=s,e;s=h}return i.$lastPosHelper=s,this.$realNumItems-this.$curLineItemCount}for(s=0,e=0;e<this.$realNumItems;e+=this.$curLineItemCount){if((h=s+this.$virtualItems[e].height+this.$lineGap)>i.$lastPosHelper)return i.$lastPosHelper=s,e;s=h}return i.$lastPosHelper=s,this.$realNumItems-this.$curLineItemCount}getIndexOnPos2(t){if(this.$realNumItems<this.$curLineItemCount)return i.$lastPosHelper=0,0;let e,s,h;if(this.numChildren>0&&!t){if((s=this.getChildAt(0).x)>i.$lastPosHelper){for(e=this.$firstIndex-this.$curLineItemCount;e>=0;e-=this.$curLineItemCount)if((s-=this.$virtualItems[e].width+this.$columnGap)<=i.$lastPosHelper)return i.$lastPosHelper=s,e;return i.$lastPosHelper=0,0}for(e=this.$firstIndex;e<this.$realNumItems;e+=this.$curLineItemCount){if((h=s+this.$virtualItems[e].width+this.$columnGap)>i.$lastPosHelper)return i.$lastPosHelper=s,e;s=h}return i.$lastPosHelper=s,this.$realNumItems-this.$curLineItemCount}for(s=0,e=0;e<this.$realNumItems;e+=this.$curLineItemCount){if((h=s+this.$virtualItems[e].width+this.$columnGap)>i.$lastPosHelper)return i.$lastPosHelper=s,e;s=h}return i.$lastPosHelper=s,this.$realNumItems-this.$curLineItemCount}getIndexOnPos3(t){if(this.$realNumItems<this.$curLineItemCount)return i.$lastPosHelper=0,0;const e=this.viewWidth,s=Math.floor(i.$lastPosHelper/e),h=s*(this.$curLineItemCount*this.$curLineItemCount2);let n,r,l=s*e;for(n=0;n<this.$curLineItemCount;n++){if((r=l+this.$virtualItems[h+n].width+this.$columnGap)>i.$lastPosHelper)return i.$lastPosHelper=l,h+n;l=r}return i.$lastPosHelper=l,h+this.$curLineItemCount-1}handleScroll(t){this.$eventLocked||(this.$enterCounter=0,0==this.$layout||2==this.$layout?(this.handleScroll1(t),this.handleArchOrder1()):1==this.$layout||3==this.$layout?(this.handleScroll2(t),this.handleArchOrder2()):this.handleScroll3(t),this.$boundsChanged=!1)}handleScroll1(e){if(this.$enterCounter++,this.$enterCounter>3)return void console.warn("this list view cannot be filled full as the itemRenderer function always returns an item with different size.");let s=this.$scrollPane.scrollingPosY,h=s+this.$scrollPane.viewHeight;const n=h==this.$scrollPane.contentHeight;i.$lastPosHelper=s;const r=this.getIndexOnPos1(e);if(r==this.$firstIndex&&!e)return;s=i.$lastPosHelper;const l=this.$firstIndex;this.$firstIndex=r;let a=r;const o=l>r,$=this.numChildren,c=l+$-1;let u,d,g,p,f,m=o?c:l,w=0,y=s,b=0,I=0,x=this.defaultItem;const C=(this.$scrollPane.viewWidth-this.$columnGap*(this.$curLineItemCount-1))/this.$curLineItemCount;for(this.$itemInfoVer++;a<this.$realNumItems&&(n||y<h);){if((null==(d=this.$virtualItems[a]).obj||e)&&(null!=this.itemProvider&&(null==(x=this.itemProvider(a%this.$numItems))&&(x=this.$defaultItem),x=t.UIPackage.normalizeURL(x)),null!=d.obj&&d.obj.resourceURL!=x&&(d.obj instanceof t.GButton&&(d.selected=d.obj.selected),this.removeChildToPool(d.obj),d.obj=null)),null==d.obj){if(o){for(f=m;f>=l;f--)if(null!=(g=this.$virtualItems[f]).obj&&g.updateFlag!=this.$itemInfoVer&&g.obj.resourceURL==x){g.obj instanceof t.GButton&&(g.selected=g.obj.selected),d.obj=g.obj,g.obj=null,f==m&&m--;break}}else for(f=m;f<=c;f++)if(null!=(g=this.$virtualItems[f]).obj&&g.updateFlag!=this.$itemInfoVer&&g.obj.resourceURL==x){g.obj instanceof t.GButton&&(g.selected=g.obj.selected),d.obj=g.obj,g.obj=null,f==m&&m++;break}null!=d.obj?this.setChildIndex(d.obj,o?a-r:this.numChildren):(d.obj=this.$pool.get(x),o?this.addChildAt(d.obj,a-r):this.addChild(d.obj)),d.obj instanceof t.GButton&&(d.obj.selected=d.selected),u=!0}else u=e;u&&(this.$autoResizeItem&&(0==this.$layout||this.$columnCount>0)&&d.obj.setSize(C,d.obj.height,!0),this.itemRenderer(a%this.$numItems,d.obj),a%this.$curLineItemCount==0&&(b+=Math.ceil(d.obj.height)-d.height,a==r&&l>r&&(I=Math.ceil(d.obj.height)-d.height)),d.width=Math.ceil(d.obj.width),d.height=Math.ceil(d.obj.height)),d.updateFlag=this.$itemInfoVer,d.obj.setXY(w,y),a==r&&(h+=d.height),w+=d.width+this.$columnGap,a%this.$curLineItemCount==this.$curLineItemCount-1&&(w=0,y+=d.height+this.$lineGap),a++}for(p=0;p<$;p++)(d=this.$virtualItems[l+p]).updateFlag!=this.$itemInfoVer&&null!=d.obj&&(d.obj instanceof t.GButton&&(d.selected=d.obj.selected),this.removeChildToPool(d.obj),d.obj=null);0==b&&0==I||this.$scrollPane.changeContentSizeOnScrolling(0,b,0,I),a>0&&this.numChildren>0&&this.$container.y<0&&this.getChildAt(0).y>-this.$container.y&&this.handleScroll1(!1)}handleScroll2(e){if(this.$enterCounter++,this.$enterCounter>3)return void console.warn("this list view cannot be filled full as the itemRenderer function always returns an item with different size.");let s=this.$scrollPane.scrollingPosX,h=s+this.$scrollPane.viewWidth;const n=s==this.$scrollPane.contentWidth;i.$lastPosHelper=s;const r=this.getIndexOnPos2(e);if(r==this.$firstIndex&&!e)return;s=i.$lastPosHelper;const l=this.$firstIndex;this.$firstIndex=r;let a=r;const o=l>r,$=this.numChildren;let c,u,d,g,p,f=l+$-1,m=o?f:l,w=s,y=0,b=0,I=0,x=this.defaultItem;const C=(this.$scrollPane.viewHeight-this.$lineGap*(this.$curLineItemCount-1))/this.$curLineItemCount;for(this.$itemInfoVer++;a<this.$realNumItems&&(n||w<h);){if((null==(u=this.$virtualItems[a]).obj||e)&&(null!=this.itemProvider&&(null==(x=this.itemProvider(a%this.$numItems))&&(x=this.$defaultItem),x=t.UIPackage.normalizeURL(x)),null!=u.obj&&u.obj.resourceURL!=x&&(u.obj instanceof t.GButton&&(u.selected=u.obj.selected),this.removeChildToPool(u.obj),u.obj=null)),null==u.obj){if(o){for(p=m;p>=l;p--)if(null!=(d=this.$virtualItems[p]).obj&&d.updateFlag!=this.$itemInfoVer&&d.obj.resourceURL==x){d.obj instanceof t.GButton&&(d.selected=d.obj.selected),u.obj=d.obj,d.obj=null,p==m&&m--;break}}else for(p=m;p<=f;p++)if(null!=(d=this.$virtualItems[p]).obj&&d.updateFlag!=this.$itemInfoVer&&d.obj.resourceURL==x){d.obj instanceof t.GButton&&(d.selected=d.obj.selected),u.obj=d.obj,d.obj=null,p==m&&m++;break}null!=u.obj?this.setChildIndex(u.obj,o?a-r:this.numChildren):(u.obj=this.$pool.get(x),o?this.addChildAt(u.obj,a-r):this.addChild(u.obj)),u.obj instanceof t.GButton&&(u.obj.selected=u.selected),c=!0}else c=e;c&&(this.$autoResizeItem&&(1==this.$layout||this.$lineCount>0)&&u.obj.setSize(u.obj.width,C,!0),this.itemRenderer(a%this.$numItems,u.obj),a%this.$curLineItemCount==0&&(b+=Math.ceil(u.obj.width)-u.width,a==r&&l>r&&(I=Math.ceil(u.obj.width)-u.width)),u.width=Math.ceil(u.obj.width),u.height=Math.ceil(u.obj.height)),u.updateFlag=this.$itemInfoVer,u.obj.setXY(w,y),a==r&&(h+=u.width),y+=u.height+this.$lineGap,a%this.$curLineItemCount==this.$curLineItemCount-1&&(y=0,w+=u.width+this.$columnGap),a++}for(g=0;g<$;g++)(u=this.$virtualItems[l+g]).updateFlag!=this.$itemInfoVer&&null!=u.obj&&(u.obj instanceof t.GButton&&(u.selected=u.obj.selected),this.removeChildToPool(u.obj),u.obj=null);0==b&&0==I||this.$scrollPane.changeContentSizeOnScrolling(b,0,I,0),a>0&&this.numChildren>0&&this.$container.x<0&&this.getChildAt(0).x>-this.$container.x&&this.handleScroll2(!1)}handleScroll3(e){let s=this.$scrollPane.scrollingPosX;i.$lastPosHelper=s;const h=this.getIndexOnPos3(e);if(h==this.$firstIndex&&!e)return;s=i.$lastPosHelper;const n=this.$firstIndex;this.$firstIndex=h;let r=n;const l=this.$virtualItems.length,a=this.$curLineItemCount*this.$curLineItemCount2,o=h%this.$curLineItemCount,$=this.viewWidth,c=Math.floor(h/a)*a,u=c+2*a;let d,g,p,f,m,w=this.$defaultItem;const y=(this.$scrollPane.viewWidth-this.$columnGap*(this.$curLineItemCount-1))/this.$curLineItemCount,b=(this.$scrollPane.viewHeight-this.$lineGap*(this.$curLineItemCount2-1))/this.$curLineItemCount2;for(this.$itemInfoVer++,g=c;g<u;g++)if(!(g>=this.$realNumItems)){if(m=g%this.$curLineItemCount,g-c<a){if(m<o)continue}else if(m>o)continue;(p=this.$virtualItems[g]).updateFlag=this.$itemInfoVer}let I=null,x=0;for(g=c;g<u;g++)if(!(g>=this.$realNumItems)&&(p=this.$virtualItems[g]).updateFlag==this.$itemInfoVer){if(null==p.obj){for(;r<l;){if(null!=(f=this.$virtualItems[r]).obj&&f.updateFlag!=this.$itemInfoVer){f.obj instanceof t.GButton&&(f.selected=f.obj.selected),p.obj=f.obj,f.obj=null;break}r++}-1==x&&(x=this.getChildIndex(I)+1),null==p.obj?(null!=this.itemProvider&&(null==(w=this.itemProvider(g%this.$numItems))&&(w=this.$defaultItem),w=t.UIPackage.normalizeURL(w)),p.obj=this.$pool.get(w),this.addChildAt(p.obj,x)):x=this.setChildIndexBefore(p.obj,x),x++,p.obj instanceof t.GButton&&(p.obj.selected=p.selected),d=!0}else d=e,x=-1,I=p.obj;d&&(this.$autoResizeItem&&(this.$curLineItemCount==this.$columnCount&&this.$curLineItemCount2==this.$lineCount?p.obj.setSize(y,b,!0):this.$curLineItemCount==this.$columnCount?p.obj.setSize(y,p.obj.height,!0):this.$curLineItemCount2==this.$lineCount&&p.obj.setSize(p.obj.width,b,!0)),this.itemRenderer(g%this.$numItems,p.obj),p.width=Math.ceil(p.obj.width),p.height=Math.ceil(p.obj.height))}let C=c/a*$,v=C,S=0,P=0;for(g=c;g<u;g++)g>=this.$realNumItems||((p=this.$virtualItems[g]).updateFlag==this.$itemInfoVer&&p.obj.setXY(v,S),p.height>P&&(P=p.height),g%this.$curLineItemCount==this.$curLineItemCount-1?(v=C,S+=P+this.$lineGap,P=0,g==c+a-1&&(v=C+=$,S=0)):v+=p.width+this.$columnGap);for(g=r;g<l;g++)(p=this.$virtualItems[g]).updateFlag!=this.$itemInfoVer&&null!=p.obj&&(p.obj instanceof t.GButton&&(p.selected=p.obj.selected),this.removeChildToPool(p.obj),p.obj=null)}handleArchOrder1(){if(2==this.$childrenRenderOrder){const t=this.$scrollPane.posY+this.viewHeight/2;let e=Number.POSITIVE_INFINITY,i=0,s=0;const h=this.numChildren;for(let n=0;n<h;n++){const h=this.getChildAt(n);this.foldInvisibleItems&&!h.visible||(i=Math.abs(t-h.y-h.height/2))<e&&(e=i,s=n)}this.apexIndex=s}}handleArchOrder2(){if(2==this.childrenRenderOrder){const t=this.$scrollPane.posX+this.viewWidth/2;let e=Number.POSITIVE_INFINITY,i=0,s=0;const h=this.numChildren;for(let n=0;n<h;n++){const h=this.getChildAt(n);this.foldInvisibleItems&&!h.visible||(i=Math.abs(t-h.x-h.width/2))<e&&(e=i,s=n)}this.apexIndex=s}}handleAlign(t,e){let i=0,s=0;e<this.viewHeight&&(1==this.$verticalAlign?s=Math.floor((this.viewHeight-e)/2):2==this.$verticalAlign&&(s=this.viewHeight-e)),t<this.viewWidth&&("center"==this.$align?i=Math.floor((this.viewWidth-t)/2):"right"==this.$align&&(i=this.viewWidth-t)),i==this.$alignOffset.x&&s==this.$alignOffset.y||(this.$alignOffset.set(i,s),null!=this.$scrollPane?this.$scrollPane.adjustMaskContainer():(this.$container.x=this.$margin.left+this.$alignOffset.x,this.$container.y=this.$margin.top+this.$alignOffset.y))}updateBounds(){if(this.$virtual)return;let t,e,i=0,s=0,h=0,n=0,r=0,l=0,a=0,o=0,$=0;const c=this.$children.length,u=this.viewWidth,d=this.viewHeight;let g,p=0,f=0;if(0==this.$layout){for(t=0;t<c;t++)e=this.getChildAt(t),this.foldInvisibleItems&&!e.visible||(0!=s&&(s+=this.$lineGap),e.y=s,this.$autoResizeItem&&e.setSize(u,e.height,!0),s+=Math.ceil(e.height),e.width>h&&(h=e.width));r=Math.ceil(h),l=s}else if(1==this.$layout){for(t=0;t<c;t++)e=this.getChildAt(t),this.foldInvisibleItems&&!e.visible||(0!=i&&(i+=this.$columnGap),e.x=i,this.$autoResizeItem&&e.setSize(e.width,d,!0),i+=Math.ceil(e.width),e.height>n&&(n=e.height));r=i,l=Math.ceil(n)}else if(2==this.$layout)if(this.$autoResizeItem&&this.$columnCount>0){for(t=0;t<c;t++)if(e=this.getChildAt(t),(!this.foldInvisibleItems||e.visible)&&(p+=e.sourceWidth,++a==this.$columnCount||t==c-1)){for(g=(u-p-(a-1)*this.$columnGap)/p,i=0,a=f;a<=t;a++)e=this.getChildAt(a),this.foldInvisibleItems&&!e.visible||(e.setXY(i,s),a<t?(e.setSize(e.sourceWidth+Math.round(e.sourceWidth*g),e.height,!0),i+=Math.ceil(e.width)+this.$columnGap):e.setSize(u-i,e.height,!0),e.height>n&&(n=e.height));s+=Math.ceil(n)+this.$lineGap,n=0,a=0,f=t+1,p=0}l=s+Math.ceil(n),r=u}else{for(t=0;t<c;t++)e=this.getChildAt(t),this.foldInvisibleItems&&!e.visible||(0!=i&&(i+=this.$columnGap),(0!=this.$columnCount&&a>=this.$columnCount||0==this.$columnCount&&i+e.width>u&&0!=n)&&(i=0,s+=Math.ceil(n)+this.$lineGap,n=0,a=0),e.setXY(i,s),(i+=Math.ceil(e.width))>h&&(h=i),e.height>n&&(n=e.height),a++);l=s+Math.ceil(n),r=Math.ceil(h)}else if(3==this.$layout)if(this.$autoResizeItem&&this.$lineCount>0){for(t=0;t<c;t++)if(e=this.getChildAt(t),(!this.foldInvisibleItems||e.visible)&&(p+=e.sourceHeight,++a==this.$lineCount||t==c-1)){for(g=(d-p-(a-1)*this.$lineGap)/p,s=0,a=f;a<=t;a++)e=this.getChildAt(a),this.foldInvisibleItems&&!e.visible||(e.setXY(i,s),a<t?(e.setSize(e.width,e.sourceHeight+Math.round(e.sourceHeight*g),!0),s+=Math.ceil(e.height)+this.$lineGap):e.setSize(e.width,d-s,!0),e.width>h&&(h=e.width));i+=Math.ceil(h)+this.$columnGap,h=0,a=0,f=t+1,p=0}r=i+Math.ceil(h),l=d}else{for(t=0;t<c;t++)e=this.getChildAt(t),this.foldInvisibleItems&&!e.visible||(0!=s&&(s+=this.$lineGap),(0!=this.$lineCount&&a>=this.$lineCount||0==this.$lineCount&&s+e.height>d&&0!=h)&&(s=0,i+=Math.ceil(h)+this.$columnGap,h=0,a=0),e.setXY(i,s),(s+=Math.ceil(e.height))>n&&(n=s),e.width>h&&(h=e.width),a++);r=i+Math.ceil(h),l=Math.ceil(n)}else{let m;if(this.$autoResizeItem&&this.$lineCount>0&&(m=Math.floor((d-(this.$lineCount-1)*this.$lineGap)/this.$lineCount)),this.$autoResizeItem&&this.$columnCount>0){for(t=0;t<c;t++)if(e=this.getChildAt(t),(!this.foldInvisibleItems||e.visible)&&(p+=e.sourceWidth,++a==this.$columnCount||t==c-1)){for(g=(u-p-(a-1)*this.$columnGap)/p,i=0,a=f;a<=t;a++)e=this.getChildAt(a),this.foldInvisibleItems&&!e.visible||(e.setXY(o*u+i,s),a<t?(e.setSize(e.sourceWidth+Math.round(e.sourceWidth*g),this.$lineCount>0?m:e.height,!0),i+=Math.ceil(e.width)+this.$columnGap):e.setSize(u-i,this.$lineCount>0?m:e.height,!0),e.height>n&&(n=e.height));s+=Math.ceil(n)+this.$lineGap,n=0,a=0,f=t+1,p=0,$++,(0!=this.$lineCount&&$>=this.$lineCount||0==this.$lineCount&&s+e.height>d)&&(o++,s=0,$=0)}}else for(t=0;t<c;t++)e=this.getChildAt(t),this.foldInvisibleItems&&!e.visible||(0!=i&&(i+=this.$columnGap),this.$autoResizeItem&&this.$lineCount>0&&e.setSize(e.width,m,!0),(0!=this.$columnCount&&a>=this.$columnCount||0==this.$columnCount&&i+e.width>u&&0!=n)&&(i=0,s+=Math.ceil(n)+this.$lineGap,n=0,a=0,$++,(0!=this.$lineCount&&$>=this.$lineCount||0==this.$lineCount&&s+e.height>d&&0!=h)&&(o++,s=0,$=0)),e.setXY(o*u+i,s),(i+=Math.ceil(e.width))>h&&(h=i),e.height>n&&(n=e.height),a++);l=o>0?d:s+Math.ceil(n),r=(o+1)*u}this.handleAlign(r,l),this.setBounds(0,0,r,l)}setupBeforeAdd(e){let i,s,h;if(super.setupBeforeAdd(e),(i=e.attributes.layout)&&(this.$layout=t.ParseListLayoutType(i)),h=(i=e.attributes.overflow)?t.ParseOverflowType(i):0,(i=e.attributes.margin)&&this.$margin.parse(i),(i=e.attributes.align)&&(this.$align=t.ParseAlignType(i)),(i=e.attributes.vAlign)&&(this.$verticalAlign=t.ParseVertAlignType(i)),2==h){let h,n,r;h=(i=e.attributes.scroll)?t.ParseScrollType(i):1,n=(i=e.attributes.scrollBar)?t.ParseScrollBarDisplayType(i):0,r=(i=e.attributes.scrollBarFlags)?parseInt(i):0;let l,a,o,$,c=new t.utils.Margin;(i=e.attributes.scrollBarMargin)&&c.parse(i),(i=e.attributes.scrollBarRes)&&(l=(s=i.split(","))[0],a=s[1]),(i=e.attributes.ptrRes)&&(o=(s=i.split(","))[0],$=s[1]),this.setupScroll(c,h,n,r,l,a,o,$)}else this.setupOverflow(h);(i=e.attributes.lineGap)&&(this.$lineGap=parseInt(i)),(i=e.attributes.colGap)&&(this.$columnGap=parseInt(i)),(i=e.attributes.lineItemCount)&&(2==this.$layout||4==this.$layout?this.$columnCount=parseInt(i):3==this.$layout&&(this.$lineCount=parseInt(i))),(i=e.attributes.lineItemCount2)&&(this.$lineCount=parseInt(i)),(i=e.attributes.selectionMode)&&(this.$selectionMode=t.ParseListSelectionMode(i)),(i=e.attributes.defaultItem)&&(this.$defaultItem=i),i=e.attributes.autoItemSize,1==this.$layout||0==this.$layout?this.$autoResizeItem="false"!=i:this.$autoResizeItem="true"==i,(i=e.attributes.renderOrder)&&(this.$childrenRenderOrder=t.ParseListChildrenRenderOrder(i),2==this.$childrenRenderOrder&&(i=e.attributes.apex)&&(this.$apexIndex=parseInt(i))),e.children.forEach(e=>{if("item"!=e.nodeName)return;let s=e.attributes.url;if(s||(s=this.$defaultItem),!s)return;let h=this.getFromPool(s);null!=h&&(this.addChild(h),(i=e.attributes.title)&&(h.text=i),(i=e.attributes.icon)&&(h.icon=i),(i=e.attributes.name)&&(h.name=i),(i=e.attributes.selectedIcon)&&h instanceof t.GButton&&(h.selectedIcon=i))},this)}setupAfterAdd(t){let e;super.setupAfterAdd(t),(e=t.attributes.selectionController)&&(this.$selectionController=this.parent.getController(e))}}i.$lastPosHelper=0,t.GList=i}(fgui||(fgui={})),function(t){!function(t){t.Recycler=class{constructor(){this.$count=0,this.$pool={}}get count(){return this.$count}clear(){for(let t in this.$pool){let e=this.$pool[t];e&&(e.length=0,e=null)}this.$pool={},this.$count=0}get(t){let e=this.$pool[t];return null==e&&(e=[],this.$pool[t]=e),e.length?(this.$count--,e.shift()):this.createObject(t)}recycle(t,e){if(!t)return;let i=this.$pool[t];null==i&&(i=[],this.$pool[t]=i),this.$count++,i.push(e)}}}(t.utils||(t.utils={}))}(fgui||(fgui={})),function(t){!function(e){e.GObjectRecycler=class extends e.Recycler{constructor(){super()}clear(){for(let t in this.$pool){let e=this.$pool[t];e&&e.forEach(t=>{t.dispose()})}super.clear()}createObject(e){return t.UIPackage.createObjectFromURL(e)}}}(t.utils||(t.utils={}))}(fgui||(fgui={})),function(t){class e extends t.GObject{constructor(){super(),this.$frame=0,this.$color=0,this.$contentSourceWidth=0,this.$contentSourceHeight=0,this.$contentWidth=0,this.$contentHeight=0,this.$loadingTexture=null,this.$playing=!0,this.$url="",this.$fill=0,this.$align="left",this.$verticalAlign=0,this.$showErrorSign=!0,this.$color=16777215}createDisplayObject(){this.$container=new t.UIContainer(this),this.$container.hitArea=new PIXI.Rectangle,this.setDisplayObject(this.$container),this.$container.interactiveChildren=!1}dispose(){this.clearContent(),super.dispose()}get url(){return this.$url}set url(t){this.$url!=t&&(this.$url=t,this.loadContent(),this.updateGear(7))}get icon(){return this.$url}set icon(t){this.url=t}get align(){return this.$align}set align(t){this.$align!=t&&(this.$align=t,this.updateLayout())}get verticalAlign(){return this.$verticalAlign}set verticalAlign(t){this.$verticalAlign!=t&&(this.$verticalAlign=t,this.updateLayout())}get fill(){return this.$fill}set fill(t){this.$fill!=t&&(this.$fill=t,this.updateLayout())}get autoSize(){return this.$autoSize}set autoSize(t){this.$autoSize!=t&&(this.$autoSize=t,this.updateLayout())}get playing(){return this.$playing}set playing(e){this.$playing!=e&&(this.$playing=e,this.$content instanceof t.MovieClip&&(this.$content.playing=e),this.updateGear(5))}get frame(){return this.$frame}set frame(e){this.$frame!=e&&(this.$frame=e,this.$content instanceof t.MovieClip&&(this.$content.currentFrame=e),this.updateGear(5))}get color(){return this.$color}set color(t){this.$color!=t&&(this.$color=t,this.updateGear(4),this.applyColor())}applyColor(){this.$content&&(this.$content.tint=this.$color)}get showErrorSign(){return this.$showErrorSign}set showErrorSign(t){this.$showErrorSign=t}get content(){return this.$content}get texture(){return this.$content instanceof t.UIImage?this.$content.texture:null}set texture(e){this.url=null,this.$content?this.$container.addChild(this.$content):(this.$content=new t.UIImage(null),this.$content.$initDisp(),this.$container.addChild(this.$content)),this.switchToMovieMode(!1),this.$content instanceof t.UIImage&&(this.$content.texture=e),e?(this.$contentSourceWidth=e.orig.width,this.$contentSourceHeight=e.orig.height):this.$contentSourceWidth=this.$contentHeight=0,this.updateLayout()}loadContent(){this.clearContent(),this.$url&&(t.utils.StringUtil.startsWith(this.$url,"ui://")?this.loadFromPackage(this.$url):this.loadExternal())}loadFromPackage(e){if(this.$contentItem=t.UIPackage.getItemByURL(e),this.$contentItem)if(this.$contentItem.load(),0==this.$contentItem.type)null==this.$contentItem.texture?this.setErrorState():(this.switchToMovieMode(!1),this.$content.$initDisp(this.$contentItem),this.$contentSourceWidth=this.$contentItem.width,this.$contentSourceHeight=this.$contentItem.height,this.updateLayout());else if(2==this.$contentItem.type){this.switchToMovieMode(!0),this.$contentSourceWidth=this.$contentItem.width,this.$contentSourceHeight=this.$contentItem.height;let t=this.$content;t.interval=this.$contentItem.interval,t.swing=this.$contentItem.swing,t.repeatDelay=this.$contentItem.repeatDelay,t.frames=this.$contentItem.frames,t.boundsRect=new PIXI.Rectangle(0,0,this.$contentSourceWidth,this.$contentSourceHeight),this.updateLayout()}else this.setErrorState();else this.setErrorState()}switchToMovieMode(e){this.$container.removeChildren(),e?this.$content instanceof t.MovieClip||(this.$content=new t.MovieClip(this)):this.$content instanceof t.UIImage||(this.$content=new t.UIImage(null)),this.$container.addChild(this.$content)}loadExternal(){this.$container.removeChildren(),this.$content&&this.$content instanceof t.UIImage?this.$container.addChild(this.$content):(this.$content=new t.UIImage(null),this.$content.$initDisp(),this.$container.addChild(this.$content)),this.$content.texture=PIXI.Texture.from(this.$url,{scaleMode:PIXI.SCALE_MODES.LINEAR}),this.$content.texture.once("update",()=>{this.$content.texture&&(this.$content.texture.frame=new PIXI.Rectangle(0,0,this.$content.texture.baseTexture.width,this.$content.texture.baseTexture.height),this.$contentSourceWidth=this.$content.texture.width,this.$contentSourceHeight=this.$content.texture.height,this.updateLayout())})}__loadExternal(){let t=PIXI.Texture.from(this.$url,{scaleMode:PIXI.SCALE_MODES.LINEAR});this.$loadingTexture=t,t.width>1&&t.height>1?this.$loadResCompleted(t):t.once("update",()=>{t.width&&t.height?this.$loadResCompleted(t):this.$loadResCompleted(null)})}freeExternal(t){PIXI.Texture.removeFromCache(t),t.destroy(null!=t.baseTexture)}$loadResCompleted(t){t?this.onExternalLoadSuccess(t):(this.onExternalLoadFailed(),this.$loadingTexture&&(this.$loadingTexture.removeAllListeners(),this.freeExternal(this.$loadingTexture)),this.$loadingTexture=null),this.$loadingTexture=null}onExternalLoadSuccess(e){this.$container.removeChildren(),this.$content&&this.$content instanceof t.UIImage?this.$container.addChild(this.$content):(this.$content=new t.UIImage(null),this.$content.$initDisp(),this.$container.addChild(this.$content)),e.frame=new PIXI.Rectangle(0,0,e.baseTexture.width,e.baseTexture.height),this.$content.texture=e,this.$contentSourceWidth=e.width,this.$contentSourceHeight=e.height,this.updateLayout()}onExternalLoadFailed(){this.setErrorState()}setErrorState(){this.$showErrorSign&&(null==this.$errorSign&&t.UIConfig.loaderErrorSign&&(this.$errorSign=e.$errorSignPool.get(t.UIConfig.loaderErrorSign)),this.$errorSign&&(this.$errorSign.width=this.width,this.$errorSign.height=this.height,this.$container.addChild(this.$errorSign.displayObject)))}clearErrorState(){this.$errorSign&&(this.$container.removeChild(this.$errorSign.displayObject),e.$errorSignPool.recycle(this.$errorSign.resourceURL,this.$errorSign),this.$errorSign=null)}updateLayout(){if(null!=this.$content)if(this.$content.position.set(0,0),this.$content.scale.set(1,1),this.$contentWidth=this.$contentSourceWidth,this.$contentHeight=this.$contentSourceHeight,this.$autoSize)this.$updatingLayout=!0,0==this.$contentWidth&&(this.$contentWidth=50),0==this.$contentHeight&&(this.$contentHeight=30),this.setSize(this.$contentWidth,this.$contentHeight),this.$updatingLayout=!1;else{let e=1,i=1;0!=this.$fill&&(e=this.width/this.$contentSourceWidth,i=this.height/this.$contentSourceHeight,1==e&&1==i||(2==this.$fill?e=i:3==this.$fill?i=e:1==this.$fill?e>i?e=i:i=e:5==this.$fill&&(e>i?i=e:e=i),this.$contentWidth=this.$contentSourceWidth*e,this.$contentHeight=this.$contentSourceHeight*i)),this.$content instanceof t.UIImage?(this.$content.width=this.$contentWidth,this.$content.height=this.$contentHeight):this.$content.scale.set(e,i),"center"==this.$align?this.$content.x=Math.floor((this.width-this.$contentWidth)/2):"right"==this.$align&&(this.$content.x=this.width-this.$contentWidth),1==this.$verticalAlign?this.$content.y=Math.floor((this.height-this.$contentHeight)/2):2==this.$verticalAlign&&(this.$content.y=this.height-this.$contentHeight)}else this.$autoSize&&(this.$updatingLayout=!0,this.setSize(50,30),this.$updatingLayout=!1)}clearContent(){this.clearErrorState(),this.$content&&this.$content.parent&&this.$container.removeChild(this.$content),null==this.$contentItem&&this.$content instanceof t.UIImage&&this.freeExternal(this.$content.texture),this.$content&&this.$content.destroy(),this.$content=null,this.$contentItem=null}handleSizeChanged(){this.$updatingLayout||this.updateLayout();let t=this.$container.hitArea;t.x=t.y=0,t.width=this.width,t.height=this.height}setupBeforeAdd(e){let i;super.setupBeforeAdd(e),(i=e.attributes.url)&&(this.$url=i),(i=e.attributes.align)&&(this.$align=t.ParseAlignType(i)),(i=e.attributes.vAlign)&&(this.$verticalAlign=t.ParseVertAlignType(i)),(i=e.attributes.fill)&&(this.$fill=t.ParseLoaderFillType(i)),this.$autoSize="true"==e.attributes.autoSize,(i=e.attributes.errorSign)&&(this.$showErrorSign="true"==i),this.$playing="false"!=e.attributes.playing,(i=e.attributes.color)&&(this.color=t.utils.StringUtil.convertFromHtmlColor(i)),this.$url&&this.loadContent()}}e.$errorSignPool=new t.utils.GObjectRecycler,t.GLoader=e}(fgui||(fgui={})),function(t){t.GMovieClip=class extends t.GObject{constructor(){super()}mapPivotWidth(t){return t*this.$sourceWidth}mapPivotHeight(t){return t*this.$sourceHeight}handleSizeChanged(){null!=this.$displayObject&&0!=this.$sourceWidth&&0!=this.$sourceHeight&&this.$displayObject.scale.set(this.$width/this.$sourceWidth*this.$scaleX,this.$height/this.$sourceHeight*this.$scaleY)}handleScaleChanged(){null!=this.$displayObject&&this.$displayObject.scale.set(this.$width/this.$sourceWidth*this.$scaleX,this.$height/this.$sourceHeight*this.$scaleY)}get touchable(){return!1}set touchable(t){this.$touchable=!1}get color(){return this.$movieClip.tint}set color(t){this.$movieClip.tint=t}createDisplayObject(){this.$movieClip=new t.MovieClip(this),this.setDisplayObject(this.$movieClip)}get playing(){return this.$movieClip.playing}set playing(t){this.$movieClip.playing!=t&&(this.$movieClip.playing=t,this.updateGear(5))}get frame(){return this.$movieClip.currentFrame}set frame(t){this.$movieClip.currentFrame!=t&&(this.$movieClip.currentFrame=t,this.updateGear(5))}setPlaySettings(...t){this.$movieClip.setPlaySettings.apply(this.$movieClip,t)}constructFromResource(){this.$sourceWidth=this.packageItem.width,this.$sourceHeight=this.packageItem.height,this.$initWidth=this.$sourceWidth,this.$initHeight=this.$sourceHeight,this.setSize(this.$sourceWidth,this.$sourceHeight),this.packageItem.load(),this.$movieClip.interval=this.packageItem.interval,this.$movieClip.swing=this.packageItem.swing,this.$movieClip.repeatDelay=this.packageItem.repeatDelay,this.$movieClip.frames=this.packageItem.frames,this.$movieClip.boundsRect=new PIXI.Rectangle(0,0,this.$sourceWidth,this.$sourceHeight)}setupBeforeAdd(e){let i;super.setupBeforeAdd(e),(i=e.attributes.frame)&&(this.$movieClip.currentFrame=parseInt(i)),i=e.attributes.playing,this.$movieClip.playing="false"!=i,(i=e.attributes.color)&&(this.color=t.utils.StringUtil.convertFromHtmlColor(i))}}}(fgui||(fgui={})),function(t){class e extends t.GComponent{constructor(){super(),this.$max=0,this.$value=0,this.$barMaxWidth=0,this.$barMaxHeight=0,this.$barMaxWidthDelta=0,this.$barMaxHeightDelta=0,this.$barStartX=0,this.$barStartY=0,this.$tweenValue=0,this.$titleType=0,this.$value=50,this.$max=100}get titleType(){return this.$titleType}set titleType(t){this.$titleType!=t&&(this.$titleType=t,this.update(this.$value))}get max(){return this.$max}set max(t){this.$max!=t&&(this.$max=t,this.update(this.$value))}get value(){return this.$value}set value(t){null!=this.$tweener&&(this.$tweener.pause(),this.$tweener=null),this.$value!=t&&(this.$value=t,this.update(this.$value))}tweenValue(i,s){return this.$value!=i?(this.$tweener&&(this.$tweener.stop(),TWEEN.remove(this.$tweener)),this.$tweenValue=this.$value,this.$value=i,this.$tweener=new TWEEN.Tween(this).onUpdate(t.utils.Binder.create(this.onUpdateTween,this)).to({$tweenValue:i},1e3*s).easing(e.easeLinear).start(),this.$tweener):null}onUpdateTween(){this.update(this.$tweenValue)}update(e){let i=0!=this.$max?Math.min(e/this.$max,1):0;if(this.$titleObject)switch(this.$titleType){case 0:this.$titleObject.text=`${Math.round(100*i)}%`;break;case 1:this.$titleObject.text=`${Math.round(e)}/${Math.round(this.$max)}`;break;case 2:this.$titleObject.text=`${Math.round(e)}`;break;case 3:this.$titleObject.text=`${Math.round(this.$max)}`}let s=this.width-this.$barMaxWidthDelta,h=this.height-this.$barMaxHeightDelta;this.$reverse?(this.$barObjectH&&(this.$barObjectH.width=s*i,this.$barObjectH.x=this.$barStartX+(s-this.$barObjectH.width)),this.$barObjectV&&(this.$barObjectV.height=h*i,this.$barObjectV.y=this.$barStartY+(h-this.$barObjectV.height))):(this.$barObjectH&&(this.$barObjectH.width=s*i),this.$barObjectV&&(this.$barObjectV.height=h*i)),this.$aniObject instanceof t.GMovieClip&&(this.$aniObject.frame=Math.round(100*i))}constructFromXML(e){let i;super.constructFromXML(e),(i=(e=e.getChildNodes("ProgressBar")[0]).attributes.titleType)&&(this.$titleType=t.ParseProgressTitleType(i)),this.$reverse="true"==e.attributes.reverse,this.$titleObject=this.getChild("title"),this.$barObjectH=this.getChild("bar"),this.$barObjectV=this.getChild("bar_v"),this.$aniObject=this.getChild("ani"),this.$barObjectH&&(this.$barMaxWidth=this.$barObjectH.width,this.$barMaxWidthDelta=this.width-this.$barMaxWidth,this.$barStartX=this.$barObjectH.x),this.$barObjectV&&(this.$barMaxHeight=this.$barObjectV.height,this.$barMaxHeightDelta=this.height-this.$barMaxHeight,this.$barStartY=this.$barObjectV.y)}handleSizeChanged(){super.handleSizeChanged(),this.$barObjectH&&(this.$barMaxWidth=this.width-this.$barMaxWidthDelta),this.$barObjectV&&(this.$barMaxHeight=this.height-this.$barMaxHeightDelta),this.$inProgressBuilding||this.update(this.$value)}setupAfterAdd(t){super.setupAfterAdd(t),(t=t.getChildNodes("ProgressBar")[0])&&(this.$value=parseInt(t.attributes.value)||0,this.$max=parseInt(t.attributes.max)||0),this.update(this.$value)}dispose(){this.$tweener&&this.$tweener.stop(),TWEEN.remove(this.$tweener),this.$tweener=null,super.dispose()}}e.easeLinear=t.ParseEaseType("linear"),t.GProgressBar=e}(fgui||(fgui={})),function(t){class e{constructor(){this.width=0,this.height=0,this.textHeight=0,this.y=0}static get(){if(e.pool.length){let t=e.pool.pop();return t.width=0,t.height=0,t.textHeight=0,t.text=null,t.y=0,t}return new e}static recycle(t){e.pool.push(t)}static recycleMany(t){t&&t.length&&t.forEach(t=>{e.pool.push(t)},this),t.length=0}}e.pool=[],t.LineInfo=e;class i extends t.GObject{constructor(){super(),this.$verticalAlign=0,this.$offset=new PIXI.Point,this.$singleLine=!0,this.$text="",this.$textWidth=0,this.$textHeight=0,this.$style=new PIXI.TextStyle({fontSize:12,fontFamily:t.UIConfig.defaultFont,align:"left",leading:3,fill:0}),this.$verticalAlign=0,this.$text="",this.$autoSize=1,this.$widthAutoSize=!0,this.$heightAutoSize=!0,this.$bitmapPool=[],this.touchable=!1}createDisplayObject(){this.$textField=new t.UITextField(this),this.setDisplayObject(this.$textField)}switchBitmapMode(e){e&&this.displayObject==this.$textField?(null==this.$btContainer&&(this.$btContainer=new t.UIContainer(this)),this.switchDisplayObject(this.$btContainer)):e||this.displayObject!=this.$btContainer||this.switchDisplayObject(this.$textField)}dispose(){t.GTimer.inst.remove(this.$render,this),this.$bitmapFont=null,this.$bitmapPool.length=0,this.$bitmapPool=null,this.$style=null,super.dispose()}set text(t){this.setText(t)}setText(t){null==t&&(t=""),this.$text!=t&&(this.$text=t,this.updateGear(6),this.parent&&this.parent.$inProgressBuilding?this.renderNow():this.render())}get text(){return this.getText()}getText(){return this.$text}set color(t){this.setColor(t)}get color(){return this.getColor()}set colors(t){this.setColor(t)}get colors(){return this.getColor()}getColor(){return this.$color}setColor(t){this.$color!=t&&(this.$color=t,this.updateGear(4),this.$style.fill=this.$color,this.render())}get titleColor(){return this.color}set titleColor(t){this.color=t}get lineHeight(){return this.$style.lineHeight>0?this.$style.lineHeight:this.$fontProperties?this.$fontProperties.fontSize+this.$style.strokeThickness+this.$style.leading:+this.$style.fontSize+this.$style.strokeThickness}set lineHeight(t){this.$style.lineHeight=t}get font(){return this.$font||t.UIConfig.defaultFont}set font(e){this.$font!=e&&(this.$font=e,this.$font&&t.utils.StringUtil.startsWith(this.$font,"ui://")?this.$bitmapFont=t.UIPackage.getBitmapFontByURL(this.$font):this.$style.fontFamily=this.$font||t.UIConfig.defaultFont,this.render())}get fontSize(){return+this.$style.fontSize}set fontSize(t){t<=0||this.$style.fontSize!=t&&(this.$style.fontSize=t,this.render())}get align(){return this.$style.align}set align(t){this.$style.align!=t&&(this.$style.align=t,this.render())}get verticalAlign(){return this.$verticalAlign}set verticalAlign(t){this.$verticalAlign!=t&&(this.$verticalAlign=t,this.$inProgressBuilding||this.layoutAlign())}get leading(){return this.$style.leading}set leading(t){this.$style.leading!=t&&(this.$style.leading=t,this.render())}get letterSpacing(){return this.$style.letterSpacing}set letterSpacing(t){this.$style.letterSpacing!=t&&(this.$style.letterSpacing=t,this.render())}get underline(){return!1}set underline(t){}get bold(){return"bold"==this.$style.fontWeight}set bold(t){let e=!0===t?"bold":"normal";this.$style.fontWeight!=e&&(this.$style.fontWeight=e,this.render())}get weight(){return this.$style.fontWeight}set weight(t){this.$style.fontWeight!=t&&(this.$style.fontWeight=t,this.render())}get variant(){return this.$style.fontVariant}set variant(t){this.$style.fontVariant!=t&&(this.$style.fontVariant=t,this.render())}get italic(){return"italic"==this.$style.fontStyle}set italic(t){let e=!0===t?"italic":"normal";this.$style.fontStyle!=e&&(this.$style.fontStyle=e,this.render())}get multipleLine(){return!this.$singleLine}set multipleLine(t){t=!t,this.$singleLine!=t&&(this.$singleLine=t,this.render())}get stroke(){return+this.$style.strokeThickness}set stroke(t){this.$style.strokeThickness!=t&&(this.$style.strokeThickness=t)}get strokeColor(){return this.$style.stroke}set strokeColor(t){this.$style.stroke!=t&&(this.$style.stroke=t)}set autoSize(t){this.$autoSize!=t&&(this.$autoSize=t,this.$widthAutoSize=1==t||3==t,this.$heightAutoSize=1==t||2==t,this.render())}get autoSize(){return this.$autoSize}get textWidth(){return this.$requireRender&&this.renderNow(),this.$textWidth}get textHeight(){return this.$requireRender&&this.renderNow(),this.$textHeight}set cacheAsBitmap(t){this.$cacheAsBitmap=t}get cacheAsBitmap(){return this.$cacheAsBitmap}ensureSizeCorrect(){this.$sizeDirty&&this.$requireRender&&this.renderNow()}render(){this.$requireRender||(this.$requireRender=!0,t.GTimer.inst.callLater(this.$render,this)),this.$sizeDirty||!this.$widthAutoSize&&!this.$heightAutoSize||(this.$sizeDirty=!0,this.emit(t.DisplayObjectEvent.SIZE_DELAY_CHANGE,this))}applyStyle(){this.$textField.style.stroke=this.$style.stroke,this.$textField.style.strokeThickness=this.$style.strokeThickness,this.$textField.style.fontStyle=this.$style.fontStyle,this.$textField.style.fontVariant=this.$style.fontVariant,this.$textField.style.fontWeight=this.$style.fontWeight,this.$textField.style.letterSpacing=this.$style.letterSpacing,this.$textField.style.align=this.$style.align,this.$textField.style.fontSize=this.$style.fontSize,this.$textField.style.fontFamily=this.$style.fontFamily,this.$textField.style.fill=this.$style.fill,this.$textField.style.leading=this.$style.leading}$render(){this.$requireRender&&this.renderNow()}renderNow(t=!0){if(this.$cacheAsBitmap&&(this.$textField.cacheAsBitmap=!1),this.$requireRender=!1,this.$sizeDirty=!1,null!=this.$bitmapFont)return void this.renderWithBitmapFont(t);this.switchBitmapMode(!1),this.applyStyle(),this.$textField.$updateMinHeight();let e=!this.$widthAutoSize&&this.multipleLine;this.$textField.width=this.$textField.style.wordWrapWidth=e||0==this.autoSize?Math.ceil(this.width):1e4,this.$textField.style.wordWrap=e,this.$textField.style.breakWords=e,this.$textField.text=this.$text,this.$fontProperties=PIXI.TextMetrics.measureFont(this.$style.toFontString()),this.$textWidth=Math.ceil(this.$textField.textWidth),this.$textWidth>0&&(this.$textWidth+=2*i.GUTTER_X),this.$textHeight=Math.ceil(this.$textField.textHeight),this.$textHeight>0&&(this.$textHeight+=2*i.GUTTER_Y);let s=this.width,h=this.height;3==this.autoSize?this.shrinkTextField():(this.$textField.scale.set(1,1),this.$widthAutoSize&&(s=this.$textWidth,this.$textField.width=s),this.$heightAutoSize?(h=this.$textHeight,this.$textField.height!=this.$textHeight&&(this.$textField.height=this.$textHeight)):(h=this.height,this.$textHeight>h&&(this.$textHeight=h))),t&&(this.$updatingSize=!0,this.setSize(s,h),this.$updatingSize=!1),this.layoutAlign(),this.$cacheAsBitmap&&(this.$textField.cacheAsBitmap=!0)}renderWithBitmapFont(s){this.switchBitmapMode(!0),this.$btContainer.children.forEach((t,e)=>{this.$bitmapPool.push(this.$btContainer.getChildAt(e))},this),this.$btContainer.removeChildren(),this.$lines?e.recycleMany(this.$lines):this.$lines=[];let h,n,r=this.letterSpacing,l=this.leading-1,a=this.width-2*i.GUTTER_X,o=0,$=0,c=0,u=0,d=0,g=0,p=0,f=0,m=0,w="",y=i.GUTTER_Y,b=!this.$widthAutoSize&&this.multipleLine,I=this.$bitmapFont.resizable?this.fontSize/this.$bitmapFont.size:1;this.$textWidth=0,this.$textHeight=0;let x=this.text.length;for(let i=0;i<x;++i){let s=this.$text.charAt(i),x=s.charCodeAt(i);if("\n"!=s)if(x>256||x<=32?(g>0&&(f=o),g=0):(0==g&&(p=o),g++)," "==s?(u=Math.ceil(this.fontSize/2),d=Math.ceil(this.fontSize)):(n=this.$bitmapFont.glyphs[s])?(u=Math.ceil(n.advance*I),d=Math.ceil(n.lineHeight*I)):" "==s?(u=Math.ceil(this.$bitmapFont.size*I/2),d=Math.ceil(this.$bitmapFont.size*I)):(u=0,d=0),d>c&&(c=d),d>$&&($=d),0!=o&&(o+=r),o+=u,!b||o<=a)w+=s;else{if((h=e.get()).height=$,h.textHeight=c,0==w.length)h.text=s;else if(g>0&&f>0){let e=(w+=s).length-g;h.text=t.utils.StringUtil.trimRight(w.substr(0,e)),h.width=f,w=w.substr(e+1),o-=p}else h.text=w,h.width=o-(u+r),w=s,o=u,$=d,c=d;h.y=y,y+=h.height+l,h.width>this.$textWidth&&(this.$textWidth=h.width),g=0,p=0,f=0,this.$lines.push(h)}else w+=s,(h=e.get()).width=o,0==c&&(0==m&&(m=Math.ceil(this.fontSize*I)),0==$&&($=m),c=$),h.height=$,m=$,h.textHeight=c,h.text=w,h.y=y,y+=h.height+l,h.width>this.$textWidth&&(this.$textWidth=h.width),this.$lines.push(h),w="",o=0,$=0,c=0,g=0,p=0,f=0}(w.length>0||this.$lines.length>0&&t.utils.StringUtil.endsWith(this.$lines[this.$lines.length-1].text,"\n"))&&((h=e.get()).width=o,0==$&&($=m),0==c&&(c=$),h.height=$,h.textHeight=c,h.text=w,h.y=y,h.width>this.$textWidth&&(this.$textWidth=h.width),this.$lines.push(h)),this.$textWidth>0&&(this.$textWidth+=2*i.GUTTER_X),0==this.$lines.length?this.$textHeight=0:(h=this.$lines[this.$lines.length-1],this.$textHeight=h.y+h.height+i.GUTTER_Y);let C,v=0;C=this.$widthAutoSize?0==this.$textWidth?0:this.$textWidth:this.width,v=this.$heightAutoSize?0==this.$textHeight?0:this.$textHeight:this.height,s&&(this.$updatingSize=!0,this.setSize(C,v),this.$updatingSize=!1),0!=C&&0!=v&&(a=this.width-2*i.GUTTER_X,this.$lines.forEach(t=>{let e=i.GUTTER_X,s=0,h=0;s="center"==this.align?(a-t.width)/2:"right"==this.align?a-t.width:0,x=t.text.length;for(let i=0;i<x;i++){let l=t.text.charAt(i);if(null!=(n=this.$bitmapFont.glyphs[l])){let i;h=(t.height+t.textHeight)/2-Math.ceil(n.lineHeight*I),(i=this.$bitmapPool.length?this.$bitmapPool.pop():new PIXI.Sprite).x=e+s+Math.ceil(n.offsetX*I),i.y=t.y+h+Math.ceil(n.offsetY*I),i.texture=n.texture,i.scale.set(I,I),i.tint=!0===this.$bitmapFont.colorable?this.$color:16777215,this.$btContainer.addChild(i),e+=r+Math.ceil(n.advance*I)}else e+=" "==l?r+Math.ceil(this.$bitmapFont.size*I/2):r}}))}localToGlobal(t=0,e=0,i){return t-=this.$offset.x,e-=this.$offset.y,super.localToGlobal(t,e,i)}globalToLocal(t=0,e=0,i){let s=super.globalToLocal(t,e,i);return s.x-=this.$offset.x,s.y-=this.$offset.y,s}handleSizeChanged(){this.$updatingSize||(null!=this.$bitmapFont?this.$widthAutoSize||this.render():this.$inProgressBuilding?(this.$textField.width=this.width,this.$textField.height=this.height):3==this.$autoSize?this.shrinkTextField():this.$widthAutoSize||(this.$heightAutoSize?this.$textField.width=this.width:(this.$textField.width=this.width,this.$textField.height=this.height)),this.layoutAlign())}shrinkTextField(){let t=Math.min(1,this.width/this.$textWidth);this.$textField.scale.set(t,t)}layoutAlign(){let t=this.$textWidth,e=this.$textHeight;if(3==this.autoSize&&(t*=this.displayObject.scale.x,e*=this.displayObject.scale.y),0==this.$verticalAlign||0==e)this.$offset.y=i.GUTTER_Y;else{let t=Math.max(0,this.height-e);1==this.$verticalAlign?this.$offset.y=.5*t:2==this.$verticalAlign&&(this.$offset.y=t)}let s=0;switch(this.$style.align){case"center":s=.5*(this.width-t);break;case"right":s=this.width-t}this.$offset.x=s,this.updatePosition()}updatePosition(){this.displayObject.position.set(Math.floor(this.x+this.$offset.x),Math.floor(this.y+this.$offset.y))}handleXYChanged(){super.handleXYChanged(),this.$displayObject&&this.updatePosition()}setupBeforeAdd(e){super.setupBeforeAdd(e);let i=e.attributes.font;i&&(this.font=i),(i=e.attributes.vAlign)&&(this.verticalAlign=t.ParseVertAlignType(i)),(i=e.attributes.leading)&&(this.$style.leading=parseInt(i)),(i=e.attributes.letterSpacing)&&(this.$style.letterSpacing=parseInt(i)),(i=e.attributes.fontSize)&&(this.$style.fontSize=parseInt(i)),(i=e.attributes.color)&&(this.color=t.utils.StringUtil.convertFromHtmlColor(i)),(i=e.attributes.align)&&(this.align=t.ParseAlignType(i)),(i=e.attributes.autoSize)&&(this.autoSize=t.ParseAutoSizeType(i),this.$widthAutoSize=1==this.$autoSize||3==this.$autoSize,this.$heightAutoSize=1==this.$autoSize||2==this.$autoSize),this.underline="true"==e.attributes.underline,this.italic="true"==e.attributes.italic,this.bold="true"==e.attributes.bold,this.multipleLine="true"!=e.attributes.singleLine,(i=e.attributes.strokeColor)&&(this.strokeColor=t.utils.StringUtil.convertFromHtmlColor(i),i=e.attributes.strokeSize,this.stroke=i?parseInt(i)+1:2)}setupAfterAdd(t){super.setupAfterAdd(t);let e=t.attributes.text;null!=e&&e.length>0&&(this.text=e),this.$sizeDirty=!1}}i.GUTTER_X=2,i.GUTTER_Y=2,t.GTextField=i}(fgui||(fgui={})),function(t){t.TextBlock=class{};t.GRichTextField=class extends t.GTextField{constructor(){super(),this.$textField.interactive=!0,this.$textField.interactiveChildren=!1,this.on(t.TextEvent.LinkClick,this.$clickLink,this)}set ubbEnabled(t){this.$ubbEnabled!=t&&(this.$ubbEnabled=t,this.render())}get ubbEnabled(){return this.$ubbEnabled}setupBeforeAdd(t){super.setupBeforeAdd(t),this.$ubbEnabled="true"==t.attributes.ubb}set textFlow(t){Object.assign(this.$style,t.style),this.$textFlow=t,this.text=t.text,this.render()}set text(t){this.$text=t,null==this.$text&&(this.$text=""),this.$textField.width=this.width,this.updateGear(6),this.render()}$clickLink(e){this.emit(t.TextEvent.LinkClick,e.text,this)}dispose(){this.off(t.TextEvent.LinkClick,this.$clickLink,this),super.dispose()}}}(fgui||(fgui={})),function(t){class e{constructor(){this.touchDown=!1,this.mouseX=0,this.mouseY=0}}t.GRootMouseStatus=e;class i extends t.GComponent{constructor(){super(),null==i.$inst&&(i.$inst=this),this.opaque=!1,this.$popupStack=[],this.$justClosedPopups=[],this.$uid=i.uniqueID++,t.utils.DOMEventManager.inst.on(t.DisplayObjectEvent.MOUSE_WHEEL,this.dispatchMouseWheel,this)}static get inst(){return null==i.$inst&&new i,i.$inst}static get globalMouseStatus(){return i.$gmStatus}attachTo(e,i){t.GTimer.inst.setTicker(PIXI.Ticker.shared),this.$uiStage&&(this.$uiStage.off(t.DisplayObjectEvent.SIZE_CHANGED,this.$winResize,this),this.$uiStage.nativeStage.off(t.InteractiveEvents.Down,this.$stageDown,this),this.$uiStage.nativeStage.off(t.InteractiveEvents.Up,this.$stageUp,this),this.$uiStage.nativeStage.off(t.InteractiveEvents.Move,this.$stageMove,this),this.$uiStage.nativeStage.removeChild(this.$displayObject),this.$uiStage.dispose()),this.$uiStage=new t.UIStage(e,i),this.$uiStage.nativeStage.on(t.InteractiveEvents.Down,this.$stageDown,this),this.$uiStage.nativeStage.on(t.InteractiveEvents.Up,this.$stageUp,this),this.$uiStage.nativeStage.on(t.InteractiveEvents.Move,this.$stageMove,this),this.$uiStage.nativeStage.addChild(this.$displayObject),this.$modalLayer||(this.$modalLayer=new t.GGraph,this.$modalLayer.setSize(this.width,this.height),this.$modalLayer.drawRect(0,0,0,t.UIConfig.modalLayerColor,t.UIConfig.modalLayerAlpha),this.$modalLayer.addRelation(this,24))}get uniqueID(){return this.$uid}get stageWidth(){return this.$uiStage.stageWidth}get stageHeight(){return this.$uiStage.stageHeight}get contentScaleFactor(){return this.$uiStage.resolution}get applicationContext(){return this.$uiStage.applicationContext}get nativeStage(){return this.$uiStage.nativeStage}get orientation(){return this.$uiStage.orientation}get stageWrapper(){return this.$uiStage}dispatchMouseWheel(e){let s=this.getObjectUnderPoint(i.globalMouseStatus.mouseX,i.globalMouseStatus.mouseY);if(null!=s)for(;s.parent&&s.parent!=this;)s.emit(t.DisplayObjectEvent.MOUSE_WHEEL,e),s=s.parent}getObjectUnderPoint(e,s){i.sHelperPoint.set(e,s);let h=this.$uiStage.applicationContext.renderer.plugins.interaction.hitTest(i.sHelperPoint,this.nativeStage);return t.GObject.castFromNativeObject(h)}showWindow(t){this.addChild(t),t.requestFocus(),t.x>this.width?t.x=this.width-t.width:t.x+t.width<0&&(t.x=0),t.y>this.height?t.y=this.height-t.height:t.y+t.height<0&&(t.y=0),this.adjustModalLayer()}hideWindow(t){t.hide()}hideWindowImmediately(t){t.parent==this&&this.removeChild(t),this.adjustModalLayer()}bringToFront(e){let i;for(i=null==this.$modalLayer.parent||e.modal?this.numChildren-1:this.getChildIndex(this.$modalLayer)-1;i>=0;i--){let s=this.getChildAt(i);if(s==e)return;if(s instanceof t.Window)break}i>=0&&this.setChildIndex(e,i)}showModalWait(e=null){null!=t.UIConfig.globalModalWaiting&&(null==this.$modalWaitPane&&(this.$modalWaitPane=t.UIPackage.createObjectFromURL(t.UIConfig.globalModalWaiting),this.$modalWaitPane.addRelation(this,24)),this.$modalWaitPane.setSize(this.width,this.height),this.addChild(this.$modalWaitPane),this.$modalWaitPane.text=e)}closeModalWait(){null!=this.$modalWaitPane&&null!=this.$modalWaitPane.parent&&this.removeChild(this.$modalWaitPane)}closeAllExceptModals(){this.$children.slice().forEach(e=>{e instanceof t.Window&&!e.modal&&e.hide()},this)}closeAllWindows(){this.$children.slice().forEach(e=>{e instanceof t.Window&&e.hide()},this)}getTopWindow(){for(let e=this.numChildren-1;e>=0;e--){let i=this.getChildAt(e);if(i instanceof t.Window)return i}return null}get hasModalWindow(){return null!=this.$modalLayer.parent}get modalWaiting(){return this.$modalWaitPane&&this.$modalWaitPane.inContainer}showPopup(t,e=null,s=0){if(this.$popupStack.length>0){let e=this.$popupStack.indexOf(t);if(-1!=e)for(let t=this.$popupStack.length-1;t>=e;t--)this.removeChild(this.$popupStack.pop())}let h;this.$popupStack.push(t),this.addChild(t),this.adjustModalLayer();let n,r,l=0,a=0;e?(h=e.localToRoot(),l=e.width,a=e.height):h=this.globalToLocal(i.$gmStatus.mouseX,i.$gmStatus.mouseY),(n=h.x)+t.width>this.width&&(n=n+l-t.width),r=h.y+a,(0==s&&r+t.height>this.height||2==s)&&(r=h.y-t.height-1)<0&&(r=0,n+=.5*l),t.x=n,t.y=r}togglePopup(t,e=null,i){-1==this.$justClosedPopups.indexOf(t)&&this.showPopup(t,e,i)}hidePopup(t=null){let e;if(null!=t){let i=this.$popupStack.indexOf(t);if(-1!=i)for(e=this.$popupStack.length-1;e>=i;e--)this.closePopup(this.$popupStack.pop())}else{for(e=this.$popupStack.length-1;e>=0;e--)this.closePopup(this.$popupStack[e]);this.$popupStack.length=0}}get hasAnyPopup(){return 0!=this.$popupStack.length}closePopup(e){null!=e.parent&&(e instanceof t.Window?e.hide():this.removeChild(e))}showTooltips(e){if(null==this.$defaultTooltipWin){let e=t.UIConfig.tooltipsWin;if(!e)return void console.error("UIConfig.tooltipsWin not defined");this.$defaultTooltipWin=t.UIPackage.createObjectFromURL(e)}this.$defaultTooltipWin.text=e,this.showTooltipsWin(this.$defaultTooltipWin)}showTooltipsWin(t,e=null){this.hideTooltips(),this.$tooltipWin=t;let s=0,h=0;null==e?(s=i.$gmStatus.mouseX+10,h=i.$gmStatus.mouseY+20):(s=e.x,h=e.y);let n=this.globalToLocal(s,h);s=n.x,h=n.y,s+this.$tooltipWin.width>this.width&&(s=s-this.$tooltipWin.width-1)<0&&(s=10),h+this.$tooltipWin.height>this.height&&(h=h-this.$tooltipWin.height-1,s-this.$tooltipWin.width-1>0&&(s=s-this.$tooltipWin.width-1),h<0&&(h=10)),this.$tooltipWin.x=s,this.$tooltipWin.y=h,this.addChild(this.$tooltipWin)}hideTooltips(){null!=this.$tooltipWin&&(this.$tooltipWin.parent&&this.removeChild(this.$tooltipWin),this.$tooltipWin=null)}get focus(){return this.$focusedObject&&!this.$focusedObject.onStage&&(this.$focusedObject=null),this.$focusedObject}set focus(t){if(t&&(!t.focusable||!t.onStage))throw new Error("Invalid target to focus");this.setFocus(t)}setFocus(e){this.$focusedObject!=e&&(this.$focusedObject=e,this.emit(t.FocusEvent.CHANGED,this))}adjustModalLayer(){let e=this.numChildren;null!=this.$modalWaitPane&&null!=this.$modalWaitPane.parent&&this.setChildIndex(this.$modalWaitPane,e-1);for(let i=e-1;i>=0;i--){let e=this.getChildAt(i);if(e instanceof t.Window&&e.modal)return void(null==this.$modalLayer.parent?this.addChildAt(this.$modalLayer,i):this.setChildIndexBefore(this.$modalLayer,i))}null!=this.$modalLayer.parent&&this.removeChild(this.$modalLayer)}$stageDown(e){i.$gmStatus.mouseX=e.data.global.x,i.$gmStatus.mouseY=e.data.global.y,i.$gmStatus.touchDown=!0;let s=e.target;for(;s&&s!=this.nativeStage;){if(t.isUIObject(s)){let t=s.UIOwner;if(t.touchable&&t.focusable){this.setFocus(t);break}}s=s.parent}null!=this.$tooltipWin&&this.hideTooltips(),this.checkPopups(e.target)}checkPopups(e){if(!this.$checkingPopups&&(this.$checkingPopups=!0,this.$justClosedPopups.length=0,this.$popupStack.length>0)){let i,s=e;for(;s&&s!=this.nativeStage;){if(t.isUIObject(s)){let t=this.$popupStack.indexOf(s.UIOwner);if(-1!=t){let e;for(let i=this.$popupStack.length-1;i>t;i--)e=this.$popupStack.pop(),this.closePopup(e),this.$justClosedPopups.push(e);return}}s=s.parent}for(let t=this.$popupStack.length-1;t>=0;t--)i=this.$popupStack[t],this.closePopup(i),this.$justClosedPopups.push(i);this.$popupStack.length=0}}$stageMove(t){i.$gmStatus.mouseX=t.data.global.x,i.$gmStatus.mouseY=t.data.global.y}$stageUp(t){i.$gmStatus.touchDown=!1,this.$checkingPopups=!1}$winResize(t){this.setSize(t.stageWidth,t.stageHeight)}}i.uniqueID=0,i.$gmStatus=new e,t.GRoot=i}(fgui||(fgui={})),function(t){class e extends t.GComponent{constructor(){super(),this.$dragOffset=new PIXI.Point,this.$scrollPerc=0}setScrollPane(t,e){this.$target=t,this.$vertical=e}set displayPerc(t){this.$vertical?(this.$fixedGripSize||(this.$grip.height=t*this.$bar.height),this.$grip.y=this.$bar.y+(this.$bar.height-this.$grip.height)*this.$scrollPerc):(this.$fixedGripSize||(this.$grip.width=t*this.$bar.width),this.$grip.x=this.$bar.x+(this.$bar.width-this.$grip.width)*this.$scrollPerc)}get scrollPerc(){return this.$scrollPerc}set scrollPerc(t){this.$scrollPerc=t,this.$vertical?this.$grip.y=this.$bar.y+(this.$bar.height-this.$grip.height)*this.$scrollPerc:this.$grip.x=this.$bar.x+(this.$bar.width-this.$grip.width)*this.$scrollPerc}get minSize(){return this.$vertical?(null!=this.$arrowButton1?this.$arrowButton1.height:0)+(null!=this.$arrowButton2?this.$arrowButton2.height:0):(null!=this.$arrowButton1?this.$arrowButton1.width:0)+(null!=this.$arrowButton2?this.$arrowButton2.width:0)}constructFromXML(e){super.constructFromXML(e),null!=(e=e.getChildNodes("ScrollBar")[0])&&(this.$fixedGripSize="true"==e.attributes.fixedGripSize),this.$grip=this.getChild("grip"),this.$grip?(this.$bar=this.getChild("bar"),this.$bar?(this.$arrowButton1=this.getChild("arrow1"),this.$arrowButton2=this.getChild("arrow2"),this.$grip.on(t.InteractiveEvents.Down,this.$gripMouseDown,this),this.$arrowButton1&&this.$arrowButton1.on(t.InteractiveEvents.Down,this.$arrowButton1Click,this),this.$arrowButton2&&this.$arrowButton2.on(t.InteractiveEvents.Down,this.$arrowButton2Click,this),this.on(t.InteractiveEvents.Down,this.$barMouseDown,this)):console.error("please create and define 'bar' in the Editor for the scrollbar")):console.error("please create and define 'grip' in the Editor for the scrollbar")}$gripMouseDown(e){if(!this.$bar)return;e.stopPropagation(),this.$dragOffset=e.data.getLocalPosition(this.displayObject,this.$dragOffset),this.$dragOffset.x-=this.$grip.x,this.$dragOffset.y-=this.$grip.y;let i=t.GRoot.inst.nativeStage;i.on(t.InteractiveEvents.Move,this.$gripDragging,this),i.on(t.InteractiveEvents.Up,this.$gripDraggingEnd,this)}$gripDragging(t){let i=t.data.getLocalPosition(this.displayObject,e.sScrollbarHelperPoint);if(this.$vertical){let t=i.y-this.$dragOffset.y;this.$target.setPercY((t-this.$bar.y)/(this.$bar.height-this.$grip.height),!1)}else{let t=i.x-this.$dragOffset.x;this.$target.setPercX((t-this.$bar.x)/(this.$bar.width-this.$grip.width),!1)}}$gripDraggingEnd(e){let i=t.GRoot.inst.nativeStage;i.off(t.InteractiveEvents.Move,this.$gripDragging,this),i.off(t.InteractiveEvents.Up,this.$gripDraggingEnd,this)}$arrowButton1Click(t){t.stopPropagation(),this.$vertical?this.$target.scrollUp():this.$target.scrollLeft()}$arrowButton2Click(t){t.stopPropagation(),this.$vertical?this.$target.scrollDown():this.$target.scrollRight()}$barMouseDown(t){let i=t.data.getLocalPosition(this.$grip.displayObject,e.sScrollbarHelperPoint);this.$vertical?i.y<0?this.$target.scrollUp(4):this.$target.scrollDown(4):i.x<0?this.$target.scrollLeft(4):this.$target.scrollRight(4)}dispose(){this.off(t.InteractiveEvents.Down,this.$barMouseDown,this),this.$arrowButton1&&this.$arrowButton1.off(t.InteractiveEvents.Down,this.$arrowButton1Click,this),this.$arrowButton2&&this.$arrowButton2.off(t.InteractiveEvents.Down,this.$arrowButton2Click,this),this.$grip.off(t.InteractiveEvents.Down,this.$gripMouseDown,this),this.$gripDraggingEnd(null),super.dispose()}}e.sScrollbarHelperPoint=new PIXI.Point,t.GScrollBar=e}(fgui||(fgui={})),function(t){class e extends t.GComponent{constructor(){super(),this.$max=0,this.$value=0,this.$barMaxWidth=0,this.$barMaxHeight=0,this.$barMaxWidthDelta=0,this.$barMaxHeightDelta=0,this.$titleType=0,this.$value=50,this.$max=100,this.$clickPos=new PIXI.Point}get titleType(){return this.$titleType}set titleType(t){this.$titleType=t}get max(){return this.$max}set max(t){this.$max!=t&&(this.$max=t,this.update())}get value(){return this.$value}set value(t){this.$value!=t&&(this.$value=t,this.update())}update(){let t=Math.min(this.$value/this.$max,1);this.updateWidthPercent(t)}updateWidthPercent(e){if(this.$titleObject)switch(this.$titleType){case 0:this.$titleObject.text=`${Math.round(100*e)}%`;break;case 1:this.$titleObject.text=`${this.$value}/${this.$max}`;break;case 2:this.$titleObject.text=`${this.$value}`;break;case 3:this.$titleObject.text=`${this.$max}`}this.$barObjectH&&(this.$barObjectH.width=(this.width-this.$barMaxWidthDelta)*e),this.$barObjectV&&(this.$barObjectV.height=(this.height-this.$barMaxHeightDelta)*e),this.$aniObject instanceof t.GMovieClip&&(this.$aniObject.frame=Math.round(100*e))}handleSizeChanged(){super.handleSizeChanged(),this.$barObjectH&&(this.$barMaxWidth=this.width-this.$barMaxWidthDelta),this.$barObjectV&&(this.$barMaxHeight=this.height-this.$barMaxHeightDelta),this.$inProgressBuilding||this.update()}setupAfterAdd(t){super.setupAfterAdd(t),(t=t.getChildNodes("Slider")[0])&&(this.$value=parseInt(t.attributes.value),this.$max=parseInt(t.attributes.max)),this.update()}constructFromXML(e){let i;super.constructFromXML(e),(e=e.getChildNodes("Slider")[0])&&(i=e.attributes.titleType)&&(this.$titleType=t.ParseProgressTitleType(i)),this.$titleObject=this.getChild("title"),this.$barObjectH=this.getChild("bar"),this.$barObjectV=this.getChild("bar_v"),this.$aniObject=this.getChild("ani"),this.$gripObject=this.getChild("grip"),this.$barObjectH&&(this.$barMaxWidth=this.$barObjectH.width,this.$barMaxWidthDelta=this.width-this.$barMaxWidth),this.$barObjectV&&(this.$barMaxHeight=this.$barObjectV.height,this.$barMaxHeightDelta=this.height-this.$barMaxHeight),this.$gripObject&&this.$gripObject.on(t.InteractiveEvents.Down,this.$gripMouseDown,this)}$gripMouseDown(e){this.$clickPos=this.globalToLocal(e.data.global.x,e.data.global.y),this.$clickPercent=this.$value/this.$max,t.GRoot.inst.nativeStage.on(t.InteractiveEvents.Move,this.$gripMouseMove,this),t.GRoot.inst.nativeStage.on(t.InteractiveEvents.Up,this.$gripMouseUp,this)}$gripMouseMove(i){let s,h=this.globalToLocal(i.data.global.x,i.data.global.y,e.sSilderHelperPoint),n=h.x-this.$clickPos.x,r=h.y-this.$clickPos.y;(s=this.$barObjectH?this.$clickPercent+n/this.$barMaxWidth:this.$clickPercent+r/this.$barMaxHeight)>1?s=1:s<0&&(s=0);let l=Math.round(this.$max*s);l!=this.$value&&(this.$value=l,this.emit(t.StateChangeEvent.CHANGED,this)),this.updateWidthPercent(s)}$gripMouseUp(e){let i=this.$value/this.$max;this.updateWidthPercent(i),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Move,this.$gripMouseMove,this),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Up,this.$gripMouseUp,this)}dispose(){this.$gripObject&&this.$gripObject.off(t.InteractiveEvents.Down,this.$gripMouseDown,this),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Move,this.$gripMouseMove,this),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Up,this.$gripMouseUp,this),super.dispose()}}e.sSilderHelperPoint=new PIXI.Point,t.GSlider=e}(fgui||(fgui={})),function(t){!function(e){e.InputDelegate=class{constructor(e){this.$inited=!1,this.$restrictString=null,this.$restrictRegex=null,this.$focused=!1,this.$textField=e,this.$input=new t.InputElement(e)}initialize(){this.$inited||(this.$input.$addToStage(),this.$input.on("updateText",this.updateText,this),this.$input.on(t.FocusEvent.CHANGED,this.focusHandler,this),this.$textField.on(t.InteractiveEvents.Down,this.textFieldDownHandler,this),this.$inited=!0)}textFieldDownHandler(){this.$onFocus()}destroy(){this.$inited&&(this.$input.$removeFromStage(),this.$textField.off(t.InteractiveEvents.Down,this.textFieldDownHandler,this),t.GRoot.inst.off(t.InteractiveEvents.Down,this.onStageDown,this),this.$input.off("updateText",this.updateText,this),this.$input.off(t.FocusEvent.CHANGED,this.focusHandler,this),this.$inited=!1)}get text(){return this.$input.text}set text(t){this.$input.text=t}setColor(t){return this.$input.setColor(t)}updateText(){let e=this.$input.text,i=!1;if(null!=this.$restrictRegex){let t=e.match(this.$restrictRegex);e=t?t.join(""):"",i=!0}i&&this.$input.text!=e&&(this.$input.text=e),this.$textField.text=this.$input.text,this.$textField.emit(t.TextEvent.Change,this.$textField)}onStageDown(e){t.GObject.castFromNativeObject(e.currentTarget)!=this.$textField&&this.$input.$hide()}focusHandler(e){"focus"==e?this.$focused||(this.$focused=!0,this.$textField.$isTyping=!0,this.$textField.alpha=0,this.$textField.emit(t.FocusEvent.CHANGED,"focus",this.$textField),this.$textField.emit(t.TextEvent.FocusIn,this.$textField)):"blur"==e&&this.$focused&&(this.$focused=!1,t.GRoot.inst.off(t.InteractiveEvents.Down,this.onStageDown,this),this.$textField.$isTyping=!1,this.$textField.alpha=1,this.$input.$onBlur(),this.$textField.emit(t.FocusEvent.CHANGED,"blur",this.$textField),this.$textField.emit(t.TextEvent.FocusOut,this.$textField))}get isFocused(){return this.$focused}$getProperty(t){return this.$inited&&this.$input.getAttribute(t)||null}$setProperty(t,e){this.$inited&&this.$input.setAttribute(t,e)}get $restrict(){return this.$restrictString}set $restrict(t){this.$restrictString=t,null!=this.$restrictString&&this.$restrictString.length>0?this.$restrictRegex=new RegExp(this.$restrictString):this.$restrictRegex=null}get type(){return this.$type}set type(t){t!=this.$type&&(this.$type=t)}tryHideInput(){!this.$textField.visible&&this.$input&&this.$input.$removeFromStage()}$updateProperties(){if(this.isFocused)return this.$input.resetInput(),void this.tryHideInput();this.$input.text=this.$textField.text,this.$input.resetInput(),this.tryHideInput()}$onFocus(){this.$textField.visible&&!this.$focused&&(t.GRoot.inst.off(t.InteractiveEvents.Down,this.onStageDown,this),t.GTimer.inst.callLater(()=>{t.GRoot.inst.on(t.InteractiveEvents.Down,this.onStageDown,this)},this),this.$input.$show())}}}(t.utils||(t.utils={}))}(fgui||(fgui={})),function(t){t.GTextInput=class extends t.GTextField{constructor(){super(),this.$util=null,this.$isTyping=!1,this.focusable=!0,this.editable=!0,this.type="text",this.on("removed",this.removed,this),this.on("added",this.added,this),this.$util.initialize()}createDisplayObject(){super.createDisplayObject(),this.$displayObject.hitArea=new PIXI.Rectangle}handleSizeChanged(){super.handleSizeChanged();let t=this.$displayObject.hitArea;t.x=t.y=0,t.width=this.width,t.height=this.height}removed(t){this.$util&&this.$util.destroy()}added(t){this.$util&&this.$util.initialize()}requestFocus(){this.root.focus=this,this.$util.$onFocus()}get editable(){return this.$editable}set editable(e){e!=this.$editable&&(this.$editable=e,this.$editable?(this.$util||(this.$util=new t.utils.InputDelegate(this)),this.$util.initialize()):this.$util&&this.$util.destroy(),this.touchable=this.$editable)}changeToPassText(t){let e="";for(let i=0,s=t.length;i<s;i++)switch(t.charAt(i)){case"\n":e+="\n";break;case"\r":break;default:e+="*"}return e}getText(){return this.$util.text}setText(t){null==t&&(t=""),this.$text!=t&&(this.$util.text=t,super.setText(t))}setColor(t){super.setColor(t),this.$util.setColor(t)}get promptText(){return this.$util.$getProperty("placeholder")}set promptText(t){null==t&&(t=""),this.$util.$setProperty("placeholder",t)}get maxLength(){return parseInt(this.$util.$getProperty("maxlength"))||0}set maxLength(t){this.$util.$setProperty("maxlength",String(t))}get restrict(){return this.$util.$restrict}set restrict(t){this.$util.$restrict=t}get password(){return"password"==this.type}set password(t){this.type="password"}get type(){return this.$util.type}set type(t){this.$util.type=t}dispose(){super.dispose(),this.off("removed",this.removed,this),this.off("added",this.added,this),this.$util.destroy(),this.$util=null}renderNow(t=!0){this.$requireRender=!1,this.$sizeDirty=!1,this.$util.$updateProperties(),this.$isTyping&&this.decorateInputbox();let e=this.$text;"password"==this.type&&(this.$text=this.changeToPassText(this.$text)),super.renderNow(t),this.$text=e}decorateInputbox(){}setupBeforeAdd(t){super.setupBeforeAdd(t);var e=t.attributes.maxLength;null!=e&&(this.maxLength=parseInt(e)),null!=(e=t.attributes.restrict)&&(this.restrict=e),"true"==(e=t.attributes.password)?this.password=!0:"4"==(e=t.attributes.keyboardType)?this.type="number":"3"==e?this.type="url":"5"==e?this.type="tel":"6"==e&&(this.type="email")}}}(fgui||(fgui={})),function(t){class e{constructor(){this.$enumIdx=0,this.$enumCount=0,this.$curTime=Date.now(),this.$startedTime=0,this.$items=[],this.$itemPool=[],TWEEN.setupNow&&TWEEN.setupNow(()=>this.$startedTime)}getItem(){return this.$itemPool.length?this.$itemPool.pop():new i}findItem(t,e){let i=this.$items.length;for(let s=0;s<i;s++){let i=this.$items[s];if(i.callback==t&&i.thisObj==e)return i}return null}add(t,e,i,s,h){let n=this.findItem(i,s);n||((n=this.getItem()).callback=i,n.thisObj=s,this.$items.push(n)),n.delay=t,n.counter=0,n.repeat=e,n.param=h,n.end=!1}addLoop(t,e,i,s){this.add(t,0,e,i,s)}callLater(t,e,i){this.add(1,1,t,e,i)}callDelay(t,e,i,s){this.add(t,1,e,i,s)}exists(t,e){return null!=this.findItem(t,e)}remove(t,e){let i=this.findItem(t,e);if(i){let t=this.$items.indexOf(i);this.$items.splice(t,1),t<this.$enumIdx&&this.$enumIdx--,this.$enumCount--,i.callback=null,i.param=null,this.$itemPool.push(i)}}get ticker(){return this.$ticker}get curTime(){return this.$curTime}advance(){for(this.$enumIdx=0,this.$enumCount=this.$items.length;this.$enumIdx<this.$enumCount;){let t=this.$items[this.$enumIdx];this.$enumIdx++;let e=this.$ticker.deltaTime/PIXI.settings.TARGET_FPMS;if(this.$curTime+=e,t.advance(e)){if(t.end&&(this.$enumIdx--,this.$enumCount--,this.$items.splice(this.$enumIdx,1),this.$itemPool.push(t)),t.callback){let i=[e];t.param&&t.param instanceof Array?i=t.param.concat(i):void 0!==t.param&&i.unshift(t.param),t.callback.apply(t.thisObj,i)}t.end&&(t.callback=t.thisObj=t.param=null)}}}tickTween(){this.$startedTime+=this.$ticker.deltaTime/PIXI.settings.TARGET_FPMS,TWEEN.update(this.$startedTime,!this.$ticker.started)}setTicker(t){this.$ticker&&(this.$ticker.remove(this.advance),this.$ticker.remove(this.tickTween)),this.$ticker=t,this.$ticker.add(this.advance,this,PIXI.UPDATE_PRIORITY.NORMAL),this.$ticker.add(this.tickTween,this,PIXI.UPDATE_PRIORITY.HIGH),this.$ticker.started||this.$ticker.start()}}e.inst=new e,t.GTimer=e;class i{constructor(){this.delay=0,this.counter=0,this.repeat=0}advance(t=0){return this.counter+=t,this.counter>=this.delay&&(this.counter-=this.delay,this.counter>this.delay&&(this.counter=this.delay),this.repeat>0&&(this.repeat--,0==this.repeat&&(this.end=!0)),!0)}}}(fgui||(fgui={})),function(t){class e{constructor(e){this.$lockToken=0,this.$owner=e,this.$easeType=t.ParseEaseType("Quad.Out"),this.$tweenTime=.3,this.$tweenDelay=0}get controller(){return this.$controller}set controller(t){t!=this.$controller&&(this.$controller=t,this.$controller&&this.init())}get tween(){return this.$tween}set tween(t){this.$tween=t}get tweenDelay(){return this.$tweenDelay}set tweenDelay(t){this.$tweenDelay=t}get tweenTime(){return this.$tweenTime}set tweenTime(t){this.$tweenTime=t}get easeType(){return this.$easeType}set easeType(t){this.$easeType=t}setup(e){if(this.$controller=this.$owner.parent.getController(e.attributes.controller),null==this.$controller)return;let i;if(this.init(),(i=e.attributes.tween)&&(this.$tween=!0),(i=e.attributes.ease)&&(this.$easeType=t.ParseEaseType(i)),(i=e.attributes.duration)&&(this.$tweenTime=parseFloat(i)),(i=e.attributes.delay)&&(this.$tweenDelay=parseFloat(i)),this instanceof t.GearDisplay)(i=e.attributes.pages)&&(this.pages=i.split(","));else{let t,s;(i=e.attributes.pages)&&(t=i.split(",")),(i=e.attributes.values)&&(s=i.split("|")),t&&s&&s.forEach((e,i)=>{this.addStatus(t[i],e)}),(i=e.attributes.default)&&this.addStatus(null,i)}}updateFromRelations(t,e){}addStatus(t,e){}init(){}apply(){}updateState(){}}e.disableAllTweenEffect=!1,t.GearBase=e}(fgui||(fgui={})),function(t){t.GearAnimation=class extends t.GearBase{constructor(t){super(t)}init(){this.$default=new e(this.$owner.playing,this.$owner.frame),this.$storage={}}addStatus(t,i){if("-"==i)return;let s;null==t?s=this.$default:(s=new e,this.$storage[t]=s);let h=i.split(",");s.frame=parseInt(h[0]),s.playing="p"==h[1]}apply(){this.$owner.$gearLocked=!0;let t=this.$storage[this.$controller.selectedPageId];t||(t=this.$default),this.$owner.frame=t.frame,this.$owner.playing=t.playing,this.$owner.$gearLocked=!1}updateState(){if(null==this.$controller||this.$owner.$gearLocked||this.$owner.$inProgressBuilding)return;let t=this.$storage[this.$controller.selectedPageId];t||(t=new e,this.$storage[this.$controller.selectedPageId]=t),t.frame=this.$owner.frame,t.playing=this.$owner.playing}};class e{constructor(t=!0,e=0){this.playing=t,this.frame=e}}}(fgui||(fgui={})),function(t){t.GearColor=class extends t.GearBase{constructor(t){super(t),this.$default=0}init(){"color"in this.$owner?this.$default=this.$owner.color:"titleColor"in this.$owner&&(this.$default=this.$owner.titleColor),this.$storage={}}addStatus(e,i){if("-"==i)return;let s=t.utils.StringUtil.convertFromHtmlColor(i);null==e?this.$default=s:this.$storage[e]=s}apply(){this.$owner.$gearLocked=!0;let t=this.$storage[this.$controller.selectedPageId],e=null!=t?Math.floor(t):Math.floor(this.$default);"color"in this.$owner?this.$owner.color=e:"titleColor"in this.$owner&&(this.$owner.titleColor=e),this.$owner.$gearLocked=!1}updateState(){null==this.$controller||this.$owner.$gearLocked||this.$owner.$inProgressBuilding||("color"in this.$owner?this.$storage[this.$controller.selectedPageId]=this.$owner.color:"titleColor"in this.$owner&&(this.$storage[this.$controller.selectedPageId]=this.$owner.titleColor))}}}(fgui||(fgui={})),function(t){t.GearDisplay=class extends t.GearBase{constructor(t){super(t),this.$vid=0,this.$lockToken=1}init(){this.pages=null}lock(){return this.$vid++,this.$lockToken}release(t){t==this.$lockToken&&this.$vid--}get connected(){return null==this.controller||this.$vid>0}apply(){this.$lockToken++,this.$lockToken<=0&&(this.$lockToken=1),null==this.pages||0==this.pages.length||-1!=this.pages.indexOf(this.$controller.selectedPageId)?this.$vid=1:this.$vid=0}}}(fgui||(fgui={})),function(t){t.GearIcon=class extends t.GearBase{constructor(t){super(t)}init(){this.$default=this.$owner.icon,this.$storage={}}addStatus(t,e){null==t?this.$default=e:this.$storage[t]=e}apply(){this.$owner.$gearLocked=!0;let t=this.$storage[this.$controller.selectedPageId];this.$owner.icon=null!=t?t:this.$default,this.$owner.$gearLocked=!1}updateState(){null==this.$controller||this.$owner.$gearLocked||this.$owner.$inProgressBuilding||(this.$storage[this.$controller.selectedPageId]=this.$owner.icon)}}}(fgui||(fgui={})),function(t){t.GearLook=class extends t.GearBase{constructor(t){super(t)}init(){this.$default=new e(this.$owner.alpha,this.$owner.rotation,this.$owner.grayed),this.$storage={}}addStatus(t,i){if("-"==i)return;let s,h=i.split(",");null==t?s=this.$default:(s=new e,this.$storage[t]=s),s.alpha=parseFloat(h[0]),s.rotation=parseInt(h[1]),s.grayed="1"==h[2]}apply(){let e=this.$storage[this.$controller.selectedPageId];if(e||(e=this.$default),!this.$tween||t.UIPackage.$constructingObjects||t.GearBase.disableAllTweenEffect)this.$owner.$gearLocked=!0,this.$owner.grayed=e.grayed,this.$owner.alpha=e.alpha,this.$owner.rotation=e.rotation,this.$owner.$gearLocked=!1;else{if(this.$owner.$gearLocked=!0,this.$owner.grayed=e.grayed,this.$owner.$gearLocked=!1,this.$tweener){if(this.$tweenTarget.alpha===e.alpha&&this.$tweenTarget.rotation===e.rotation)return;this.$tweener.end().stop(),this.$tweener=null}let t=e.alpha!=this.$owner.alpha,i=e.rotation!=this.$owner.rotation;if(t||i){this.$owner.hasGearController(0,this.$controller)&&(this.$lockToken=this.$owner.lockGearDisplay()),this.$tweenTarget=e;let s={onChange:()=>{this.$owner.$gearLocked=!0,t&&(this.$owner.alpha=this.$tweenValue.x),i&&(this.$owner.rotation=this.$tweenValue.y),this.$owner.$gearLocked=!1}};null==this.$tweenValue&&(this.$tweenValue=new PIXI.Point),this.$tweenValue.x=this.$owner.alpha,this.$tweenValue.y=this.$owner.rotation,this.$tweener=new TWEEN.Tween(this.$tweenValue).delay(1e3*this.$tweenDelay).to({x:e.alpha,y:e.rotation},1e3*this.$tweenTime).easing(this.$easeType).onUpdate(s.onChange).onComplete(this.tweenComplete).start()}}}tweenComplete(){0!=this.$lockToken&&(this.$owner.releaseGearDisplay(this.$lockToken),this.$lockToken=0),this.$tweener=null,this.$owner.emit(t.GearEvent.GEAR_STOP,this)}updateState(){if(null==this.$controller||this.$owner.$gearLocked||this.$owner.$inProgressBuilding)return;let t=this.$storage[this.$controller.selectedPageId];t||(t=new e,this.$storage[this.$controller.selectedPageId]=t),t.alpha=this.$owner.alpha,t.rotation=this.$owner.rotation,t.grayed=this.$owner.grayed}};class e{constructor(t=0,e=0,i=!1){this.alpha=t,this.rotation=e,this.grayed=i}}}(fgui||(fgui={})),function(t){t.GearSize=class extends t.GearBase{constructor(t){super(t)}init(){this.$default=new e(this.$owner.width,this.$owner.height,this.$owner.scaleX,this.$owner.scaleY),this.$storage={}}addStatus(t,i){if("-"==i)return;let s,h=i.split(",");null==t?s=this.$default:(s=new e,this.$storage[t]=s),s.width=parseInt(h[0]),s.height=parseInt(h[1]),h.length>2&&(s.scaleX=parseFloat(h[2]),s.scaleY=parseFloat(h[3]))}apply(){let i=this.$storage[this.$controller.selectedPageId];if(i||(i=this.$default),!this.$tween||t.UIPackage.$constructingObjects||t.GearBase.disableAllTweenEffect)this.$owner.$gearLocked=!0,this.$owner.setSize(i.width,i.height,this.$owner.gearXY.controller==this.$controller),this.$owner.setScale(i.scaleX,i.scaleY),this.$owner.$gearLocked=!1;else{if(this.$tweener){if(this.$tweenTarget.width==i.width&&this.$tweenTarget.height==i.height&&this.$tweenTarget.scaleX==i.scaleX&&this.$tweenTarget.scaleY==i.scaleY)return;this.$tweener.end().stop(),this.$tweener=null}let t=i.width!=this.$owner.width||i.height!=this.$owner.height,s=i.scaleX!=this.$owner.scaleX||i.scaleY!=this.$owner.scaleY;if(t||s){this.$owner.hasGearController(0,this.$controller)&&(this.$lockToken=this.$owner.lockGearDisplay()),this.$tweenTarget=i;let h={onChange:()=>{this.$owner.$gearLocked=!0,t&&this.$owner.setSize(this.$tweenValue.width,this.$tweenValue.height,this.$owner.gearXY.controller==this.$controller),s&&this.$owner.setScale(this.$tweenValue.scaleX,this.$tweenValue.scaleY),this.$owner.$gearLocked=!1}};null==this.$tweenValue&&(this.$tweenValue=new e),this.$tweenValue.width=this.$owner.width,this.$tweenValue.height=this.$owner.height,this.$tweenValue.scaleX=this.$owner.scaleX,this.$tweenValue.scaleY=this.$owner.scaleY,this.$tweener=new TWEEN.Tween(this.$tweenValue).delay(1e3*this.$tweenDelay).to({width:i.width,height:i.height,scaleX:i.scaleX,scaleY:i.scaleY},1e3*this.$tweenTime).easing(this.$easeType).onUpdate(h.onChange).onComplete(this.tweenComplete).start()}}}tweenComplete(){0!=this.$lockToken&&(this.$owner.releaseGearDisplay(this.$lockToken),this.$lockToken=0),this.$tweener=null,this.$owner.emit(t.GearEvent.GEAR_STOP,this)}updateState(){if(null==this.$controller||this.$owner.$gearLocked||this.$owner.$inProgressBuilding)return;let t=this.$storage[this.$controller.selectedPageId];t||(t=new e,this.$storage[this.$controller.selectedPageId]=t),t.width=this.$owner.width,t.height=this.$owner.height,t.scaleX=this.$owner.scaleX,t.scaleY=this.$owner.scaleY}updateFromRelations(t,e){if(null!=this.$controller&&null!=this.$storage){for(let i in this.$storage){let s=this.$storage[i];s.width+=t,s.height+=e}this.$default.width+=t,this.$default.height+=e,this.updateState()}}};class e{constructor(t=0,e=0,i=0,s=0){this.width=t,this.height=e,this.scaleX=i,this.scaleY=s}}}(fgui||(fgui={})),function(t){t.GearText=class extends t.GearBase{constructor(t){super(t)}init(){this.$default=this.$owner.text,this.$storage={}}addStatus(t,e){null==t?this.$default=e:this.$storage[t]=e}apply(){this.$owner.$gearLocked=!0;let t=this.$storage[this.$controller.selectedPageId];this.$owner.text=null!=t?t:this.$default,this.$owner.$gearLocked=!1}updateState(){null==this.$controller||this.$owner.$gearLocked||this.$owner.$inProgressBuilding||(this.$storage[this.$controller.selectedPageId]=this.$owner.text)}}}(fgui||(fgui={})),function(t){t.GearXY=class extends t.GearBase{constructor(t){super(t)}init(){this.$default=new PIXI.Point(this.$owner.x,this.$owner.y),this.$storage={}}addStatus(t,e){if("-"==e)return;let i,s=e.split(",");null==t?i=this.$default:(i=new PIXI.Point,this.$storage[t]=i),i.x=parseInt(s[0]),i.y=parseInt(s[1])}apply(){let e=this.$storage[this.$controller.selectedPageId];if(e||(e=this.$default),!this.$tween||t.UIPackage.$constructingObjects||t.GearBase.disableAllTweenEffect)this.$owner.$gearLocked=!0,this.$owner.setXY(e.x,e.y),this.$owner.$gearLocked=!1;else{if(this.$tweener){if(this.$tweenTarget.x===e.x&&this.$tweenTarget.y===e.y)return;this.$tweener.end().stop(),this.$tweener=null}if(this.$owner.x!=e.x||this.$owner.y!=e.y){this.$owner.hasGearController(0,this.$controller),this.$lockToken=this.$owner.lockGearDisplay(),this.$tweenTarget=e;let t={onChange:()=>{this.$owner.$gearLocked=!0,this.$owner.setXY(this.$tweenValue.x,this.$tweenValue.y),this.$owner.$gearLocked=!1}};null==this.$tweenValue&&(this.$tweenValue=new PIXI.Point),this.$tweenValue.x=this.$owner.x,this.$tweenValue.y=this.$owner.y,this.$tweener=new TWEEN.Tween(this.$tweenValue).onUpdate(t.onChange).delay(1e3*this.$tweenDelay).to({x:e.x,y:e.y},1e3*this.$tweenTime).easing(this.$easeType).onComplete(this.tweenComplete).start()}}}tweenComplete(){0!=this.$lockToken&&(this.$owner.releaseGearDisplay(this.$lockToken),this.$lockToken=0),this.$tweener=null,this.$owner.emit(t.GearEvent.GEAR_STOP,this)}updateState(){if(null==this.$controller||this.$owner.$gearLocked||this.$owner.$inProgressBuilding)return;let t=this.$storage[this.$controller.selectedPageId];t||(t=new PIXI.Point,this.$storage[this.$controller.selectedPageId]=t),t.x=this.$owner.x,t.y=this.$owner.y}updateFromRelations(t,e){if(null!=this.$controller&&null!=this.$storage){for(let i in this.$storage){let s=this.$storage[i];s.x+=t,s.y+=e}this.$default.x+=t,this.$default.y+=e,this.updateState()}}}}(fgui||(fgui={})),function(t){t.isAnimationGear=function(t){return t&&"playing"in t&&"frame"in t}}(fgui||(fgui={})),function(t){t.isColorGear=function(t){return t&&("color"in t||"titleColor"in t)}}(fgui||(fgui={})),function(t){t.isColorableTitle=function(t){return t&&"titleColor"in t&&"fontSize"in t}}(fgui||(fgui={})),function(t){t.PopupMenu=class{constructor(e=null){if(!e&&!(e=t.UIConfig.popupMenu))throw new Error("UIConfig.popupMenu not defined");this.$contentPane=t.UIPackage.createObjectFromURL(e),this.$contentPane.on("added",this.$addedToStage,this),this.$list=this.$contentPane.getChild("list"),this.$list.removeChildrenToPool(),this.$list.addRelation(this.$contentPane,14),this.$list.removeRelation(this.$contentPane,15),this.$contentPane.addRelation(this.$list,15),this.$list.on(t.ListEvent.ItemClick,this.$clickItem,this)}dispose(){t.GTimer.inst.remove(this.$delayClickItem,this),this.$list.off(t.ListEvent.ItemClick,this.$clickItem,this),this.$contentPane.off("added",this.$addedToStage,this),this.$contentPane.dispose()}addItem(t,e){let i=this.$list.addItemFromPool();i.title=t,i.data=e,i.grayed=!1;let s=i.getController("checked");return null!=s&&(s.selectedIndex=0),i}addItemAt(t,e,i){let s=this.$list.getFromPool();this.$list.addChildAt(s,e),s.title=t,s.data=i,s.grayed=!1;let h=s.getController("checked");return null!=h&&(h.selectedIndex=0),s}addSeperator(){if(null==t.UIConfig.popupMenuSeperator)throw new Error("UIConfig.popupMenuSeperator not defined");this.$list.addItemFromPool(t.UIConfig.popupMenuSeperator)}getItemName(t){return this.$list.getChildAt(t).name}setItemText(t,e){this.$list.getChild(t).title=e}setItemVisible(t,e){let i=this.$list.getChild(t);i.visible!=e&&(i.visible=e,this.$list.setBoundsChangedFlag())}setItemGrayed(t,e){this.$list.getChild(t).grayed=e}setItemCheckable(t,e){let i=this.$list.getChild(t).getController("checked");null!=i&&(e?0==i.selectedIndex&&(i.selectedIndex=1):i.selectedIndex=0)}setItemChecked(t,e){let i=this.$list.getChild(t).getController("checked");null!=i&&(i.selectedIndex=e?2:1)}isItemChecked(t){let e=this.$list.getChild(t).getController("checked");return null!=e&&2==e.selectedIndex}removeItem(t){let e=this.$list.getChild(t);if(null!=e){let t=this.$list.getChildIndex(e);return this.$list.removeChildToPoolAt(t),!0}return!1}clearItems(){this.$list.removeChildrenToPool()}get itemCount(){return this.$list.numChildren}get contentPane(){return this.$contentPane}get list(){return this.$list}show(e=null,i){(null!=e?e.root:t.GRoot.inst).showPopup(this.contentPane,e instanceof t.GRoot?null:e,i)}$clickItem(e,i){t.GTimer.inst.add(100,1,this.$delayClickItem,this,i)}$delayClickItem(e){if(!(e instanceof t.GButton))return;if(e.grayed)return void(this.$list.selectedIndex=-1);let i=e.getController("checked");null!=i&&0!=i.selectedIndex&&(1==i.selectedIndex?i.selectedIndex=2:i.selectedIndex=1);let s=this.$contentPane.parent;s&&s.hidePopup(this.contentPane),null!=e.data&&e.data.call(null),t.GTimer.inst.remove(this.$delayClickItem,this)}$addedToStage(){this.$list.selectedIndex=-1,this.$list.resizeToFit(1e5,10)}}}(fgui||(fgui={})),function(t){t.RelationItem=class{constructor(t){this.$owner=t,this.$defs=[]}get owner(){return this.$owner}set target(t){this.$target!=t&&(this.$target&&this.releaseRefTarget(this.$target),this.$target=t,this.$target&&this.addRefTarget(this.$target))}get target(){return this.$target}add(t,e){if(24==t)return this.add(14,e),void this.add(15,e);let i=this.$defs.length;for(let e=0;e<i;e++)if(this.$defs[e].type==t)return;this.internalAdd(t,e)}internalAdd(t,i){if(24==t)return this.internalAdd(14,i),void this.internalAdd(15,i);let s=new e;s.percent=i,s.type=t,this.$defs.push(s),(i||1==t||3==t||5==t||8==t||10==t||12==t)&&(this.$owner.pixelSnapping=!0)}remove(t=0){if(24==t)return this.remove(14),void this.remove(15);for(let e=this.$defs.length-1;e>=0;e--)if(this.$defs[e].type==t){this.$defs.splice(e,1);break}}copyFrom(t){this.target=t.target,this.$defs.length=0,t.$defs.forEach(t=>{let i=new e;i.copyFrom(t),this.$defs.push(i)},this)}dispose(){null!=this.$target&&(this.releaseRefTarget(this.$target),this.$target=null)}get isEmpty(){return 0==this.$defs.length}applyOnSelfResized(t,e){let i=this.$owner.x,s=this.$owner.y;this.$defs.forEach(i=>{switch(i.type){case 3:case 5:this.$owner.x-=t/2;break;case 4:case 6:this.$owner.x-=t;break;case 10:case 12:this.$owner.y-=e/2;break;case 11:case 13:this.$owner.y-=e}},this),i==this.$owner.x&&s==this.$owner.y||(i=this.$owner.x-i,s=this.$owner.y-s,this.$owner.updateGearFromRelations(1,i,s),null!=this.$owner.parent&&this.$owner.parent.$transitions.length>0&&this.$owner.parent.$transitions.forEach(t=>{t.updateFromRelations(this.$owner.id,i,s)},this))}applyOnXYChanged(t,e,i){let s;switch(t.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:this.$owner.x+=e;break;case 7:case 8:case 9:case 10:case 11:case 12:case 13:this.$owner.y+=i;break;case 14:case 15:break;case 16:case 17:s=this.$owner.x,this.$owner.x+=e,this.$owner.width=this.$owner.$rawWidth-(this.$owner.x-s);break;case 18:case 19:this.$owner.width=this.$owner.$rawWidth+e;break;case 20:case 21:s=this.$owner.y,this.$owner.y+=i,this.$owner.height=this.$owner.$rawHeight-(this.$owner.y-s);break;case 22:case 23:this.$owner.height=this.$owner.$rawHeight+i}}applyOnSizeChanged(t){let e,i,s,h;switch(this.$target!=this.$owner.parent?(e=this.$target.x,i=this.$target.y):(e=0,i=0),t.type){case 0:break;case 1:s=this.$owner.x-(e+this.$targetWidth/2),t.percent&&(s=s/this.$targetWidth*this.$target.$rawWidth),this.$owner.x=e+this.$target.$rawWidth/2+s;break;case 2:s=this.$owner.x-(e+this.$targetWidth),t.percent&&(s=s/this.$targetWidth*this.$target.$rawWidth),this.$owner.x=e+this.$target.$rawWidth+s;break;case 3:s=this.$owner.x+this.$owner.$rawWidth/2-(e+this.$targetWidth/2),t.percent&&(s=s/this.$targetWidth*this.$target.$rawWidth),this.$owner.x=e+this.$target.$rawWidth/2+s-this.$owner.$rawWidth/2;break;case 4:s=this.$owner.x+this.$owner.$rawWidth-e,t.percent&&(s=s/this.$targetWidth*this.$target.$rawWidth),this.$owner.x=e+s-this.$owner.$rawWidth;break;case 5:s=this.$owner.x+this.$owner.$rawWidth-(e+this.$targetWidth/2),t.percent&&(s=s/this.$targetWidth*this.$target.$rawWidth),this.$owner.x=e+this.$target.$rawWidth/2+s-this.$owner.$rawWidth;break;case 6:s=this.$owner.x+this.$owner.$rawWidth-(e+this.$targetWidth),t.percent&&(s=s/this.$targetWidth*this.$target.$rawWidth),this.$owner.x=e+this.$target.$rawWidth+s-this.$owner.$rawWidth;break;case 7:break;case 8:s=this.$owner.y-(i+this.$targetHeight/2),t.percent&&(s=s/this.$targetHeight*this.$target.$rawHeight),this.$owner.y=i+this.$target.$rawHeight/2+s;break;case 9:s=this.$owner.y-(i+this.$targetHeight),t.percent&&(s=s/this.$targetHeight*this.$target.$rawHeight),this.$owner.y=i+this.$target.$rawHeight+s;break;case 10:s=this.$owner.y+this.$owner.$rawHeight/2-(i+this.$targetHeight/2),t.percent&&(s=s/this.$targetHeight*this.$target.$rawHeight),this.$owner.y=i+this.$target.$rawHeight/2+s-this.$owner.$rawHeight/2;break;case 11:s=this.$owner.y+this.$owner.$rawHeight-i,t.percent&&(s=s/this.$targetHeight*this.$target.$rawHeight),this.$owner.y=i+s-this.$owner.$rawHeight;break;case 12:s=this.$owner.y+this.$owner.$rawHeight-(i+this.$targetHeight/2),t.percent&&(s=s/this.$targetHeight*this.$target.$rawHeight),this.$owner.y=i+this.$target.$rawHeight/2+s-this.$owner.$rawHeight;break;case 13:s=this.$owner.y+this.$owner.$rawHeight-(i+this.$targetHeight),t.percent&&(s=s/this.$targetHeight*this.$target.$rawHeight),this.$owner.y=i+this.$target.$rawHeight+s-this.$owner.$rawHeight;break;case 14:s=this.$owner.$inProgressBuilding&&this.$owner==this.$target.parent?this.$owner.sourceWidth-this.$target.$initWidth:this.$owner.$rawWidth-this.$targetWidth,t.percent&&(s=s/this.$targetWidth*this.$target.$rawWidth),this.$target==this.$owner.parent?this.$owner.setSize(this.$target.$rawWidth+s,this.$owner.$rawHeight,!0):this.$owner.width=this.$target.$rawWidth+s;break;case 15:s=this.$owner.$inProgressBuilding&&this.$owner==this.$target.parent?this.$owner.sourceHeight-this.$target.$initHeight:this.$owner.$rawHeight-this.$targetHeight,t.percent&&(s=s/this.$targetHeight*this.$target.$rawHeight),this.$target==this.$owner.parent?this.$owner.setSize(this.$owner.$rawWidth,this.$target.$rawHeight+s,!0):this.$owner.height=this.$target.$rawHeight+s;break;case 16:break;case 17:s=this.$owner.x-(e+this.$targetWidth),t.percent&&(s=s/this.$targetWidth*this.$target.$rawWidth),h=this.$owner.x,this.$owner.x=e+this.$target.$rawWidth+s,this.$owner.width=this.$owner.$rawWidth-(this.$owner.x-h);break;case 18:break;case 19:s=this.$owner.$inProgressBuilding&&this.$owner==this.$target.parent?this.$owner.sourceWidth-(e+this.$target.$initWidth):this.$owner.width-(e+this.$targetWidth),this.$owner!=this.$target.parent&&(s+=this.$owner.x),t.percent&&(s=s/this.$targetWidth*this.$target.$rawWidth),this.$owner!=this.$target.parent?this.$owner.width=e+this.$target.$rawWidth+s-this.$owner.x:this.$owner.width=e+this.$target.$rawWidth+s;break;case 20:break;case 21:s=this.$owner.y-(i+this.$targetHeight),t.percent&&(s=s/this.$targetHeight*this.$target.$rawHeight),h=this.$owner.y,this.$owner.y=i+this.$target.$rawHeight+s,this.$owner.height=this.$owner.$rawHeight-(this.$owner.y-h);break;case 22:break;case 23:s=this.$owner.$inProgressBuilding&&this.$owner==this.$target.parent?this.$owner.sourceHeight-(i+this.$target.$initHeight):this.$owner.$rawHeight-(i+this.$targetHeight),this.$owner!=this.$target.parent&&(s+=this.$owner.y),t.percent&&(s=s/this.$targetHeight*this.$target.$rawHeight),this.$owner!=this.$target.parent?this.$owner.height=i+this.$target.$rawHeight+s-this.$owner.y:this.$owner.height=i+this.$target.$rawHeight+s}}addRefTarget(e){e!=this.$owner.parent&&e.on(t.DisplayObjectEvent.XY_CHANGED,this.$targetXYChanged,this),e.on(t.DisplayObjectEvent.SIZE_CHANGED,this.$targetSizeChanged,this),e.on(t.DisplayObjectEvent.SIZE_DELAY_CHANGE,this.$targetSizeWillChange,this),this.$targetX=this.$target.x,this.$targetY=this.$target.y,this.$targetWidth=this.$target.$rawWidth,this.$targetHeight=this.$target.$rawHeight}releaseRefTarget(e){e.off(t.DisplayObjectEvent.XY_CHANGED,this.$targetXYChanged,this),e.off(t.DisplayObjectEvent.SIZE_CHANGED,this.$targetSizeChanged,this),e.off(t.DisplayObjectEvent.SIZE_DELAY_CHANGE,this.$targetSizeWillChange,this)}$targetXYChanged(t){if(null!=this.$owner.relations.$dealing||null!=this.$owner.group&&this.$owner.group.$updating)return this.$targetX=this.$target.x,void(this.$targetY=this.$target.y);this.$owner.relations.$dealing=this.$target;let e=this.$owner.x,i=this.$owner.y,s=this.$target.x-this.$targetX,h=this.$target.y-this.$targetY;this.$defs.forEach(t=>{this.applyOnXYChanged(t,s,h)},this),this.$targetX=this.$target.x,this.$targetY=this.$target.y,e==this.$owner.x&&i==this.$owner.y||(e=this.$owner.x-e,i=this.$owner.y-i,this.$owner.updateGearFromRelations(1,e,i),null!=this.$owner.parent&&this.$owner.parent.$transitions.length>0&&this.$owner.parent.$transitions.forEach(t=>{t.updateFromRelations(this.$owner.id,e,i)},this)),this.$owner.relations.$dealing=null}$targetSizeChanged(t){if(null!=this.$owner.relations.$dealing)return;this.$owner.relations.$dealing=this.$target;let e=this.$owner.x,i=this.$owner.y,s=this.$owner.$rawWidth,h=this.$owner.$rawHeight;this.$defs.forEach(t=>{this.applyOnSizeChanged(t)},this),this.$targetWidth=this.$target.$rawWidth,this.$targetHeight=this.$target.$rawHeight,e==this.$owner.x&&i==this.$owner.y||(e=this.$owner.x-e,i=this.$owner.y-i,this.$owner.updateGearFromRelations(1,e,i),null!=this.$owner.parent&&this.$owner.parent.$transitions.length>0&&this.$owner.parent.$transitions.forEach(t=>{t.updateFromRelations(this.$owner.id,e,i)},this)),s==this.$owner.$rawWidth&&h==this.$owner.$rawHeight||(s=this.$owner.$rawWidth-s,h=this.$owner.$rawHeight-h,this.$owner.updateGearFromRelations(2,s,h)),this.$owner.relations.$dealing=null}$targetSizeWillChange(t){this.$owner.relations.sizeDirty=!0}};class e{copyFrom(t){this.percent=t.percent,this.type=t.type}}t.RelationDef=e}(fgui||(fgui={})),function(t){class e{constructor(t){this.sizeDirty=!1,this.$owner=t,this.$items=[]}add(e,i,s=!1){let h=this.$items.length;for(let t=0;t<h;t++){let h=this.$items[t];if(h.target==e)return void h.add(i,s)}let n=new t.RelationItem(this.$owner);n.target=e,n.add(i,s),this.$items.push(n)}addItems(t,i){let s,h,n=i.split(",");for(let i=0;i<2;i++){if(!(s=n[i]))continue;"%"==s.charAt(s.length-1)?(s=s.substr(0,s.length-1),h=!0):h=!1,-1==s.indexOf("-")&&(s=`${s}-${s}`);let r=e.RELATION_NAMES.indexOf(s);if(-1==r)throw new Error("Invalid relation type");this.add(t,r,h)}}remove(t,e=0){let i=this.$items.length,s=0;for(;s<i;){let h=this.$items[s];h.target==t?(h.remove(e),h.isEmpty?(h.dispose(),this.$items.splice(s,1),i--):s++):s++}}contains(t){let e=this.$items.length;for(let i=0;i<e;i++)if(this.$items[i].target==t)return!0;return!1}clearFor(t){let e=this.$items.length,i=0;for(;i<e;){let s=this.$items[i];s.target==t?(s.dispose(),this.$items.splice(i,1),e--):i++}}clearAll(){this.$items.forEach(t=>{t.dispose()},this),this.$items.length=0}copyFrom(e){this.clearAll(),e.$items.forEach(e=>{let i=new t.RelationItem(this.$owner);i.copyFrom(e),this.$items.push(i)},this)}dispose(){this.clearAll()}onOwnerSizeChanged(t,e){this.$items.length<=0||this.$items.forEach(i=>{i.applyOnSelfResized(t,e)},this)}ensureRelationsSizeCorrect(){0!=this.$items.length&&(this.sizeDirty=!1,this.$items.forEach(t=>{t.target.ensureSizeCorrect()},this))}get empty(){return 0==this.$items.length}setup(t){t.children.forEach(t=>{if("relation"!=t.nodeName)return;let e,i;e=t.attributes.target,(i=this.$owner.parent?e?this.$owner.parent.getChildById(e):this.$owner.parent:this.$owner.getChildById(e))&&this.addItems(i,t.attributes.sidePair)},this)}}e.RELATION_NAMES=["left-left","left-center","left-right","center-center","right-left","right-center","right-right","top-top","top-middle","top-bottom","middle-middle","bottom-top","bottom-middle","bottom-bottom","width-width","height-height","leftext-left","leftext-right","rightext-left","rightext-right","topext-top","topext-bottom","bottomext-top","bottomext-bottom"],t.Relations=e}(fgui||(fgui={})),function(t){class e extends PIXI.utils.EventEmitter{constructor(e,i,s,h,n,r,l,a,o){let $;if(super(),this.$isDragging=!1,this.$owner=e,this.$maskContainer=new t.UIContainer(null),this.$owner.$rootContainer.addChild(this.$maskContainer),this.$container=this.$owner.$container,this.$container.x=0,this.$container.y=0,this.$maskContainer.addChild(this.$container),this.$scrollBarMargin=s,this.$scrollType=i,this.$scrollSpeed=t.UIConfig.defaultScrollSpeed,this.$mouseWheelSpeed=2*this.$scrollSpeed,this.$decelerationRate=t.UIConfig.defaultScrollDecelerationRate,this.$displayOnLeft=0!=(1&n),this.$snapToItem=0!=(2&n),this.$displayOnDemand=0!=(4&n),this.$pageMode=0!=(8&n),this.$touchEffect=!!(16&n)||!(32&n)&&t.UIConfig.defaultScrollTouchEffect,this.$bouncebackEffect=!!(64&n)||!(128&n)&&t.UIConfig.defaultScrollBounceEffect,this.$inertiaDisabled=0!=(256&n),0==(512&n)&&(this.$maskContainer.scrollRect=new PIXI.Rectangle),this.$scrollBarVisible=!0,this.$mouseWheelEnabled=!0,this.$xPos=0,this.$yPos=0,this.$aniFlag=0,this.$footerLockedSize=0,this.$headerLockedSize=0,0==h&&(h=t.UIConfig.defaultScrollBarDisplay),this.$viewSize=new PIXI.Point,this.$contentSize=new PIXI.Point,this.$pageSize=new PIXI.Point(1,1),this.$overlapSize=new PIXI.Point,this.$tweening=0,this.$tweenTime=new PIXI.Point,this.$tweenStart=new PIXI.Point,this.$tweenDuration=new PIXI.Point,this.$tweenChange=new PIXI.Point,this.$velocity=new PIXI.Point,this.$containerPos=new PIXI.Point,this.$beginTouchPos=new PIXI.Point,this.$lastTouchPos=new PIXI.Point,this.$lastTouchGlobalPos=new PIXI.Point,3!=h){if(2==this.$scrollType||1==this.$scrollType){const e=r||t.UIConfig.verticalScrollBar;if(e){if(this.$vtScrollBar=t.UIPackage.createObjectFromURL(e),!this.$vtScrollBar)throw new Error(`Cannot create scrollbar from ${e}`);this.$vtScrollBar.setScrollPane(this,!0),this.$owner.$rootContainer.addChild(this.$vtScrollBar.displayObject)}}if((2==this.$scrollType||0==this.$scrollType)&&($=l||t.UIConfig.horizontalScrollBar)){if(this.$hzScrollBar=t.UIPackage.createObjectFromURL($),!this.$hzScrollBar)throw new Error(`Cannot create scrollbar from ${$}`);this.$hzScrollBar.setScrollPane(this,!1),this.$owner.$rootContainer.addChild(this.$hzScrollBar.displayObject)}this.$scrollBarDisplayAuto=2==h,this.$scrollBarDisplayAuto&&(this.$scrollBarVisible=!1,this.$vtScrollBar&&(this.$vtScrollBar.displayObject.visible=!1),this.$hzScrollBar&&(this.$hzScrollBar.displayObject.visible=!1))}else this.$mouseWheelEnabled=!1;if(a&&(this.$header=t.UIPackage.createObjectFromURL(a),null==this.$header))throw new Error(`Cannot create scrollPane.header from ${$}`);if(o&&(this.$footer=t.UIPackage.createObjectFromURL(o),null==this.$footer))throw new Error(`Cannot create scrollPane.footer from ${$}`);null==this.$header&&null==this.$footer||(this.$refreshBarAxis=2==this.$scrollType||1==this.$scrollType?"y":"x"),this.setSize(e.width,e.height),this.$owner.on(t.InteractiveEvents.Over,this.$rollOver,this),this.$owner.on(t.InteractiveEvents.Out,this.$rollOut,this),this.$owner.on(t.InteractiveEvents.Down,this.$mouseDown,this),this.$owner.on(t.DisplayObjectEvent.MOUSE_WHEEL,this.$mouseWheel,this)}dispose(){0!=this.$tweening&&t.GTimer.inst.remove(this.tweenUpdate,this),this.$pageController=null,null!=this.$hzScrollBar&&this.$hzScrollBar.dispose(),null!=this.$vtScrollBar&&this.$vtScrollBar.dispose(),null!=this.$header&&this.$header.dispose(),null!=this.$footer&&this.$footer.dispose(),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Move,this.$mouseMove,this),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Up,this.$mouseUp,this),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Click,this.$click,this),this.$owner.off(t.InteractiveEvents.Over,this.$rollOver,this),this.$owner.off(t.InteractiveEvents.Out,this.$rollOut,this),this.$owner.off(t.InteractiveEvents.Down,this.$mouseDown,this),this.$owner.off(t.DisplayObjectEvent.MOUSE_WHEEL,this.$mouseWheel,this)}get owner(){return this.$owner}get horzScrollBar(){return this.$hzScrollBar}get vertScrollBar(){return this.$vtScrollBar}get header(){return this.$header}get footer(){return this.$footer}get bouncebackEffect(){return this.$bouncebackEffect}set bouncebackEffect(t){this.$bouncebackEffect=t}get touchEffect(){return this.$touchEffect}set touchEffect(t){this.$touchEffect=t}set scrollSpeed(e){this.$scrollSpeed=e,0==this.$scrollSpeed&&(this.$scrollSpeed=t.UIConfig.defaultScrollSpeed),this.$mouseWheelSpeed=2*this.$scrollSpeed}get scrollSpeed(){return this.$scrollSpeed}get snapToItem(){return this.$snapToItem}set snapToItem(t){this.$snapToItem=t}get mouseWheelEnabled(){return this.$mouseWheelEnabled}set mouseWheelEnabled(t){this.$mouseWheelEnabled=t}get decelerationRate(){return this.$decelerationRate}set decelerationRate(t){this.$decelerationRate=t}get percX(){return 0==this.$overlapSize.x?0:this.$xPos/this.$overlapSize.x}set percX(t){this.setPercX(t,!1)}setPercX(e,i=!1){this.$owner.ensureBoundsCorrect(),this.setPosX(this.$overlapSize.x*t.utils.NumberUtil.clamp01(e),i)}get percY(){return 0==this.$overlapSize.y?0:this.$yPos/this.$overlapSize.y}set percY(t){this.setPercY(t,!1)}setPercY(e,i=!1){this.$owner.ensureBoundsCorrect(),this.setPosY(this.$overlapSize.y*t.utils.NumberUtil.clamp01(e),i)}get posX(){return this.$xPos}set posX(t){this.setPosX(t,!1)}setPosX(e,i=!1){this.$owner.ensureBoundsCorrect(),1==this.$loop&&(e=this.loopCheckingNewPos(e,"x")),(e=t.utils.NumberUtil.clamp(e,0,this.$overlapSize.x))!=this.$xPos&&(this.$xPos=e,this.posChanged(i))}get posY(){return this.$yPos}set posY(t){this.setPosY(t,!1)}setPosY(e,i=!1){this.$owner.ensureBoundsCorrect(),1==this.$loop&&(e=this.loopCheckingNewPos(e,"y")),(e=t.utils.NumberUtil.clamp(e,0,this.$overlapSize.y))!=this.$yPos&&(this.$yPos=e,this.posChanged(i))}get contentWidth(){return this.$contentSize.x}get contentHeight(){return this.$contentSize.y}get viewWidth(){return this.$viewSize.x}set viewWidth(t){t=t+this.$owner.margin.left+this.$owner.margin.right,null!=this.$vtScrollBar&&(t+=this.$vtScrollBar.width),this.$owner.width=t}get viewHeight(){return this.$viewSize.y}set viewHeight(t){t=t+this.$owner.margin.top+this.$owner.margin.bottom,null!=this.$hzScrollBar&&(t+=this.$hzScrollBar.height),this.$owner.height=t}get currentPageX(){if(!this.$pageMode)return 0;var t=Math.floor(this.$xPos/this.$pageSize.x);return this.$xPos-t*this.$pageSize.x>.5*this.$pageSize.x&&t++,t}set currentPageX(t){this.$pageMode&&this.$overlapSize.x>0&&this.setPosX(t*this.$pageSize.x,!1)}get currentPageY(){if(!this.$pageMode)return 0;let t=Math.floor(this.$yPos/this.$pageSize.y);return this.$yPos-t*this.$pageSize.y>.5*this.$pageSize.y&&t++,t}set currentPageY(t){this.$pageMode&&this.$overlapSize.y>0&&this.setPosY(t*this.$pageSize.y,!1)}get isBottomMost(){return this.$yPos==this.$overlapSize.y||0==this.$overlapSize.y}get isRightMost(){return this.$xPos==this.$overlapSize.x||0==this.$overlapSize.x}get pageController(){return this.$pageController}set pageController(t){this.$pageController=t}get scrollingPosX(){return t.utils.NumberUtil.clamp(-this.$container.x,0,this.$overlapSize.x)}get scrollingPosY(){return t.utils.NumberUtil.clamp(-this.$container.y,0,this.$overlapSize.y)}scrollTop(t=!1){this.setPercY(0,t)}scrollBottom(t=!1){this.setPercY(1,t)}scrollUp(t=1,e=!1){this.$pageMode?this.setPosY(this.$yPos-this.$pageSize.y*t,e):this.setPosY(this.$yPos-this.$scrollSpeed*t,e)}scrollDown(t=1,e=!1){this.$pageMode?this.setPosY(this.$yPos+this.$pageSize.y*t,e):this.setPosY(this.$yPos+this.$scrollSpeed*t,e)}scrollLeft(t=1,e=!1){this.$pageMode?this.setPosX(this.$xPos-this.$pageSize.x*t,e):this.setPosX(this.$xPos-this.$scrollSpeed*t,e)}scrollRight(t=1,e=!1){this.$pageMode?this.setPosX(this.$xPos+this.$pageSize.x*t,e):this.setPosX(this.$xPos+this.$scrollSpeed*t,e)}scrollToView(i,s=!1,h=!1){let n;if(this.$owner.ensureBoundsCorrect(),this.$needRefresh&&this.refresh(),i instanceof t.GObject?i.parent!=this.$owner?(i.parent.localToGlobalRect(i.x,i.y,i.width,i.height,e.sHelperRect),n=this.$owner.globalToLocalRect(e.sHelperRect.x,e.sHelperRect.y,e.sHelperRect.width,e.sHelperRect.height,e.sHelperRect)):((n=e.sHelperRect).x=i.x,n.y=i.y,n.width=i.width,n.height=i.height):n=i,this.$overlapSize.y>0){const t=this.$yPos+this.$viewSize.y;h||n.y<=this.$yPos||n.height>=this.$viewSize.y?this.$pageMode?this.setPosY(Math.floor(n.y/this.$pageSize.y)*this.$pageSize.y,s):this.setPosY(n.y,s):n.y+n.height>t&&(this.$pageMode?this.setPosY(Math.floor(n.y/this.$pageSize.y)*this.$pageSize.y,s):n.height<=this.$viewSize.y/2?this.setPosY(n.y+2*n.height-this.$viewSize.y,s):this.setPosY(n.y+n.height-this.$viewSize.y,s))}if(this.$overlapSize.x>0){let t=this.$xPos+this.$viewSize.x;h||n.x<=this.$xPos||n.width>=this.$viewSize.x?this.$pageMode?this.setPosX(Math.floor(n.x/this.$pageSize.x)*this.$pageSize.x,s):this.setPosX(n.x,s):n.x+n.width>t&&(this.$pageMode?this.setPosX(Math.floor(n.x/this.$pageSize.x)*this.$pageSize.x,s):n.width<=this.$viewSize.x/2?this.setPosX(n.x+2*n.width-this.$viewSize.x,s):this.setPosX(n.x+n.width-this.$viewSize.x,s))}!s&&this.$needRefresh&&this.refresh()}isChildInView(t){if(this.$overlapSize.y>0){var e=t.y+this.$container.y;if(e<-t.height||e>this.$viewSize.y)return!1}return!(this.$overlapSize.x>0&&((e=t.x+this.$container.x)<-t.width||e>this.$viewSize.x))}cancelDragging(){t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Move,this.$mouseMove,this),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Up,this.$mouseUp,this),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Click,this.$click,this),e.draggingPane==this&&(e.draggingPane=null),e.$gestureFlag=0,this.$isDragging=!1,this.$maskContainer.interactive=!0}get isDragging(){return this.$isDragging}lockHeader(i){this.$headerLockedSize!=i&&(this.$headerLockedSize=i,!this.$refreshEventDispatching&&this.$container[this.$refreshBarAxis]>=0&&(this.$tweenStart.set(this.$container.x,this.$container.y),this.$tweenChange.set(0,0),this.$tweenChange[this.$refreshBarAxis]=this.$headerLockedSize-this.$tweenStart[this.$refreshBarAxis],this.$tweenDuration.set(e.TWEEN_DEFAULT_DURATION,e.TWEEN_DEFAULT_DURATION),this.$tweenTime.set(0,0),this.$tweening=2,t.GTimer.inst.addLoop(1,this.tweenUpdate,this)))}lockFooter(i){if(this.$footerLockedSize!=i&&(this.$footerLockedSize=i,!this.$refreshEventDispatching&&this.$container[this.$refreshBarAxis]<=-this.$overlapSize[this.$refreshBarAxis])){this.$tweenStart.set(this.$container.x,this.$container.y),this.$tweenChange.set(0,0);let i=this.$overlapSize[this.$refreshBarAxis];0==i?i=Math.max(this.$contentSize[this.$refreshBarAxis]+this.$footerLockedSize-this.$viewSize[this.$refreshBarAxis],0):i+=this.$footerLockedSize,this.$tweenChange[this.$refreshBarAxis]=-i-this.$tweenStart[this.$refreshBarAxis],this.$tweenDuration.set(e.TWEEN_DEFAULT_DURATION,e.TWEEN_DEFAULT_DURATION),this.$tweenTime.set(0,0),this.$tweening=2,t.GTimer.inst.addLoop(1,this.tweenUpdate,this)}}onOwnerSizeChanged(){this.setSize(this.$owner.width,this.$owner.height),this.posChanged(!1)}handleControllerChanged(t){this.$pageController==t&&(0==this.$scrollType?this.currentPageX=t.selectedIndex:this.currentPageY=t.selectedIndex)}updatePageController(){if(null!=this.$pageController&&!this.$pageController.$updating){let t;if((t=0==this.$scrollType?this.currentPageX:this.currentPageY)<this.$pageController.pageCount){const e=this.$pageController;this.$pageController=null,e.selectedIndex=t,this.$pageController=e}}}adjustMaskContainer(){let t,e;t=this.$displayOnLeft&&null!=this.$vtScrollBar?Math.floor(this.$owner.margin.left+this.$vtScrollBar.width):Math.floor(this.$owner.margin.left),e=Math.floor(this.$owner.margin.top),this.$maskContainer.position.set(t,e),0!=this.$owner.$alignOffset.x||0!=this.$owner.$alignOffset.y?(null==this.$alignContainer&&(this.$alignContainer=new PIXI.Container,this.$maskContainer.addChild(this.$alignContainer),this.$alignContainer.addChild(this.$container)),this.$alignContainer.position.set(this.$owner.$alignOffset.x,this.$owner.$alignOffset.y)):this.$alignContainer&&this.$alignContainer.position.set(0,0)}setSize(t,e){this.adjustMaskContainer(),this.$hzScrollBar&&(this.$hzScrollBar.y=e-this.$hzScrollBar.height,this.$vtScrollBar&&!this.$vScrollNone?(this.$hzScrollBar.width=t-this.$vtScrollBar.width-this.$scrollBarMargin.left-this.$scrollBarMargin.right,this.$displayOnLeft?this.$hzScrollBar.x=this.$scrollBarMargin.left+this.$vtScrollBar.width:this.$hzScrollBar.x=this.$scrollBarMargin.left):(this.$hzScrollBar.width=t-this.$scrollBarMargin.left-this.$scrollBarMargin.right,this.$hzScrollBar.x=this.$scrollBarMargin.left)),this.$vtScrollBar&&(this.$displayOnLeft||(this.$vtScrollBar.x=t-this.$vtScrollBar.width),this.$hzScrollBar?this.$vtScrollBar.height=e-this.$hzScrollBar.height-this.$scrollBarMargin.top-this.$scrollBarMargin.bottom:this.$vtScrollBar.height=e-this.$scrollBarMargin.top-this.$scrollBarMargin.bottom,this.$vtScrollBar.y=this.$scrollBarMargin.top),this.$viewSize.x=t,this.$viewSize.y=e,this.$hzScrollBar&&!this.$hScrollNone&&(this.$viewSize.y-=this.$hzScrollBar.height),this.$vtScrollBar&&!this.$vScrollNone&&(this.$viewSize.x-=this.$vtScrollBar.width),this.$viewSize.x-=this.$owner.margin.left+this.$owner.margin.right,this.$viewSize.y-=this.$owner.margin.top+this.$owner.margin.bottom,this.$viewSize.x=Math.max(1,this.$viewSize.x),this.$viewSize.y=Math.max(1,this.$viewSize.y),this.$pageSize.x=this.$viewSize.x,this.$pageSize.y=this.$viewSize.y,this.handleSizeChanged()}setContentSize(t,e){this.$contentSize.x==t&&this.$contentSize.y==e||(this.$contentSize.x=t,this.$contentSize.y=e,this.handleSizeChanged())}changeContentSizeOnScrolling(t,e,i,s){const h=this.$xPos==this.$overlapSize.x,n=this.$yPos==this.$overlapSize.y;this.$contentSize.x+=t,this.$contentSize.y+=e,this.handleSizeChanged(),1==this.$tweening?(0!=t&&h&&this.$tweenChange.x<0&&(this.$xPos=this.$overlapSize.x,this.$tweenChange.x=-this.$xPos-this.$tweenStart.x),0!=e&&n&&this.$tweenChange.y<0&&(this.$yPos=this.$overlapSize.y,this.$tweenChange.y=-this.$yPos-this.$tweenStart.y)):2==this.$tweening?(0!=i&&(this.$container.x-=i,this.$tweenStart.x-=i,this.$xPos=-this.$container.x),0!=s&&(this.$container.y-=s,this.$tweenStart.y-=s,this.$yPos=-this.$container.y)):this.$isDragging?(0!=i&&(this.$container.x-=i,this.$containerPos.x-=i,this.$xPos=-this.$container.x),0!=s&&(this.$container.y-=s,this.$containerPos.y-=s,this.$yPos=-this.$container.y)):(0!=t&&h&&(this.$xPos=this.$overlapSize.x,this.$container.x=-this.$xPos),0!=e&&n&&(this.$yPos=this.$overlapSize.y,this.$container.y=-this.$yPos)),this.$pageMode&&this.updatePageController()}handleSizeChanged(e=!1){this.$displayOnDemand&&(this.$vtScrollBar&&(this.$contentSize.y<=this.$viewSize.y?this.$vScrollNone||(this.$vScrollNone=!0,this.$viewSize.x+=this.$vtScrollBar.width):this.$vScrollNone&&(this.$vScrollNone=!1,this.$viewSize.x-=this.$vtScrollBar.width)),this.$hzScrollBar&&(this.$contentSize.x<=this.$viewSize.x?this.$hScrollNone||(this.$hScrollNone=!0,this.$viewSize.y+=this.$hzScrollBar.height):this.$hScrollNone&&(this.$hScrollNone=!1,this.$viewSize.y-=this.$hzScrollBar.height))),this.$vtScrollBar&&(this.$viewSize.y<this.$vtScrollBar.minSize?this.$vtScrollBar.displayObject.visible=!1:(this.$vtScrollBar.displayObject.visible=this.$scrollBarVisible&&!this.$vScrollNone,0==this.$contentSize.y?this.$vtScrollBar.displayPerc=0:this.$vtScrollBar.displayPerc=Math.min(1,this.$viewSize.y/this.$contentSize.y))),this.$hzScrollBar&&(this.$viewSize.x<this.$hzScrollBar.minSize?this.$hzScrollBar.displayObject.visible=!1:(this.$hzScrollBar.displayObject.visible=this.$scrollBarVisible&&!this.$hScrollNone,0==this.$contentSize.x?this.$hzScrollBar.displayPerc=0:this.$hzScrollBar.displayPerc=Math.min(1,this.$viewSize.x/this.$contentSize.x)));const i=this.$maskContainer.scrollRect;if(i&&(i.width=this.$viewSize.x,i.height=this.$viewSize.y,this.$maskContainer.scrollRect=i),0==this.$scrollType||2==this.$scrollType?this.$overlapSize.x=Math.ceil(Math.max(0,this.$contentSize.x-this.$viewSize.x)):this.$overlapSize.x=0,1==this.$scrollType||2==this.$scrollType?this.$overlapSize.y=Math.ceil(Math.max(0,this.$contentSize.y-this.$viewSize.y)):this.$overlapSize.y=0,this.$xPos=t.utils.NumberUtil.clamp(this.$xPos,0,this.$overlapSize.x),this.$yPos=t.utils.NumberUtil.clamp(this.$yPos,0,this.$overlapSize.y),null!=this.$refreshBarAxis){var s=this.$overlapSize[this.$refreshBarAxis];0==s?s=Math.max(this.$contentSize[this.$refreshBarAxis]+this.$footerLockedSize-this.$viewSize[this.$refreshBarAxis],0):s+=this.$footerLockedSize,"x"==this.$refreshBarAxis?this.$container.position.set(t.utils.NumberUtil.clamp(this.$container.x,-s,this.$headerLockedSize),t.utils.NumberUtil.clamp(this.$container.y,-this.$overlapSize.y,0)):this.$container.position.set(t.utils.NumberUtil.clamp(this.$container.x,-this.$overlapSize.x,0),t.utils.NumberUtil.clamp(this.$container.y,-s,this.$headerLockedSize)),null!=this.$header&&("x"==this.$refreshBarAxis?this.$header.height=this.$viewSize.y:this.$header.width=this.$viewSize.x),null!=this.$footer&&("y"==this.$refreshBarAxis?this.$footer.height=this.$viewSize.y:this.$footer.width=this.$viewSize.x)}else this.$container.position.set(t.utils.NumberUtil.clamp(this.$container.x,-this.$overlapSize.x,0),t.utils.NumberUtil.clamp(this.$container.y,-this.$overlapSize.y,0));this.syncScrollBar(),this.checkRefreshBar(),this.$pageMode&&this.updatePageController()}posChanged(e){0==this.$aniFlag?this.$aniFlag=e?1:-1:1!=this.$aniFlag||e||(this.$aniFlag=-1),this.$needRefresh=!0,t.GTimer.inst.callLater(this.refresh,this)}refresh(){this.$needRefresh=!1,t.GTimer.inst.remove(this.refresh,this),(this.$pageMode||this.$snapToItem)&&(e.sEndPos.set(-this.$xPos,-this.$yPos),this.alignPosition(e.sEndPos,!1),this.$xPos=-e.sEndPos.x,this.$yPos=-e.sEndPos.y),this.refresh2(),this.emit(t.ScrollEvent.SCROLL,this),this.$needRefresh&&(this.$needRefresh=!1,t.GTimer.inst.remove(this.refresh,this),this.refresh2()),this.syncScrollBar(),this.$aniFlag=0}refresh2(){if(1!=this.$aniFlag||this.$isDragging)0!=this.$tweening&&this.killTween(),this.$container.position.set(Math.floor(-this.$xPos),Math.floor(-this.$yPos)),this.loopCheckingCurrent();else{let i,s;this.$overlapSize.x>0?i=-Math.floor(this.$xPos):(0!=this.$container.x&&(this.$container.x=0),i=0),this.$overlapSize.y>0?s=-Math.floor(this.$yPos):(0!=this.$container.y&&(this.$container.y=0),s=0),i!=this.$container.x||s!=this.$container.y?(this.$tweening=1,this.$tweenTime.set(0,0),this.$tweenDuration.set(e.TWEEN_MANUALLY_SET_DURATION,e.TWEEN_MANUALLY_SET_DURATION),this.$tweenStart.set(this.$container.x,this.$container.y),this.$tweenChange.set(i-this.$tweenStart.x,s-this.$tweenStart.y),t.GTimer.inst.addLoop(1,this.tweenUpdate,this)):0!=this.$tweening&&this.killTween()}this.$pageMode&&this.updatePageController()}syncScrollBar(e=!1){null!=this.$vtScrollBar&&(this.$vtScrollBar.scrollPerc=0==this.$overlapSize.y?0:t.utils.NumberUtil.clamp(-this.$container.y,0,this.$overlapSize.y)/this.$overlapSize.y,this.$scrollBarDisplayAuto&&this.showScrollBar(!e)),null!=this.$hzScrollBar&&(this.$hzScrollBar.scrollPerc=0==this.$overlapSize.x?0:t.utils.NumberUtil.clamp(-this.$container.x,0,this.$overlapSize.x)/this.$overlapSize.x,this.$scrollBarDisplayAuto&&this.showScrollBar(!e)),e&&(this.$maskContainer.interactive=!0)}$mouseDown(i){if(!this.$touchEffect)return;0!=this.$tweening?(this.killTween(),this.$isDragging=!0):this.$isDragging=!1;const s=PIXI.utils.isMobile.any?this.$owner.globalToLocal(i.data.global.x,i.data.global.y):this.$owner.globalToLocal(t.GRoot.globalMouseStatus.mouseX,t.GRoot.globalMouseStatus.mouseY,e.sHelperPoint);this.$containerPos.set(this.$container.x,this.$container.y),this.$beginTouchPos.copyFrom(s),this.$lastTouchPos.copyFrom(s),this.$lastTouchGlobalPos.copyFrom(s),this.$isHoldAreaDone=!1,this.$velocity.set(0,0),this.$velocityScale=1,this.$lastMoveTime=t.GTimer.inst.curTime/1e3,t.GRoot.inst.nativeStage.on(t.InteractiveEvents.Move,this.$mouseMove,this),t.GRoot.inst.nativeStage.on(t.InteractiveEvents.Up,this.$mouseUp,this),t.GRoot.inst.nativeStage.on(t.InteractiveEvents.UpOutside,this.$mouseUp,this),t.GRoot.inst.nativeStage.on(t.InteractiveEvents.Click,this.$click,this)}$mouseMove(){if(!this.$touchEffect)return;if(null!=e.draggingPane&&e.draggingPane!=this||null!=t.GObject.draggingObject)return;let i=t.UIConfig.touchScrollSensitivity;const s=this.$owner.globalToLocal(t.GRoot.globalMouseStatus.mouseX,t.GRoot.globalMouseStatus.mouseY,e.sHelperPoint);let h,n,r,l;if(1==this.$scrollType){if(!this.$isHoldAreaDone){if(e.$gestureFlag|=1,(h=Math.abs(this.$beginTouchPos.y-s.y))<i)return;if(0!=(2&e.$gestureFlag)&&h<(n=Math.abs(this.$beginTouchPos.x-s.x)))return}r=!0}else if(0==this.$scrollType){if(!this.$isHoldAreaDone){if(e.$gestureFlag|=2,(h=Math.abs(this.$beginTouchPos.x-s.x))<i)return;if(0!=(1&e.$gestureFlag)&&h<(n=Math.abs(this.$beginTouchPos.y-s.y)))return}l=!0}else{if(e.$gestureFlag=3,!this.$isHoldAreaDone&&(h=Math.abs(this.$beginTouchPos.y-s.y))<i&&(h=Math.abs(this.$beginTouchPos.x-s.x))<i)return;r=l=!0}let a=Math.floor(this.$containerPos.x+s.x-this.$beginTouchPos.x),o=Math.floor(this.$containerPos.y+s.y-this.$beginTouchPos.y);r&&(o>0?this.$bouncebackEffect?null!=this.$header&&0!=this.$header.height?this.$container.y=Math.floor(Math.min(.5*o,this.$header.height)):this.$container.y=Math.floor(Math.min(.5*o,this.$viewSize.y*e.PULL_DIST_RATIO)):this.$container.y=0:o<-this.$overlapSize.y?this.$bouncebackEffect?null!=this.$footer&&this.$footer.height>0?this.$container.y=Math.floor(Math.max(.5*(o+this.$overlapSize.y),-this.$footer.height)-this.$overlapSize.y):this.$container.y=Math.floor(Math.max(.5*(o+this.$overlapSize.y),-this.$viewSize.y*e.PULL_DIST_RATIO)-this.$overlapSize.y):this.$container.y=-this.$overlapSize.y:this.$container.y=o),l&&(a>0?this.$bouncebackEffect?null!=this.$header&&0!=this.$header.width?this.$container.x=Math.floor(Math.min(.5*a,this.$header.width)):this.$container.x=Math.floor(Math.min(.5*a,this.$viewSize.x*e.PULL_DIST_RATIO)):this.$container.x=0:a<0-this.$overlapSize.x?this.$bouncebackEffect?null!=this.$footer&&this.$footer.width>0?this.$container.x=Math.floor(Math.max(.5*(a+this.$overlapSize.x),-this.$footer.width)-this.$overlapSize.x):this.$container.x=Math.floor(Math.max(.5*(a+this.$overlapSize.x),-this.$viewSize.x*e.PULL_DIST_RATIO)-this.$overlapSize.x):this.$container.x=-this.$overlapSize.x:this.$container.x=a);const $=PIXI.Ticker.shared.FPS,c=t.GTimer.inst.curTime/1e3,u=Math.max(c-this.$lastMoveTime,1/$);let d=s.x-this.$lastTouchPos.x,g=s.y-this.$lastTouchPos.y;if(l||(d=0),r||(g=0),0!=u){const e=u*$-1;if(e>1){const t=Math.pow(.833,e);this.$velocity.x=this.$velocity.x*t,this.$velocity.y=this.$velocity.y*t}this.$velocity.x=t.utils.NumberUtil.lerp(this.$velocity.x,60*d/$/u,10*u),this.$velocity.y=t.utils.NumberUtil.lerp(this.$velocity.y,60*g/$/u,10*u)}const p=this.$lastTouchGlobalPos.x-s.x,f=this.$lastTouchGlobalPos.y-s.y;0!=d?this.$velocityScale=Math.abs(p/d):0!=g&&(this.$velocityScale=Math.abs(f/g)),this.$lastTouchPos.copyFrom(s),this.$lastTouchGlobalPos.copyFrom(s),this.$lastMoveTime=c,this.$overlapSize.x>0&&(this.$xPos=t.utils.NumberUtil.clamp(-this.$container.x,0,this.$overlapSize.x)),this.$overlapSize.y>0&&(this.$yPos=t.utils.NumberUtil.clamp(-this.$container.y,0,this.$overlapSize.y)),0!=this.$loop&&(a=this.$container.x,o=this.$container.y,this.loopCheckingCurrent()&&(this.$containerPos.x+=this.$container.x-a,this.$containerPos.y+=this.$container.y-o)),e.draggingPane=this,this.$isHoldAreaDone=!0,this.$isDragging=!0,this.$maskContainer.interactive=!1,this.syncScrollBar(),this.checkRefreshBar(),this.$pageMode&&this.updatePageController(),this.emit(t.ScrollEvent.SCROLL,this)}$mouseUp(){if(t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Move,this.$mouseMove,this),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.UpOutside,this.$mouseUp,this),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Up,this.$mouseUp,this),t.GRoot.inst.nativeStage.off(t.InteractiveEvents.Click,this.$click,this),e.draggingPane==this&&(e.draggingPane=null),e.$gestureFlag=0,!this.$isDragging||!this.$touchEffect)return this.$isDragging=!1,void(this.$maskContainer.interactive=!0);this.$isDragging=!1,this.$maskContainer.interactive=!0,this.$tweenStart.set(this.$container.x,this.$container.y),e.sEndPos.set(this.$tweenStart.x,this.$tweenStart.y);let i=!1;if(this.$container.x>0?(e.sEndPos.x=0,i=!0):this.$container.x<-this.$overlapSize.x&&(e.sEndPos.x=-this.$overlapSize.x,i=!0),this.$container.y>0?(e.sEndPos.y=0,i=!0):this.$container.y<-this.$overlapSize.y&&(e.sEndPos.y=-this.$overlapSize.y,i=!0),i){if(this.$tweenChange.set(e.sEndPos.x-this.$tweenStart.x,e.sEndPos.y-this.$tweenStart.y),this.$tweenChange.x<-t.UIConfig.touchDragSensitivity||this.$tweenChange.y<-t.UIConfig.touchDragSensitivity?(this.$refreshEventDispatching=!0,this.emit(t.ScrollEvent.PULL_DOWN_RELEASE),this.$refreshEventDispatching=!1):(this.$tweenChange.x>t.UIConfig.touchDragSensitivity||this.$tweenChange.y>t.UIConfig.touchDragSensitivity)&&(this.$refreshEventDispatching=!0,this.emit(t.ScrollEvent.PULL_UP_RELEASE),this.$refreshEventDispatching=!1),this.$headerLockedSize>0&&0==e.sEndPos[this.$refreshBarAxis])e.sEndPos[this.$refreshBarAxis]=this.$headerLockedSize,this.$tweenChange.x=e.sEndPos.x-this.$tweenStart.x,this.$tweenChange.y=e.sEndPos.y-this.$tweenStart.y;else if(this.$footerLockedSize>0&&e.sEndPos[this.$refreshBarAxis]==-this.$overlapSize[this.$refreshBarAxis]){var s=this.$overlapSize[this.$refreshBarAxis];0==s?s=Math.max(this.$contentSize[this.$refreshBarAxis]+this.$footerLockedSize-this.$viewSize[this.$refreshBarAxis],0):s+=this.$footerLockedSize,e.sEndPos[this.$refreshBarAxis]=-s,this.$tweenChange.x=e.sEndPos.x-this.$tweenStart.x,this.$tweenChange.y=e.sEndPos.y-this.$tweenStart.y}this.$tweenDuration.set(e.TWEEN_DEFAULT_DURATION,e.TWEEN_DEFAULT_DURATION)}else{if(this.$inertiaDisabled)this.$tweenDuration.set(e.TWEEN_DEFAULT_DURATION,e.TWEEN_DEFAULT_DURATION);else{const i=PIXI.Ticker.shared.FPS,s=(t.GTimer.inst.curTime/1e3-this.$lastMoveTime)*i-1;if(s>1){const t=Math.pow(.833,s);this.$velocity.x=this.$velocity.x*t,this.$velocity.y=this.$velocity.y*t}this.updateTargetAndDuration(this.$tweenStart,e.sEndPos)}if(e.sOldChange.set(e.sEndPos.x-this.$tweenStart.x,e.sEndPos.y-this.$tweenStart.y),this.loopCheckingTarget(e.sEndPos),(this.$pageMode||this.$snapToItem)&&this.alignPosition(e.sEndPos,!0),this.$tweenChange.x=e.sEndPos.x-this.$tweenStart.x,this.$tweenChange.y=e.sEndPos.y-this.$tweenStart.y,0==this.$tweenChange.x&&0==this.$tweenChange.y)return void(this.$scrollBarDisplayAuto&&this.showScrollBar(!1));(this.$pageMode||this.$snapToItem)&&(this.fixDuration("x",e.sOldChange.x),this.fixDuration("y",e.sOldChange.y))}this.$tweening=2,this.$tweenTime.set(0,0),t.GTimer.inst.addLoop(1,this.tweenUpdate,this)}$click(){this.$isDragging=!1}$mouseWheel(t){if(!this.$mouseWheelEnabled)return;const e=t.delta>0?-1:t.delta<0?1:0;this.$overlapSize.x>0&&0==this.$overlapSize.y?this.$pageMode?this.setPosX(this.$xPos+this.$pageSize.x*e,!1):this.setPosX(this.$xPos+this.$mouseWheelSpeed*e,!1):this.$pageMode?this.setPosY(this.$yPos+this.$pageSize.y*e,!1):this.setPosY(this.$yPos+this.$mouseWheelSpeed*e,!1)}$rollOver(){this.showScrollBar(!0)}$rollOut(){this.showScrollBar(!1)}showScrollBar(e){e?(t.GTimer.inst.remove(this.setScrollBarVisible,this),this.setScrollBarVisible(!0)):t.GTimer.inst.add(500,1,this.setScrollBarVisible,this,e)}setScrollBarVisible(t){this.$scrollBarVisible=t&&this.$viewSize.x>0&&this.$viewSize.y>0,this.$vtScrollBar&&(this.$vtScrollBar.displayObject.visible=this.$scrollBarVisible&&!this.$vScrollNone),this.$hzScrollBar&&(this.$hzScrollBar.displayObject.visible=this.$scrollBarVisible&&!this.$hScrollNone)}getLoopPartSize(e,i){let s=0;return this.$owner instanceof t.GList&&(s="x"==i?this.$owner.columnGap:this.$owner.lineGap),(this.$contentSize[i]+s)/e}loopCheckingCurrent(){let t=!1;return 1==this.$loop&&this.$overlapSize.x>0?this.$xPos<.001?(this.$xPos+=this.getLoopPartSize(2,"x"),t=!0):this.$xPos>=this.$overlapSize.x&&(this.$xPos-=this.getLoopPartSize(2,"x"),t=!0):2==this.$loop&&this.$overlapSize.y>0&&(this.$yPos<.001?(this.$yPos+=this.getLoopPartSize(2,"y"),t=!0):this.$yPos>=this.$overlapSize.y&&(this.$yPos-=this.getLoopPartSize(2,"y"),t=!0)),t&&this.$container.position.set(Math.floor(-this.$xPos),Math.floor(-this.$yPos)),t}loopCheckingTarget(t){1==this.$loop&&this.loopCheckingTarget2(t,"x"),2==this.$loop&&this.loopCheckingTarget2(t,"y")}loopCheckingTarget2(t,e){var i,s;t[e]>0?(i=this.getLoopPartSize(2,e),(s=this.$tweenStart[e]-i)<=0&&s>=-this.$overlapSize[e]&&(t[e]-=i,this.$tweenStart[e]=s)):t[e]<-this.$overlapSize[e]&&(i=this.getLoopPartSize(2,e),(s=this.$tweenStart[e]+i)<=0&&s>=-this.$overlapSize[e]&&(t[e]+=i,this.$tweenStart[e]=s))}loopCheckingNewPos(e,i){if(0==this.$overlapSize[i])return e;let s,h="x"==i?this.$xPos:this.$yPos,n=!1;return e<.001?(e+=this.getLoopPartSize(2,i))>h&&(s=this.getLoopPartSize(6,i),s=Math.ceil((e-h)/s)*s,h=t.utils.NumberUtil.clamp(h+s,0,this.$overlapSize[i]),n=!0):e>=this.$overlapSize[i]&&(e-=this.getLoopPartSize(2,i))<h&&(s=this.getLoopPartSize(6,i),s=Math.ceil((h-e)/s)*s,h=t.utils.NumberUtil.clamp(h-s,0,this.$overlapSize[i]),n=!0),n&&("x"==i?this.$container.x=-Math.floor(h):this.$container.y=-Math.floor(h)),e}alignPosition(t,i){if(this.$pageMode)t.x=this.alignByPage(t.x,"x",i),t.y=this.alignByPage(t.y,"y",i);else if(this.$snapToItem){var s=this.$owner.getSnappingPosition(-t.x,-t.y,e.sHelperPoint);t.x<0&&t.x>-this.$overlapSize.x&&(t.x=-s.x),t.y<0&&t.y>-this.$overlapSize.y&&(t.y=-s.y)}}alignByPage(t,e,i){let s;if(t>0)s=0;else if(t<-this.$overlapSize[e])s=Math.ceil(this.$contentSize[e]/this.$pageSize[e])-1;else{s=Math.floor(-t/this.$pageSize[e]);var h=i?t-this.$containerPos[e]:t-this.$container[e],n=Math.min(this.$pageSize[e],this.$contentSize[e]-(s+1)*this.$pageSize[e]),r=-t-s*this.$pageSize[e];Math.abs(h)>this.$pageSize[e]?r>.5*n&&s++:r>n*(h<0?.3:.7)&&s++;const l=this.$pageSize[e];(t=-s*l)<-l&&(t=-l)}if(i){var l,a=this.$tweenStart[e];l=a>0?0:a<-this.$overlapSize[e]?Math.ceil(this.$contentSize[e]/this.$pageSize[e])-1:Math.floor(-a/this.$pageSize[e]);var o=Math.floor(-this.$containerPos[e]/this.$pageSize[e]);Math.abs(s-o)>1&&Math.abs(l-o)<=1&&(t=-(s=s>o?o+1:o-1)*this.$pageSize[e])}return t}updateTargetAndDuration(t,e){e.x=this.updateTargetAndDuration2(t.x,"x"),e.y=this.updateTargetAndDuration2(t.y,"y")}updateTargetAndDuration2(i,s){let h=this.$velocity[s];var n=0;if(i>0)i=0;else if(i<-this.$overlapSize[s])i=-this.$overlapSize[s];else{var r=PIXI.utils.isMobile.any;let e=Math.abs(h)*this.$velocityScale;r&&(e*=Math.max(t.GRoot.inst.stageWrapper.designWidth,t.GRoot.inst.stageWrapper.designHeight)/Math.max(t.GRoot.inst.stageWidth,t.GRoot.inst.stageHeight));let l=0;if(this.$pageMode||!r?e>500&&(l=Math.pow((e-500)/500,2)):e>1e3&&(l=Math.pow((e-1e3)/1e3,2)),0!=l){l>1&&(l=1),e*=l,h*=l,this.$velocity[s]=h,n=Math.log(60/e)/Math.log(this.$decelerationRate)/60,i+=(h/60-1)/(1-this.$decelerationRate)}}return n<e.TWEEN_DEFAULT_DURATION&&(n=e.TWEEN_DEFAULT_DURATION),this.$tweenDuration[s]=n,i}fixDuration(t,i){if(0==this.$tweenChange[t]||Math.abs(this.$tweenChange[t])>=Math.abs(i))return;let s=Math.abs(this.$tweenChange[t]/i)*this.$tweenDuration[t];s<e.TWEEN_DEFAULT_DURATION&&(s=e.TWEEN_DEFAULT_DURATION),this.$tweenDuration[t]=s}killTween(){1==this.$tweening&&(this.$container.position.set(this.$tweenStart.x+this.$tweenChange.x,this.$tweenStart.y+this.$tweenChange.y),this.emit(t.ScrollEvent.SCROLL,this)),this.$tweening=0,t.GTimer.inst.remove(this.tweenUpdate,this),this.emit(t.ScrollEvent.SCROLL_END,this)}checkRefreshBar(){if(null==this.$header&&null==this.$footer)return;const t=this.$container[this.$refreshBarAxis];if(null!=this.$header)if(t>0){null==this.$header.displayObject.parent&&this.$maskContainer.addChildAt(this.$header.displayObject,0);const i=e.sHelperPoint;i.set(this.$header.width,this.$header.height),i[this.$refreshBarAxis]=t,this.$header.setSize(i.x,i.y)}else null!=this.$header.displayObject.parent&&this.$maskContainer.removeChild(this.$header.displayObject);if(null!=this.$footer){var i=this.$overlapSize[this.$refreshBarAxis];if(t<-i||0==i&&this.$footerLockedSize>0){null==this.$footer.displayObject.parent&&this.$maskContainer.addChildAt(this.$footer.displayObject,0);const s=e.sHelperPoint;s.set(this.$footer.x,this.$footer.y),s[this.$refreshBarAxis]=i>0?t+this.$contentSize[this.$refreshBarAxis]:Math.max(Math.min(t+this.$viewSize[this.$refreshBarAxis],this.$viewSize[this.$refreshBarAxis]-this.$footerLockedSize),this.$viewSize[this.$refreshBarAxis]-this.$contentSize[this.$refreshBarAxis]),this.$footer.setXY(s.x,s.y),s.set(this.$footer.width,this.$footer.height),s[this.$refreshBarAxis]=i>0?-i-t:this.$viewSize[this.$refreshBarAxis]-this.$footer[this.$refreshBarAxis],this.$footer.setSize(s.x,s.y)}else null!=this.$footer.displayObject.parent&&this.$maskContainer.removeChild(this.$footer.displayObject)}}tweenUpdate(){var e=this.runTween("x"),i=this.runTween("y");this.$container.position.set(e,i),2==this.$tweening&&(this.$overlapSize.x>0&&(this.$xPos=t.utils.NumberUtil.clamp(-e,0,this.$overlapSize.x)),this.$overlapSize.y>0&&(this.$yPos=t.utils.NumberUtil.clamp(-i,0,this.$overlapSize.y)),this.$pageMode&&this.updatePageController()),0==this.$tweenChange.x&&0==this.$tweenChange.y?(this.$tweening=0,t.GTimer.inst.remove(this.tweenUpdate,this),this.loopCheckingCurrent(),this.syncScrollBar(!0),this.checkRefreshBar(),this.emit(t.ScrollEvent.SCROLL,this),this.emit(t.ScrollEvent.SCROLL_END,this)):(this.syncScrollBar(!1),this.checkRefreshBar(),this.emit(t.ScrollEvent.SCROLL,this))}runTween(i){const s=t.GTimer.inst.ticker.deltaTime;let h;if(0!=this.$tweenChange[i]){if(this.$tweenTime[i]+=s*PIXI.settings.TARGET_FPMS,this.$tweenTime[i]>=this.$tweenDuration[i])h=this.$tweenStart[i]+this.$tweenChange[i],this.$tweenChange[i]=0;else{const t=e.$easeTypeFunc(this.$tweenTime[i],this.$tweenDuration[i]);h=this.$tweenStart[i]+Math.floor(this.$tweenChange[i]*t)}var n=0,r=-this.$overlapSize[i];if(this.$headerLockedSize>0&&this.$refreshBarAxis==i&&(n=this.$headerLockedSize),this.$footerLockedSize>0&&this.$refreshBarAxis==i){var l=this.$overlapSize[this.$refreshBarAxis];0==l?l=Math.max(this.$contentSize[this.$refreshBarAxis]+this.$footerLockedSize-this.$viewSize[this.$refreshBarAxis],0):l+=this.$footerLockedSize,r=-l}2==this.$tweening&&this.$bouncebackEffect?h>20+n&&this.$tweenChange[i]>0||h>n&&0==this.$tweenChange[i]?(this.$tweenTime[i]=0,this.$tweenDuration[i]=e.TWEEN_DEFAULT_DURATION,this.$tweenChange[i]=-h+n,this.$tweenStart[i]=h):(h<r-20&&this.$tweenChange[i]<0||h<r&&0==this.$tweenChange[i])&&(this.$tweenTime[i]=0,this.$tweenDuration[i]=e.TWEEN_DEFAULT_DURATION,this.$tweenChange[i]=r-h,this.$tweenStart[i]=h):h>n?(h=n,this.$tweenChange[i]=0):h<r&&(h=r,this.$tweenChange[i]=0)}else h=this.$container[i];return h}}e.$easeTypeFunc=((t,e)=>(t=t/e-1)*t*t+1),e.$gestureFlag=0,e.sHelperPoint=new PIXI.Point,e.sHelperRect=new PIXI.Rectangle,e.sEndPos=new PIXI.Point,e.sOldChange=new PIXI.Point,e.TWEEN_DEFAULT_DURATION=.4,e.TWEEN_MANUALLY_SET_DURATION=.5,e.PULL_DIST_RATIO=.5,t.ScrollPane=e}(fgui||(fgui={})),function(t){class e{constructor(e){this.autoPlayRepeat=1,this.autoPlayDelay=0,this.$ownerBaseX=0,this.$ownerBaseY=0,this.$totalTimes=0,this.$totalTasks=0,this.$playing=!1,this.$options=0,this.$maxTime=0,this.$owner=e,this.$items=[],this.$owner.on(t.DisplayObjectEvent.VISIBLE_CHANGED,this.$ownerVisibleChanged,this)}$ownerVisibleChanged(t,i){0==(this.$options&e.OPTION_AUTO_STOP_DISABLED)&&!1===t&&this.stop(0!=(this.$options&e.OPTION_AUTO_STOP_AT_END),!1)}get autoPlay(){return this.$autoPlay}set autoPlay(t){this.$autoPlay!=t&&(this.$autoPlay=t,this.$autoPlay?this.$owner.onStage&&this.play({times:this.autoPlayRepeat,delay:this.autoPlayDelay}):this.$owner.onStage||this.stop(!1,!0))}changeRepeat(t){this.$totalTimes=0|t}play(...t){if(t.length&&"object"==typeof t[0]){let e=t[0];this.$play(e.onComplete,e.onCompleteObj,e.onCompleteParam,e.times||1,e.delay||0,!1)}else this.$play(t[0],t[1],t[2],t[3]||1,t[4]||0,!1)}playReverse(...t){if(t.length&&"object"==typeof t[0]){let e=t[0];this.$play(e.onComplete,e.onCompleteObj,e.onCompleteParam,e.times||1,e.delay||0,!0)}else this.$play(t[0],t[1],t[2],t[3]||1,t[4]||0,!0)}$play(t,i,s,h,n,r=!1){this.stop(),0==h?h=1:-1==h&&(h=Number.MAX_VALUE),this.$totalTimes=h,this.$reversed=r,this.internalPlay(n),this.$playing=this.$totalTasks>0,this.$playing?(this.$onComplete=t,this.$onCompleteParam=s,this.$onCompleteObj=i,0!=(this.$options&e.OPTION_IGNORE_DISPLAY_CONTROLLER)&&this.$items.forEach(t=>{null!=t.target&&t.target!=this.$owner&&(t.lockToken=t.target.lockGearDisplay())},this)):null!=t&&(s&&s.length?t.apply(i,s):t.call(i,s))}stop(t=!0,e=!1){if(this.$playing){this.$playing=!1,this.$totalTasks=0,this.$totalTimes=0;let i=this.$onComplete,s=this.$onCompleteParam,h=this.$onCompleteObj;this.$onComplete=null,this.$onCompleteParam=null,this.$onCompleteObj=null;let n,r=this.$items.length;if(this.$reversed)for(let e=r-1;e>=0;e--)null!=(n=this.$items[e]).target&&this.stopItem(n,t);else for(let e=0;e<r;e++)null!=(n=this.$items[e]).target&&this.stopItem(n,t);e&&null!=i&&(s&&s.length>0?i.apply(h,s):i.call(h,s))}}stopItem(e,i){if(0!=e.lockToken&&(e.target.releaseGearDisplay(e.lockToken),e.lockToken=0),12==e.type&&e.filterCreated&&(e.target.filters=null),!e.completed)if(this.disposeTween(e),10==e.type){let t=e.target.getTransition(e.value.s);null!=t&&t.stop(i,!1)}else 11==e.type?(t.GTimer.inst.remove(e.$shake,e),e.target.$gearLocked=!0,e.target.setXY(e.target.x-e.startValue.f1,e.target.y-e.startValue.f2),e.target.$gearLocked=!1):i&&(e.tween?e.yoyo&&e.repeat%2!=0?this.applyValue(e,this.$reversed?e.endValue:e.startValue):this.applyValue(e,this.$reversed?e.startValue:e.endValue):9!=e.type&&this.applyValue(e,e.value))}dispose(){t.GTimer.inst.remove(this.internalPlay,this),this.$owner.off(t.DisplayObjectEvent.VISIBLE_CHANGED,this.$ownerVisibleChanged,this),this.$playing=!1,this.$items.forEach(e=>{if(null!=e.target&&!e.completed)if(this.disposeTween(e),10==e.type){let t=e.target.getTransition(e.value.s);null!=t&&t.dispose()}else 11==e.type&&t.GTimer.inst.remove(e.$shake,e)},this)}get playing(){return this.$playing}setValue(t,...e){this.$items.forEach(i=>{if(null==i.label&&null==i.label2)return;let s;if(i.label==t)s=i.tween?i.startValue:i.value;else{if(i.label2!=t)return;s=i.endValue}switch(i.type){case 0:case 1:case 3:case 2:case 13:s.b1=!0,s.b2=!0,s.f1=parseFloat(e[0]),s.f2=parseFloat(e[1]);break;case 4:s.f1=parseFloat(e[0]);break;case 5:s.i=parseInt(e[0]);break;case 6:s.c=parseFloat(e[0]);break;case 7:s.i=parseInt(e[0]),e.length>1&&(s.b=e[1]);break;case 8:s.b=e[0];break;case 9:s.s=e[0],e.length>1&&(s.f1=parseFloat(e[1]));break;case 10:s.s=e[0],e.length>1&&(s.i=parseInt(e[1]));break;case 11:s.f1=parseFloat(e[0]),e.length>1&&(s.f2=parseFloat(e[1]));break;case 12:s.f1=parseFloat(e[0]),s.f2=parseFloat(e[1]),s.f3=parseFloat(e[2]),s.f4=parseFloat(e[3])}},this)}setHook(t,e,i){let s=this.$items.length;for(let h=0;h<s;h++){let s=this.$items[h];if(s.label==t){s.hook=e,s.hookObj=i;break}if(s.label2==t){s.hook2=e,s.hook2Obj=i;break}}}clearHooks(){this.$items.forEach(t=>{t.hook=null,t.hookObj=null,t.hook2=null,t.hook2Obj=null},this)}setTarget(t,e){this.$items.forEach(i=>{i.label==t&&(i.targetId=e.id)},this)}setDuration(t,e){this.$items.forEach(i=>{i.tween&&i.label==t&&(i.duration=e)},this)}updateFromRelations(t,e,i){this.$items.forEach(s=>{0==s.type&&s.targetId==t&&(s.tween?(s.startValue.f1+=e,s.startValue.f2+=i,s.endValue.f1+=e,s.endValue.f2+=i):(s.value.f1+=e,s.value.f2+=i))},this)}internalPlay(t=0){this.$ownerBaseX=this.$owner.x,this.$ownerBaseY=this.$owner.y,this.$totalTasks=0,this.$items.forEach(e=>{if(e.targetId?e.target=this.$owner.getChildById(e.targetId):e.target=this.$owner,null==e.target)return;let i;this.disposeTween(e),e.tween?(i=this.$reversed?t+this.$maxTime-e.time-e.duration:t+e.time)>0?(this.$totalTasks++,e.completed=!1,e.tweener=new TWEEN.Tween(e.value).delay(1e3*i).onComplete(()=>{this.$delayCall(e)}).start()):this.startTween(e):(i=this.$reversed?t+this.$maxTime-e.time:t+e.time)<=0?this.applyValue(e,e.value):(this.$totalTasks++,e.completed=!1,e.tweener=new TWEEN.Tween(e.value).delay(1e3*i).onComplete(()=>this.$delayCall2(e)).start())},this)}prepareValue(t,e,i=!1){let s,h;switch(i?(s=t.endValue,h=t.startValue):(s=t.startValue,h=t.endValue),t.type){case 0:case 1:0==t.type?t.target==this.$owner?(s.b1||(s.f1=0),s.b2||(s.f2=0)):(s.b1||(s.f1=t.target.x),s.b2||(s.f2=t.target.y)):(s.b1||(s.f1=t.target.width),s.b2||(s.f2=t.target.height)),t.value.f1=s.f1,t.value.f2=s.f2,h.b1||(h.f1=t.value.f1),h.b2||(h.f2=t.value.f2),t.value.b1=s.b1||h.b1,t.value.b2=s.b2||h.b2,e.f1=h.f1,e.f2=h.f2;break;case 2:case 13:t.value.f1=s.f1,t.value.f2=s.f2,e.f1=h.f1,e.f2=h.f2;break;case 4:t.value.f1=s.f1,e.f1=h.f1;break;case 5:t.value.i=s.i,e.i=h.i;break;case 12:t.value.f1=s.f1,t.value.f2=s.f2,t.value.f3=s.f3,t.value.f4=s.f4,e.f1=h.f1,e.f2=h.f2,e.f3=h.f3,e.f4=h.f4}}startTween(e){let i,h=new s;this.prepareValue(e,h,this.$reversed),this.applyValue(e,e.value),0!=e.repeat?(e.tweenTimes=0,i=t.utils.Binder.create(this.$tweenRepeatComplete,this,e)):i=t.utils.Binder.create(this.$tweenComplete,this,e),this.$totalTasks++,e.completed=!1,this.prepareValue(e,h,this.$reversed);const n=t.utils.Binder.create(this.$tweenUpdate,this,e);e.tweener=new TWEEN.Tween(e.value).onUpdate(()=>{n(null)}).to(h,1e3*e.duration).onComplete(()=>i(e.tweener)).easing(e.easeType).start(),null!=e.hook&&e.hook.call(e.hookObj)}$delayCall(t){this.disposeTween(t),this.$totalTasks--,this.startTween(t)}$delayCall2(t){this.disposeTween(t),this.$totalTasks--,t.completed=!0,this.applyValue(t,t.value),null!=t.hook&&t.hook.call(t.hookObj),this.checkAllComplete()}$tweenUpdate(t,e){this.applyValue(e,e.value)}$tweenComplete(t,e){this.disposeTween(e),this.$totalTasks--,e.completed=!0,null!=e.hook2&&e.hook2.call(e.hook2Obj),this.checkAllComplete()}$tweenRepeatComplete(e,i){if(i.tweenTimes++,-1==i.repeat||i.tweenTimes<i.repeat+1){let e,h=new s;e=i.yoyo?this.$reversed?i.tweenTimes%2==0:i.tweenTimes%2==1:this.$reversed,this.prepareValue(i,h,e),this.disposeTween(i);const n=t.utils.Binder.create(this.$tweenUpdate,this,i);i.tweener=new TWEEN.Tween(i.value).onUpdate(()=>{n(null)}).to(h,1e3*i.duration).easing(i.easeType).delay(0).onComplete(()=>{this.$tweenRepeatComplete(null,i)}).start()}else this.$tweenComplete(null,i)}disposeTween(t){t&&t.tweener&&(t.tweener.stop(),TWEEN.remove(t.tweener),t.tweener=null)}$playTransComplete(t){this.disposeTween(t),this.$totalTasks--,t.completed=!0,this.checkAllComplete()}checkAllComplete(){if(this.$playing&&0==this.$totalTasks)if(this.$totalTimes<0)t.GTimer.inst.callLater(this.internalPlay,this,0);else if(this.$totalTimes--,this.$totalTimes>0)t.GTimer.inst.callLater(this.internalPlay,this,0);else if(this.$playing=!1,this.$items.forEach(t=>{null!=t.target&&(0!=t.lockToken&&(t.target.releaseGearDisplay(t.lockToken),t.lockToken=0),t.filterCreated&&(t.filterCreated=!1,t.target.filters=null),this.disposeTween(t))}),null!=this.$onComplete){let t=this.$onComplete,e=this.$onCompleteParam,i=this.$onCompleteObj;this.$onComplete=null,this.$onCompleteParam=null,this.$onCompleteObj=null,e&&e.length?t.apply(i,e):t.call(i,e)}}applyValue(e,i){switch(e.target.$gearLocked=!0,e.type){case 0:if(e.target==this.$owner){let t=0,s=0;t=i.b1?i.f1+this.$ownerBaseX:e.target.x,s=i.b2?i.f2+this.$ownerBaseY:e.target.y,e.target.setXY(t,s)}else i.b1||(i.f1=e.target.x),i.b2||(i.f2=e.target.y),e.target.setXY(i.f1,i.f2);break;case 1:i.b1||(i.f1=e.target.width),i.b2||(i.f2=e.target.height),e.target.setSize(i.f1,i.f2);break;case 3:e.target.setPivot(i.f1,i.f2);break;case 4:e.target.alpha=i.f1;break;case 5:e.target.rotation=i.i;break;case 2:e.target.setScale(i.f1,i.f2);break;case 13:e.target.setSkew(i.f1,i.f2);break;case 6:t.isColorGear(e.target)&&(e.target.color=i.c);break;case 7:t.isAnimationGear(e.target)&&(i.b1||(i.i=e.target.frame),e.target.frame=i.i,e.target.playing=i.b);break;case 8:e.target.visible=i.b;break;case 10:let s=e.target.getTransition(i.s);null!=s&&(0==i.i?s.stop(!1,!0):s.playing?s.$totalTimes=-1==i.i?Number.MAX_VALUE:i.i:(e.completed=!1,this.$totalTasks++,this.$reversed?s.playReverse(this.$playTransComplete,this,e,e.value.i):s.play(this.$playTransComplete,this,e,e.value.i)));break;case 9:break;case 11:e.startValue.f1=0,e.startValue.f2=0,e.startValue.f3=e.value.f2,t.GTimer.inst.add(1,0,e.$shake,e,[this]),this.$totalTasks++,e.completed=!1;break;case 12:e.target.updateColorComponents(i.f1,i.f2,i.f3,i.f4)}e.target.$gearLocked=!1}$shakeItem(e,i){let s=Math.ceil(e.value.f1*e.startValue.f3/e.value.f2),h=(2*Math.random()-1)*s,n=(2*Math.random()-1)*s;h=h>0?Math.ceil(h):Math.floor(h),n=n>0?Math.ceil(n):Math.floor(n),e.target.$gearLocked=!0,e.target.setXY(e.target.x-e.startValue.f1+h,e.target.y-e.startValue.f2+n),e.target.$gearLocked=!1,e.startValue.f1=h,e.startValue.f2=n,e.startValue.f3-=i/1e3,e.startValue.f3<=0&&(e.target.$gearLocked=!0,e.target.setXY(e.target.x-e.startValue.f1,e.target.y-e.startValue.f2),e.target.$gearLocked=!1,e.completed=!0,this.$totalTasks--,t.GTimer.inst.remove(e.$shake,e),this.checkAllComplete())}setup(s){this.name=s.attributes.name;let h=s.attributes.options;h&&(this.$options=parseInt(h)),this.$autoPlay="true"==s.attributes.autoPlay,this.$autoPlay&&((h=s.attributes.autoPlayRepeat)&&(this.autoPlayRepeat=parseInt(h)),(h=s.attributes.autoPlayDelay)&&(this.autoPlayDelay=parseFloat(h))),s.children.forEach(s=>{if("item"!=s.nodeName)return;let n=new i;switch(this.$items.push(n),n.time=parseInt(s.attributes.time)/e.FRAME_RATE,n.targetId=s.attributes.target,h=s.attributes.type){case"XY":n.type=0;break;case"Size":n.type=1;break;case"Scale":n.type=2;break;case"Pivot":n.type=3;break;case"Alpha":n.type=4;break;case"Rotation":n.type=5;break;case"Color":n.type=6;break;case"Animation":n.type=7;break;case"Visible":n.type=8;break;case"Sound":n.type=9;break;case"Transition":n.type=10;break;case"Shake":n.type=11;break;case"ColorFilter":n.type=12;break;case"Skew":n.type=13;break;default:n.type=14}if(n.tween="true"==s.attributes.tween,n.label=s.attributes.label,n.tween){n.duration=parseInt(s.attributes.duration)/e.FRAME_RATE,n.time+n.duration>this.$maxTime&&(this.$maxTime=n.time+n.duration),(h=s.attributes.ease)&&(n.easeType=t.ParseEaseType(h)),(h=s.attributes.repeat)&&(n.repeat=parseInt(h)),n.yoyo="true"==s.attributes.yoyo,n.label2=s.attributes.label2;let i=s.attributes.endValue;i?(this.decodeValue(n.type,s.attributes.startValue,n.startValue),this.decodeValue(n.type,i,n.endValue)):(n.tween=!1,this.decodeValue(n.type,s.attributes.startValue,n.value))}else n.time>this.$maxTime&&(this.$maxTime=n.time),this.decodeValue(n.type,s.attributes.value,n.value)},this)}decodeValue(e,i,s){let h;switch(e){case 0:case 1:case 3:case 13:"-"==(h=i.split(","))[0]?s.b1=!1:(s.f1=parseFloat(h[0]),s.b1=!0),"-"==h[1]?s.b2=!1:(s.f2=parseFloat(h[1]),s.b2=!0);break;case 4:s.f1=parseFloat(i);break;case 5:s.i=parseInt(i);break;case 2:h=i.split(","),s.f1=parseFloat(h[0]),s.f2=parseFloat(h[1]);break;case 6:s.c=t.utils.StringUtil.convertFromHtmlColor(i);break;case 7:"-"==(h=i.split(","))[0]?s.b1=!1:(s.i=parseInt(h[0]),s.b1=!0),s.b="p"==h[1];break;case 8:s.b="true"==i;break;case 9:if(h=i.split(","),s.s=h[0],h.length>1){let t=parseInt(h[1]);s.f1=0==t||100==t?1:t/100}else s.f1=1;break;case 10:h=i.split(","),s.s=h[0],h.length>1?s.i=parseInt(h[1]):s.i=1;break;case 11:h=i.split(","),s.f1=parseFloat(h[0]),s.f2=parseFloat(h[1]);break;case 12:h=i.split(","),s.f1=parseFloat(h[0]),s.f2=parseFloat(h[1]),s.f3=parseFloat(h[2]),s.f4=parseFloat(h[3])}}}e.OPTION_IGNORE_DISPLAY_CONTROLLER=1,e.OPTION_AUTO_STOP_DISABLED=0,e.OPTION_AUTO_STOP_AT_END=0,e.FRAME_RATE=24,t.Transition=e;class i{constructor(){this.time=0,this.type=0,this.duration=0,this.repeat=0,this.yoyo=!1,this.tween=!1,this.tweenTimes=0,this.completed=!1,this.lockToken=0,this.easeType=t.ParseEaseType("Quad.Out"),this.value=new s,this.startValue=new s,this.endValue=new s}$shake(t,e){t.$shakeItem(this,e)}}class s{constructor(){this.f1=0,this.f2=0,this.f3=0,this.f4=0,this.i=0,this.c=0,this.b=!1,this.b1=!0,this.b2=!0}}}(fgui||(fgui={})),function(t){t.Window=class extends t.GComponent{constructor(){super(),this.$requestingCmd=0,this.focusable=!0,this.$uiSources=[],this.bringToFrontOnClick=t.UIConfig.bringWindowToFrontOnClick,this.on("added",this.$onShown,this),this.on("removed",this.$onHidden,this),this.on(t.InteractiveEvents.Down,this.$mouseDown,this)}addUISource(t){this.$uiSources.push(t)}set contentPane(t){this.$contentPane!=t&&(null!=this.$contentPane&&this.removeChild(this.$contentPane),this.$contentPane=t,null!=this.$contentPane&&(this.addChild(this.$contentPane),this.setSize(this.$contentPane.width,this.$contentPane.height),this.$contentPane.addRelation(this,24),this.$frame=this.$contentPane.getChild("frame"),null!=this.$frame&&(this.closeButton=this.$frame.getChild("closeButton"),this.dragArea=this.$frame.getChild("dragArea"),this.contentArea=this.$frame.getChild("contentArea"))))}get contentPane(){return this.$contentPane}get frame(){return this.$frame}get closeButton(){return this.$closeButton}set closeButton(t){null!=this.$closeButton&&this.$closeButton.removeClick(this.closeEventHandler,this),this.$closeButton=t,null!=this.$closeButton&&this.$closeButton.click(this.closeEventHandler,this)}get dragArea(){return this.$dragArea}set dragArea(e){this.$dragArea!=e&&(null!=this.$dragArea&&(this.$dragArea.draggable=!1,this.$dragArea.off(t.DragEvent.START,this.$dragStart,this)),this.$dragArea=e,null!=this.$dragArea&&(this.$dragArea instanceof t.GGraph&&this.$dragArea.drawRect(0,0,0,0,0),this.$dragArea.draggable=!0,this.$dragArea.on(t.DragEvent.START,this.$dragStart,this)))}get contentArea(){return this.$contentArea}set contentArea(t){this.$contentArea=t}show(){t.GRoot.inst.showWindow(this)}showOn(t){t.showWindow(this)}hide(){this.isShowing&&this.doHideAnimation()}hideImmediately(){(this.parent&&this.parent instanceof t.GRoot?this.parent:t.GRoot.inst).hideWindowImmediately(this)}centerOn(t,e=!1){this.setXY(Math.round(.5*(t.width-this.width)),Math.round(.5*(t.height-this.height))),e&&(this.addRelation(t,3),this.addRelation(t,10))}toggleVisible(){this.isTop?this.hide():this.show()}get isShowing(){return null!=this.parent}get isTop(){return null!=this.parent&&this.parent.getChildIndex(this)==this.parent.numChildren-1}get modal(){return this.$modal}set modal(t){this.$modal=t}bringToFront(){this.root.bringToFront(this)}showModalWait(e,i=0){0!=i&&(this.$requestingCmd=i),t.UIConfig.windowModalWaiting&&(this.$modalWaitPane||(this.$modalWaitPane=t.UIPackage.createObjectFromURL(t.UIConfig.windowModalWaiting)),this.layoutModalWaitPane(e),this.addChild(this.$modalWaitPane))}layoutModalWaitPane(t){if(null!=this.$contentArea){let e=this.$frame.localToGlobal();e=this.globalToLocal(e.x,e.y,e),this.$modalWaitPane.setXY(e.x+this.$contentArea.x,e.y+this.$contentArea.y),this.$modalWaitPane.setSize(this.$contentArea.width,this.$contentArea.height),t&&t.length&&(this.$modalWaitPane.text=t)}else this.$modalWaitPane.setSize(this.width,this.height)}closeModalWait(t=0){return(0==t||this.$requestingCmd==t)&&(this.$requestingCmd=0,this.$modalWaitPane&&null!=this.$modalWaitPane.parent&&this.removeChild(this.$modalWaitPane),!0)}get modalWaiting(){return this.$modalWaitPane&&null!=this.$modalWaitPane.parent}init(){this.$inited||this.$loading||(this.$uiSources.length>0?(this.$loading=!1,this.$uiSources.forEach(t=>{t.loaded||(t.load(this.$uiLoadComplete,this),this.$loading=!0)},this),this.$loading||this.$init()):this.$init())}onInit(){}onShown(){}onHide(){}doShowAnimation(){this.onShown()}doHideAnimation(){this.hideImmediately()}$uiLoadComplete(){let t=this.$uiSources.length;for(let e=0;e<t;e++)if(!this.$uiSources[e].loaded)return;this.$loading=!1,this.$init()}$init(){this.$inited=!0,this.onInit(),this.isShowing&&this.doShowAnimation()}dispose(){this.off("added",this.$onShown,this),this.off("removed",this.$onHidden,this),this.off(t.InteractiveEvents.Down,this.$mouseDown,this),this.$dragArea&&this.$dragArea.off(t.DragEvent.START,this.$dragStart,this),null!=this.parent&&this.hideImmediately(),this.$modalWaitPane&&this.$modalWaitPane.dispose(),this.$contentPane&&this.$contentPane.dispose(),super.dispose()}closeEventHandler(t){this.hide()}$onShown(t){this.$inited?this.doShowAnimation():this.init()}$onHidden(t){this.closeModalWait(),this.onHide()}$mouseDown(t){this.isShowing&&this.bringToFrontOnClick&&this.bringToFront()}$dragStart(e){t.GObject.castFromNativeObject(e.currentTarget).stopDrag(),this.startDrag(e.data.pointerId)}}}(fgui||(fgui={})),function(t){!function(e){e.InteractionManager=class extends t.InteractionManager{constructor(t,e){super(t,e),this.stageRotation=0,this.stageScaleX=1,this.stageScaleY=1}processInteractive(t,e,i,s){const h=this.search.findHit(t,e,i,s),n=this.delayedEvents;if(!n.length)return h;t.stopPropagationHint=!1;const r=n.length;this.delayedEvents=[];for(let t=0;t<r;t++){const{displayObject:e,eventString:i,eventData:s}=n[t];s.stopsPropagatingAt===e&&(s.stopPropagationHint=!0),this.dispatchEvent(e,i,s)}return h}mapPositionToPoint(t,e,i){if(t.set(e,i),globalThis.tt)return;let s=void 0,h=this.interactionDOMElement;s=h.parentElement?h.getBoundingClientRect():{x:0,y:0,width:0,height:0};let n=navigator.isCocoonJS?this.resolution:1/this.resolution,r=document.documentElement,l=e-=s.left+window.pageXOffset-r.clientLeft,a=i-=s.top+window.pageYOffset-r.clientTop;90==this.stageRotation?(l=i,a=s.width-e):-90==this.stageRotation&&(l=s.height-i,a=e),l=l*this.stageScaleX*n,a=a*this.stageScaleY*n,t.set(l,a)}},t.extensions.add({name:"interaction",type:"renderer-webgl-plugin",ref:t.extras.InteractionManager})}(t.extras||(t.extras={}))}(PIXI||(PIXI={})),function(t){!function(e){e.NineSlicePlane=class extends t.NineSlicePlane{constructor(){super(...arguments),this.$flipX=!1,this.$flipY=!1}updateHorizontalVertices(){const t=this.vertices,e=this.topHeight+this.bottomHeight,i=this._height>e?1:this._height/e;t[9]=t[11]=t[13]=t[15]=(this.$flipY?this.bottomHeight:this.topHeight)*i,t[17]=t[19]=t[21]=t[23]=this._height-(this.$flipY?this.topHeight:this.bottomHeight)*i,t[25]=t[27]=t[29]=t[31]=this._height}updateVerticalVertices(){const t=this.vertices,e=this.leftWidth+this.rightWidth,i=this._width>e?1:this._width/e;t[2]=t[10]=t[18]=t[26]=(this.$flipX?this.rightWidth:this.leftWidth)*i,t[4]=t[12]=t[20]=t[28]=this._width-(this.$flipX?this.leftWidth:this.rightWidth)*i,t[6]=t[14]=t[22]=t[30]=this._width}_refresh(){if(isNaN(this.leftWidth)||isNaN(this.topHeight)||isNaN(this.rightWidth)||isNaN(this.bottomHeight))return;super._refresh();let t=this.geometry.buffers[1].data;if(this.$flipX){let e=t[0],i=t[2];t[0]=t[6],t[2]=t[4],t[6]=e,t[4]=i,e=t[8],i=t[10],t[8]=t[14],t[10]=t[12],t[14]=e,t[12]=i,e=t[16],i=t[18],t[16]=t[22],t[18]=t[20],t[22]=e,t[20]=i,e=t[24],i=t[26],t[24]=t[30],t[26]=t[28],t[30]=e,t[28]=i}if(this.$flipY){let e=t[1],i=t[9];t[1]=t[25],t[9]=t[17],t[25]=e,t[17]=i,e=t[3],i=t[11],t[3]=t[27],t[11]=t[19],t[27]=e,t[19]=i,e=t[5],i=t[13],t[5]=t[29],t[13]=t[21],t[29]=e,t[21]=i,e=t[7],i=t[15],t[7]=t[31],t[15]=t[23],t[31]=e,t[23]=i}}get flipX(){return this.$flipX}get flipY(){return this.$flipY}set flipX(t){this.$flipX!=t&&(this.$flipX=t,this._refresh())}set flipY(t){this.$flipY!=t&&(this.$flipY=t,this._refresh())}}}(t.extras||(t.extras={}))}(PIXI||(PIXI={})),function(t){!function(e){class i extends t.Sprite{constructor(t,e){super(e),this.$flipX=!1,this.$flipY=!1,this.$frameId=t}get flipX(){return this.$flipX}get flipY(){return this.$flipY}set flipX(t){this.$flipX!=t&&(this.$flipX=t,fgui.GTimer.inst.callLater(this.updateUvs,this))}set flipY(t){this.$flipY!=t&&(this.$flipY=t,fgui.GTimer.inst.callLater(this.updateUvs,this))}combineCacheId(t,e){return this.$frameId&&""!=this.$frameId?`${this.$frameId}${t?"_fx":""}${e?"_fy":""}`:null}getTextureFromCache(t,e){const s=this.combineCacheId(t,e);if(null==s)return this.texture;let h=i.$cachedTexturePool[s];return h?h.refCount++:(h={refCount:1,texture:this.createFlippedTexture(this.texture,t,e)},i.$cachedTexturePool[s]=h),h.texture}tryRemoveTextureCache(t,e){const s=this.combineCacheId(t,e);if(!s)return!1;let h=i.$cachedTexturePool[s];return!!h&&(h.refCount--,h.refCount<=0&&(h.texture.destroy(),delete i.$cachedTexturePool[s]),!0)}createFlippedTexture(t,e,i){let s=t.clone(),h=s._uvs;if(this.$flipX){const t=h.x0,e=h.x3;h.x0=h.x1,h.x1=t,h.x3=h.x2,h.x2=e}if(this.$flipY){const t=h.y0,e=h.y1;h.y0=h.y3,h.y3=t,h.y1=h.y2,h.y2=e}return h.uvsFloat32[0]=(65535*h.y0&65535)<<16|65535*h.x0&65535,h.uvsFloat32[1]=(65535*h.y1&65535)<<16|65535*h.x1&65535,h.uvsFloat32[2]=(65535*h.y2&65535)<<16|65535*h.x2&65535,h.uvsFloat32[3]=(65535*h.y3&65535)<<16|65535*h.x3&65535,s}updateUvs(){if(this.texture&&(this.$flipX||this.$flipY)){let t=this.getTextureFromCache(this.$flipX,this.$flipY);this.texture!=t&&(this.texture=t)}}destroy(t){this.tryRemoveTextureCache(this.$flipX,this.$flipY),super.destroy(t)}}i.$cachedTexturePool={},e.Sprite=i}(t.extras||(t.extras={}))}(PIXI||(PIXI={})),function(t){!function(e){class i extends t.TilingSprite{constructor(t,e){super(e),this.$flipX=!1,this.$flipY=!1,this.$frameId=t}get flipX(){return this.$flipX}get flipY(){return this.$flipY}set flipX(t){this.$flipX!=t&&(this.$flipX=t,fgui.GTimer.inst.callLater(this.updateUvs,this))}set flipY(t){this.$flipY!=t&&(this.$flipY=t,fgui.GTimer.inst.callLater(this.updateUvs,this))}combineCacheId(t,e){return this.$frameId&&""!=this.$frameId?`${this.$frameId}${t?"_fx":""}${e?"_fy":""}`:null}getTextureFromCache(t,e){const s=this.combineCacheId(t,e);if(null==s)return this.texture;let h=i.$cachedTexturePool[s];return h?h.refCount++:(h={refCount:1,texture:this.createFlippedTexture(this.texture,t,e)},i.$cachedTexturePool[s]=h),h.texture}tryRemoveTextureCache(t,e){const s=this.combineCacheId(t,e);if(!s)return!1;let h=i.$cachedTexturePool[s];return!!h&&(h.refCount--,h.refCount<=0&&(h.texture.destroy(),delete i.$cachedTexturePool[s]),!0)}createFlippedTexture(t,e,i){let s=t.clone(),h=s._uvs;if(this.$flipX){const t=h.x0,e=h.x3;h.x0=h.x1,h.x1=t,h.x3=h.x2,h.x2=e}if(this.$flipY){const t=h.y0,e=h.y1;h.y0=h.y3,h.y3=t,h.y1=h.y2,h.y2=e}return h.uvsFloat32[0]=(65535*h.y0&65535)<<16|65535*h.x0&65535,h.uvsFloat32[1]=(65535*h.y1&65535)<<16|65535*h.x1&65535,h.uvsFloat32[2]=(65535*h.y2&65535)<<16|65535*h.x2&65535,h.uvsFloat32[3]=(65535*h.y3&65535)<<16|65535*h.x3&65535,s}updateUvs(){if(this.texture&&(this.$flipX||this.$flipY)){let t=this.getTextureFromCache(this.$flipX,this.$flipY);this.texture!=t&&(this.texture=t)}}destroy(t){this.tryRemoveTextureCache(this.$flipX,this.$flipY),super.destroy(t)}}i.$cachedTexturePool={},e.TilingSprite=i}(t.extras||(t.extras={}))}(PIXI||(PIXI={})),function(t){class e{}e.defaultFont="Arial",e.modalLayerColor=3355443,e.modalLayerAlpha=.2,e.defaultScrollSpeed=25,e.defaultScrollBarDisplay=1,e.defaultScrollTouchEffect=!0,e.defaultScrollBounceEffect=!0,e.defaultScrollDecelerationRate=.967,e.defaultComboBoxVisibleItemCount=10,e.touchScrollSensitivity=20,e.touchDragSensitivity=10,e.bringWindowToFrontOnClick=!0,t.UIConfig=e}(fgui||(fgui={})),function(t){t.Action=class{static create(e){switch(e){case"play_transition":return new t.PlayTransitionAction;case"change_page":return new t.ChangePageAction}return null}execute(t,e,i){this.fromPage&&0!=this.fromPage.length&&-1==this.fromPage.indexOf(e)||this.toPage&&0!=this.toPage.length&&-1==this.toPage.indexOf(i)?this.leave(t):this.enter(t)}enter(t){}leave(t){}setup(t){let e;(e=t.attributes.fromPage)&&(this.fromPage=e.split(",")),(e=t.attributes.toPage)&&(this.toPage=e.split(","))}}}(fgui||(fgui={})),function(t){t.ChangePageAction=class extends t.Action{enter(t){if(!this.controllerName)return;let e;if(e=this.objectId?t.parent.getChildById(this.objectId):t.parent){let i=e.getController(this.controllerName);i&&i!=t&&!i.$updating&&(i.selectedPageId=this.targetPage)}}setup(t){super.setup(t),this.objectId=t.attributes.objectId,this.controllerName=t.attributes.controller,this.targetPage=t.attributes.targetPage}}}(fgui||(fgui={})),function(t){class e{}e.CHANGED="__stateChanged",t.StateChangeEvent=e}(fgui||(fgui={})),function(t){class e extends PIXI.utils.EventEmitter{constructor(){super(),this.$selectedIndex=0,this.$previousIndex=0,this.$pageIds=[],this.$pageNames=[],this.$selectedIndex=-1,this.$previousIndex=-1}get name(){return this.$name}set name(t){this.$name=t}get parent(){return this.$parent}get selectedIndex(){return this.$selectedIndex}set selectedIndex(e){if(this.$selectedIndex!=e){if(e>this.$pageIds.length-1)throw new Error(`index out of range: ${e}`);this.$updating=!0,this.$previousIndex=this.$selectedIndex,this.$selectedIndex=e,this.$parent.applyController(this),this.emit(t.StateChangeEvent.CHANGED,this),this.$updating=!1}}setSelectedIndex(t=0){if(this.$selectedIndex!=t){if(t>this.$pageIds.length-1)throw new Error(`index out of range: ${t}`);this.$updating=!0,this.$previousIndex=this.$selectedIndex,this.$selectedIndex=t,this.$parent.applyController(this),this.$updating=!1}}get previsousIndex(){return this.$previousIndex}get selectedPage(){return-1==this.$selectedIndex?null:this.$pageNames[this.$selectedIndex]}set selectedPage(t){this.selectedIndex=Math.max(0,this.$pageNames.indexOf(t))}setSelectedPage(t){this.setSelectedIndex(Math.max(0,this.$pageNames.indexOf(t)))}get previousPage(){return-1==this.$previousIndex?null:this.$pageNames[this.$previousIndex]}get pageCount(){return this.$pageIds.length}getPageName(t=0){return this.$pageNames[t]}addPage(t=""){this.addPageAt(t,this.$pageIds.length)}addPageAt(t,i=0){let s=`${e.$nextPageId++}`;i==this.$pageIds.length?(this.$pageIds.push(s),this.$pageNames.push(t)):(this.$pageIds.splice(i,0,s),this.$pageNames.splice(i,0,t))}removePage(t){let e=this.$pageNames.indexOf(t);-1!=e&&(this.$pageIds.splice(e,1),this.$pageNames.splice(e,1),this.$selectedIndex>=this.$pageIds.length?this.selectedIndex=this.$selectedIndex-1:this.$parent.applyController(this))}removePageAt(t=0){this.$pageIds.splice(t,1),this.$pageNames.splice(t,1),this.$selectedIndex>=this.$pageIds.length?this.selectedIndex=this.$selectedIndex-1:this.$parent.applyController(this)}clearPages(){this.$pageIds.length=0,this.$pageNames.length=0,-1!=this.$selectedIndex?this.selectedIndex=-1:this.$parent.applyController(this)}hasPage(t){return this.$pageNames.indexOf(t)>=0}getPageIndexById(t){return this.$pageIds.indexOf(t)}getPageIdByName(t){let e=this.$pageNames.indexOf(t);return-1!=e?this.$pageIds[e]:null}getPageNameById(t){let e=this.$pageIds.indexOf(t);return-1!=e?this.$pageNames[e]:null}getPageId(t=0){return this.$pageIds[t]}get selectedPageId(){return-1==this.$selectedIndex?null:this.$pageIds[this.$selectedIndex]}set selectedPageId(t){this.selectedIndex=this.$pageIds.indexOf(t)}set oppositePageId(t){this.$pageIds.indexOf(t)>0?this.selectedIndex=0:this.$pageIds.length>1&&(this.selectedIndex=1)}get previousPageId(){return-1==this.$previousIndex?null:this.$pageIds[this.$previousIndex]}executeActions(){this.$actions&&this.$actions.length>0&&this.$actions.forEach(t=>{t.execute(this,this.previousPageId,this.selectedPageId)})}setup(e){this.$name=e.attributes.name,this.$autoRadioGroupDepth="true"==e.attributes.autoRadioGroupDepth;let i=e.attributes.pages;if(i){let t=i.split(","),e=t.length;for(let i=0;i<e;i+=2)this.$pageIds.push(t[i]),this.$pageNames.push(t[i+1])}let s=e.children;if(s.length>0&&(this.$actions=this.$actions||[],s.forEach(e=>{let i=t.Action.create(e.attributes.type);i.setup(e),this.$actions.push(i)})),i=e.attributes.transitions){let e,s;this.$actions=this.$actions||[],i.split(",").forEach(i=>{if(i&&i.length){let h=new t.PlayTransitionAction;e=i.indexOf("="),h.transitionName=i.substr(e+1),i=i.substring(0,e),e=i.indexOf("-"),(s=parseInt(i.substring(e+1)))<this.$pageIds.length&&(h.toPage=[this.$pageIds[s]]),"*"!=(i=i.substring(0,e))&&(s=parseInt(i))<this.$pageIds.length&&(h.fromPage=[this.$pageIds[s]]),h.stopOnExit=!0,this.$actions.push(h)}})}this.$parent&&this.$pageIds.length>0?this.$selectedIndex=0:this.$selectedIndex=-1}}e.$nextPageId=0,t.Controller=e}(fgui||(fgui={})),function(t){t.PageOption=class{set controller(t){this.$controller=t}set name(t){this.$id=this.$controller.getPageIdByName(t)}get name(){return this.$id?this.$controller.getPageNameById(this.$id):null}set index(t){this.$id=this.$controller.getPageId(t)}get index(){return this.$id?this.$controller.getPageIndexById(this.$id):-1}clear(){this.$id=null}set id(t){this.$id=t}get id(){return this.$id}}}(fgui||(fgui={})),function(t){!function(t){class e{constructor(t){this.nodeName=t.nodeName,this.context=t,this.type=t.nodeType,this.text=this.type==Node.COMMENT_NODE||this.type==Node.TEXT_NODE||this.type==Node.ELEMENT_NODE?this.context.textContent:null}get children(){return this.$children||(this.$children=this.__parseChildNodes(this)),this.$children}get attributes(){return this.$attributes||(this.$attributes=this.__parseNodeAttributes(this)),this.$attributes}getChildNodes(t=null){let e=this.children,i=[];if(!e||e.length<=0)return i;let s=e.length;for(let h=0;h<s;h++){let s=e[h];s.type!=Node.TEXT_NODE&&((!t||t&&t.length>0&&s.nodeName.toLowerCase()==t.toLowerCase())&&i.push(s))}return i}__parseChildNodes(t,i=null){let s=t.context.childNodes,h=[];if(!s||s.length<=0)return h;let n=s.length;for(let t=0;t<n;t++){let n=s.item(t);n.nodeType!=Node.TEXT_NODE&&((!i||i&&i.length>0&&n.nodeName.toLowerCase()==i.toLowerCase())&&h.push(new e(n)))}return h}__parseNodeAttributes(t){let e=t.context.attributes,i={};if(!e||e.length<=0)return i;let s=e.length;for(let t=0;t<s;t++){let s=e.item(t);i[s.nodeName]=s.nodeValue}return i}}t.XmlNode=e;class i{static tryParse(t,s="text/xml"){let h=i.$parser.parseFromString(t,s);return h&&h.childNodes&&h.childNodes.length>=1?new e(h.firstChild):null}static getXmlRoot(t){if(!t||!t.context)throw new Error("Invalid xml node");let i=t.context;for(;null!=i.parentNode;)i=i.parentNode;return i==t.context?t:new e(i)}}i.$parser=new DOMParser,t.XmlParser=i}(t.utils||(t.utils={}))}(fgui||(fgui={})),function(t){t.PlayTransitionAction=class extends t.Action{constructor(){super(...arguments),this.repeat=1,this.delay=0,this.stopOnExit=!1}enter(t){let e=t.parent.getTransition(this.transitionName);e&&(this.$currentTransition&&this.$currentTransition.playing?e.changeRepeat(this.repeat):e.play({times:this.repeat,delay:this.delay}),this.$currentTransition=e)}leave(t){this.stopOnExit&&this.$currentTransition&&(this.$currentTransition.stop(),this.$currentTransition=null)}setup(t){let e;super.setup(t),this.transitionName=t.attributes.transition,(e=t.attributes.repeat)&&(this.repeat=parseInt(e)),(e=t.attributes.delay)&&(this.delay=parseFloat(e)),this.stopOnExit="true"==t.attributes.stopOnExit}}}(fgui||(fgui={})),function(t){t.BMGlyph=class{constructor(){this.x=0,this.y=0,this.offsetX=0,this.offsetY=0,this.width=0,this.height=0,this.advance=0,this.lineHeight=0,this.channel=0}}}(fgui||(fgui={})),function(t){t.BitmapFont=class{constructor(){this.size=0,this.glyphs={}}}}(fgui||(fgui={})),function(t){t.FillSprite=class extends PIXI.Sprite{constructor(t){super(t),this._fillDir=0,this._flip=0,this._percent=0}get flip(){return this._flip}set flip(t){t!=this._flip&&(this._flip=t)}get fillAmount(){return"number"==typeof this._fillAmount?this._fillAmount:100}set fillAmount(t){t!=this._fillAmount&&(this._fillAmount=t)}get fillBegin(){return this._fillBegin}set fillBegin(t){t!=this._fillBegin&&(this._fillBegin=t)}get fillMode(){return this._fillMode}set fillMode(t){t!=this._fillMode&&(this._fillMode=t,this.checkAndFixFillBegin())}get fillDirection(){return this._fillDir}set fillDirection(t){t!=this._fillDir&&(this._fillDir=t,this.checkAndFixFillBegin())}checkAndFixFillBegin(){switch(this._fillMode){case 1:0!=this._fillBegin&&1!=this._fillBegin&&(this._fillBegin=0);break;case 2:2!=this._fillBegin&&3!=this._fillBegin&&(this._fillBegin=2);break;case 3:4!=this._fillBegin&&6!=this._fillBegin&&5!=this._fillBegin&&7!=this._fillBegin&&(this._fillBegin=4);break;case 4:case 5:0!=this._fillBegin&&1!=this._fillBegin&&2!=this._fillBegin&&3!=this._fillBegin&&(this._fillBegin=2)}}set amount(t){this._percent=t}get amount(){return this._percent}}}(fgui||(fgui={})),function(t){t.Frame=class{constructor(){this.addDelay=0}}}(fgui||(fgui={})),function(t){!function(t){class e{static encodeHTML(t){return t?t.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace("'","&apos;"):""}static getFileName(t){let e=t.lastIndexOf("/");return-1!=e&&(t=t.substr(e+1)),-1!=(e=t.lastIndexOf("\\"))&&(t=t.substr(e+1)),-1!=(e=t.lastIndexOf("."))?t.substring(0,e):t}static startsWith(t,e,i=!1){return!!t&&(!(t.length<e.length)&&(t=t.substring(0,e.length),i?t.toLowerCase()==e.toLowerCase():t==e))}static endsWith(t,e,i=!1){return!!t&&(!(t.length<e.length)&&(t=t.substring(t.length-e.length),i?t.toLowerCase()==e.toLowerCase():t==e))}static trim(t){return e.trimLeft(e.trimRight(t))}static trimLeft(t){let e,i="";for(e=0;e<t.length&&(" "==(i=t.charAt(e))||"\n"==i||"\r"==i);e++);return t.substr(e)}static trimRight(t){let e,i="";for(e=t.length-1;e>=0&&(" "==(i=t.charAt(e))||"\n"==i||"\r"==i);e--);return t.substring(0,e+1)}static convertToHtmlColor(t,e=!1){let i;i=e?(t>>24&255).toString(16):"";let s=(t>>16&255).toString(16),h=(t>>8&255).toString(16),n=(255&t).toString(16);return 1==i.length&&(i=`0${i}`),1==s.length&&(s=`0${s}`),1==h.length&&(h=`0${h}`),1==n.length&&(n=`0${n}`),`#${i}${s}${h}${n}`}static convertFromHtmlColor(t,e=!1){return t.length<1?0:("#"==t.charAt(0)&&(t=t.substr(1)),8==t.length?(parseInt(t.substr(0,2),16)<<24)+parseInt(t.substr(2),16):e?4278190080+parseInt(t,16):parseInt(t,16))}}t.StringUtil=e}(t.utils||(t.utils={}))}(fgui||(fgui={})),function(t){!function(t){t.Binder=class{static create(t,e,...i){return e?function(){let s=arguments.length>0?[].concat(Array.prototype.slice.call(arguments)).concat(i):[].concat(i);t.apply(e,s)}:t}}}(t.utils||(t.utils={}))}(fgui||(fgui={})),function(t){class e{}e.CHANGED="__focusChanged",t.FocusEvent=e}(fgui||(fgui={})),function(t){t.InputElement=class extends PIXI.utils.EventEmitter{constructor(t){super(),this.$requestToShow=!1,this.inputElement=null,this.inputDiv=null,this.$scaleX=0,this.$scaleY=0,this.textValue="",this.colorValue=16777215,this.$attrsCache={},this.$textfield=t}$addToStage(){this.htmlInput=t.HTMLInput.inst}initElement(){let t=this.$textfield.localToGlobal(0,0),e=t.x,i=t.y,s=this.htmlInput.$scaleX,h=this.htmlInput.$scaleY;this.$textfield.multipleLine||(this.inputElement.style.top=-this.$textfield.leading*h+"px"),this.inputDiv.style.top=(i+1)*h+"px",this.inputDiv.style.left=e*s+"px";let n=this.$textfield,r=1,l=1,a=0;for(;n.parent;)r*=n.scaleX,l*=n.scaleY,a+=n.rotation,n=n.parent;let o=this.inputDiv.style;o.transform=o.webkitTransform=o.msTransform=o.mozTransform=o.oTransform="rotate("+a+"deg)",this.$scaleX=s*r,this.$scaleY=h*l}get textField(){return this.$textfield}$show(){if(this.htmlInput.isCurrentInput(this))this.inputElement.onblur=null;else{this.inputElement=this.htmlInput.requestInput(this),this.$textfield.multipleLine||(this.inputElement.type=this.$textfield.type);for(let t in this.$attrsCache)this.inputElement.setAttribute(t,this.$attrsCache[t]);this.inputDiv=this.htmlInput.$wrapper}this.htmlInput.$requestToShow=!0,this.$requestToShow=!0,this.initElement()}onBlurHandler(){this.htmlInput.clearInputElement(),this.htmlInput.clearAttributes(this.$attrsCache),window.scrollTo(0,0)}$hide(){}get text(){return this.textValue||(this.textValue=""),this.textValue}set text(t){this.textValue=t,this.inputElement&&(this.inputElement.value=this.textValue)}setColor(e){this.colorValue=e,this.inputElement&&this.setElementStyle("color",t.utils.StringUtil.convertToHtmlColor(this.colorValue))}$onBlur(){}onInputHandler(){window.setTimeout(()=>{this.inputElement&&this.inputElement.selectionStart==this.inputElement.selectionEnd&&(this.textValue=this.inputElement.value,this.emit("updateText"))},0)}setAreaHeight(){let t=this.$textfield;if(t.multipleLine){let e=t.textHeight;if(t.height<=t.fontSize)this.setElementStyle("height",t.fontSize*this.$scaleY+"px"),this.setElementStyle("padding","0px"),this.setElementStyle("lineHeight",t.lineHeight*this.$scaleY+"px");else if(t.height<e)this.setElementStyle("height",t.height*this.$scaleY+"px"),this.setElementStyle("padding","0px"),this.setElementStyle("lineHeight",t.lineHeight*this.$scaleY+"px");else{this.setElementStyle("height",(e+t.leading)*this.$scaleY+"px");let i=(t.height-e)*this.$scaleY,s=i*this.getVAlignFactor(t),h=i-s;this.setElementStyle("padding",s+"px 0px "+h+"px 0px"),this.setElementStyle("lineHeight",t.lineHeight*this.$scaleY+"px")}}}getVAlignFactor(t){let e=0;switch(t.verticalAlign){case 0:break;case 1:e=.5;break;case 2:e=1}return e}onClickHandler(e){this.$requestToShow&&(this.$requestToShow=!1,this.inputElement.value=this.text,null==this.inputElement.onblur&&(this.inputElement.onblur=t.utils.Binder.create(this.onBlurHandler,this)),this.resetInput(),this.$textfield.maxLength>0?this.inputElement.setAttribute("maxlength",String(this.$textfield.maxLength)):this.inputElement.removeAttribute("maxlength"),this.inputElement.selectionStart=this.inputElement.value.length,this.inputElement.selectionEnd=this.inputElement.value.length,this.inputElement.focus(),this.emit(t.FocusEvent.CHANGED,"focus",this.inputElement))}onDisconnect(){this.inputElement=null,this.emit(t.FocusEvent.CHANGED,"blur",this.inputElement)}setElementStyle(t,e){null!=e&&this.inputElement&&(this.inputElement.style[t]=e)}setAttribute(t,e){null!=t&&null!=e&&(this.$attrsCache[t]=e)}getAttribute(t){return this.$attrsCache[t]}$removeFromStage(){this.inputElement&&this.htmlInput.disconnect(this)}resetInput(){if(this.inputElement){let e=this.$textfield;this.setElementStyle("fontFamily",e.font),this.setElementStyle("fontStyle",e.italic?"italic":"normal"),this.setElementStyle("fontWeight",e.bold?"bold":"normal"),this.setElementStyle("textAlign",e.align),this.setElementStyle("fontSize",e.fontSize*this.$scaleY+"px"),this.setElementStyle("color",t.utils.StringUtil.convertToHtmlColor(e.color)),this.setElementStyle("width",e.width*this.$scaleX+"px");let i="middle",s=0;switch(e.verticalAlign){case 0:i="top";break;case 1:i="middle",s=.5;break;case 2:i="bottom",s=1}if(this.setElementStyle("verticalAlign",i),e.multipleLine)this.setAreaHeight();else if(this.setElementStyle("lineHeight",e.lineHeight*this.$scaleY+"px"),e.height<e.fontSize)this.setElementStyle("height",e.fontSize*this.$scaleY+"px"),this.setElementStyle("padding","0px 0px "+.5*e.fontSize*this.$scaleX+"px 0px");else{this.setElementStyle("height",e.fontSize*this.$scaleY+"px");let t=(e.height-e.fontSize)*this.$scaleY,i=t*s,h=t-i,n=.5*e.fontSize*this.$scaleY;h<n&&(h=n),this.setElementStyle("padding",i+"px 0px "+h+"px 0px")}this.inputDiv.style.clip="rect(0px "+e.width*this.$scaleX+"px "+e.height*this.$scaleY+"px 0px)",this.inputDiv.style.height=e.height*this.$scaleY+"px",this.inputDiv.style.width=e.width*this.$scaleX+"px"}}}}(fgui||(fgui={})),function(t){class e{constructor(){this.$requestToShow=!1,this.$scaleX=1,this.$scaleY=1}static get inst(){return e.$instance||(e.$instance=new e),e.$instance}initialize(e,i){let s;this.$canvas=i,this.$delegateDiv||(s=document.createElement("div"),this.$delegateDiv=s,s.id="__delegateDiv",e.appendChild(s),this.initDomPos(s),this.$wrapper=document.createElement("div"),this.initDomPos(this.$wrapper),this.$wrapper.style.width="0px",this.$wrapper.style.height="0px",this.$wrapper.style.left="0px",this.$wrapper.style.top="-100px",this.setTransform(this.$wrapper,"0% 0% 0px"),s.appendChild(this.$wrapper),t.GRoot.inst.on(t.InteractiveEvents.Click,this.canvasClickHandler,this),this.initInputElement(!0),this.initInputElement(!1))}isInputOn(){return null!=this.$input}canvasClickHandler(t){this.$requestToShow?(this.$requestToShow=!1,this.$input.onClickHandler(t),this.show()):this.$curEle&&(this.clearInputElement(),this.$curEle.blur(),this.$curEle=null)}isInputShown(){return null!=this.$input}isCurrentInput(t){return this.$input==t}initDomPos(t){t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.border="none",t.style.padding="0"}setTransform(t,e,i){let s=t.style;s.transformOrigin=s.webkitTransformOrigin=s.msTransformOrigin=s.mozTransformOrigin=s.oTransformOrigin=e,i&&i.length>0&&(s.transform=s.webkitTransform=s.msTransform=s.mozTransform=s.oTransform=i)}updateSize(t,e){if(!this.$canvas)return;this.$scaleX=t,this.$scaleY=e,this.$delegateDiv.style.left=this.$canvas.style.left,this.$delegateDiv.style.top=this.$canvas.style.top;let i=this.$canvas.style;this.setTransform(this.$delegateDiv,"0% 0% 0px",i.transform||i.webkitTransform||i.msTransform||i.mozTransform||i.oTransform)}initInputElement(t){let e;t?((e=document.createElement("textarea")).style.resize="none",this.$multiLine=e,e.id="stageTextAreaEle"):(e=document.createElement("input"),this.$singleLine=e,e.type="text",e.id="stageInputEle"),this.$wrapper.appendChild(e),e.setAttribute("tabindex","-1"),e.style.width="1px",e.style.height="12px",this.initDomPos(e);let i=e.style;i.outline="thin",i.background="none",i.overflow="hidden",i.wordBreak="break-all",i.opacity=0,e.oninput=(t=>{this.$input&&this.$input.onInputHandler()})}show(){t.GTimer.inst.callLater(()=>{this.$curEle.style.opacity="1"},this)}disconnect(t){null!=this.$input&&this.$input!=t||(this.clearInputElement(),this.$curEle&&this.$curEle.blur())}clearAttributes(t){if(this.$curEle)for(let e in t)this.$curEle.removeAttribute(e)}clearInputElement(){if(this.$curEle){this.$curEle.value="",this.$curEle.onblur=null;let t,e=this.$curEle.style;e.width="1px",e.height="12px",e.left="0px",e.top="0px",e.opacity="0",(t=this.$singleLine==this.$curEle?this.$multiLine:this.$singleLine).style.display="block",this.$wrapper.style.left="0px",this.$wrapper.style.top="-100px",this.$wrapper.style.height="0px",this.$wrapper.style.width="0px"}this.$input&&(this.$input.onDisconnect(),this.$input=null,e.isTyping=!1)}requestInput(t){let i;return this.clearInputElement(),this.$input=t,e.isTyping=!0,this.$input.textField.multipleLine?(this.$curEle=this.$multiLine,i=this.$singleLine):(this.$curEle=this.$singleLine,i=this.$multiLine),i.style.display="none",this.$curEle}}e.isTyping=!1,t.HTMLInput=e}(fgui||(fgui={})),function(t){t.isUIObject=function(t){return t&&"UIOwner"in t&&null!=t.UIOwner}}(fgui||(fgui={})),function(t){t.DefaultMovieClipSettings=class{constructor(){this.startFrame=0,this.endFrame=-1,this.repeatCount=0,this.loopEndAt=-1,this.endCallback=null,this.endCallbackContext=null}mix(t){let e=this;for(let i in t)"mix"!=i&&(e[i]=t[i]);return this}}}(fgui||(fgui={})),function(t){t.MovieClipData=class{constructor(){this.repeatedCount=0,this.$curFrame=0,this.$lastTime=0,this.$curFrameDelay=0,this.$lastTime=Date.now()}update(t){let e=Date.now(),i=e-this.$lastTime;this.$lastTime=e;let s=this.$curFrame;s>=t.frameCount&&(s=t.frameCount-1),this.reachesEnd=!1,this.$curFrameDelay+=i;let h=t.interval+t.frames[s].addDelay+(0==s&&this.repeatedCount>0?t.repeatDelay:0);this.$curFrameDelay<h||(this.$curFrameDelay-=h,this.$curFrameDelay>t.interval&&(this.$curFrameDelay=t.interval),t.swing?this.reversed?(this.$curFrame--,this.$curFrame<0&&(this.$curFrame=Math.min(1,t.frameCount-1),this.repeatedCount++,this.reversed=!this.reversed)):(this.$curFrame++,this.$curFrame>t.frameCount-1&&(this.$curFrame=Math.max(0,t.frameCount-2),this.repeatedCount++,this.reachesEnd=!0,this.reversed=!this.reversed)):(this.$curFrame++,this.$curFrame>t.frameCount-1&&(this.$curFrame=0,this.repeatedCount++,this.reachesEnd=!0)))}get currentFrame(){return this.$curFrame}set currentFrame(t){this.$curFrame=t,this.$curFrameDelay=0}rewind(){this.$curFrame=0,this.$curFrameDelay=0,this.reversed=!1,this.reachesEnd=!1}reset(){this.$curFrame=0,this.$curFrameDelay=0,this.repeatedCount=0,this.reachesEnd=!1,this.reversed=!1}copy(t){this.$curFrame=t.$curFrame,this.$curFrameDelay=t.$curFrameDelay,this.repeatedCount=t.repeatedCount,this.reachesEnd=t.reachesEnd,this.reversed=t.reversed}}}(fgui||(fgui={})),function(t){!function(t){class e{static clamp(t,e,i){return t<e?t=e:t>i&&(t=i),t}static clamp01(t){return t>1?t=1:t<0&&(t=0),t}static isNumber(t){return"number"==typeof t&&!isNaN(t)}static sign(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1}static angleToRadian(t){return t*e.RADIAN}static lerp(t,e,i){return t+i*(e-t)}}e.RADIAN=Math.PI/180,t.NumberUtil=e}(t.utils||(t.utils={}))}(fgui||(fgui={})),function(t){t.MovieClip=class extends PIXI.Sprite{constructor(e){super(),this.interval=0,this.repeatDelay=0,this.$frameCount=0,this.$currentFrame=0,this.$status=0,this.UIOwner=e,this.data=new t.MovieClipData,this.$playing=!0,this.interactive=this.interactiveChildren=!1,this.$settings=new t.DefaultMovieClipSettings,this.visible,this.on("added",this.added,this),this.on("removed",this.removed,this)}get frames(){return this.$frames}set frames(t){this.$frames=t,null!=this.$frames?this.$frameCount=this.$frames.length:this.$frameCount=0,(-1==this.$settings.endFrame||this.$settings.endFrame>this.$frameCount-1)&&(this.$settings.endFrame=this.$frameCount-1),(-1==this.$settings.loopEndAt||this.$settings.loopEndAt>this.$frameCount-1)&&(this.$settings.loopEndAt=this.$frameCount-1),(this.$currentFrame<0||this.$currentFrame>this.$frameCount-1)&&(this.$currentFrame=this.$frameCount-1),this.$frameCount>0?this.setFrame(this.$frames[this.$currentFrame]):this.setFrame(null),this.data.rewind()}get frameCount(){return this.$frameCount}get boundsRect(){return this._bounds.getRectangle(PIXI.Rectangle.EMPTY)}set boundsRect(t){this._bounds.addBoundsArea(new PIXI.Bounds,t)}get currentFrame(){return this.$currentFrame}set currentFrame(t){this.$currentFrame!=t&&(this.$currentFrame=t,this.data.currentFrame=t,this.setFrame(this.$currentFrame<this.$frameCount?this.$frames[this.$currentFrame]:null))}get playing(){return this.$playing}set playing(e){this.$playing=e,e&&t.GObject.isDisplayObjectOnStage(this)?t.GTimer.inst.add(0,0,this.update,this):t.GTimer.inst.remove(this.update,this)}setPlaySettings(...e){if(1==e.length&&"object"==typeof e[0])this.$settings.mix(e[0]);else{let i=e[0],s=e[1],h=e[2],n=e[3],r=e[4],l=e[5],a={};t.utils.NumberUtil.isNumber(i)&&(a.startFrame=i),t.utils.NumberUtil.isNumber(s)&&(a.endFrame=s),t.utils.NumberUtil.isNumber(h)&&(a.repeatCount=h),t.utils.NumberUtil.isNumber(n)&&(a.loopEndAt=n),r&&"function"==typeof r&&(a.endCallback=r),l&&(a.endCallbackContext=l),this.$settings.mix(a)}(-1==this.$settings.endFrame||this.$settings.endFrame>this.$frameCount-1)&&(this.$settings.endFrame=this.$frameCount-1),-1==this.$settings.loopEndAt&&(this.$settings.loopEndAt=this.$settings.endFrame),this.$status=0,this.currentFrame=this.$settings.startFrame}update(){this.UIOwner.$inProgressBuilding||this.$playing&&0!=this.$frameCount&&3!=this.$status&&(this.data.update(this),this.$currentFrame!=this.data.currentFrame&&(1==this.$status?(this.$currentFrame=this.$settings.startFrame,this.data.currentFrame=this.$currentFrame,this.$status=0):2==this.$status?(this.$currentFrame=this.$settings.loopEndAt,this.data.currentFrame=this.$currentFrame,this.$status=3,null!=this.$settings.endCallback&&t.GTimer.inst.callLater(this.$playEnd,this)):(this.$currentFrame=this.data.currentFrame,this.$currentFrame==this.$settings.endFrame&&this.$settings.repeatCount>0&&(this.$settings.repeatCount--,0==this.$settings.repeatCount?this.$status=2:this.$status=1)),this.setFrame(this.$frames[this.$currentFrame])))}$playEnd(){if(null!=this.$settings.endCallback){let t=this.$settings.endCallback,e=this.$settings.endCallbackContext;this.$settings.endCallback=this.$settings.endCallbackContext=null,this.$settings.endCallbackContext=null,t&&t.call(e,this)}}setFrame(t){this.texture=null==t?null:t.texture,this._textureID=-1}added(e){this.$playing&&t.GTimer.inst.add(0,0,this.update,this)}removed(e){this.$playing&&t.GTimer.inst.remove(this.update,this)}destroy(){t.GTimer.inst.remove(this.update,this),this.off("added",this.added,this),this.off("removed",this.removed,this),super.destroy()}}}(fgui||(fgui={})),function(t){t.UIContainer=class extends PIXI.Container{constructor(t){super(),this.UIOwner=t,this.interactive=!0,this.interactiveChildren=!0}get scrollRect(){return this.$scrollRect}set scrollRect(t){this.$scrollRect=t,null!=t?(this.$rectMask||(this.$rectMask=new PIXI.Graphics,this.$rectMask.isMask=!0,this.addChild(this.$rectMask),this.mask=this.$rectMask),this.$rectMask.clear(),t.width>0&&t.height>0&&(this.$rectMask.beginFill(0,1),this.$rectMask.drawRect(this.$scrollRect.x,this.$scrollRect.y,this.$scrollRect.width,this.$scrollRect.height),this.$rectMask.endFill())):this.mask=null}}}(fgui||(fgui={})),function(t){t.UIImage=class extends PIXI.Container{constructor(t){super(),this.UIOwner=t,this.interactive=this.interactiveChildren=!1}$initDisp(t){if(!this.$disp){if(t)if(t.load(),t.scaleByTile){let e=new PIXI.extras.TilingSprite(t.id,t.texture);this.$disp=e}else t.scale9Grid?(this.$disp=new PIXI.extras.NineSlicePlane(t.texture,t.scale9Grid.left,t.scale9Grid.top,Math.max(0,t.texture.width-t.scale9Grid.width-t.scale9Grid.x),Math.max(0,t.texture.height-t.scale9Grid.height-t.scale9Grid.y)),this.tiledSlices=t.tiledSlices):this.$disp=new PIXI.extras.Sprite(t.id,t.texture);else this.$disp=new PIXI.extras.Sprite;this.addChild(this.$disp)}}get tint(){return this.$disp.tint}set tint(t){this.$disp.tint=t}get height(){return this.$disp.height}set height(t){this.$disp.height=t}get width(){return this.$disp.width}set width(t){this.$disp.width=t}get texture(){return this.$disp.texture}set texture(t){this.$disp.texture=t}get scale9Grid(){return this.$disp instanceof PIXI.NineSlicePlane?new PIXI.Rectangle(this.$disp.leftWidth,this.$disp.topHeight,this.$disp.rightWidth,this.$disp.bottomHeight):null}set scale9Grid(t){this.$disp instanceof PIXI.NineSlicePlane&&(t.left!=this.$disp.leftWidth&&(this.$disp.leftWidth=t.left),t.top!=this.$disp.topHeight&&(this.$disp.topHeight=t.top),t.right!=this.$disp.rightWidth&&(this.$disp.rightWidth=t.right),t.bottom!=this.$disp.bottomHeight&&(this.$disp.bottomHeight=t.bottom))}get tiledSlices(){return 0}set tiledSlices(t){}get flipX(){return this.$disp.flipX}get flipY(){return this.$disp.flipY}set flipX(e){t.GRoot.inst.applicationContext.renderer.type==PIXI.RENDERER_TYPE.WEBGL&&(this.$disp.flipX=e)}set flipY(e){t.GRoot.inst.applicationContext.renderer.type==PIXI.RENDERER_TYPE.WEBGL&&(this.$disp.flipY=e)}destroy(t){this.$disp&&(this.$disp.destroy(t),this.$disp=null),super.destroy(t)}}}(fgui||(fgui={})),function(t){t.UISprite=class extends PIXI.Graphics{constructor(t){super(),this.UIOwner=t,this.interactive=!1,this.interactiveChildren=!1}}}(fgui||(fgui={})),function(t){!function(e){class i extends PIXI.utils.EventEmitter{constructor(){super(),this.retEvent={},this.nullLowestDeltaTimeout=NaN,this.$pressedKeys={},this.$releasedKeys={},this.$downKeys=[],window.addEventListener("resize",t=>this.notifyResizeEvents(t),!1),window.addEventListener("keydown",t=>this.onWindowKeyDown(t),!1),window.addEventListener("keyup",t=>this.onWindowKeyUp(t),!1);const t="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];for(let e=t.length;e;)window.addEventListener(t[--e],t=>this.onMouseWheel(t),!1)}notifyResizeEvents(t){this.emit("resize")}onMouseWheel(e){let i=e||window.event,s=0,h=0,n=0,r=0;if("detail"in i&&(n=-1*i.detail),"wheelDelta"in i&&(n=i.wheelDelta),"wheelDeltaY"in i&&(n=i.wheelDeltaY),"wheelDeltaX"in i&&(h=-1*i.wheelDeltaX),"axis"in i&&i.axis===i.HORIZONTAL_AXIS&&(h=-1*n,n=0),s=0===n?h:n,"deltaY"in i&&(s=n=-1*i.deltaY),"deltaX"in i&&(h=i.deltaX,0===n&&(s=-1*h)),0!==n||0!==h){if(1===i.deltaMode){const t=16;s*=t,n*=t,h*=t}else if(2===i.deltaMode){const t=16;s*=t,n*=t,h*=t}r=Math.max(Math.abs(n),Math.abs(h)),(!this.lowestDelta||r<this.lowestDelta)&&(this.lowestDelta=r,"mousewheel"===i.type&&r%120==0&&(this.lowestDelta/=40)),"mousewheel"===i.type&&r%120==0&&(s/=40,h/=40,n/=40),s=Math[s>=1?"floor":"ceil"](s/this.lowestDelta),h=Math[h>=1?"floor":"ceil"](h/this.lowestDelta),n=Math[n>=1?"floor":"ceil"](n/this.lowestDelta),this.retEvent.delta=s,this.retEvent.deltaX=h,this.retEvent.deltaY=n,this.retEvent.deltaFactor=this.lowestDelta,this.retEvent.deltaMode=0,this.nullLowestDeltaTimeout&&clearTimeout(this.nullLowestDeltaTimeout),this.nullLowestDeltaTimeout=setTimeout(()=>this.nullLowestDelta(),200),this.emit(t.DisplayObjectEvent.MOUSE_WHEEL,this.retEvent)}}nullLowestDelta(){this.lowestDelta=null}isKeyDown(t){return this.$downKeys.indexOf(t)>=0}isKeyPressed(t){return!!this.$pressedKeys[t]}isKeyReleased(t){return!!this.$releasedKeys[t]}onWindowKeyDown(t){let e=t.which||t.keyCode;this.isKeyDown(e)||(this.$downKeys.push(e),this.$pressedKeys[e]=!0,this.emit("keyPressed",e))}onWindowKeyUp(t){let e=t.which||t.keyCode;if(this.isKeyDown(e)){this.$pressedKeys[e]=!1,this.$releasedKeys[e]=!0;let t=this.$downKeys.indexOf(e);t>=0&&this.$downKeys.splice(t,1),this.emit("keyReleased",e)}}}i.inst=new i,e.DOMEventManager=i}(t.utils||(t.utils={}))}(fgui||(fgui={})),function(t){class e{constructor(){this.scaleMode="showAll",this.orientation="auto",this.resolution=1,this.designWidth=800,this.designHeight=600,this.alignV=4,this.alignH=1,this.fallbackWidth=0,this.fallbackHeight=0,this.initliazeHTMLInput=void 0}}t.DefaultUIStageOptions=e;class i{getRect(t,e,i){let s=t.parentElement;if(!s)throw new Error("Your view of PIXI are still in memory but not appended to DOM yet? it's necessary that there is a parent element to wrap your view up.");let h=s.getBoundingClientRect(),n={x:0,y:0,width:0,height:0};return!h||h.width<=0||h.height<=0?(console.warn("It seems that you did not set a explicit size for the parent element of your view, now fall back to window size instead."),n.width=window.innerWidth,n.height=window.innerHeight,n.x=0,n.y=0):(n.x=h.left,n.y=h.top,n.width=h.width,n.height=h.height),(n.width<=0||n.height<=0)&&(console.warn("fetch container size to initialize PIXI in all ways have failed, now use default size (fallbackWidth / fallbackHeight) specified in the options instead."),n.width=e,n.height=i),n}}t.UIStage=class extends PIXI.utils.EventEmitter{constructor(h,n){let r;if(super(),this.$width=0,this.$height=0,this.$scaleX=1,this.$scaleY=1,this.$canvasMatrix=new PIXI.Matrix,this.offsetX=0,this.offsetY=0,this.$sizeCalcer=new i,s.push(this),this.$appContext=h,this.$appStage=h.stage,this.$appStage.interactive=!0,n instanceof e)r=n;else if(r=new e,null!=n)for(let t in n)r[t]=n[t];if(!r.designWidth||!r.designHeight)throw new Error("Invalid designWidth / designHeight in the parameter 'stageOptions'.");if(this.$options=r,null==r.initliazeHTMLInput||r.initliazeHTMLInput){this.$appContext.view.style.position="absolute";let e,i=this.$appContext.view.parentElement,s=i.style;"DIV"!=i.tagName&&(i=document.createElement("DIV"),s.position="relative",s.left=s.top="0px",s.width=s.height="100%",s.overflow="hidden",this.$appContext.view.parentElement.appendChild(i),i.appendChild(this.$appContext.view)),""!=(e=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(i).position:s.position)&&"static"!=e||(e="relative",i.style.position=e),t.HTMLInput.inst.initialize(i,this.$appContext.view),this.updateScreenSize()}}get orientation(){return this.$options.orientation}get stageWidth(){return this.$width}get stageHeight(){return this.$height}get applicationContext(){return this.$appContext}get nativeStage(){return this.$appStage}get resolution(){return this.$options.resolution}set resolution(t){this.$options.resolution=t,this.updateScreenSize()}get scaleX(){return this.$scaleX}get scaleY(){return this.$scaleY}get designWidth(){return this.$options.designWidth}get designHeight(){return this.$options.designHeight}setDesignSize(t,e){let i=this.$options;i.designWidth=t,i.designHeight=e,this.updateScreenSize()}calculateStageSize(t,e,i,s,h){let n=e,r=i,l=s,a=h,o=e/l||0,$=i/a||0;switch(t){case"exactFit":break;case"fixedHeight":l=Math.round(e/$);break;case"fixedWidth":a=Math.round(i/o);break;case"noBorder":o>$?r=Math.round(a*o):n=Math.round(l*$);break;case"showAll":o>$?n=Math.round(l*$):r=Math.round(a*o);break;case"fixedAuto":n/r<l/a?($=o,a=Math.round(i/o)):(o=$,l=Math.round(e/$));break;default:l=e,a=i}return{stageWidth:l,stageHeight:a,displayWidth:n,displayHeight:r}}updateScreenSize(){if(t.HTMLInput.isTyping)return;let e=this.$appContext.view,i=e.style,s=this.$sizeCalcer.getRect(e,this.$options.fallbackWidth,this.$options.fallbackHeight),h=!1,n=this.$options.orientation;"auto"!=n&&(h="portrait"!=n&&s.height>s.width||"portrait"==n&&s.width>s.height);let r=h?s.height:s.width,l=h?s.width:s.height,a=this.calculateStageSize(this.$options.scaleMode,r,l,this.$options.designWidth,this.$options.designHeight),o=a.stageWidth,$=a.stageHeight,c=a.displayWidth,u=a.displayHeight;e.width!==o&&(e.width=o),e.height!==$&&(e.height=$),i.transformOrigin=i.webkitTransformOrigin=i.msTransformOrigin=i.mozTransformOrigin=i.oTransformOrigin="0px 0px 0px",i.width=c+"px",i.height=u+"px",this.$appContext.renderer.resize(o,$);let d,g,p=this.$canvasMatrix.identity(),f=h?u:c,m=h?c:u;d=0==this.$options.alignH?0:2==this.$options.alignH?s.width-f:.5*(s.width-f),g=3==this.$options.alignV?0:5==this.$options.alignV?s.height-m:.5*(s.height-m);let w=0;h?"landscape"==this.$options.orientation?(p.rotate(Math.PI/2),p.translate(l-d,g),w=90):(p.rotate(-Math.PI/2),p.translate(d,r-g),w=-90):p.translate(d,g),h?(p.tx+=this.offsetY,p.ty+=this.offsetX):(p.tx+=this.offsetX,p.ty+=this.offsetY),p.a=this.formatData(p.a),p.d=this.formatData(p.d),p.tx=this.formatData(p.tx),p.ty=this.formatData(p.ty),i.transformOrigin=i.webkitTransformOrigin=i.msTransformOrigin=i.mozTransformOrigin=i.oTransformOrigin="0px 0px 0px",i.transform=i.webkitTransform=i.msTransform=i.mozTransform=i.oTransform=`matrix(${p.a},${p.b},${p.c},${p.d},${p.tx},${p.ty})`,this.$width=o,this.$height=$,this.$scaleX=o/c,this.$scaleY=$/u;let y=this.$appContext.renderer.plugins.interaction;y.stageRotation=w,y.stageScaleX=this.$scaleX,y.stageScaleY=this.$scaleY,this.$appContext.renderer.resize(o,$),t.HTMLInput.inst.updateSize(c/o,u/$),this.emit(t.DisplayObjectEvent.SIZE_CHANGED,this)}formatData(t){return Math.abs(t)<1e-6?0:Math.abs(1-t)<.001?t>0?1:-1:t}dispose(){let t=s.length;for(;t-- >=0;)s[t]===this&&s.splice(t,1)}};let s=[]}(fgui||(fgui={})),function(t){PIXI.TextMetrics.canBreakChars=function(t,e,i,s,h){return 2!=function(t,e){const i=t,s="number"==typeof e&&!isNaN(e)&&e>0;if(i>=55296&&i<=56319){if(s){const t=1024*(i-55296)+(e-56320)+65536;if(t>=118784&&t<=128895)return 2}}else{if(i>=8448&&i<=10239||i>=11013&&i<=11015||i>=10548&&i<=10549||i>=12951&&i<=12953||169===i||174===i||12349===i||12336===i||11093===i||11036===i||11035===i||11088===i||8986===i)return 1;if(s&&(8419===e||65039===e||55356===e))return 2}return 0}(t.charCodeAt(0),e&&e.charCodeAt(0))},PIXI.TextMetrics.isBreakingSpace=function(t){return"string"==typeof t&&(" "!==t&&PIXI.TextMetrics._breakingSpaces.indexOf(t.charCodeAt(0))>=0)};t.UITextField=class extends PIXI.Text{constructor(t){super(""),this.$minHeightID=-1,this.$width=0,this.$height=0,this.UIOwner=t,this.interactive=this.interactiveChildren=!1,this.texture.noFrame=!1,this.$width=this.texture.frame.width,this.$height=this.texture.frame.height,this.$minHeight=-1,this.texture.on("update",this.updateFrame,this)}get minHeight(){return this.$minHeight}$updateMinHeight(){(this.style.styleID!=this.$minHeightID||this.$minHeight<=0)&&(this.$minHeight=PIXI.TextMetrics.measureText("",this.style,!1).lineHeight,this.$minHeightID=this.style.styleID)}updateFrame(){t.GTimer.inst.callLater(this.internalUpdateFrame,this)}internalUpdateFrame(){if(this.texture){let t=this.texture.frame;this.$height=Math.max(this.$height,this.$minHeight);let e=t.x+this.$width,i=t.y+this.$height;e>this.texture.baseTexture.width&&(e=this.texture.baseTexture.width-t.x),i>this.texture.baseTexture.height&&(i=this.texture.baseTexture.height-t.y),t.width=e/this.resolution,t.height=i/this.resolution,this.texture.trim.width=t.width,this.texture.trim.height=t.height;let s=this.style.trim?0:this.style.padding;this.texture.trim.x=-s,this.texture.trim.y=-s,this.texture.frame=t}}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1}get width(){return this.$width}set width(t){this.$width=t,this.updateFrame()}get height(){return this.$height}set height(t){this.$height=t,this.updateFrame()}get textHeight(){return this.updateText(!0),this.texture.orig.height}set textHeight(t){}get textWidth(){return this.updateText(!0),this.texture.orig.width}set textWidth(t){t!=this.style.wordWrapWidth&&(this.style.wordWrapWidth=t)}}}(fgui||(fgui={})),function(t){class e{}e.XY_CHANGED="__xyChanged",e.SIZE_CHANGED="__sizeChanged",e.VISIBLE_CHANGED="__visibleChanged",e.SIZE_DELAY_CHANGE="__sizeDelayChange",e.MOUSE_WHEEL="__mouseWheel",t.DisplayObjectEvent=e}(fgui||(fgui={})),function(t){class e{}e.START="__dragStart",e.END="__dragEnd",e.MOVING="__dragMoving",e.DROP="__dragDrop",t.DragEvent=e}(fgui||(fgui={})),function(t){class e{}e.GEAR_STOP="__gearStop",t.GearEvent=e}(fgui||(fgui={})),function(t){class e{}e.ItemClick="__itemClick",t.ListEvent=e}(fgui||(fgui={})),function(t){class e{}e.SCROLL="__scroll",e.SCROLL_END="__scrollEnd",e.PULL_DOWN_RELEASE="__pullDownRelease",e.PULL_UP_RELEASE="__pullUpRelease",t.ScrollEvent=e}(fgui||(fgui={})),function(t){class e{}e.LinkClick="__linkClick",e.Change="__textChange",e.FocusIn="__textFocusIn",e.FocusOut="__textFocusOut",t.TextEvent=e}(fgui||(fgui={})),function(t){t.DisplayListItem=class{constructor(t,e){this.packageItem=t,this.type=e}}}(fgui||(fgui={})),function(t){t.PackageItem=class{constructor(){this.width=0,this.height=0,this.tiledSlices=0,this.interval=0,this.repeatDelay=0}load(){return this.owner.getItemAsset(this)}toString(){return this.name}}}(fgui||(fgui={})),function(t){class e{static setPackageItemExtension(t,i){e.packageItemExtensions[t.substring(5)]=i}static setLoaderExtension(t){e.loaderExtension=t}static newObject(i){switch(i.type){case 0:return new t.GImage;case 2:return new t.GMovieClip;case 4:let s=e.packageItemExtensions[i.owner.id+i.id]||e.packageItemExtensions[i.owner.name+"/"+i.name];if(s)return new s;let h=i.owner.getItemAsset(i).attributes.extention;if(null==h)return new t.GComponent;switch(h){case"Button":return new t.GButton;case"ProgressBar":return new t.GProgressBar;case"Label":return new t.GLabel;case"Slider":return new t.GSlider;case"ScrollBar":return new t.GScrollBar;case"ComboBox":return new t.GComboBox;default:return new t.GComponent}}return null}static newObjectDirectly(i){switch(i){case"image":return new t.GImage;case"movieclip":return new t.GMovieClip;case"component":return new t.GComponent;case"text":return new t.GTextField;case"list":return new t.GList;case"richtext":return new t.GRichTextField;case"inputtext":return new t.GTextInput;case"group":return new t.GGroup;case"graph":return new t.GGraph;case"loader":return null!=e.loaderExtension?new e.loaderExtension:new t.GLoader}return null}}e.packageItemExtensions={},t.UIObjectFactory=e}(fgui||(fgui={})),function(t){const e=function(){var t=Uint8Array,e=Uint16Array,i=Uint32Array;const s=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),h=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]);var n=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r=function(t,s){for(var h=new e(31),n=0;n<31;++n)h[n]=s+=1<<t[n-1];var r=new i(h[30]);for(n=1;n<30;++n)for(var l=h[n];l<h[n+1];++l)r[l]=l-h[n]<<5|n;return[h,r]},l=r(s,2),a=l[0],o=l[1];a[28]=258,o[258]=28;var $,c=r(h,0),u=c[0],d=(c[1],new e(32768));for(f=0;f<32768;++f)$=(61680&($=(52428&($=(43690&f)>>>1|(21845&f)<<1))>>>2|(13107&$)<<2))>>>4|(3855&$)<<4,d[f]=((65280&$)>>>8|(255&$)<<8)>>>1;var g=function(t,i,s){for(var h=t.length,n=0,r=new e(i);n<h;++n)t[n]&&++r[t[n]-1];var l,a=new e(i);for(n=0;n<i;++n)a[n]=a[n-1]+r[n-1]<<1;if(s){l=new e(1<<i);var o=15-i;for(n=0;n<h;++n)if(t[n])for(var $=n<<4|t[n],c=i-t[n],u=a[t[n]-1]++<<c,g=u|(1<<c)-1;u<=g;++u)l[d[u]>>>o]=$}else for(l=new e(h),n=0;n<h;++n)t[n]&&(l[n]=d[a[t[n]-1]++]>>>15-t[n]);return l},p=new t(288);for(f=0;f<144;++f)p[f]=8;for(f=144;f<256;++f)p[f]=9;for(f=256;f<280;++f)p[f]=7;for(f=280;f<288;++f)p[f]=8;var f,m=new t(32);for(f=0;f<32;++f)m[f]=5;var w=g(p,9,1),y=g(m,5,1),b=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},I=function(t,e,i){var s=e/8|0;return(t[s]|t[s+1]<<8)>>(7&e)&i},x=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},C=function(t){return(t+7)/8|0},v=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"];const S=(t,e,i)=>{const s=new Error(e||v[t]);if(s.code=t,Error.captureStackTrace&&Error.captureStackTrace(s,S),!i)throw s;return s},P=(r,l,o)=>{const $=r.length;if(!$||o&&o.f&&!o.l)return l||new t(0);const c=!l||o,d=!o||o.i;o||(o={}),l||(l=new t(3*$));const p=e=>{let i=l.length;if(e>i){const s=new t(Math.max(2*i,e));s.set(l),l=s}};let f=o.f||0,m=o.p||0,v=o.b||0,P=o.l,E=o.d,T=o.m,O=o.n;const k=8*$;do{if(!P){f=I(r,m,1);const e=I(r,m+1,3);if(m+=3,!e){const t=C(m)+4,e=r[t-4]|r[t-3]<<8,i=t+e;if(i>$){d&&S(0);break}c&&p(v+e),l.set(r.subarray(t,i),v),o.b=v+=e,o.p=m=8*i,o.f=f;continue}if(1==e)P=w,E=y,T=9,O=5;else if(2==e){const e=I(r,m,31)+257,i=I(r,m+10,15)+4,s=e+I(r,m+5,31)+1;m+=14;const h=new t(s),l=new t(19);for(let t=0;t<i;++t)l[n[t]]=I(r,m+3*t,7);m+=3*i;const a=b(l),o=(1<<a)-1,$=g(l,a,1);for(let t=0;t<s;){const e=$[I(r,m,o)];m+=15&e;const i=e>>>4;if(i<16)h[t++]=i;else{let e=0,s=0;for(16==i?(s=3+I(r,m,3),m+=2,e=h[t-1]):17==i?(s=3+I(r,m,7),m+=3):18==i&&(s=11+I(r,m,127),m+=7);s--;)h[t++]=e}}const c=h.subarray(0,e),u=h.subarray(e);T=b(c),O=b(u),P=g(c,T,1),E=g(u,O,1)}else S(1);if(m>k){d&&S(0);break}}c&&p(v+131072);const e=(1<<T)-1,i=(1<<O)-1;let L=m;for(;;L=m){const t=P[x(r,m)&e],n=t>>>4;if((m+=15&t)>k){d&&S(0);break}if(t||S(2),n<256)l[v++]=n;else{if(256==n){L=m,P=null;break}{let t=n-254;if(n>264){const e=n-257,i=s[e];t=I(r,m,(1<<i)-1)+a[e],m+=i}const e=E[x(r,m)&i],o=e>>>4;e||S(3),m+=15&e;let $=u[o];if(o>3){const t=h[o];$+=x(r,m)&(1<<t)-1,m+=t}if(m>k){d&&S(0);break}c&&p(v+131072);const g=v+t;for(;v<g;v+=4)l[v]=l[v-$],l[v+1]=l[v+1-$],l[v+2]=l[v+2-$],l[v+3]=l[v+3-$];v=g}}}o.l=P,o.p=L,o.b=v,o.f=f,P&&(f=1,o.m=T,o.d=E,o.n=O)}while(!f);return v==l.length?l:function(s,h,n){(null==h||h<0)&&(h=0),(null==n||n>s.length)&&(n=s.length);var r=new(2==s.BYTES_PER_ELEMENT?e:4==s.BYTES_PER_ELEMENT?i:t)(n-h);return r.set(s.subarray(h,n)),r}(l,0,v)};var E=new t(0);var T="undefined"!=typeof TextDecoder&&new TextDecoder;try{T.decode(E,{stream:!0}),1}catch(t){}return{inflateSync:function(t,e){return P(t,e)}}}();class i{constructor(t,e,i,s,h){this.atlasName=t,this.frame=e,this.orig=i,this.trim=s,this.rotate=h}}class s{constructor(){this.$items=[],this.$atlasConfigs={}}static getById(t){return s.$packageInstById[t]}static getByName(t){return s.$packageInstByName[t]}static addPackage(t){let e=new s;return e.create(t),s.$packageInstById[e.id]=e,s.$packageInstByName[e.name]=e,e.customId=t,e}static removePackage(t){let e=s.$packageInstById[t];e.dispose(),delete s.$packageInstById[e.id],null!=e.$customId&&delete s.$packageInstById[e.$customId],delete s.$packageInstByName[e.name]}static createObject(t,e,i){let h=s.getByName(t);return h?h.createObject(e,i):null}static createObjectFromURL(t,e){let i=s.getItemByURL(t);return i?i.owner.internalCreateObject(i,e):null}static getItemURL(t,e){let i=s.getByName(t);if(!i)return null;let h=i.$itemsByName[e];return h?`ui://${i.id}${h.id}`:null}static getItemByURL(t){let e=t.indexOf("//");if(-1==e)return null;let i,h=t.indexOf("/",e+2);if(-1==h){if(t.length>13){let e=t.substr(5,8);if(null!=(i=s.getById(e))){let e=t.substr(13);return i.getItemById(e)}}}else{let n=t.substr(e+2,h-e-2);if(null!=(i=s.getByName(n))){let e=t.substr(h+1);return i.getItemByName(e)}}return null}static getBitmapFontByURL(t){return s.$bitmapFonts[t]}static setStringsSource(e){s.$stringsSource={},t.utils.XmlParser.tryParse(e).children.forEach(t=>{if("string"==t.nodeName){let e=t.attributes.name,i=e.indexOf("-");if(-1==i)return;let h=t.text,n=e.substring(0,i),r=e.substring(i+1),l=s.$stringsSource[n];l||(l={},s.$stringsSource[n]=l),l[r]=h}})}static normalizeURL(t){if(null==t)return null;let e=t.indexOf("//");if(-1==e)return null;let i=t.indexOf("/",e+2);if(-1==i)return t;let h=t.substr(e+2,i-e-2),n=t.substr(i+1);return s.getItemURL(h,n)}create(e){this.$resKey=e;let h=t.utils.AssetLoader.resourcesPool[this.$resKey];if(h||(h=t.utils.AssetLoader.resourcesPool[`${this.$resKey}_fui`]),!h)throw new Error(`Resource '${this.$resKey}' not found, please make sure that you use "new fgui.utils.AssetLoader" to load resources instead of " PIXI.loaders.Loader".`);if(!h.data||!(h.data instanceof ArrayBuffer||h.data instanceof Uint8Array))throw new Error(`Resource '${this.$resKey}' is not a proper binary resource, please load it as binary format by calling yourLoader.add(name, url, { loadType:PIXI.loaders.Resource.LOAD_TYPE.XHR, xhrType: PIXI.loaders.Resource.XHR_RESPONSE_TYPE.BUFFER })`);this.decompressPackage(h.data);let n=this.getResDescriptor("sprites.bytes");n&&n.split(s.sep1).forEach((t,e)=>{if(e>=1&&t&&t.length){let e,h=t.split(s.sep2),n=h[0],r=parseInt(h[1]);if(r>=0)e=`atlas${r}`;else{let t=n.indexOf("_");e=-1==t?`atlas_${n}`:`atlas_${n.substr(0,t)}`}let l=new i(e);l.frame=new PIXI.Rectangle(parseInt(h[2]),parseInt(h[3]),parseInt(h[4]),parseInt(h[5])),l.rotate="1"==h[6]?6:0,l.orig=0!=l.rotate?new PIXI.Rectangle(0,0,l.frame.height,l.frame.width):null,this.$atlasConfigs[n]=l}}),n=this.getResDescriptor("package.xml");let r=t.utils.XmlParser.tryParse(n);this.$id=r.attributes.id,this.$name=r.attributes.name;let l=r.children[0].children;this.$itemsById={},this.$itemsByName={},l.forEach(e=>{let i=new t.PackageItem;if(i.type=t.ParsePackageItemType(e.nodeName),i.id=e.attributes.id,i.name=e.attributes.name,i.file=e.attributes.file,n=e.attributes.size){let t=n.split(s.sep0);i.width=parseInt(t[0]),i.height=parseInt(t[1])}switch(i.type){case 0:if("9grid"==(n=e.attributes.scale)){if(n=e.attributes.scale9grid){let t=n.split(s.sep0),h=new PIXI.Rectangle(parseInt(t[0]),parseInt(t[1]),parseInt(t[2]),parseInt(t[3]));i.scale9Grid=h,(n=e.attributes.gridTile)&&(i.tiledSlices=parseInt(n))}}else"tile"==n&&(i.scaleByTile=!0)}i.owner=this,this.$items.push(i),this.$itemsById[i.id]=i,null!=i.name&&(this.$itemsByName[i.name]=i)},this),this.$items.forEach(t=>{6==t.type&&(this.loadFont(t),s.$bitmapFonts[t.bitmapFont.id]=t.bitmapFont)},this)}decompressPackage(i){this.$resData={};var s=e.inflateSync(new Uint8Array(i));let h,n,r=t.utils.RawByte.decodeUTF8(s),l=0;for(;;){let t=r.indexOf("|",l);if(-1==t)break;h=r.substring(l,t),l=t+1,t=r.indexOf("|",l),n=parseInt(r.substring(l,t)),l=t+1,this.$resData[h]=r.substr(l,n),l+=n}}dispose(){this.$items.forEach(e=>{let i=e.texture;null!=i?(i.destroy(),PIXI.Texture.removeFromCache(i)):null!=e.frames?e.frames.forEach(t=>{(i=t.texture)&&(i.destroy(),PIXI.Texture.removeFromCache(i))}):null!=e.bitmapFont&&delete s.$bitmapFonts[e.bitmapFont.id];let h=this.$atlasConfigs[e.id];h&&t.utils.AssetLoader.destroyResource(`${this.$resKey}@${h.atlasName}`)},this),t.utils.AssetLoader.destroyResource(`${this.$resKey}`)}get id(){return this.$id}get name(){return this.$name}get customId(){return this.$customId}set customId(t){null!=this.$customId&&delete s.$packageInstById[this.$customId],this.$customId=t,null!=this.$customId&&(s.$packageInstById[this.$customId]=this)}createObject(t,e){let i=this.$itemsByName[t];return i?this.internalCreateObject(i,e):null}internalCreateObject(e,i=null){let h=4==e.type&&null!=i?new i:t.UIObjectFactory.newObject(e);return null==h?null:(s.$constructingObjects++,h.packageItem=e,h.constructFromResource(),s.$constructingObjects--,h)}getItemById(t){return this.$itemsById[t]}getItemByName(t){return this.$itemsByName[t]}getItemAssetByName(t){let e=this.$itemsByName[t];if(null==e)throw new Error(`Resource '${t}' not found`);return this.getItemAsset(e)}createSpriteTexture(t,e){let i=this.$itemsById[e.atlasName];if(null!=i){let s=this.getItemAsset(i);if(!s||!s.baseTexture)return null;e.texCacheID||(e.texCacheID=`${this.$resKey}@${e.atlasName}@${t}`);let h=PIXI.utils.TextureCache[e.texCacheID];return h||(h=new PIXI.Texture(s.baseTexture,e.frame,e.orig,e.trim,e.rotate),PIXI.Texture.addToCache(h,e.texCacheID)),h}return null}getItemAsset(e){switch(e.type){case 0:if(!e.decoded){e.decoded=!0;let t=this.$atlasConfigs[e.id];null!=t&&(e.texture=this.createSpriteTexture(e.id,t))}return e.texture;case 7:if(!e.decoded){e.decoded=!0;let i=null!=e.file&&e.file.length>0?e.file:`${e.id}.png`,s=`${this.$resKey}@${t.utils.StringUtil.getFileName(i)}`,h=t.utils.AssetLoader.resourcesPool[s];if(!h)throw new Error(`${s} not found in fgui.utils.AssetLoader.resourcesPool, please use new AssetLoader() to load assets instead of using new PIXI.loaders.Loader(). besides, AssetLoader is a sub-class from PIXI.loaders.Loader so they have the same usage.`);e.texture=h.texture,e.texture||(h=t.utils.AssetLoader.resourcesPool[`${this.$resKey}@${i.replace(".","_")}`],e.texture=h.texture)}return e.texture;case 3:return e.decoded=!1,null;case 6:return e.decoded||(e.decoded=!0,this.loadFont(e)),e.bitmapFont;case 2:return e.decoded||(e.decoded=!0,this.loadMovieClip(e)),e.frames;case 4:if(!e.decoded){e.decoded=!0;let i=this.getResDescriptor(`${e.id}.xml`),s=t.utils.XmlParser.tryParse(i);e.componentData=s,this.loadComponentChildren(e),this.loadComponentTranslation(e)}return e.componentData;default:return t.utils.AssetLoader.resourcesPool[`${this.$resKey}@${e.id}`]}}loadComponentChildren(e){let i=e.componentData.getChildNodes("displayList");null!=i&&i.length>0?(e.displayList=[],i[0].children.forEach(i=>{let h,n=i.nodeName,r=i.attributes.src;if(r){let l,a=i.attributes.pkg,o=null!=(l=a&&a!=e.owner.id?s.getById(a):e.owner)?l.getItemById(r):null;h=null!=o?new t.DisplayListItem(o,null):new t.DisplayListItem(null,n)}else h="text"==n&&"true"==i.attributes.input?new t.DisplayListItem(null,"inputtext"):new t.DisplayListItem(null,n);h.desc=i,e.displayList.push(h)})):e.displayList=[]}getResDescriptor(t){return this.$resData[t]}loadComponentTranslation(t){if(null==s.$stringsSource)return;let e,i,h,n,r,l,a=s.$stringsSource[this.id+t.id];null!=a&&t.displayList.forEach(t=>{i=t.desc,n=i.nodeName,r=i.attributes.id,(l=i.attributes.tooltips)&&null!=(e=a[`${r}-tips`])&&(i.attributes.tooltips=e);let s=i.getChildNodes("gearText");if((h=s&&s[0])&&(null!=(e=a[`${r}-texts`])&&(h.attributes.values=e),null!=(e=a[`${r}-texts_def`])&&(h.attributes.default=e)),"text"==n||"richtext"==n)null!=(e=a[r])&&(i.attributes.text=e),null!=(e=a[`${r}-prompt`])&&(i.attributes.prompt=e);else if("list"==n)i.children.forEach((t,i)=>{"item"==t.nodeName&&null!=(e=a[`${r}-${i}`])&&(t.attributes.title=e)});else if("component"==n){if(s=i.getChildNodes("Button"),h=s&&s[0])return null!=(e=a[r])&&(h.attributes.title=e),void(null!=(e=a[`${r}-0`])&&(h.attributes.selectedTitle=e));if(s=i.getChildNodes("Label"),h=s&&s[0])return void(null!=(e=a[r])&&(h.attributes.title=e));if(s=i.getChildNodes("ComboBox"),h=s&&s[0])return null!=(e=a[r])&&(h.attributes.title=e),void h.children.forEach((t,i)=>{"item"==t.nodeName&&null!=(e=a[`${r}-${i}`])&&(t.attributes.title=e)})}})}loadMovieClip(e){let i,h=t.utils.XmlParser.tryParse(this.getResDescriptor(`${e.id}.xml`));null!=(i=h.attributes.interval)&&(e.interval=parseInt(i)),null!=(i=h.attributes.swing)&&(e.swing="true"==i),null!=(i=h.attributes.repeatDelay)&&(e.repeatDelay=parseInt(i)),e.frames=[],h.children[0].children.forEach((h,n)=>{let r=new t.Frame,l=(i=h.attributes.rect).split(s.sep0),a=new PIXI.Rectangle(parseInt(l[0]),parseInt(l[1]),parseInt(l[2]),parseInt(l[3]));if((i=h.attributes.addDelay)&&(r.addDelay=parseInt(i)),e.frames.push(r),a.width<=0)return;i=(i=h.attributes.sprite)?`${e.id}_${i}`:`${e.id}_${n}`;let o=this.$atlasConfigs[i];null!=o&&(o.trim=a,r.texture=this.createSpriteTexture(i,o))})}loadFont(e){let i=new t.BitmapFont;i.id=`ui://${this.id}${e.id}`;let h,n,r=this.getResDescriptor(`${e.id}.fnt`),l=r.split(s.sep1),a={},o=!1,$=0,c=0,u=!1,d=!1,g=0,p=0,f=0,m=0;l.forEach(l=>{if(l&&l.length){let w=(r=t.utils.StringUtil.trim(l)).split(s.sep2);if(w.forEach(t=>{let e=t.split(s.sep3);a[e[0]]=e[1]}),"char"==(r=w[0])){let e=new t.BMGlyph;e.x=parseInt(a.x)||0,e.y=parseInt(a.y)||0,e.offsetX=parseInt(a.xoffset)||0,e.offsetY=parseInt(a.yoffset)||0,e.width=parseInt(a.width)||0,e.height=parseInt(a.height)||0,m=Math.max(e.height,m),e.advance=parseInt(a.xadvance)||0,null!=a.chnl&&(e.channel=parseInt(a.chnl),15==e.channel?e.channel=4:1==e.channel?e.channel=3:2==e.channel?e.channel=2:e.channel=1),o?null!=n&&(e.texture=new PIXI.Texture(n.baseTexture,new PIXI.Rectangle(e.x+g,e.y+p,e.width,e.height))):a.img&&null!=(h=this.$itemsById[a.img])&&(h.load(),e.width=h.width,e.height=h.height,e.texture=h.texture),o?e.lineHeight=f:(0==e.advance&&(e.advance=0==c?e.offsetX+e.width:c),e.lineHeight=e.offsetY<0?e.height:e.offsetY+e.height,$>0&&e.lineHeight<$&&(e.lineHeight=$)),i.glyphs[String.fromCharCode(0|+a.id)]=e}else if("info"==r){if(o=null!=a.face,a.size&&($=parseInt(a.size)),u="true"==a.resizable,d="true"==a.colored,o){let t=this.$atlasConfigs[e.id];if(null!=t){g=t.frame.x,p=t.frame.y;let e=this.$itemsById[t.atlasName];null!=e&&(n=this.getItemAsset(e))}}}else"common"==r&&(a.lineHeight&&(f=parseInt(a.lineHeight)),0==$?$=f:0==f&&(f=$),a.xadvance&&(c=parseInt(a.xadvance)))}}),0==$&&m>0&&($=m),i.ttf=o,i.size=$,i.resizable=u,i.colorable=d,e.bitmapFont=i}}s.$constructingObjects=0,s.$packageInstById={},s.$packageInstByName={},s.$bitmapFonts={},s.$stringsSource=null,s.sep0=",",s.sep1="\n",s.sep2=" ",s.sep3="=",t.UIPackage=s}(fgui||(fgui={})),function(t){!function(t){class e extends PIXI.Loader{constructor(t,e){super(t,e)}_onComplete(){e.addResources(this.resources),super._onComplete()}static get resourcesPool(){return e.$resources}static destroyResource(t){let i=e.$resources[t];i&&(i.isComplete||i.abort(),i.children=null,i.data=null,i.texture&&i.texture.destroy(),i.textures=null,i.xhr=null,e.$resources[t]=null,delete e.$resources[t])}static addResources(t){if(t)for(let i in t)e.$resources[i]=t[i]}}e.$resources={},t.AssetLoader=e}(t.utils||(t.utils={}))}(fgui||(fgui={})),function(t){!function(t){class e{constructor(t=0,e=0,i=0,s=0){this._raw=[],this.h=0,this.s=0,this.c=0,this.b=0,this.setColor(t,e,i,s)}get hue(){return this.h}get brightness(){return this.b}get contrast(){return this.c}get saturation(){return this.s}setColor(t,e,i,s){return this.reset().adjustColor(t,e,i,s)}reset(){return this.copy(e.IDENTITY_MATRIX)}adjustColor(t,e,i,s){return this.adjustHue(s),this.adjustContrast(e),this.adjustBrightness(t),this.adjustSaturation(i)}adjustBrightness(t){return 0==t||isNaN(t)?this:(this.b=t,t=this._cleanValue(t,255),this._multiplyMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0,0,0,0,0,1]),this)}adjustContrast(t){if(0==t||isNaN(t))return this;let i;this.c=t;return i=(t=this._cleanValue(t,100))<0?1+t/100*1:1*(i=0==(i=t%1)?e.DELTA_INDEX[t]:e.DELTA_INDEX[t<<0]*(1-i)+e.DELTA_INDEX[1+(t<<0)]*i)+1,this._multiplyMatrix([i/1,0,0,0,.5*(1-i),0,i/1,0,0,.5*(1-i),0,0,i/1,0,.5*(1-i),0,0,0,1,0,0,0,0,0,1]),this}adjustSaturation(t){if(0==t||isNaN(t))return this;this.s=t;let e=1+((t=this._cleanValue(t,100))>0?3*t/100:t/100);return this._multiplyMatrix([.3086*(1-e)+e,.6094*(1-e),.082*(1-e),0,0,.3086*(1-e),.6094*(1-e)+e,.082*(1-e),0,0,.3086*(1-e),.6094*(1-e),.082*(1-e)+e,0,0,0,0,0,1,0,0,0,0,0,1]),this}adjustHue(t){if(0==t||isNaN(t))return this;this.h=t,t=this._cleanValue(t,180)/180*Math.PI;let e=Math.cos(t),i=Math.sin(t);return this._multiplyMatrix([.213+.787*e+-.213*i,.715+-.715*e+-.715*i,.072+-.072*e+.928*i,0,0,.213+-.213*e+.143*i,.715+e*(1-.715)+.14*i,.072+-.072*e+-.283*i,0,0,.213+-.213*e+-.787*i,.715+-.715*e+.715*i,.072+.928*e+.072*i,0,0,0,0,0,1,0,0,0,0,0,1]),this}concat(t){return(t=this._fixMatrix(t)).length!=e.LENGTH?this:(this._multiplyMatrix(t),this)}clone(){return(new e).copy(this._raw)}toArray(){let t=[];for(let i=0,s=e.LENGTH;i<s;i++)t[i]=this._raw[i];return t}copy(t){let i=e.LENGTH;for(let e=0;e<i;e++)this._raw[e]=t[e];return this}_multiplyMatrix(t){let e,i,s,h=[];for(e=0;e<5;e++){for(i=0;i<5;i++)h[i]=this._raw[i+5*e];for(i=0;i<5;i++){let n=0;for(s=0;s<5;s++)n+=t[i+5*s]*h[s];this._raw[i+5*e]=n}}}_cleanValue(t,e){return Math.min(e,Math.max(-e,t))}_fixMatrix(t){return t instanceof e&&(t=t.toArray()),t.length<e.LENGTH?t=t.slice(0,t.length).concat(e.IDENTITY_MATRIX.slice(t.length,e.LENGTH)):t.length>e.LENGTH&&(t=t.slice(0,e.LENGTH)),t}}e.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],e.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],e.LENGTH=e.IDENTITY_MATRIX.length,t.ColorMatrix=e}(t.utils||(t.utils={}))}(fgui||(fgui={})),function(t){!function(e){e.DragIndicator=class{constructor(){this.$agent=new t.GLoader,this.$agent.draggable=!0,this.$agent.touchable=!1,this.$agent.setSize(100,100),this.$agent.setPivot(.5,.5,!0),this.$agent.align="center",this.$agent.verticalAlign=1,this.$agent.sortingOrder=1e6,this.$agent.on(t.DragEvent.END,this.$dragEnd,this)}get dragAgent(){return this.$agent}get isDragging(){return null!=this.$agent.parent}get sourceObject(){return this.$sourceObject}startDrag(e,i,s,h=-1){if(this.isDragging)return;this.$sourceObject=e,this.$sourceData=s,this.$agent.url=i,t.GRoot.inst.addChild(this.$agent);const n=t.GRoot.inst.globalToLocal(t.GRoot.globalMouseStatus.mouseX,t.GRoot.globalMouseStatus.mouseY);this.$agent.setXY(n.x,n.y),this.$agent.startDrag(h)}cancel(){null!=this.$agent.parent&&(this.$agent.stopDrag(),t.GRoot.inst.removeChild(this.$agent),this.$sourceData=null)}$dragEnd(e){if(!this.isDragging)return;t.GRoot.inst.removeChild(this.$agent);let i=this.$sourceData;this.$sourceData=null;let s=t.GRoot.inst.getObjectUnderPoint(e.data.global.x,e.data.global.y);for(;null!=s;){if(s.hasListener(t.DragEvent.DROP))return s.requestFocus(),e.currentTarget=s.displayObject,void s.emit(t.DragEvent.DROP,e,i);s=s.parent}}}}(t.utils||(t.utils={}))}(fgui||(fgui={})),function(t){!function(t){t.Margin=class{constructor(){this.left=0,this.right=0,this.top=0,this.bottom=0}parse(t){if(!t)return void(this.left=this.right=this.top=this.bottom=0);let e=t.split(",");if(1==e.length){let t=parseInt(e[0]);this.left=this.right=this.top=this.bottom=t}else this.top=parseInt(e[0]),this.bottom=parseInt(e[1]),this.left=parseInt(e[2]),this.right=parseInt(e[3])}copy(t){this.top=t.top,this.bottom=t.bottom,this.left=t.left,this.right=t.right}}}(t.utils||(t.utils={}))}(fgui||(fgui={})),function(t){!function(t){class e{static inRange(t,e,i){return e<=t&&t<=i}static decodeUTF8(t){let i,s=0,h="",n=0,r=0,l=0,a=0;for(;t.length>s;){let o=t[s++];if(-1==o)i=0!=r?65533:-1;else if(0==r)e.inRange(o,0,127)?i=o:(e.inRange(o,194,223)?(r=1,a=128,n=o-192):e.inRange(o,224,239)?(r=2,a=2048,n=o-224):e.inRange(o,240,244)&&(r=3,a=65536,n=o-240),n*=Math.pow(64,r),i=null);else if(e.inRange(o,128,191))if(l+=1,n+=(o-128)*Math.pow(64,r-l),l!==r)i=null;else{let t=n,s=a;n=0,r=0,l=0,a=0,i=e.inRange(t,s,1114111)&&!this.inRange(t,55296,57343)?t:o}else n=0,r=0,l=0,a=0,s--,i=65533;null!==i&&-1!==i&&(i<=65535?i>0&&(h+=String.fromCharCode(i)):(i-=65536,h+=String.fromCharCode(55296+(i>>10&1023)),h+=String.fromCharCode(56320+(1023&i))))}return h}}t.RawByte=e}(t.utils||(t.utils={}))}(fgui||(fgui={})),function(t){!function(t){class e{constructor(){this.$readPos=0,this.smallFontSize=12,this.normalFontSize=14,this.largeFontSize=16,this.defaultImgWidth=0,this.defaultImgHeight=0,this.$handlers={url:this.onTag_URL,img:this.onTag_IMG,b:this.onTag_Simple,i:this.onTag_Simple,u:this.onTag_Simple,sup:this.onTag_Simple,sub:this.onTag_Simple,color:this.onTag_COLOR,font:this.onTag_FONT,size:this.onTag_SIZE}}onTag_URL(t,e,i){if(e)return"</a>";if(null!=i)return`<a href="${i}" target="_blank">`;return`<a href="${this.getTagText()}" target="_blank">`}onTag_IMG(t,e,i){if(e)return null;{let t=this.getTagText(!0);return t?this.defaultImgWidth?`<img src="${t}" width="${this.defaultImgWidth}" height="${this.defaultImgHeight}"/>`:`<img src="${t}"/>`:null}}onTag_Simple(t,e,i){return e?`</${t}>`:`<${t}>`}onTag_COLOR(t,e,i){return e?"</font>":`<font color="${i}">`}onTag_FONT(t,e,i){return e?"</font>":`<font face="${i}">`}onTag_SIZE(t,e,i){return e?"</font>":("normal"==i?i=`${this.normalFontSize}`:"small"==i?i=`${this.smallFontSize}`:"large"==i?i=`${this.largeFontSize}`:i.length&&"+"==i.charAt(0)?i=`${this.smallFontSize+parseInt(i.substr(1))}`:i.length&&"-"==i.charAt(0)&&(i=`${this.smallFontSize-parseInt(i.substr(1))}`),`<font size="${i}">`)}getTagText(t=!1){let e=this.$text.indexOf("[",this.$readPos);if(-1==e)return null;let i=this.$text.substring(this.$readPos,e);return t&&(this.$readPos=e),i}parseStyle(t){return[]}}e.inst=new e,t.UBBParser=e}(t.utils||(t.utils={}))}(fgui||(fgui={}));